{"version":3,"sources":["webpack:///./js/items.js","webpack:///./components/views/character/dnd-character-builder-equipment-item-detail.js","webpack:///./components/views/character/dnd-character-builder-equipment.js"],"names":["renderer","renderSelection","item","rootEl","data","makeSmall","hasParsed","noDisplay","type","category","undefined","entries","window","itemTypeList","j","length","push","property","properties","split","itemPropertyList","k","armor","resist","stealth","strength","scfType","adjustItem","wrap","querySelector","innerHTML","classList","add","value","weight","tier","rarity","reqAttune","weaponCategory","damages","i","damage","isLast","roll","dmgTypeToFull","dmg1","dmgType","ac","speed","capacity","carryingcapacity","append","indexOf","prop","a","name","dmg2","range","reload","entryList","renderStack","recursiveEntryRender","join","toLowerCase","DndCharacterBuilderEquipmentItemDetail","isEditMode","Boolean","hasRenderedOutput","hasAC","armorAC","Number","isArmor","isMartial","weaponMagicModifier","itemRarity","String","itemName","itemWeight","weaponProperties","Array","itemResist","itemQuantity","Object","storedItem","itemType","super","this","itemTypes","rarityTypes","damageTypes","resistTypes","weaponPropertyOptions","weaponPropertyValues","connectedCallback","editModeHandler","e","detail","addEventListener","disconnectedCallback","removeEventListener","console","error","itemRef","lookupFailed","$","renderedOutput","_getItemType","weapon","parseInt","genericBonus","propStr","props","map","propObj","find","option","trim","filter","canHaveResist","canHaveQuantity","quantity","canHaveSpell","ITEM_TYPE_JSON_TO_ABV","newType","root","isEquipped","isAttuned","hasQuantity","typeVal","key","rollDamageIndexAttr","getAttribute","rollDamageIndex","splice","parsedMod","isNaN","propCodes","bind","parsedAC","parsedWeight","parseFloat","parsedQuantity","bools","bool","customElements","define","DndCharacterBuilderEquipment","inventory","character","expandedItems","expandedIds","uniqueId","openedItemID","grid","closeItemDetails","scrollTo","originalScrollHeight","scrollY","characterChangeHandler","updateFromCharacter","setTimeout","notifyResize","ready","draggedItem","rowDetailsRenderer","rowData","detailsOpened","firstElementChild","detailEl","document","createElement","unique","Date","now","appendChild","draggedItems","dropMode","dropTargetItem","isChild","container","removeId","itemCounter","dropLocation","children","dropTargetId","id","finalAddIndex","substring","lastIndexOf","parentItemREF","dataProvider","params","callback","startIndex","page","pageSize","parentItem","slice","clearCache","openedItem","openItemDetails","dispatchEvent","CustomEvent","bubbles","composed","model","__data","stayClosed","detailsOpenedItems","checkboxEl","remove","preventDefault","stopPropagation","itemModel","checkbox","target","_flashCheckbox","log","getEventContext","newQuantity"],"mappings":"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","file":"12.bundle.js","sourcesContent":["import EntryRenderer from '../util/entryrender.js';\r\nimport Parser from '../util/Parser.js';\r\nimport { cloneDeep, utils_makeRoller } from '../js/utils.js';\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"margin-bottom_small\">\r\n\t\t\t<span class=\"type\"></span><span class=\"rarity\"></span>\r\n\t\t\t<span class=\"attunement\"></span>\r\n\t\t</div>\r\n\t\t<div class=\"margin-bottom_small\">\r\n\t\t\t<span class=\"value\"></span><span class=\"weight\"></span>\r\n\t\t</div>\r\n\t\t<div class=\"margin-bottom_small\">\r\n\t\t\t<span class=\"damage\"></span>\r\n\t\t\t<span class=\"damageType\"></span>\r\n\t\t\t<span class=\"properties\"></span>\r\n\t\t</div>\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nconst renderer = new EntryRenderer();\r\nfunction renderSelection(item, rootEl, data, makeSmall) {\r\n\tadjustItem(item);\r\n\tconst wrap = rootEl.querySelector(\".selection-wrapper\") || rootEl;\r\n\twrap.innerHTML = stats_wrapper;\r\n\r\n\tif (makeSmall) {\r\n\t\twrap.querySelector('.stats-wrapper').classList.add('small');\r\n\t}\r\n\t\r\n\t// const sourceEl = rootEl.querySelector(\".stats-wrapper .source\")\r\n\t// const source = item.source;\r\n\t// const sourceFull = Parser.sourceJsonToFull(source);\r\n\t// sourceEl.innerHTML = (`<span class=\"source${item.source}\">${sourceFull},</span> page ${item.page}`);\r\n\r\n\trootEl.querySelector(\".stats-wrapper .value\").innerHTML = (item.value ? item.value+(item.weight ? \", \" : \"\") : \"\");\r\n\trootEl.querySelector(\".stats-wrapper .weight\").innerHTML = (item.weight ? item.weight+(item.weight == 1 ? \" lb.\" : \" lbs.\") : \"\");\r\n\trootEl.querySelector(\".stats-wrapper .rarity\").innerHTML = ((item.tier ? \", \"+item.tier : \"\")+(item.rarity ? \", \"+item.rarity : \"\"));\r\n\trootEl.querySelector(\".stats-wrapper .attunement\").innerHTML = (item.reqAttune ? item.reqAttune : \"\");\r\n\trootEl.querySelector(\".stats-wrapper .type\").innerHTML = (item.typeText);\r\n\r\n\trootEl.querySelector(\".stats-wrapper .damage\").innerHTML = (\"\");\r\n\trootEl.querySelector(\".stats-wrapper .damageType\").innerHTML = (\"\");\r\n\tconst type = item.type || \"\";\r\n\tif (item.weaponCategory) {\r\n\t\tif (item.damages && item.damages.length) {\r\n\t\t\tfor (let i = 0; i < item.damages.length; i++) {\r\n\t\t\t\tconst damage = item.damages[i];\r\n\t\t\t\tconst isLast = i === item.damages.length - 1;\r\n\t\t\t\tif (damage.roll && damage.type) {\r\n\t\t\t\t\trootEl.querySelector(\".stats-wrapper .damage\").innerHTML += `<span>${utils_makeRoller(damage.roll)} ${Parser.dmgTypeToFull(damage.type)}</span>${isLast ? '': ' + '}`\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(item.dmg1) rootEl.querySelector(\".stats-wrapper .damage\").innerHTML = (utils_makeRoller(item.dmg1));\r\n\t\t\tif(item.dmgType) rootEl.querySelector(\".stats-wrapper .damageType\").innerHTML = (Parser.dmgTypeToFull(item.dmgType));\r\n\t\t}\r\n\t} else if (type === \"LA\" ||type === \"MA\"|| type === \"HA\") {\r\n\t\trootEl.querySelector(\".stats-wrapper .damage\").innerHTML = (\"AC \"+item.ac+(type === \"LA\" ? \" + Dex\" : type === \"MA\" ? \" + Dex (max 2)\" : \"\"));\r\n\t} else if (type === \"S\") {\r\n\t\trootEl.querySelector(\".stats-wrapper .damage\").innerHTML = (\"AC +\"+item.ac);\r\n\t} else if (type === \"MNT\" || type === \"VEH\") {\r\n\t\tconst speed = item.speed;\r\n\t\tconst capacity = item.carryingcapacity;\r\n\t\tif (speed) rootEl.querySelector(\".stats-wrapper .damage\").append(\"Speed=\"+speed);\r\n\t\tif (speed && capacity) rootEl.querySelector(\".stats-wrapper .damage\").append(type === \"MNT\" ? \", \" : \"<br/>\");\r\n\t\tif (capacity) {\r\n\t\t\trootEl.querySelector(\".stats-wrapper .damage\").append(\"Carrying Capacity=\"+capacity);\r\n\r\n\t\t\tif (capacity.indexOf(\"ton\") === -1 && capacity.indexOf(\"passenger\") === -1) {\r\n\t\t\t\trootEl.querySelector(\".stats-wrapper .damage\").append(capacity == 1 ? \" lb.\" : \" lbs.\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trootEl.querySelector(\".stats-wrapper .properties\").innerHTML = (\"\");\r\n\tif (item.property) {\r\n\t\tconst properties = item.property.split(\",\");\r\n\t\tfor (let i = 0; i < properties.length; i++) {\r\n\t\t\tconst prop = properties[i];\r\n\t\t\tlet a = window.itemPropertyList[prop].name;\r\n\t\t\tif (prop === \"V\" && item.dmg2) a = `${a} (${item.dmg2})`;\r\n\t\t\tif (prop === \"T\" || prop === \"A\" || prop === \"AF\") a = `${a} (${item.range}ft.)`;\r\n\t\t\tif (prop === \"RLD\") a = `${a} (${item.reload} shots)`;\r\n\t\t\ta = (i > 0 ? \", \" : item.dmg1 ? \"- \" : \"\") + a;\r\n\t\t\trootEl.querySelector(\".stats-wrapper .properties\").append(a);\r\n\t\t}\r\n\t}\r\n\r\n\tconst entryList = {type: \"entries\", entries: item.entries};\r\n\tconst renderStack = [];\r\n\trenderer.recursiveEntryRender(entryList, renderStack, 1);\r\n\trootEl.querySelector(\".stats-wrapper .text\").innerHTML = (utils_makeRoller(renderStack.join(\"\")).split(item.name.toLowerCase()).join(\"<i>\"+item.name.toLowerCase()+\"</i>\"));\r\n}\r\n\r\nfunction adjustItem(item) {\r\n\tif (item.hasParsed) {\r\n\t\treturn;\r\n\t}\r\n\titem.hasParsed = true;\r\n\tif (item.noDisplay) {\r\n\t\treturn;\r\n\t}\r\n\tif (item.type === \"GV\") {\r\n\t\titem.category = \"Generic Variant\";\r\n\t}\r\n\tif (item.category === undefined) {\r\n\t\titem.category = \"Other\";\r\n\t}\r\n\tif (item.entries === undefined) {\r\n\t\titem.entries = [];\r\n\t} else {\r\n\t\titem.entries = cloneDeep(item.entries);\r\n\t}\r\n\tif (item.type && window.itemTypeList[item.type]) {\r\n\t\tfor (let j = 0; j < window.itemTypeList[item.type].entries.length; j++) {\r\n\t\t\titem.entries.push(window.itemTypeList[item.type].entries[j]);\r\n\t\t}\r\n\t}\r\n\tif (item.property) {\r\n\t\tconst properties = item.property.split(\",\");\r\n\t\tfor (let j = 0; j < properties.length; j++) {\r\n\t\t\tif (window.itemPropertyList[properties[j]].entries) {\r\n\t\t\t\tfor (let k = 0; k < window.itemPropertyList[properties[j]].entries.length; k++) {\r\n\t\t\t\t\titem.entries.push(window.itemPropertyList[properties[j]].entries[k]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//The following could be encoded in JSON, but they depend on more than one JSON property; maybe fix if really bored later\r\n\tif (item.armor) {\r\n\t\tif (item.resist) {\r\n\t\t\titem.entries.push(\"You have resistance to \"+item.resist+\" damage while you wear this armor.\");\r\n\t\t}\r\n\t\tif (item.armor && item.stealth) {\r\n\t\t\titem.entries.push(\"The wearer has disadvantage on Stealth (Dexterity) checks.\");\r\n\t\t}\r\n\t\tif (item.type === \"HA\" && item.strength) {\r\n\t\t\titem.entries.push(\"If the wearer has a Strength score lower than \" + item.strength + \", their speed is reduced by 10 feet.\");\r\n\t\t}\r\n\t} else if (item.resist) {\r\n\t\tif (item.type === \"P\") {\r\n\t\t\titem.entries.push(\"When you drink this potion, you gain resistance to \"+item.resist+\" damage for 1 hour.\");\r\n\t\t}\r\n\t\tif (item.type === \"RG\") {\r\n\t\t\titem.entries.push(\"You have resistance to \"+item.resist+\" damage while wearing this ring.\");\r\n\t\t}\r\n\t}\r\n\tif (item.type === \"SCF\") {\r\n\t\tif (item.scfType === \"arcane\") {\r\n\t\t\titem.entries.push(\"An arcane focus is a special item designed to channel the power of arcane spells. A sorcerer, warlock, or wizard can use such an item as a spellcasting focus, using it in place of any material component which does not list a cost.\");\r\n\t\t}\r\n\t\tif (item.scfType === \"druid\") {\r\n\t\t\titem.entries.push(\"A druid can use such a druidic focus as a spellcasting focus, using it in place of any material component that does not have a cost.\");\r\n\t\t}\r\n\t\tif (item.scfType === \"holy\") {\r\n\t\t\titem.entries.push(\"A holy symbol is a representation of a god or pantheon.\");\r\n\t\t\titem.entries.push(\"A cleric or paladin can use a holy symbol as a spellcasting focus, using it in place of any material components which do not list a cost. To use the symbol in this way, the caster must hold it in hand, wear it visibly, or bear it on a shield.\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport { renderSelection };","import { PolymerElement, html } from \"@polymer/polymer\";\nimport {\n  setItem\n} from \"../../../util/charBuilder\";\nimport { getEditModeChannel, isEditMode } from \"../../../util/editMode\";\nimport { renderSelection } from \"../../../js/items\";\nimport { DAMAGE_TYPES, RARITY_TYPES } from \"../../../util/consts\";\nimport { findInPath, util_capitalizeAll } from \"../../../js/utils\";\nimport \"@vaadin/vaadin-text-field/vaadin-text-field\";\nimport \"@vaadin/vaadin-text-field/vaadin-integer-field\";\nimport \"@vaadin/vaadin-text-field/vaadin-text-area\";\nimport Parser from '../../../util/Parser';\n\n\n//// BOONS\n// Resistance\n// DC+\n// Proficiency?\n// Spells known\nclass DndCharacterBuilderEquipmentItemDetail extends PolymerElement {\n  \n  static get properties() {\n    return {\n      isEditMode: {\n        type: Boolean,\n        value: false\n      },\n      hasRenderedOutput: {\n        type: Boolean,\n        value: false\n      },\n      hasAC: {\n        type: Boolean,\n        value: false\n      },\n      armorAC: {\n        type: Number,\n        value: 0\n      },\n      isArmor: {\n        type: Boolean,\n        value: false\n      },\n      isMartial: {\n        type: Boolean,\n        value: false\n      },\n      weaponMagicModifier: {\n        type: Number,\n        value: 0\n      },\n      itemRarity: {\n        type: String,\n      },\n      itemName: {\n        type: String,\n      },\n      itemWeight: {\n        type: Number,\n        value: 0\n      },\n      weaponProperties: {\n        type: Array,\n      },\n      itemResist: {\n        type: String,\n      },\n      itemQuantity: {\n        type: Number,\n        value: 0\n      },\n      item: {\n        type: Object\n      },\n      storedItem: {\n        type: Object\n      },\n      itemType: {\n        type: String,\n        value: ''\n      }\n    };\n  }\n\n  static get observers() {\n    return [\n      '_itemChanged(item)'\n    ]\n  }\n\n  constructor() {\n    super();\n\n    this.itemTypes = [\n      'Currency',\n      'Armor (Light)',\n      'Armor (Medium)',\n      'Armor (Heavy)',\n      'Melee Weapon',\n      'Ranged Weapon',\n      'Shield',\n      'Adventuring Gear',\n      'Ammunition',\n      'Artisan Tool',\n      'Explosive',\n      'Gaming Set',\n      'Instrument',\n      'Mount',\n      'Potion',\n      'Rod',\n      'Ring',\n      'Scroll',\n      'Spellcasting Focus',\n      'Tool',\n      'Tack and Harness',\n      'Trade Good',\n      'Vehicle',\n      'Wand'\n    ];\n\n    this.rarityTypes = RARITY_TYPES;\n    this.damageTypes = DAMAGE_TYPES;\n    this.resistTypes = ['<None>', ...DAMAGE_TYPES];\n    this.weaponPropertyOptions = [\n      { name: 'Two-Handed', value: '2H' },\n      { name: 'Ammunition', value: 'A' },\n      { name: 'Finesse', value: 'F' },\n      { name: 'Heavy', value: 'H' },\n      { name: 'Light', value: 'L' },\n      { name: 'Loading', value: 'LD' },\n      { name: 'Reach', value: 'R' },\n      { name: 'Reload', value: 'RLD' },\n      { name: 'Special', value: 'S' },\n      { name: 'Thrown', value: 'T' },\n      { name: 'Versatile', value: 'V' },\n    ]\n    this.weaponPropertyValues = [\n      'Two-Handed',\n      'Ammunition',\n      'Finesse',\n      'Heavy',\n      'Light',\n      'Loading',\n      'Reach',\n      'Reload',\n      'Special',\n      'Thrown',\n      'Versatile'\n    ]\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.editModeHandler = (e) => {\n      this.isEditMode = e.detail.isEditMode;\n    }\n    getEditModeChannel().addEventListener('editModeChange', this.editModeHandler);\n    this.isEditMode = isEditMode();\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n\n    getEditModeChannel().removeEventListener('editModeChange', this.editModeHandler);\n  }\n\n  _itemChanged() {\n    console.error('itemDetail:', this.item);\n\n    if (this.item.itemRef && !this.item.lookupFailed) {\n      this.hasRenderedOutput = true;\n      renderSelection(this.item, this.$.renderedOutput, undefined, true);\n    } else {\n      this.hasRenderedOutput = false;\n    }\n    this.itemType = this._getItemType();\n    this.hasAC = this.item.type === 'S' || !!this.item.armor;\n    if (this.hasAC) {\n      this.armorAC = this.item.ac;\n    }\n    this.isArmor = !!this.item.armor;\n    this.isMartial = this.item.weaponCategory === 'Martial';\n    if (this.item.weapon) {\n      this.weaponMagicModifier = parseInt(this.item.genericBonus, 10);\n      const propStr = this.item.property;\n      if (propStr) {\n        const props = propStr.split(',').map(prop => {\n          const propObj = this.weaponPropertyOptions.find((option) => option.value === prop.trim());\n          if (propObj) {\n            return propObj.name;\n          }\n        }).filter(prop => !!prop);\n        this.weaponProperties = props;\n        if (!this.item.damages) {\n          if (this.item.dmg1) {\n            this.item.storedItem.damages = [{roll: this.item.dmg1, type: util_capitalizeAll(Parser.dmgTypeToFull(this.item.dmgType))}];\n          } else {\n            this.item.storedItem.damages = [];\n          }\n        }\n      }\n    }\n    this.itemRarity = this.item.rarity;\n    this.itemName = this.item.name;\n    this.itemWeight = this.item.weight;\n    this.canHaveResist = this.item.armor || this.item.type === 'P' || this.item.type === 'RG';\n    this.itemResist = this.item.resist;\n    this.canHaveQuantity = this.item.type === 'P' || this.item.type === 'A' || this.item.type === 'EXP';\n    this.itemQuantity = this.item.quantity;\n    this.canHaveSpell = this.item.type === 'SC';\n\n    if (this.item.storedItem) {\n      this.storedItem = this.item.storedItem;\n    }\n  }\n\n  _getItemType() {\n    if (this.item) {\n      return Parser.ITEM_TYPE_JSON_TO_ABV[this.item.type];  \n    }\n    return '';\n  }\n\n  _selectItemType() {\n    const newType = this.root.querySelector('#typeSelect').value\n    this.storedItem.armor = false;\n    this.storedItem.weapon = false;\n    this.storedItem.type = '';\n    this.storedItem.isEquipped = false;\n    this.storedItem.isAttuned = false;\n\n    switch (newType) {\n      case 'Armor (Light)':\n        this.storedItem.armor = true;\n        this.storedItem.weaponCategory = null;\n        this.storedItem.type = 'LA';\n        break;\n      case 'Armor (Medium)':\n        this.storedItem.armor = true;\n        this.storedItem.weaponCategory = null;\n        this.storedItem.type = 'MA';\n        break;\n      case 'Armor (Heavy)':\n        this.storedItem.armor = true;\n        this.storedItem.weaponCategory = null;\n        this.storedItem.type = 'HA';\n        break;\n      case 'Ranged Weapon':\n        this.storedItem.weapon = true;\n        this.storedItem.weaponCategory = 'Simple';\n        this.storedItem.type = 'R';\n        this.storedItem.resist = null;\n        break;\n      case 'Melee Weapon':\n        this.storedItem.weapon = true;\n        this.storedItem.weaponCategory = 'Simple';\n        this.storedItem.type = 'M';\n        this.storedItem.resist = null;\n        break;\n      case 'Shield':\n        this.storedItem.type = 'S';\n        this.storedItem.weaponCategory = null;\n        this.storedItem.ac = 2;\n        this.storedItem.resist = null;\n        break;\n      case 'Adventuring Gear':\n        this.storedItem.weaponCategory = null;\n        this.storedItem.type = 'G';\n        this.storedItem.resist = null;\n        break;\n      case 'Currency':\n        this.storedItem.weaponCategory = null;\n        this.storedItem.type = '$'\n        this.storedItem.resist = null;\n        this.storedItem.quantity = 1;\n        this.storedItem.hasQuantity = true;\n        break;\n      default:\n        const typeVal = Object.entries(Parser.ITEM_TYPE_JSON_TO_ABV).find(([key, value]) => value === newType);\n        if (typeVal) {\n          this.storedItem.type = typeVal[0];\n        }\n        if (newType !== 'P' || newType !== 'RG') {\n          this.storedItem.resist = null;\n        }\n        break;\n    }\n    if (!(this.storedItem.type === 'P' || this.storedItem.type === 'A' || this.storedItem.type === 'EXP' || this.storedItem.type === '$')) {\n      this.storedItem.hasQuantity = false;\n    }\n    setItem(this.item);\n  }\n\n  _updateItem() {\n    setItem(this.item);\n  }\n\n  _addDamage() {\n    if (!this.storedItem.damages) {\n      this.storedItem.damages = [];\n    }\n    this.storedItem.damages.push({roll: '', type: ''});\n    setItem(this.item);\n  }\n\n  _removeDamage(e) {\n    const rollDamageEl = findInPath('.roll__damage', e);\n    const rollDamageIndexAttr = rollDamageEl.getAttribute('index');\n    const rollDamageIndex = parseInt(rollDamageIndexAttr, 10);\n    this.storedItem.damages.splice(rollDamageIndex, 1);\n    setItem(this.item);\n  }\n\n  _changeWeaponType() {\n    if (this.item.weapon) {\n      if (this.isMartial) {\n        this.storedItem.weaponCategory = 'Martial';\n      } else {\n        this.storedItem.weaponCategory = 'Simple';\n      }\n      setItem(this.item);\n    }\n  }\n\n  _weaponMagicModifierChange() {\n    let parsedMod = parseInt(this.weaponMagicModifier, 10);\n\n    if (isNaN(parsedMod)) {\n      parsedMod = 0;\n    }\n    this.storedItem.genericBonus = parsedMod > 0 ? `+${parsedMod}` : parsedMod;\n    setItem(this.item);\n  }\n\n  _itemRarityChange() {\n    if (this.itemRarity) {\n      this.storedItem.rarity = this.itemRarity;\n      setItem(this.item);\n    }\n  }\n\n  _itemNameChange() {\n    if (this.itemName) {\n      this.storedItem.name = this.itemName;\n      setItem(this.item);\n    }\n  }\n\n  _addWeaponProperty() {\n    return ((props) => {\n      if (props && props.length) {\n        const propCodes = props.map((prop) => {\n          const propObj = this.weaponPropertyOptions.find((option) => option.name === prop.trim());\n          if (propObj) {\n            return propObj.value;\n          }\n        }).filter(prop => !!prop);\n        this.storedItem.property = propCodes.join(',');\n        setItem(this.item);\n      }\n    }).bind(this);\n  }\n\n  _armorACChange() {\n    let parsedAC = parseInt(this.armorAC, 10);\n\n    if (isNaN(parsedAC)) {\n      parsedAC = 0;\n    }\n    this.storedItem.ac = parsedAC;\n    setItem(this.item);\n  }\n\n  _itemWeightChange() {\n    let parsedWeight = parseFloat(this.itemWeight, 10);\n\n    if (isNaN(parsedWeight)) {\n      parsedWeight = 0;\n    }\n    this.storedItem.weight = parsedWeight;\n    setItem(this.item);\n\n  }\n\n  _itemResistChange() {\n    if (this.itemResist) {\n      this.storedItem.resist = this.itemResist === '<None>' ? null : this.itemResist;\n      setItem(this.item);\n    }\n  }\n\n  _itemQuantityChange() {\n    let parsedQuantity = parseInt(this.itemQuantity, 10);\n\n    if (isNaN(parsedQuantity)) {\n      parsedQuantity = 0;\n    }\n    this.storedItem.quantity = parsedQuantity;\n    this.storedItem.hasQuantity = true;\n    setItem(this.item);\n  }\n\n  _or(...bools) {\n    for (let bool of bools) {\n      if (bool) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  static get template() {\n    return html`\n      <style include=\"material-styles my-styles\"></style>\n      <style>\n        :host {}\n        [hidden] {\n          display: none !important;\n        }\n\n        .edit__wrap {\n          margin-right: -10px;\n        }\n        .edit__name {\n          width: calc(65% - 10px);\n          padding-top: 0;\n        }\n        .edit__notes {\n          width: calc(100% - 10px);\n          min-height: 200px;\n        }\n        .edit__checkboxes {\n          display: flex;\n          flex-direction: column;\n          margin: 10px 10px 0 0;\n        }\n        .edit__weapon {\n          margin-right: 10px;\n        }\n\n        .damage_heading {\n          margin: 16px 0 0px;\n          font-size: 16px;\n          color: var(--mdc-theme-secondary);\n        }\n\n        .roll__damages {\n          display: flex;\n          flex-direction: column;\n        }\n        .roll__damage {\n          display: flex;\n        }\n        .roll__damage vaadin-text-field,\n        .roll__damage vaadin-select {\n          max-width: 100%;\n        }\n        .roll__damage-roll--edit,\n        .roll__damage-type--edit {\n          width: calc(50% - 40px);\n        }\n        .roll__damage-roll--edit {\n          margin-right: 16px;\n        }\n        .roll__damage-remove {\n          margin: auto 16px 4px;\n        }\n\n        dnd-switch {\n          margin: 10px auto 0;\n          display: block;\n        }\n\n        h2 {\n          margin-top: 0;\n          font-size: 16px;\n          font-weight: bold;\n          margin-bottom: 8px;\n        }\n\n        vaadin-checkbox {\n          width: fit-content;\n        }\n\n        vaadin-select {\n          max-width: calc(50% - 12px);\n        }\n        vaadin-number-field,\n        vaadin-integer-field {\n          width: calc(33% - 10px);\n        }\n        vaadin-text-field,\n        vaadin-text-area,\n        vaadin-integer-field,\n        vaadin-number-field,\n        vaadin-select {\n          margin-right: 10px;\n        }\n\n        .margin-bottom_large {\n          margin-bottom: 0 !important;\n        }\n\n        @media(min-width: 921px) {\n        }\n      </style>\n\n      <div>\n        <div hidden$=\"[[isEditMode]]\">\n          <div hidden$=\"[[!hasRenderedOutput]]\">\n            <h2>[[item.name]]</h4>\n            <div>[[item.notes]]</div>\n            <div hidden$=\"[[item.hideRef]]\" id=\"renderedOutput\"></div>\n          </div>\n\n          <div hidden$=\"[[hasRenderedOutput]]\">\n            <h2>[[item.name]]</h4>\n            <div>[[item.notes]]</div>\n          </div>\n        </div>\n\n        <template is=\"dom-if\" if=\"[[isEditMode]]\">\n          <div class=\"edit__wrap\">\n            <vaadin-text-field class=\"edit__name\" theme=\"label--secondary\" value=\"{{itemName}}\" label=\"Name\" on-change=\"_itemNameChange\"></vaadin-text-field>\n            <vaadin-number-field theme=\"label--secondary\" has-controls value=\"{{itemWeight}}\" label=\"Weight\" min=\"0\" on-change=\"_itemWeightChange\"></vaadin-number-field>\n\n            <vaadin-select id=\"typeSelect\" value=\"[[itemType]]\" on-change=\"_selectItemType\" label=\"Type\" >\n              <template>\n                <vaadin-list-box>\n                  <template is=\"dom-repeat\" items=\"[[itemTypes]]\">\n                    <vaadin-item>[[item]]</vaadin-item>\n                  </template>\n                </vaadin-list-box>\n              </template>\n            </vaadin-select>\n\n            <vaadin-select id=\"raritySelect\" value=\"{{itemRarity}}\" on-change=\"_itemRarityChange\" label=\"Rarity\" >\n              <template>\n                <vaadin-list-box>\n                  <template is=\"dom-repeat\" items=\"[[rarityTypes]]\">\n                    <vaadin-item>[[item]]</vaadin-item>\n                  </template>\n                </vaadin-list-box>\n              </template>\n            </vaadin-select>\n\n            <div class=\"edit__weapon\" hidden$=\"[[!item.weapon]]\">\n              <vaadin-integer-field theme=\"label--secondary\"  min=\"0\" max=\"5\" has-controls value=\"{{weaponMagicModifier}}\" label=\"Magic Modifier\" on-change=\"_weaponMagicModifierChange\"></vaadin-integer-field>\n\n              <dnd-select-add choices=\"100\" label=\"Weapon Properties\" options=\"[[weaponPropertyValues]]\" value=\"[[weaponProperties]]\" add-callback=\"[[_addWeaponProperty()]]\"></dnd-select-add>\n\n              <dnd-switch label='Simple Weapon' secondary-label='Martial Weapon' initial-value=\"[[isMartial]]\" checked={{isMartial}} on-switch-change=\"_changeWeaponType\" ></dnd-switch>\n\n              <h4 class=\"damage_heading\">Damage</h4>\n              <template is=\"dom-repeat\" items=\"[[storedItem.damages]]\" as=\"damage\">\n                <div class=\"roll__damage\" index$=\"[[index]]\">\n                  <dnd-button on-click=\"_removeDamage\" icon=\"remove\" class='roll__damage-remove icon-only'></dnd-button>\n                  <div class=\"roll__damage-roll--edit\">\n                    <vaadin-text-field theme=\"label--secondary\" value=\"{{damage.roll}}\" on-change=\"_updateItem\" label=\"Damage Roll\"></vaadin-text-field>\n                  </div>\n                  <div class=\"roll__damage-type--edit\">\n                    <vaadin-select value=\"{{damage.type}}\" on-change=\"_updateItem\" label=\"Damage Type\" >\n                      <template>\n                        <vaadin-list-box>\n                          <template is=\"dom-repeat\" items=\"[[damageTypes]]\">\n                            <vaadin-item>[[item]]</vaadin-item>\n                          </template>\n                        </vaadin-list-box>\n                      </template>\n                    </vaadin-select>\n                  </div>\n                </div>\n              </template>\n              <dnd-button on-click=\"_addDamage\" label=\"Add Damage\" icon=\"add\" class=\"roll__add-damage\"></dnd-button>\n            </div>\n\n            <vaadin-integer-field theme=\"label--secondary\"  hidden$=\"[[!hasAC]]\" min=\"0\" max=\"30\" has-controls value=\"{{armorAC}}\" label=\"AC\" on-change=\"_armorACChange\"></vaadin-integer-field>\n            \n            <vaadin-integer-field theme=\"label--secondary\"  hidden$=\"[[!item.hasQuantity]]\" min=\"0\" has-controls value=\"{{itemQuantity}}\" label=\"Quantity\" on-change=\"_itemQuantityChange\"></vaadin-integer-field>\n\n            <!-- <vaadin-select hidden$=\"[[!canHaveResist]]\" value=\"{{itemResist}}\" on-change=\"_itemResistChange\" label=\"Resistance\">\n              <template>\n                <vaadin-list-box>\n                  <template is=\"dom-repeat\" items=\"[[resistTypes]]\">\n                    <vaadin-item>[[item]]</vaadin-item>\n                  </template>\n                </vaadin-list-box>\n              </template>\n            </vaadin-select> -->\n\n            <div class=\"edit__checkboxes\">\n              <vaadin-checkbox hidden$=\"[[!canHaveQuantity]]\" checked=\"{{storedItem.hasQuantity}}\" on-change=\"_updateItem\">Has Quantity?</vaadin-checkbox>\n              <vaadin-checkbox hidden$=\"[[!isArmor]]\" checked=\"{{storedItem.stealth}}\" on-change=\"_updateItem\">Disadvantage on Stealth?</vaadin-checkbox>\n              <vaadin-checkbox checked=\"{{storedItem.reqAttune}}\" on-change=\"_updateItem\">Requires Attunement?</vaadin-checkbox>\n              <vaadin-checkbox checked=\"{{storedItem.wondrous}}\" on-change=\"_updateItem\">Wondrous?</vaadin-checkbox>\n              <vaadin-checkbox hidden$=\"[[!storedItem.itemRef]]\" checked=\"{{storedItem.hideRef}}\" on-change=\"_updateItem\">Hide Reference?</vaadin-checkbox>\n            </div>\n\n            <vaadin-text-area  theme=\"label--secondary\" class=\"edit__notes\" value=\"{{storedItem.notes}}\" label=\"Notes\" on-change=\"_updateItem\"></vaadin-text-area>\n          </div>\n        </template>\n      </div>\n    `;\n  }\n}\n\ncustomElements.define(\"dnd-character-builder-equipment-item-detail\", DndCharacterBuilderEquipmentItemDetail);","import { PolymerElement, html } from \"@polymer/polymer\";\nimport { \n  getCharacterChannel,\n  getSelectedCharacter,\n  getItems,\n  removeItem,\n  canAttuneItem,\n  canEquipItem,\n  toggleItemEquipped,\n  toggleItemAttuned,\n  setItem,\n  spliceItems,\n  isChildItem,\n  getItemAtId,\n  addItem\n} from \"../../../util/charBuilder\";\nimport { getEditModeChannel, isEditMode } from \"../../../util/editMode\";\nimport \"@vaadin/vaadin-checkbox\";\nimport \"@vaadin/vaadin-grid\";\nimport \"@vaadin/vaadin-grid/vaadin-grid-tree-toggle\";\nimport \"@vaadin/vaadin-grid/vaadin-grid-column\";\nimport \"./dnd-character-builder-equipment-item-detail\";\n\n\n// TODO:\n// https://www.google.com/maps/place/7143+Billy+Goat+Dr,+New+Albany,+OH+43054/@40.1050273,-82.8250067,3a,18.1y,193.97h,87.13t/data=!3m7!1e1!3m5!1slpGo1R5kmFJTnA3yjtJYlQ!2e0!5s20151001T000000!7i13312!8i6656!4m7!3m6!1s0x88385e0b74c51a19:0x75954c845587a43b!8m2!3d40.1048551!4d-82.8250649!14m1!1BCgIgAQ\n// http://www.brosco.com/uploads/Price%20Pages%20and%20Forms/Doors/Larson1.pdf\n// Equipment choices from class\n// Parse equipment packs\n// Money counter\n// Ammunition / Potion / Other consumable counts\n// Magic Weapon modifier in entries\n// \nclass DndCharacterBuilderEquipment extends PolymerElement {\n  \n  static get properties() {\n    return {\n      inventory: {\n        type: Array\n      },\n      isEditMode: {\n        type: Boolean,\n        value: false\n      },\n      character: {\n        type: Object,\n      },\n      expandedItems: {\n        type: Array\n      },\n      expandedIds: {\n        type: Array\n      }\n    };\n  }\n\n  static get observers() {\n    return [\n      '_expandedItemsChange(expandedItems.*)'\n    ]\n  }\n\n  _expandedItemsChange() {\n    if (this.expandedItems && this.expandedItems.length) {\n      this.expandedIds = this.expandedItems.filter(item => !!item).map((item) => item.uniqueId);\n      console.error(this.expandedIds);\n\n      if (this.openedItemID) {\n        this.$.grid.closeItemDetails(this.openedItemID);\n        this.openedItemID = undefined;\n      }\n    }\n    window.scrollTo(0, this.originalScrollHeight);\n  }\n\n  _recordScrollHeight() {\n    // Fix reposition issue after tree expand/collapse toggle\n    this.originalScrollHeight = window.scrollY;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.characterChangeHandler = (e) => {\n      let character = e.detail.character;\n      this.updateFromCharacter(character);\n    };\n    \n    this.updateFromCharacter(getSelectedCharacter());\n    getCharacterChannel().addEventListener(\"character-selected\", this.characterChangeHandler);\n\n    this.editModeHandler = (e) => {\n      this.isEditMode = e.detail.isEditMode;\n      if (this.$.grid) {\n        setTimeout(() => {\n          this.$.grid.notifyResize();\n        }, 0);\n      }\n    }\n    getEditModeChannel().addEventListener('editModeChange', this.editModeHandler);\n    this.isEditMode = isEditMode();\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n\n    getCharacterChannel().removeEventListener(\"character-selected\", this.characterChangeHandler);\n    getEditModeChannel().removeEventListener('editModeChange', this.editModeHandler);\n  }\n\n  ready() {\n    super.ready();\n    \n    setTimeout(() => {\n      const grid = this.$.grid;\n\n      // Define Row Details\n      grid.rowDetailsRenderer = ((root, grid, rowData) => {\n        if (rowData.detailsOpened) {\n          if (!root.firstElementChild) {\n            root.innerHTML = '<div class=\"details\" id=\"stats\"></div>';\n          }\n          if (!this.detailEl) {\n            this.detailEl = document.createElement('dnd-character-builder-equipment-item-detail');\n            this.detailEl.unique = Date.now();\n          }\n          root.querySelector('.details').appendChild(this.detailEl);\n          this.detailEl.item = rowData.item;\n        }\n      }).bind(this);\n\n      // Add Drag and Drop\n      let draggedItem;\n\n      grid.addEventListener('grid-dragstart', function(e) {\n        draggedItem = e.detail.draggedItems[0];\n        grid.dropMode = 'on-top-or-between';\n      });\n\n      grid.addEventListener('grid-dragend', function(e) {\n        draggedItem = grid.dropMode = null;\n      });\n\n      grid.addEventListener('grid-drop', (e) => {\n        const dropTargetItem = e.detail.dropTargetItem;\n        if (draggedItem && draggedItem !== dropTargetItem) {\n\n          // Prevent loops\n          const isChild = isChildItem(draggedItem, dropTargetItem.uniqueId);\n          if (draggedItem.container && isChild) {\n            return;\n          }\n\n          const removeId = draggedItem.storedItem.uniqueId;\n          draggedItem.storedItem.uniqueId = this.character.itemCounter ++;\n\n          // Dropping into container\n          if (e.detail.dropLocation === 'on-top') {\n            if (dropTargetItem.container) {\n              if (dropTargetItem.storedItem && dropTargetItem.storedItem.children) {\n                // Add child item\n                dropTargetItem.storedItem.children.push(draggedItem.storedItem);\n                setItem(dropTargetItem, undefined, true);\n                // Remove original\n                removeItem(removeId);\n              }\n              return;\n            }\n          }\n\n          // Re-ordering items, default action if 'on-top' of non-container\n          if (this.inventory) {\n            // Adjust final add index for dropLocation 'below' or 'above'\n            const dropTargetId = `${dropTargetItem.id}`;\n            let finalAddIndex = parseInt(dropTargetId.substring(dropTargetId.lastIndexOf('_')), 10);\n            if (e.detail.dropLocation === 'below') {\n              finalAddIndex++;\n            }\n\n            if (dropTargetItem.parentItemREF) {\n              // Add child item\n              dropTargetItem.parentItemREF.storedItem.children.splice(finalAddIndex, 0, draggedItem.storedItem);\n              setItem(dropTargetItem.parentItemREF, undefined, true);\n            } else {\n              // Add top-level item\n              spliceItems(finalAddIndex, draggedItem.storedItem);\n            }\n\n            // Remove original item\n            removeItem(removeId);\n          }\n        }\n      });\n\n      // Set Data Provider\n      grid.dataProvider = ((params, callback) => {\n        const startIndex = params.page * params.pageSize;\n        let children = params.parentItem ? params.parentItem.children : this.inventory;\n        if (children && children.length) {\n          const page = children.slice(startIndex, startIndex + params.pageSize);\n          callback(page, children.length);\n        }\n      }).bind(this);\n    }, 0);\n    \n  }\n\n  async updateFromCharacter(character) {\n    if (character) {\n      this.character = character;\n      this.inventory = await getItems(character);\n      console.error('inventory:', this.inventory);\n      const originalScrollHeight = window.scrollY;\n      this.$.grid.clearCache();\n      if (this.openedItemID) {\n        const openedItem = getItemAtId(this.inventory, this.openedItemID.uniqueId);\n        if (openedItem) {\n          this.$.grid.openItemDetails(openedItem);\n        }\n      }\n      if (this.expandedIds) {\n        const expandedItems = this.expandedIds.map((id) => {\n          return getItemAtId(this.inventory, id);\n        });\n        this.expandedItems = expandedItems;\n      }\n      window.scrollTo(0, originalScrollHeight);\n      this.dispatchEvent(new CustomEvent(\"loadingChange\", { bubbles: true, composed: true }));\n    }\n  }\n\n  _expandDetails(e) {\n    let data = e.model.__data.item,\n      stayClosed = this.$.grid.detailsOpenedItems.indexOf(data) > -1;\n\n    const originalScrollHeight = window.scrollY;\n\n    for (let item of this.$.grid.detailsOpenedItems) {\n      this.$.grid.closeItemDetails(item);\n    }\n\n    if (stayClosed) {\n      this.$.grid.closeItemDetails(data);\n      this.openedItemID = undefined;\n    } else {\n      this.$.grid.openItemDetails(data);\n      this.openedItemID = data;\n    }\n    this.$.grid.notifyResize();\n    window.scrollTo(0, originalScrollHeight);\n  }\n\n  _flashCheckbox(checkboxEl) {\n    if (checkboxEl) {\n      checkboxEl.classList.add('transition-bg');\n      checkboxEl.classList.add('flash-error');\n      setTimeout(() => {\n        checkboxEl.classList.remove('flash-error');\n        setTimeout(() => {\n          checkboxEl.classList.remove('transition-bg');\n        }, 200);\n      }, 200);\n    }\n  }\n\n  _deleteItem(e) {\n    let uniqueId = e.model.__data.item && e.model.__data.item.uniqueId !== undefined ? e.model.__data.item.uniqueId : undefined;\n    removeItem(uniqueId);\n  }\n\n  async _setItemEquipped(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let itemModel = e.model.__data.item;\n    let uniqueId = itemModel ? itemModel.uniqueId : undefined;\n    let isEquipped = itemModel ? itemModel.isEquipped : false;\n    \n    if (isEquipped) {\n      toggleItemEquipped(uniqueId);\n    } else if (await canEquipItem(itemModel)) {\n      toggleItemEquipped(uniqueId);\n    } else {\n      let checkbox = e.target.querySelector('vaadin-checkbox')\n      this._flashCheckbox(checkbox)\n    }\n  }\n\n  async _setItemAttuned(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let itemModel = e.model.__data.item;\n    let uniqueId = itemModel ? itemModel.uniqueId : undefined;\n    let isAttuned = itemModel ? itemModel.isAttuned : false;\n\n    if (isAttuned) {\n      toggleItemAttuned(uniqueId);\n    } else if (await canAttuneItem(itemModel)) {\n      toggleItemAttuned(uniqueId);\n    } else {\n      let checkbox = e.target.querySelector('vaadin-checkbox')\n      this._flashCheckbox(checkbox)\n    }\n  }\n\n  _quantityChange(e) {\n    console.log(e);\n    const item = this.$.grid.getEventContext(e).item;\n    let newQuantity = parseInt(item.quantity, 10);\n    if (isNaN(newQuantity)) {\n      newQuantity = 0;\n    }\n\n    item.storedItem.quantity = newQuantity;\n    setItem(item);\n  }\n\n  _addItem() {\n    addItem({}, false);\n  }\n\n  _preventDefault(e) {\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  _or(...bools) {\n    for (let bool of bools) {\n      if (bool) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  _noRarity(rarity) {\n    return !rarity || rarity === 'None';\n  }\n\n  _toggleTheme(item) {\n    return item.children && item.children.length === 0 ? 'no-children' : '';\n  }\n\n  static get template() {\n    return html`\n      <style include=\"material-styles\"></style>\n      <style>\n        :host {\n          display: block;\n          padding: 14px;\n        }\n        [hidden] {\n          display: none !important;\n        }\n        a {\n          color: var(--mdc-theme-secondary);\n        }\n\n        vaadin-grid {\n          margin-bottom: 200px;\n        }\n\n        .heading {\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          justify-content: space-between;\n          border-bottom: 1px solid var(--lumo-contrast-10pct);\n        }\n        .reference-link:hover {\n          color: var(--mdc-theme-secondary);\n        }\n\n        .col-wrap {\n          display: flex; \n          justify-content: space-between;\n          flex-wrap: wrap;\n        }\n\n        .row-wrap {\n          width: 100%;\n        }\n        .row-wrap:not(:last-child) {\n          margin-bottom: 24px;\n        }\n\n        .row-wrap > *:not(h2):not(:last-child) {\n          margin-bottom: 10px;\n        }\n\n        .no-content {\n          font-size: 14px;\n          font-style: italic;\n        }\n\n        .item-wrap {\n          display: flex;\n          flex-wrap: nowrap;\n          flex-direction: row;\n          justify-content: space-between;\n          align-items: flex-start;\n          padding: 10px 6px;\n          min-height: 28px;\n          border-bottom: 1px solid var(--_lumo-grid-secondary-border-color);\n        }\n        .item-wrap__name-wrap {\n          flex-basis: 100%;\n          min-width: 0;\n          display: flex;\n          flex-direction: column;\n          cursor: pointer;\n        }\n        .item-wrap__name-wrap:hover {\n          color: var(--mdc-theme-secondary);\n        }\n        .item-wrap__name {\n          font-weight: bold;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          position: relative;\n        }\n        .item-wrap__edited,\n        .item-wrap__from {\n          background-color: var(--mdc-theme-text-disabled-on-background);\n          color: var(--mdc-theme-on-secondary);\n          border: none;\n          border-radius: 4px;\n          outline: none;\n          display: inline-block;\n          justify-content: center;\n          white-space: normal;\n          font-size: 10px;\n          padding: 1px 4px;\n          margin-right: 4px;\n          font-style: italic;\n        }\n        .item-wrap__edited {\n          top: -1px;\n          position: relative;\n          font-weight: normal;\n        }\n        .item-wrap__type {\n          font-style: italic;\n          font-size: 12px;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          position: relative;\n        }\n        .item-wrap__type--fromBackground {\n          padding-right: 38px;\n        }\n        .item-wrap__type--fromClass {\n          padding-right: 50px;\n        }\n        .item-wrap__close {\n          font-size: 14px;\n          margin-top: 6px;\n          cursor: pointer;\n        }\n        .item-wrap__checkboxes {\n          display: flex;\n          flex-direction: column;\n          width: 80px;\n          flex-grow: 0;\n          flex-shrink: 0;\n          margin-left: auto;\n        }\n        .item-wrap__checkboxes > span {\n          cursor: pointer;\n        }\n        .item-wrap__quantity {\n          display: flex;\n          flex-direction: column;\n          width: 80px;\n          flex-grow: 0;\n          flex-shrink: 0;\n          margin-left: auto;\n        }\n        vaadin-integer-field {\n          margin: -13px 0 8px;\n        }\n        vaadin-checkbox {\n          pointer-events: none;\n          font-size: 13px;\n        }\n        vaadin-checkbox.flash-error {\n          color: var(--mdc-theme-error);\n          transition: color 0.2s ease-out;\n          --lumo-contrast-20pct: var(--mdc-theme-error);\n        }\n        vaadin-checkbox.transition-bg {\n          transition: color 0.2s ease-in;\n        }\n\n        .details {\n          font-size: 14px;\n          width: calc(100% - 30px);\n          margin: 0 auto 13px !important;\n          background: var(--lumo-contrast-10pct);\n          border-radius: 4px;\n          padding: 14px;\n        }\n\n        @media(min-width: 420px) {\n          .heading {\n            justify-content: flex-start;\n          }\n          .reference-link {\n            margin-left: 8px;\n          }\n        }\n\n        @media(min-width: 921px) {\n          .row-wrap {\n            width: calc(50% - 10px);\n          }\n          .row-wrap:first-child {\n            margin-bottom: 0;\n          }\n        }\n      </style>\n\n      <div class=\"col-wrap\">\n\n        <div class=\"row-wrap\">\n          <div class=\"heading\">\n            <h2>Inventory</h2>\n            <a class=\"reference-link mdc-icon-button material-icons\" href=\"#/items\">launch</a>\n          </div>\n          <vaadin-grid id=\"grid\" expanded-items=\"{{expandedItems}}\" height-by-rows rows-draggable theme=\"no-border no-row-borders no-row-padding\" >\n            <vaadin-grid-column>\n              <template>\n                <div class=\"item-wrap\">\n                  <vaadin-grid-tree-toggle level$=[[level]] leaf=\"[[!item.container]]\" expanded=\"{{expanded}}\" theme$=[[_toggleTheme(item)]] on-click='_recordScrollHeight'></vaadin-grid-tree-toggle>\n                  <div class=\"item-wrap__name-wrap\" on-click=\"_expandDetails\">\n                    <span class=\"item-wrap__name\">[[item.name]]\n                      <span hidden$=\"[[!item.isEdited]]\" class=\"item-wrap__edited\">Edited</span>\n                    </span>\n                    <span class=\"item-wrap__type\">\n                      <span class=\"item-wrap__from\" hidden$=\"[[!item.fromBackground]]\">BG</span>\n                      <span class=\"item-wrap__from\" hidden$=\"[[!item.fromClass]]\">Class</span>\n                      <span>[[item.typeText]]<span hidden$=\"[[_noRarity(item.rarity)]]\">, [[item.rarity]]</span></span>\n                    </span>\n                  </div>\n                  <div hidden$=\"[[item.hasQuantity]]\" class=\"item-wrap__checkboxes\">\n                    <span on-click=\"_setItemEquipped\">\n                      <vaadin-checkbox checked=\"[[item.isEquipped]]\" hidden$=\"[[!item.canEquip]]\">Equip</vaadin-checkbox>\n                    </span>\n                    <span on-click=\"_setItemAttuned\">\n                      <vaadin-checkbox checked=\"[[item.isAttuned]]\" hidden$=\"[[!item.reqAttune]]\">Attune</vaadin-checkbox>\n                    </span>\n                  </div>\n                  <div hidden$=\"[[!item.hasQuantity]]\" class=\"item-wrap__quantity\">\n                    <vaadin-integer-field min=\"0\" value=\"{{item.quantity}}\" theme=\"mini\" has-controls on-change=\"_quantityChange\"></vaadin-integer-field>\n                  </div>\n                  <div class=\"mdc-buttom-icon material-icons item-wrap__close\" on-click=\"_deleteItem\">close</div>\n                </div>\n              </template>\n            </vaadin-grid-column>\n          </vaadin-grid>\n        </div>\n      </div>\n    `;\n  }\n}\n\ncustomElements.define(\"dnd-character-builder-equipment\", DndCharacterBuilderEquipment);"],"sourceRoot":""}