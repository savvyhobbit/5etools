{"version":3,"sources":["webpack:///./components/views/dnd-rewards-view.js","webpack:///./components/dnd-button.js","webpack:///./js/items.js","webpack:///./js/bestiary.js","webpack:///./js/dice.js","webpack:///./js/spells.js","webpack:///./js/classes.js","webpack:///./util/renderList.js","webpack:///./js eager ^\\.\\/.*\\.js$ namespace object","webpack:///./js/backgrounds.js","webpack:///./js/conditions.js","webpack:///./js/cults.js","webpack:///./js/feats.js","webpack:///./js/features.js","webpack:///./js/psionics.js","webpack:///./js/races.js","webpack:///./js/rewards.js","webpack:///./js/variantrules.js","webpack:///./components/dnd-list.js","webpack:///./components/dnd-selected-item.js","webpack:///./components/dnd-selection-list.js"],"names":["DndRewardsView","customElements","define","DndButton","label","type","String","value","icon","svg","background","border","svgFill","svgStroke","setTimeout","this","button","$","i","result","fill","stroke","renderer","renderSelection","item","rootEl","data","makeSmall","hasParsed","noDisplay","category","undefined","entries","window","itemTypeList","j","length","push","property","properties","split","itemPropertyList","k","armor","resist","stealth","strength","scfType","adjustItem","wrap","querySelector","innerHTML","classList","add","weight","tier","rarity","reqAttune","weaponCategory","damages","damage","isLast","roll","dmgTypeToFull","dmg1","dmgType","ac","speed","capacity","carryingcapacity","append","indexOf","prop","a","name","dmg2","range","reload","entryList","renderStack","recursiveEntryRender","join","toLowerCase","getProfBonusFromCr","cr","CR_TO_PROF","SKILL_TO_ATB_ABV","athletics","acrobatics","arcana","history","investigation","nature","religion","insight","medicine","perception","survival","deception","intimidation","performance","persuasion","mon","monsterName","source","_pTypes","asText","sourceJsonToAbv","sourceJsonToFull","sizeAbvToFull","size","getAbilityModifier","str","dex","con","int","wis","cha","saves","save","parentElement","style","display","skills","skill","obj","Object","keys","map","uppercaseFirst","parseInt","dmgvuln","vulnerable","dmgres","dmgimm","immune","conimm","conditionImmune","senses","passive","toString","languages","crToXp","traits","trait","traitname","traittext","text","traittexthtml","renderedcount","n","firstsecond","spells","replace","newTrait","spellLinks","querySelectorAll","spellLink","spellslist","encodeURIComponent","actions","action","actionname","actiontext","actiontexthtml","newAction","reactions","reaction","reactionname","reactiontext","reactiontexthtml","newNonReaction","newReaction","legendaries","legendary","shouldAddCap","legendaryname","legendarytext","legendarytexthtml","newLegendary","trim","legendaryActions","legendaryName","newLegendaryCap","renderSection","sectionClass","sectionEntries","newThing","renderSkillOrSaveRoller","itemName","profBonusString","profDiceString","isSave","lairActions","regionalEffects","element","$this","s","out","spl","match","skillName","skillString","b","bonus","Number","fromAbility","getAbilityModNumber","pB","expert","makeSkillRoller","pBonusStr","pDiceStr","makeSaveRoller","statPEls","statPEl","addNonD20Rollers","titleMaybe","attemptToGetTitle","mode","expectedPB","withoutPB","capture","dc","ele","substring","statsRollerEls","statsRollerEl","addEventListener","rollResult","getAttribute","multi","res2","rolls","concat","total","outputRollResult","statsDCRollerEls","statsDCRollerEl","$ele","newResult","outputEl","MAX_ROLLS","children","remove","onLoad","historyIndex","diceField","useNativeValidation","newOutput","addRollHandler","e","preventDefault","focus","keyCode","which","historyCount","click","keyData","originalEvent","target","closest","spell","spellHtmlString","spellHtml","spLevelSchoolMetaToFull","level","school","meta","spTimeListToFull","time","spRangeToFull","spComponentsToFull","components","spDurationToFull","duration","entriesHigherLevel","higherLevelsEntryList","spMainClassesToFull","classes","fromSubclass","currentAndLegacy","spSubclassesToCurrentAndLegacyFull","scrollNote","CLSS_ACTIVE","renderStr","string","onDataLoad","c","subclasses","sort","sortedClasses","filter","includes","classTableDefault","items","container","appendChild","listWrapper","htmlString","curItem","Parser","itemElements","tar","renderList","onClassChange","curClass","hd","getEntryDice","faces","proficiency","p","attAbvToFull","sProfs","startingProficiencies","weapons","w","tools","numString","skillOptions","Array","isArray","choose","numberToString","count","from","getSkillProfString","sEquip","startingEquipment","fromBackground","additionalFromBackground","defList","default","goldAlt","goldAlternative","tData","classTableGroups","groupHeaders","colHeaders","levelTrs","spellsFlag","subclassDef","subclassTableGroups","tGroup","hasTitle","title","subclassData","colLabels","lbl","rows","tr","entry","stack","rowsSpellProgression","combinedLabels","classFeatures","mobileClone","cloneNode","setAttribute","colHeaderEls","colHeaderEl","textContent","subclassIndex","tblLvlFeatures","featureNames","lvlFeatureList","feature","console","error","featureId","featureLinkPart","featureLinkClasses","featureLink","getElementById","scrollIntoView","offset","scrollBy","styleClasses","gainSubclassFeature","subClass","subclassFeatures","subFeatureList","subFeature","m","childEntry","startsWith","shortName","toggleUAFeatures","subclassPillWrapper","allSourcesToggle","makeGenericTogglePill","subClasses","sc","nonStandardSource","pillText","pill","handleSubclassClick","contains","toggle","HASH_ALL_SOURCES","pillActiveClass","pillId","hashKey","defaultActive","isUA","active","isPillActive","outStack","hashPart","newHash","handleToggleFeaturesClicks","subclassName","subclassSource","routeSelection","encodedSubClass","subclassLink","subClassStack","substr","hasSubclassHash","nonStandardPills","nonStandardPill","onSubChange","sub","curHash","hideClassFeatures","showAllSources","slice","hideOtherSources","updateClassTableLinks","$toShow","$toHide","$subClassSpanList","classSpan","thisSc","shown","otherSrcSubFeats","shownInTable","v","selectedSCFeatures","selectedSCFeature","otherSrcSubFeat","asInTable","toShow","listEls","el","scs","handleTableGroups","DATA_NONE","subClassEls","subClassEl","cfToggle","toToggleCf","srcToggle","toToggleSrc","hashParts","outParts","part","els","href","prevFeature","webpackAsyncContext","req","webpackAsyncContextResolve","then","__webpack_require__","Promise","resolve","o","Error","code","id","module","exports","stats_wrapper","curbg","allBgs","_copy","sourceAbv","sourceFull","sourceEl","texthtml","collapseList","traitTables","statsEl","list","curcondition","curcult","textlist","goal","cultists","signaturespells","feat","sourceAbr","prerequisite","ability","hasabilityitem","unshift","outstack","typeArray","featureType","t","featureJsonToAbv","selectedPsionic","STATS_ORDER_AND_TYPE","STATS_DURATION","STATS_TEXT","getModeString","modeIndex","modeString","modes","getModeTitle","submodes","modeStrings","subModes","getSubModeString","subMode","modeTitleArray","bracketPart","modeTitleBracketArray","cost","costMin","min","costMax","max","getModeTitleCost","concentration","unit","getModeTitleBracketPart","order","modeStringArray","description","getTextString","loadDiscipline","race","walk","climb","fly","traitlist","statsText","header","faux","reward","entryRenderer","curRule","textStack","columns","listItems","filters","isMobile","Boolean","searchString","selectedFilters","resultsCount","super","ready","grid","detail","selectedItems","linkData","_checkBreakpoint","_adjustHeight","setInterval","innerWidth","top","getBoundingClientRect","height","innerHeight","col","options","skipSort","flat","profOptions","SKILL_JSON_TO_FULL","profAbv","abilityOptions","ATB_ABV_TO_FULL","abilityAbv","forEach","val","some","option","sourceJsonToFullCompactPrefix","valItem","uniqueVals","labelA","labelB","startsWithNumA","startsWithNumB","numA","parseFloat","numB","model","__data","newFilters","set","root","colId","index","modelId","observer","selectedItem","allItems","loading","_modelsRenderSelection","Function","characterOption","dispatchEvent","CustomEvent","bubbles","composed","shadowRoot","catch","thing","enableHashRouting","reflectToAttribute","disableScrollBack","hasSelection","_data","_filters","_selectedItem","_selectedHash","connectedCallback","selectionEventHandler","_checkHashForSelection","selection","deselectionEventHandler","disconnectedCallback","removeEventListener","newSelection","hashSelection","itemFromHash","scrollTo"],"mappings":"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","file":"24.bundle.js","sourcesContent":["import {PolymerElement, html} from '@polymer/polymer';\nimport '../styles/material-styles.js';\nimport '../styles/my-styles.js';\nimport '../dnd-selection-list';\n\nclass DndRewardsView extends PolymerElement {\n  static get template() {\n    return html`\n      <style include=\"material-styles my-styles\"></style>\n\n      <dnd-selection-list\n        enable-hash-routing\n        model-id=\"rewards\"\n        columns='[\n          {\"id\":\"source\",\"label\":\"Source\"}, \n          {\"id\":\"reward-type\",\"label\":\"Type\",\"hideMobile\":true}\n        ]'\n      >\n      </dnd-selection-list>\n    `;\n  }\n}\n\ncustomElements.define('dnd-rewards-view', DndRewardsView);","import { PolymerElement, html } from '@polymer/polymer';\nimport { MDCRipple } from '@material/ripple';\nimport { } from '@polymer/polymer/lib/elements/dom-if.js';\nimport \"./dnd-svg\";\n\nclass DndButton extends PolymerElement {\n  static get properties() {\n    return {\n      label: {\n        type: String,\n        value: ''\n      },\n      icon: {\n        type: String,\n        value: ''\n      },\n      svg: {\n        type: String,\n        value: ''\n      },\n      background: {\n        type: String,\n        value: ''\n      },\n      border: {\n        type: String,\n        value: ''\n      },\n      svgFill: {\n        type: String,\n        value: ''\n      },\n      svgStroke: {\n        type: String,\n        value: ''\n      }\n    }\n  }\n\n  connectedCallback() {\n    setTimeout(()=> {\n      this.button = new MDCRipple(this.$.button);\n    }, 10)\n  }\n\n  _exists(i) {\n    return !!i;\n  }\n\n  _styleStr(background, border, label) {\n    let result = '';\n    if (background) {\n      result+= `background: ${background}; `\n    }\n    if (border) {\n      result+= `border: ${border}; `\n    }\n    return result;\n  }\n\n  _svgStyleStr(fill, stroke) {\n    let result = '';\n    if (fill) {\n      result+= `fill: ${fill}; `\n    }\n    if (stroke) {\n      result+= `stroke: ${stroke}; `\n    }\n    return result;\n  }\n\n  static get template() {\n    return html`\n      <style include=\"material-styles\">\n        .mdc-tab-scroller__scroll-area--scroll {\n          overflow-x: auto;\n          background-color: var(--mdc-theme-surface);\n          border: 1px solid var(--mdc-theme-text-divider-on-background);\n          border-bottom: none;\n        }\n        :host {\n          display: inline;\n          overflow: hidden;\n          white-space: nowrap;\n        }\n        .mdc-button {\n          display: inline-flex;\n          justify-content: center;\n          align-items: center;\n          width: 100%;\n        }\n        .mdc-button .mdc-button__icon {\n          margin-right: 0px;\n          margin-left: 8px;\n        }\n        .mdc-button [background] {\n          background: var(--lumo-contrast-10pct);\n        }\n        dnd-svg {\n          height: 20px;\n          width: 20px;\n          flex-shrink: 0;\n          flex-grow: 0;\n          padding-left: 8px;\n          fill: var(--mdc-theme-primary);\n          stroke: var(--mdc-theme-primary);\n        }\n        i {\n          flex-shrink: 0;\n          flex-grow: 0;\n        }\n\n        \n        :host(.btn-field__btn) dnd-svg {\n          padding-left: 0;\n        }\n        :host(.btn-field__btn) i {\n          margin-left: 0;\n        }\n\n        :host(.icon-only) dnd-svg {\n          margin-left: -24px;\n          padding-left: 0;\n        }\n        :host(.icon-only) i {\n          margin-left: -18px;\n          padding-left: 0;\n        }\n\n        :host(.link) .mdc-button__label {\n          text-transform: none;\n          color: var(--lumo-body-text-color);\n          letter-spacing: normal;\n        }\n        :host(.link) i {\n          color: var(--lumo-body-text-color);\n        }\n        :host(.link) button:hover::before {\n          background: none;\n        }\n        :host(.link) button:hover i,\n        :host(.link) button:hover .mdc-button__label {\n          color: var(--mdc-theme-secondary);\n        }\n\n        :host([edit-mode]) button {\n          background-color: var(--mdc-theme-secondary);\n          color: var(--mdc-theme-on-secondary)\n        }\n        :host([edit-mode]) .mdc-button__label {\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([edit-mode]) i {\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([edit-mode]) button:hover i,\n        :host([edit-mode]) button:hover .mdc-button__label {\n          color: var(--mdc-theme-on-secondary);\n        }\n\n        :host([not-edit-mode]) button {\n          background-color: var(--mdc-theme-primary);\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([not-edit-mode]) .mdc-button__label {\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([not-edit-mode]) i {\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([not-edit-mode]) button:hover i,\n        :host([not-edit-mode]) button:hover .mdc-button__label {\n          color: var(--mdc-theme-on-primary);\n        }\n\n      </style>\n      <button id=\"button\" class=\"mdc-button\" style$=\"[[_styleStr(background, border, label)]]\">\n        <div class=\"mdc-button__ripple\"></div>\n        <span class=\"mdc-button__label\">[[label]]</span>\n        <slot name=\"label\"></slot>\n        <template is=\"dom-if\" if=\"[[_exists(icon)]]\">\n          <i class=\"material-icons mdc-button__icon\" aria-hidden=\"true\">[[icon]]</i>\n        </template>\n        <template is=\"dom-if\" if=\"[[_exists(svg)]]\">\n          <dnd-svg id=\"[[svg]]\" style$=\"[[_svgStyleStr(svgFill, svgStroke)]]\"></dnd-svg>\n        </template>\n      </button>\n    `;\n  }\n\n}\ncustomElements.define('dnd-button', DndButton);","import EntryRenderer from '../util/entryrender.js';\r\nimport Parser from '../util/Parser.js';\r\nimport { cloneDeep, utils_makeRoller } from '../js/utils.js';\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"margin-bottom_small\">\r\n\t\t\t<span class=\"type\"></span><span class=\"rarity\"></span>\r\n\t\t\t<span class=\"attunement\"></span>\r\n\t\t</div>\r\n\t\t<div class=\"margin-bottom_small\">\r\n\t\t\t<span class=\"value\"></span><span class=\"weight\"></span>\r\n\t\t</div>\r\n\t\t<div class=\"margin-bottom_small\">\r\n\t\t\t<span class=\"damage\"></span>\r\n\t\t\t<span class=\"damageType\"></span>\r\n\t\t\t<span class=\"properties\"></span>\r\n\t\t</div>\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nconst renderer = new EntryRenderer();\r\nfunction renderSelection(item, rootEl, data, makeSmall) {\r\n\tadjustItem(item);\r\n\tconst wrap = rootEl.querySelector(\".selection-wrapper\") || rootEl;\r\n\twrap.innerHTML = stats_wrapper;\r\n\r\n\tif (makeSmall) {\r\n\t\twrap.querySelector('.stats-wrapper').classList.add('small');\r\n\t}\r\n\t\r\n\t// const sourceEl = rootEl.querySelector(\".stats-wrapper .source\")\r\n\t// const source = item.source;\r\n\t// const sourceFull = Parser.sourceJsonToFull(source);\r\n\t// sourceEl.innerHTML = (`<span class=\"source${item.source}\">${sourceFull},</span> page ${item.page}`);\r\n\r\n\trootEl.querySelector(\".stats-wrapper .value\").innerHTML = (item.value ? item.value+(item.weight ? \", \" : \"\") : \"\");\r\n\trootEl.querySelector(\".stats-wrapper .weight\").innerHTML = (item.weight ? item.weight+(item.weight == 1 ? \" lb.\" : \" lbs.\") : \"\");\r\n\trootEl.querySelector(\".stats-wrapper .rarity\").innerHTML = ((item.tier ? \", \"+item.tier : \"\")+(item.rarity ? \", \"+item.rarity : \"\"));\r\n\trootEl.querySelector(\".stats-wrapper .attunement\").innerHTML = (item.reqAttune ? item.reqAttune : \"\");\r\n\trootEl.querySelector(\".stats-wrapper .type\").innerHTML = (item.typeText);\r\n\r\n\trootEl.querySelector(\".stats-wrapper .damage\").innerHTML = (\"\");\r\n\trootEl.querySelector(\".stats-wrapper .damageType\").innerHTML = (\"\");\r\n\tconst type = item.type || \"\";\r\n\tif (item.weaponCategory) {\r\n\t\tif (item.damages && item.damages.length) {\r\n\t\t\tfor (let i = 0; i < item.damages.length; i++) {\r\n\t\t\t\tconst damage = item.damages[i];\r\n\t\t\t\tconst isLast = i === item.damages.length - 1;\r\n\t\t\t\tif (damage.roll && damage.type) {\r\n\t\t\t\t\trootEl.querySelector(\".stats-wrapper .damage\").innerHTML += `<span>${utils_makeRoller(damage.roll)} ${Parser.dmgTypeToFull(damage.type)}</span>${isLast ? '': ' + '}`\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(item.dmg1) rootEl.querySelector(\".stats-wrapper .damage\").innerHTML = (utils_makeRoller(item.dmg1));\r\n\t\t\tif(item.dmgType) rootEl.querySelector(\".stats-wrapper .damageType\").innerHTML = (Parser.dmgTypeToFull(item.dmgType));\r\n\t\t}\r\n\t} else if (type === \"LA\" ||type === \"MA\"|| type === \"HA\") {\r\n\t\trootEl.querySelector(\".stats-wrapper .damage\").innerHTML = (\"AC \"+item.ac+(type === \"LA\" ? \" + Dex\" : type === \"MA\" ? \" + Dex (max 2)\" : \"\"));\r\n\t} else if (type === \"S\") {\r\n\t\trootEl.querySelector(\".stats-wrapper .damage\").innerHTML = (\"AC +\"+item.ac);\r\n\t} else if (type === \"MNT\" || type === \"VEH\") {\r\n\t\tconst speed = item.speed;\r\n\t\tconst capacity = item.carryingcapacity;\r\n\t\tif (speed) rootEl.querySelector(\".stats-wrapper .damage\").append(\"Speed=\"+speed);\r\n\t\tif (speed && capacity) rootEl.querySelector(\".stats-wrapper .damage\").append(type === \"MNT\" ? \", \" : \"<br/>\");\r\n\t\tif (capacity) {\r\n\t\t\trootEl.querySelector(\".stats-wrapper .damage\").append(\"Carrying Capacity=\"+capacity);\r\n\r\n\t\t\tif (capacity.indexOf(\"ton\") === -1 && capacity.indexOf(\"passenger\") === -1) {\r\n\t\t\t\trootEl.querySelector(\".stats-wrapper .damage\").append(capacity == 1 ? \" lb.\" : \" lbs.\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trootEl.querySelector(\".stats-wrapper .properties\").innerHTML = (\"\");\r\n\tif (item.property) {\r\n\t\tconst properties = item.property.split(\",\");\r\n\t\tfor (let i = 0; i < properties.length; i++) {\r\n\t\t\tconst prop = properties[i];\r\n\t\t\tlet a = window.itemPropertyList[prop].name;\r\n\t\t\tif (prop === \"V\" && item.dmg2) a = `${a} (${item.dmg2})`;\r\n\t\t\tif (prop === \"T\" || prop === \"A\" || prop === \"AF\") a = `${a} (${item.range}ft.)`;\r\n\t\t\tif (prop === \"RLD\") a = `${a} (${item.reload} shots)`;\r\n\t\t\ta = (i > 0 ? \", \" : item.dmg1 ? \"- \" : \"\") + a;\r\n\t\t\trootEl.querySelector(\".stats-wrapper .properties\").append(a);\r\n\t\t}\r\n\t}\r\n\r\n\tconst entryList = {type: \"entries\", entries: item.entries};\r\n\tconst renderStack = [];\r\n\trenderer.recursiveEntryRender(entryList, renderStack, 1);\r\n\trootEl.querySelector(\".stats-wrapper .text\").innerHTML = (utils_makeRoller(renderStack.join(\"\")).split(item.name.toLowerCase()).join(\"<i>\"+item.name.toLowerCase()+\"</i>\"));\r\n}\r\n\r\nfunction adjustItem(item) {\r\n\tif (item.hasParsed) {\r\n\t\treturn;\r\n\t}\r\n\titem.hasParsed = true;\r\n\tif (item.noDisplay) {\r\n\t\treturn;\r\n\t}\r\n\tif (item.type === \"GV\") {\r\n\t\titem.category = \"Generic Variant\";\r\n\t}\r\n\tif (item.category === undefined) {\r\n\t\titem.category = \"Other\";\r\n\t}\r\n\tif (item.entries === undefined) {\r\n\t\titem.entries = [];\r\n\t} else {\r\n\t\titem.entries = cloneDeep(item.entries);\r\n\t}\r\n\tif (item.type && window.itemTypeList[item.type]) {\r\n\t\tfor (let j = 0; j < window.itemTypeList[item.type].entries.length; j++) {\r\n\t\t\titem.entries.push(window.itemTypeList[item.type].entries[j]);\r\n\t\t}\r\n\t}\r\n\tif (item.property) {\r\n\t\tconst properties = item.property.split(\",\");\r\n\t\tfor (let j = 0; j < properties.length; j++) {\r\n\t\t\tif (window.itemPropertyList[properties[j]].entries) {\r\n\t\t\t\tfor (let k = 0; k < window.itemPropertyList[properties[j]].entries.length; k++) {\r\n\t\t\t\t\titem.entries.push(window.itemPropertyList[properties[j]].entries[k]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//The following could be encoded in JSON, but they depend on more than one JSON property; maybe fix if really bored later\r\n\tif (item.armor) {\r\n\t\tif (item.resist) {\r\n\t\t\titem.entries.push(\"You have resistance to \"+item.resist+\" damage while you wear this armor.\");\r\n\t\t}\r\n\t\tif (item.armor && item.stealth) {\r\n\t\t\titem.entries.push(\"The wearer has disadvantage on Stealth (Dexterity) checks.\");\r\n\t\t}\r\n\t\tif (item.type === \"HA\" && item.strength) {\r\n\t\t\titem.entries.push(\"If the wearer has a Strength score lower than \" + item.strength + \", their speed is reduced by 10 feet.\");\r\n\t\t}\r\n\t} else if (item.resist) {\r\n\t\tif (item.type === \"P\") {\r\n\t\t\titem.entries.push(\"When you drink this potion, you gain resistance to \"+item.resist+\" damage for 1 hour.\");\r\n\t\t}\r\n\t\tif (item.type === \"RG\") {\r\n\t\t\titem.entries.push(\"You have resistance to \"+item.resist+\" damage while wearing this ring.\");\r\n\t\t}\r\n\t}\r\n\tif (item.type === \"SCF\") {\r\n\t\tif (item.scfType === \"arcane\") {\r\n\t\t\titem.entries.push(\"An arcane focus is a special item designed to channel the power of arcane spells. A sorcerer, warlock, or wizard can use such an item as a spellcasting focus, using it in place of any material component which does not list a cost.\");\r\n\t\t}\r\n\t\tif (item.scfType === \"druid\") {\r\n\t\t\titem.entries.push(\"A druid can use such a druidic focus as a spellcasting focus, using it in place of any material component that does not have a cost.\");\r\n\t\t}\r\n\t\tif (item.scfType === \"holy\") {\r\n\t\t\titem.entries.push(\"A holy symbol is a representation of a god or pantheon.\");\r\n\t\t\titem.entries.push(\"A cleric or paladin can use a holy symbol as a spellcasting focus, using it in place of any material components which do not list a cost. To use the symbol in this way, the caster must hold it in hand, wear it visibly, or bear it on a shield.\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport { renderSelection };","import { parseHTML, utils_makeRoller, jqAfter, jqPrepend} from \"../js/utils.js\";\r\nimport EntryRenderer from \"../util/entryrender.js\";\r\nimport Parser from \"../util/Parser.js\"\r\nimport droll from \"../lib/droll.js\"\r\n\r\nconst MAX_ROLLS = 5\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"margin-bottom_large stats-wrapper\">\r\n\t\t<div id=\"stats\" class=\"monster\">\r\n\t\t\t<div id=\"name\">\r\n\t\t\t\tName <span class=\"source\" title=\"Source book\">SRC</span>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"sizetypealignment\">\r\n\t\t\t\t<span id=\"size\">Size</span> <span id=\"type\">type</span>, <span id=\"alignment\">alignment</span>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"divider\"></div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Armor Class</strong> <span id=\"ac\">## (source)</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Hit Points</strong> <span id=\"hp\">hp</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Speed</strong> <span id=\"speed\">30 ft.</span>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"abilitynames\">\r\n\t\t\t\t<div>STR</div>\r\n\t\t\t\t<div>DEX</div>\r\n\t\t\t\t<div>CON</div>\r\n\t\t\t\t<div>INT</div>\r\n\t\t\t\t<div>WIS</div>\r\n\t\t\t\t<div>CHA</div>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"abilityscores\">\r\n\t\t\t\t<div id=\"str\"><span class=\"score\">10</span> (<span class=\"mod\">0</span>)</div>\r\n\t\t\t\t<div id=\"dex\"><span class=\"score\">10</span> (<span class=\"mod\">0</span>)</div>\r\n\t\t\t\t<div id=\"con\"><span class=\"score\">10</span> (<span class=\"mod\">0</span>)</div>\r\n\t\t\t\t<div id=\"int\"><span class=\"score\">10</span> (<span class=\"mod\">0</span>)</div>\r\n\t\t\t\t<div id=\"wis\"><span class=\"score\">10</span> (<span class=\"mod\">0</span>)</div>\r\n\t\t\t\t<div id=\"cha\"><span class=\"score\">10</span> (<span class=\"mod\">0</span>)</div>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Saving Throws</strong> <span id=\"saves\">Str +0</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Skills</strong> <span id=\"skills\">Perception +0</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Damage Vulnerabilities</strong> <span id=\"dmgvuln\">fire</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Damage Resistances</strong> <span id=\"dmgres\">cold</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Damage Immunities</strong> <span id=\"dmgimm\">lightning</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Condition Immunities</strong> <span id=\"conimm\">exhaustion</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Senses</strong> <span id=\"senses\">darkvision 30 ft.</span> passive Perception <span id=\"pp\">10</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Languages</strong> <span id=\"languages\">Common</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Challenge</strong> <span id=\"cr\">1</span> (<span id=\"xp\">450</span> XP)\r\n\t\t\t</div>\r\n\t\t\t<div id=\"traits\">\r\n\t\t\t</div>\r\n\t\t\t<div id=\"actions\">\r\n\t\t\t\t<span>Actions</span>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"reactions\">\r\n\t\t\t\t<span>Reactions</span>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"legendaries\">\r\n\t\t\t\t<span>Legendary Actions</span>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"lairactions\">\r\n\t\t\t\t<span>Lair Actions</span>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"regionaleffects\">\r\n\t\t\t\t<span>Regional Effects</span>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div id=\"output\"></div>\r\n\t</div>`;\r\n\r\nfunction objToTitleCaseStringWithCommas(obj) {\r\n  return Object.keys(obj)\r\n    .map(function(k) {\r\n      return k.uppercaseFirst() + \" \" + obj[k];\r\n    })\r\n    .join(\", \");\r\n}\r\nconst ATB_PROF_MODE = \"mode\";\r\nconst ATB_PROF_BONUS_STR = \"profBonusStr\";\r\nconst ATB_PROF_DICE_STR = \"profDiceStr\";\r\nconst PROF_MODE_BONUS = \"bonus\";\r\nconst PROF_MODE_DICE = \"dice\";\r\nfunction getProfBonusFromCr(cr) {\r\n  if (CR_TO_PROF[cr]) return CR_TO_PROF[cr];\r\n  return 0;\r\n}\r\nconst CR_TO_PROF = {\r\n  \"0\": 2,\r\n  \"1/8\": 2,\r\n  \"1/4\": 2,\r\n  \"1/2\": 2,\r\n  \"1\": 2,\r\n  \"2\": 2,\r\n  \"3\": 2,\r\n  \"4\": 2,\r\n  \"5\": 3,\r\n  \"6\": 3,\r\n  \"7\": 3,\r\n  \"8\": 3,\r\n  \"9\": 4,\r\n  \"10\": 4,\r\n  \"11\": 4,\r\n  \"12\": 4,\r\n  \"13\": 5,\r\n  \"14\": 5,\r\n  \"15\": 5,\r\n  \"16\": 5,\r\n  \"17\": 6,\r\n  \"18\": 6,\r\n  \"19\": 6,\r\n  \"20\": 6,\r\n  \"21\": 7,\r\n  \"22\": 7,\r\n  \"23\": 7,\r\n  \"24\": 7,\r\n  \"25\": 8,\r\n  \"26\": 8,\r\n  \"27\": 8,\r\n  \"28\": 8,\r\n  \"29\": 9,\r\n  \"30\": 9\r\n};\r\nconst SKILL_TO_ATB_ABV = {\r\n  athletics: \"dex\",\r\n  acrobatics: \"dex\",\r\n  \"sleight of hand\": \"dex\",\r\n  stealth: \"dex\",\r\n  arcana: \"int\",\r\n  history: \"int\",\r\n  investigation: \"int\",\r\n  nature: \"int\",\r\n  religion: \"int\",\r\n  \"animal handling\": \"wis\",\r\n  insight: \"wis\",\r\n  medicine: \"wis\",\r\n  perception: \"wis\",\r\n  survival: \"wis\",\r\n  deception: \"cha\",\r\n  intimidation: \"cha\",\r\n  performance: \"cha\",\r\n  persuasion: \"cha\"\r\n};\r\nfunction getAttribute(skill) {\r\n  return SKILL_TO_ATB_ABV[skill.toLowerCase().trim()];\r\n}\r\n\r\nconst renderer = new EntryRenderer();\r\nfunction renderSelection(mon, rootEl) {\r\n  rootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n\tlet renderStack = [];\r\n\tlet entryList = {};\r\n\tvar name = mon.name;\r\n\twindow.monsterName = name;\r\n\tvar source = mon.source;\r\n\tvar type = mon._pTypes.asText;\r\n\r\n\trootEl.querySelector(\"#name\").innerHTML = (\r\n\t\t`<span class=\"source source${source}\" title=\"${Parser.sourceJsonToAbv(source)}\">${Parser.sourceJsonToFull(source)}</span>`\r\n\t);\r\n\trootEl.querySelector(\"#size\").innerHTML = (Parser.sizeAbvToFull(mon.size));\r\n\trootEl.querySelector(\"#type\").innerHTML = (type);\r\n\trootEl.querySelector(\"#alignment\").innerHTML = (mon.alignment);\r\n\trootEl.querySelector(\"#ac\").innerHTML = (mon.ac);\r\n\trootEl.querySelector(\"#hp\").innerHTML = (mon.hp);\r\n\trootEl.querySelector(\"#speed\").innerHTML = (mon.speed);\r\n\trootEl.querySelector(\"#str span.score\").innerHTML = (mon.str);\r\n\trootEl.querySelector(\"#str span.mod\").innerHTML = (Parser.getAbilityModifier(mon.str));\r\n\trootEl.querySelector(\"#dex span.score\").innerHTML = (mon.dex);\r\n\trootEl.querySelector(\"#dex span.mod\").innerHTML = (Parser.getAbilityModifier(mon.dex));\r\n\trootEl.querySelector(\"#con span.score\").innerHTML = (mon.con);\r\n\trootEl.querySelector(\"#con span.mod\").innerHTML = (Parser.getAbilityModifier(mon.con));\r\n\trootEl.querySelector(\"#int span.score\").innerHTML = (mon.int);\r\n\trootEl.querySelector(\"#int span.mod\").innerHTML = (Parser.getAbilityModifier(mon.int));\r\n\trootEl.querySelector(\"#wis span.score\").innerHTML = (mon.wis);\r\n\trootEl.querySelector(\"#wis span.mod\").innerHTML = (Parser.getAbilityModifier(mon.wis));\r\n\trootEl.querySelector(\"#cha span.score\").innerHTML = (mon.cha);\r\n\trootEl.querySelector(\"#cha span.mod\").innerHTML = (Parser.getAbilityModifier(mon.cha));\r\n\r\n\tvar saves = mon.save;\r\n\tif (saves) {\r\n\t\trootEl.querySelector(\"#saves\").parentElement.style.display = 'block';\r\n\t\trootEl.querySelector(\"#saves\").innerHTML = (saves);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#saves\").parentElement.style.display = 'none';\r\n\t}\r\n\r\n\tvar skills = mon.skill;\r\n\tlet perception = 0;\r\n\tif (skills) {\r\n\t\trootEl.querySelector(\"#skills\").parentElement.style.display = 'block';\r\n\t\trootEl.querySelector(\"#skills\").innerHTML = (objToTitleCaseStringWithCommas(skills));\r\n\t\tif (skills.perception) perception = parseInt(skills.perception);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#skills\").parentElement.style.display = 'none';\r\n\t}\r\n\r\n\tvar dmgvuln = mon.vulnerable;\r\n\tif (dmgvuln) {\r\n\t\trootEl.querySelector(\"#dmgvuln\").parentElement.style.display = 'block';\r\n\t\trootEl.querySelector(\"#dmgvuln\").innerHTML = (dmgvuln);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#dmgvuln\").parentElement.style.display = 'none';\r\n\t}\r\n\r\n\tvar dmgres = mon.resist;\r\n\tif (dmgres) {\r\n\t\trootEl.querySelector(\"#dmgres\").parentElement.style.display = 'block';\r\n\t\trootEl.querySelector(\"#dmgres\").innerHTML = (dmgres);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#dmgres\").parentElement.style.display = 'none';\r\n\t}\r\n\r\n\tvar dmgimm = mon.immune;\r\n\tif (dmgimm) {\r\n\t\trootEl.querySelector(\"#dmgimm\").parentElement.style.display = 'block';\r\n\t\trootEl.querySelector(\"#dmgimm\").innerHTML = (dmgimm);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#dmgimm\").parentElement.style.display = 'none';\r\n\t}\r\n\r\n\tvar conimm = mon.conditionImmune;\r\n\tif (conimm) {\r\n\t\trootEl.querySelector(\"#conimm\").parentElement.style.display = 'block';\r\n\t\trootEl.querySelector(\"#conimm\").innerHTML = (conimm);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#conimm\").parentElement.style.display = 'none';\r\n\t}\r\n\r\n\tvar senses = mon.senses;\r\n\tif (senses) {\r\n\t\trootEl.querySelector(\"#senses\").innerHTML = (senses + \", \");\r\n\t} else {\r\n\t\trootEl.querySelector(\"#senses\").innerHTML = (\"\");\r\n\t}\r\n\r\n\tvar passive = mon.passive || (10 + perception).toString;\r\n\trootEl.querySelector(\"#pp\").innerHTML = (passive)\r\n\r\n\tvar languages = mon.languages;\r\n\tif (languages) {\r\n\t\trootEl.querySelector(\"#languages\").innerHTML = (languages);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#languages\").innerHTML = (\"\\u2014\");\r\n\t}\r\n\r\n\tvar cr = mon.cr === undefined ? \"Unknown\" : mon.cr;\r\n\trootEl.querySelector(\"#cr\").innerHTML = (cr);\r\n\trootEl.querySelector(\"#xp\").innerHTML = (Parser.crToXp(cr));\r\n\r\n\tvar traits = mon.trait;\r\n\trootEl.querySelector(\"#traits\").style.display = 'none';\r\n\r\n\tif (traits && traits.length > 0) {\r\n\t\trootEl.querySelector(\"#traits\").style.display = 'block';\r\n\t\tfor (var i = traits.length - 1; i >= 0; i--) {\r\n\t\t\tvar traitname = traits[i].name;\r\n\t\t\tvar traittext = traits[i].text;\r\n\t\t\tvar traittexthtml = \"\";\r\n\t\t\tvar renderedcount = 0;\r\n\t\t\tfor (var n = 0; n < traittext.length; n++) {\r\n\t\t\t\tif (!traittext[n]) continue;\r\n\r\n\t\t\t\trenderedcount++;\r\n\t\t\t\tvar firstsecond = \"\";\r\n\t\t\t\tif (renderedcount === 1) firstsecond = \"first \";\r\n\t\t\t\tif (renderedcount === 2) firstsecond = \"second \";\r\n\r\n\t\t\t\tvar spells = \"\";\r\n\t\t\t\tif (traitname.indexOf(\"Spellcasting\") !== -1 && traittext[n].indexOf(\": \") !== -1) spells = \"spells\";\r\n\t\t\t\tif (traitname.indexOf(\"Variant\") !== -1 && traitname.indexOf(\"Coven\") !== -1 && traittext[n].indexOf(\": \") !== -1) spells = \"spells\";\r\n\r\n\t\t\t\ttraittexthtml = traittexthtml + \"<p class='\" + firstsecond + spells + \"'>\" + traittext[n].replace(/\\u2022\\s?(?=C|\\d|At\\swill)/g, \"\")+\"</p>\";\r\n\t\t\t}\r\n\t\t\tconst newTrait = parseHTML(\"<div class='trait'><div class='trait\" + i + \"'><span class='name'>\" + traitname + \".</span> \" + traittexthtml + \"</div></div>\");\r\n\t\t\tjqAfter(rootEl.querySelector(\"#traits\"), newTrait);\r\n\r\n\t\t\t// parse spells, make hyperlinks\r\n\t\t\tconst spellLinks = rootEl.querySelectorAll('.trait div p.spells');\r\n\t\t\tfor (let spellLink of spellLinks) {\r\n\t\t\t\tlet spellslist = spellLink.innerHTML;\r\n\t\t\t\tif (spellslist[0] === \"*\") return;\r\n\t\t\t\tspellslist = spellslist.split(\": \")[1].split(/\\, (?!\\+|\\dd|appears|inside gems)/g);\r\n\t\t\t\tfor (let i = 0; i < spellslist.length; i++) {\r\n\t\t\t\t\tspellslist[i] = \"<a href='#/spells/\" + encodeURIComponent((spellslist[i].replace(/(\\*)| \\(([^\\)]+)\\)/g, \"\"))).toLowerCase().replace(\"'\", \"%27\") + \"_\" + \"phb'>\" + spellslist[i] + \"</a>\";\r\n\t\t\t\t\tif (i !== spellslist.length - 1) spellslist[i] = spellslist[i] + \", \";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tspellLink.innerHTML = (spellLink.innerHTML.split(\": \")[0] + \": \" + spellslist.join(\"\"));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tconst actions = mon.action;\r\n\r\n\tif (actions && actions.length) for (let i = actions.length - 1; i >= 0; i--) {\r\n\t\tconst actionname = actions[i].name;\r\n\t\tconst actiontext = actions[i].text;\r\n\t\tlet actiontexthtml = \"\";\r\n\t\tlet renderedcount = 0;\r\n\t\tfor (let n = 0; n < actiontext.length; n++) {\r\n\t\t\tif (!actiontext[n]) continue;\r\n\r\n\t\t\trenderedcount++;\r\n\t\t\tlet firstsecond = \"\";\r\n\t\t\tif (renderedcount === 1) firstsecond = \"first \";\r\n\t\t\tif (renderedcount === 2) firstsecond = \"second \";\r\n\r\n\t\t\tactiontexthtml = actiontexthtml + \"<p class='\"+firstsecond+\"'>\"+actiontext[n]+\"</p>\";\r\n\t\t}\r\n\t\tconst newAction = parseHTML(\"<div class='action'><div class='action\"+i+\"'><span class='name'>\"+actionname+\".</span> \"+actiontexthtml+\"</div></div>\")\r\n\t\tjqAfter(rootEl.querySelector('#actions'), newAction);\r\n\t}\r\n\r\n\tconst reactions = mon.reaction;\r\n\trootEl.querySelector(\"#reactions\").style.display = 'none';\r\n\r\n\tif (reactions && (reactions.text || reactions.length)) {\r\n\r\n\t\trootEl.querySelector(\"#reactions\").style.display = 'block';\r\n\r\n\t\tif (!reactions.length) {\r\n\t\t\tconst reactionname = reactions.name;\r\n\t\t\tconst reactiontext = reactions.text;\r\n\t\t\tlet reactiontexthtml = \"\";\r\n\t\t\tlet renderedcount = 0;\r\n\t\t\tfor (let n = 0; n < reactiontext.length; n++) {\r\n\t\t\t\tif (!reactiontext[n]) continue;\r\n\r\n\t\t\t\trenderedcount++;\r\n\t\t\t\tlet firstsecond = \"\";\r\n\t\t\t\tif (renderedcount === 1) firstsecond = \"first \";\r\n\t\t\t\tif (renderedcount === 2) firstsecond = \"second \";\r\n\r\n\t\t\t\treactiontexthtml = reactiontexthtml + \"<p class='\" + firstsecond + \"'>\" + reactiontext[n] + \"</p>\";\r\n\t\t\t}\r\n\r\n\t\t\tconst newNonReaction = parseHTML(\"<div class='reaction'><div class='reaction0'><span class='name'>\" + reactionname + \".</span> \" + reactiontexthtml + \"</div></div>\")\r\n\t\t\tjqAfter(rootEl.querySelector(\"#reactions\"), newNonReaction);\r\n\t\t}\r\n\r\n\t\tif (reactions.length) for (let i = reactions.length - 1; i >= 0; i--) {\r\n\t\t\tconst reactionname = reactions[i].name;\r\n\r\n\t\t\tconst reactiontext = reactions[i].text;\r\n\t\t\tlet reactiontexthtml = \"<span>\" + reactiontext + \"</span>\";\r\n\t\t\tfor (let n = 1; n < reactiontext.length; n++) {\r\n\t\t\t\tif (!reactiontext[n]) continue;\r\n\t\t\t\treactiontexthtml = reactiontexthtml + \"<p>\" + reactiontext[n] + \"</p>\";\r\n\t\t\t}\r\n\r\n\t\t\tconst newReaction = parseHTML(\"<div class='reaction'><div class='reaction\" + i + \"'><span class='name'>\" + reactionname + \".</span> \" + reactiontexthtml + \"</div></div>\")\r\n\t\t\tjqAfter(rootEl.querySelector(\"#reactions\"), newReaction);\r\n\t\t}\r\n\t}\r\n\r\n\tconst legendaries = mon.legendary;\r\n\trootEl.querySelector(\"#legendaries\").style.display = 'none';\r\n\tif (legendaries) {\r\n\t\trootEl.querySelector(\"#legendaries\").style.display = 'block';\r\n\t\tlet shouldAddCap = legendaries.length > 0;\r\n\t\tfor (let i = legendaries.length - 1; i >= 0; i--) {\r\n\t\t\tconst legendaryname = legendaries[i].name ? legendaries[i].name + \".\" : \"\";\r\n\t\t\tconst legendarytext = legendaries[i].text;\r\n\t\t\tlet legendarytexthtml = \"\";\r\n\t\t\tlet renderedcount = 0;\r\n\t\t\tfor (let n = 0; n < legendarytext.length; n++) {\r\n\t\t\t\tif (!legendarytext[n]) continue;\r\n\t\t\t\trenderedcount++;\r\n\t\t\t\tlet firstsecond = \"\";\r\n\t\t\t\tif (renderedcount === 1) firstsecond = \"first \";\r\n\t\t\t\tif (renderedcount === 2) firstsecond = \"second \";\r\n\t\t\t\tlegendarytexthtml += `<p class='${firstsecond}'>${legendarytext[n]}</p>`;\r\n\t\t\t}\r\n\t\t\tconst newLegendary = parseHTML(`<div class='legendary'><div class='legendary'><span class='name'>${legendaryname}</span> ${legendarytexthtml}</div></div>`)\r\n\t\t\tjqAfter(rootEl.querySelector(\"#legendaries\"), newLegendary);\r\n\t\t\tif (legendaryname.trim() === '' || legendaryname.indexOf('Legendary Actions') > -1) {\r\n\t\t\t\tshouldAddCap = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (shouldAddCap) {\r\n\t\t\tconst legendaryActions = mon.legendaryActions || 3;\r\n\t\t\tconst legendaryName = name.split(\",\");\r\n\t\t\tconst newLegendaryCap = parseHTML(`<div class='legendary'><div class='legendary'><span class='name'></span> <span>${legendaryName[0]} can take ${legendaryActions} legendary action${legendaryActions > 1 ? \"s\" : \"\"}, choosing from the options below. Only one legendary action can be used at a time and only at the end of another creature's turn. ${legendaryName[0]} regains spent legendary actions at the start of its turn.</span></div></div>`)\r\n\t\t\tjqAfter(rootEl.querySelector(\"#legendaries\"), newLegendaryCap);\r\n\t\t}\r\n\t}\r\n\r\n\trootEl.querySelector(\"#lairactions\").style.display = 'none';\r\n\trootEl.querySelector(\"#regionaleffects\").style.display = 'none';\r\n\tif (mon.lairActions) renderSection(\"lairaction\", mon.lairActions);\r\n\tif (mon.regionalEffects) renderSection(\"regionaleffect\", mon.regionalEffects);\r\n\r\n\tfunction renderSection(sectionClass, sectionEntries) {\r\n\t\trootEl.querySelector(`#${sectionClass}s`).style.display = 'block';\r\n\t\tentryList = {type: \"entries\", entries: sectionEntries};\r\n\t\trenderStack = [];\r\n\t\trenderer.recursiveEntryRender(entryList, renderStack);\r\n\t\tconst newThing = parseHTML(`<div class='${sectionClass}'><div class='legendary'>${utils_makeRoller(renderStack.join(\"\"))}</div></div>`)\r\n\t\tjqAfter(rootEl.querySelector(`#${sectionClass}s`), newThing);\r\n\t}\r\n\r\n\tif (mon.skill) {\r\n\t\tmakeSkillRoller(rootEl.querySelector(\"#skills\"));\r\n\t}\r\n\tif (mon.save) {\r\n\t\tmakeSaveRoller(rootEl.querySelector(\"#saves\"));\r\n\t}\r\n\tfunction makeSkillRoller(element) {\r\n\t\tconst $this = element;\r\n\r\n\t\tconst re = /,\\s*(?![^()]*\\))/g; // Don't split commas within parentheses\r\n\t\tconst skills = $this.innerHTML.split(re).map(s => s.trim());\r\n\t\tconst out = [];\r\n\r\n\t\tskills.map(s => {\r\n\t\t\tconst re = /(\\-|\\+)?\\d+|(?:[^\\+]|\\n(?!\\+))+/g; // Split before and after each bonus\r\n\t\t\tconst spl = s.match(re);\r\n\r\n\t\t\tconst skillName = spl[0].trim();\r\n\r\n\t\t\tvar skillString = \"\";\r\n\t\t\tspl.map(b => {\r\n\t\t\t\tconst re = /(\\-|\\+)?\\d+/;\r\n\r\n\t\t\t\tif (b.match(re)){\r\n\t\t\t\t\tconst bonus = Number(b);\r\n\t\t\t\t\tconst fromAbility = Parser.getAbilityModNumber(mon[getAttribute(skillName)]);\r\n\t\t\t\t\tconst expectedPB = getProfBonusFromCr(mon.cr);\r\n\t\t\t\t\tconst pB = bonus - fromAbility;\r\n\t\t\r\n\t\t\t\t\tconst expert = (pB === expectedPB * 2) ? 2 : 1;\r\n\t\t\t\t\tconst pBonusStr = `+${bonus}`;\r\n\t\t\t\t\tconst pDiceStr = `${expert}d${pB*(3-expert)}${fromAbility >= 0 ? \"+\" : \"\"}${fromAbility}`;\r\n\t\t\r\n\t\t\t\t\tskillString += renderSkillOrSaveRoller(skillName, pBonusStr, pDiceStr, false);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tskillString += b;\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t});\r\n\r\n\t\t\tout.push(skillString);\r\n\t\t});\t\t\r\n\r\n\t\t$this.innerHTML = (out.join(\", \"));\r\n\t}\r\n\tfunction makeSaveRoller(element) {\r\n\t\tconst $this = element;\r\n\t\tconst saves = $this.innerHTML.split(\",\").map(s => s.trim());\r\n\t\tconst out = [];\r\n\t\tsaves.map(s => {\r\n\t\t\tconst spl = s.split(\"+\").map(s => s.trim());\r\n\t\t\tconst bonus = Number(spl[1]);\r\n\t\t\tconst fromAbility = Parser.getAbilityModNumber(mon[spl[0].toLowerCase()]);\r\n\t\t\tconst expectedPB = getProfBonusFromCr(mon.cr);\r\n\t\t\tconst pB = bonus - fromAbility;\r\n\r\n\t\t\tconst expert = (pB === expectedPB * 2) ? 2 : 1;\r\n\t\t\tconst pBonusStr = `+${bonus}`;\r\n\t\t\tconst pDiceStr = `${expert}d${pB*(3-expert)}${fromAbility >= 0 ? \"+\" : \"\"}${fromAbility}`;\r\n\r\n\t\t\tout.push(spl[0] + ' ' + renderSkillOrSaveRoller(spl[0], pBonusStr, pDiceStr, true));\r\n\t\t});\r\n\t\t$this.innerHTML = (out.join(\", \"));\r\n\t}\r\n\tfunction renderSkillOrSaveRoller(itemName, profBonusString, profDiceString, isSave) {\r\n\t\tconst mode = PROF_MODE_BONUS;\r\n\t\treturn `<span class='roller' title=\"${itemName} ${isSave ? \" save\" : \"\"}\" data-roll-alt=\"1d20;${profDiceString}\" data-roll='1d20${profBonusString}' ${ATB_PROF_MODE}='${mode}' ${ATB_PROF_DICE_STR}=\"+${profDiceString}\" ${ATB_PROF_BONUS_STR}=\"${profBonusString}\">${profBonusString}</span>`;\r\n\t}\r\n\r\n\t// inline rollers\r\n\tconst statPEls = rootEl.querySelectorAll(\"#stats p\");\r\n\tfor (let statPEl of statPEls) {\r\n\t\taddNonD20Rollers(statPEl);\r\n\r\n\t\t// add proficiency dice stuff for attack rolls, since those _generally_ have proficiency\r\n\t\t// this is not 100% accurate; for example, ghouls don't get their prof bonus on bite attacks\r\n\t\t// fixing it would probably involve machine learning though; we need an AI to figure it out on-the-fly\r\n\t\t// (Siri integration forthcoming)\r\n\t\tconst titleMaybe = attemptToGetTitle(statPEl);\r\n\t\tconst mode = PROF_MODE_BONUS;\r\n\r\n\t\tstatPEl.innerHTML = (statPEl.innerHTML.replace(/(\\-|\\+)?\\d+(?= to hit)/g, function(match) {\r\n\t\t\tconst bonus = Number(match);\r\n\r\n\t\t\tconst expectedPB = getProfBonusFromCr(mon.cr);\r\n\t\t\tconst withoutPB = bonus - expectedPB;\r\n\r\n\t\t\tif (expectedPB > 0) {\r\n\t\t\t\tconst profDiceString = `1d${expectedPB*2}${withoutPB >= 0 ? \"+\" : \"\"}${withoutPB}`;\r\n\r\n\t\t\t\treturn `<span class='roller' ${titleMaybe ? `title=\"${titleMaybe}\"` : \"\"} data-roll-alt='1d20;${profDiceString}' data-roll='1d20${match}' ${ATB_PROF_MODE}='${mode}' ${ATB_PROF_DICE_STR}=\"+${profDiceString}\" ${ATB_PROF_BONUS_STR}=\"${match}\">${match}</span>`\r\n\t\t\t} else {\r\n\t\t\t\treturn `<span class='roller' data-roll='1d20${match}'>${match}</span>`; // if there was no proficiency bonus to work with, fall back on this\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tstatPEl.innerHTML = (statPEl.innerHTML.replace(/DC\\s*(\\d+)/g, function(match, capture) {\r\n\t\t\tconst dc = Number(capture);\r\n\r\n\t\t\tconst expectedPB = getProfBonusFromCr(mon.cr);\r\n\r\n\t\t\tif (expectedPB > 0) {\r\n\t\t\t\tconst withoutPB = dc - expectedPB;\r\n\t\t\t\tconst profDiceString = `1d${(expectedPB*2)}${withoutPB >= 0 ? \"+\" : \"\"}${withoutPB}`;\r\n\r\n\t\t\t\treturn `DC <span class=\"dc-roller\" ${titleMaybe ? `title=\"${titleMaybe}\"` : \"\"} ${ATB_PROF_MODE}=\"${mode}\" data-roll-alt=\"${profDiceString}\" data-bonus=\"${capture}\" ${ATB_PROF_DICE_STR}=\"+${profDiceString}\" ${ATB_PROF_BONUS_STR}=\"${capture}\">${capture}</span>`;\r\n\t\t\t} else {\r\n\t\t\t\treturn match; // if there was no proficiency bonus to work with, fall back on this\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\taddNonD20Rollers(rootEl.querySelector(\"#stats #hp\"));\r\n\tfunction addNonD20Rollers (ele) {\r\n\t\tele.innerHTML = ele.innerHTML.replace(/\\d+d\\d+(\\s?(\\-|\\+)\\s?\\d+\\s?)?/g, function(match) {\r\n      const titleMaybe = attemptToGetTitle(ele);\r\n      return `<span class='roller' ${titleMaybe ? `title=\"${titleMaybe}\"` : \"\"} data-roll='${match}'>${match}</span>`;\r\n    });\r\n\t}\r\n\tfunction attemptToGetTitle(ele) {\r\n\t\tlet titleMaybe = ele.parentElement.querySelector(\".name\");\r\n\t\tif (titleMaybe) {\r\n\t\t\ttitleMaybe = titleMaybe.innerHTML;\r\n\t\t\tif (titleMaybe) {\r\n\t\t\t\ttitleMaybe = titleMaybe.substring(0, titleMaybe.length-1).trim();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn titleMaybe;\r\n\t}\r\n\r\n\t//$(\".spells span.roller\").contents().unwrap();\r\n\tlet statsRollerEls = rootEl.querySelectorAll(\"#stats span.roller\");\r\n\tfor (let statsRollerEl of statsRollerEls) {\r\n\t\tstatsRollerEl.addEventListener('click', () => {\r\n\t\t\tconst $this = statsRollerEl;\r\n\t\t\tlet roll;\r\n\t\t\tlet rollResult;\r\n\t\t\tif ($this.getAttribute(ATB_PROF_MODE) === PROF_MODE_DICE) {\r\n\t\t\t\troll = $this.getAttribute(\"data-roll-alt\").replace(/\\s+/g, \"\");\r\n\t\t\t\t// hacks because droll doesn't support e.g. \"1d20+1d4+2\" :joy: :ok_hand:\r\n\t\t\t\tconst multi = roll.split(\";\");\r\n\t\t\t\troll = roll.replace(\";\", \"+\");\r\n\t\t\t\trollResult = droll.roll(multi[0]);\r\n\t\t\t\tconst res2 = droll.roll(multi[1]);\r\n\t\t\t\trollResult.rolls = rollResult.rolls.concat(res2.rolls);\r\n\t\t\t\trollResult.total += res2.total;\r\n\t\t\t} else {\r\n\t\t\t\troll = $this.getAttribute(\"data-roll\").replace(/\\s+/g, \"\");\r\n\t\t\t\trollResult = droll.roll(roll);\r\n\t\t\t}\r\n\t\t\toutputRollResult($this, roll, rollResult);\r\n\t\t});\r\n\t}\r\n\t\r\n\tlet statsDCRollerEls = rootEl.querySelectorAll(\"#stats span.roller\");\r\n\tfor (let statsDCRollerEl of statsDCRollerEls) {\r\n\t\tconst $this = statsDCRollerEl;\r\n    let roll;\r\n    let rollResult;\r\n    if ($this.getAttribute(ATB_PROF_MODE) === PROF_MODE_DICE) {\r\n      roll = $this.getAttribute(\"data-roll-alt\").replace(/\\s+/g, \"\");\r\n      rollResult = droll.roll(roll);\r\n      outputRollResult($this, roll, rollResult);\r\n    }\r\n\t}\r\n\r\n\tfunction outputRollResult($ele, roll, rollResult) {\r\n\t\tconst name = window.monsterName;\r\n\t\tconst newResult = parseHTML(\r\n      `<span>${name}: <em>${roll}</em> rolled ${\r\n        $ele.getAttribute(\"title\") ? `${$ele.getAttribute(\"title\")} ` : \"\"\r\n      }for <strong>${rollResult.total}</strong> (<em>${rollResult.rolls.join(\", \")}</em>)<br></span>`\r\n\t\t);\r\n\t\tconst outputEl = rootEl.querySelector(\"#output\");\r\n\t\tjqPrepend(outputEl, newResult);\r\n\t\toutputEl.style.display = 'block';\r\n\t\tif (outputEl.children.length === MAX_ROLLS + 1) {\r\n\t\t\toutputEl.children[MAX_ROLLS].remove();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport { renderSelection, SKILL_TO_ATB_ABV };\r\n","import { parseHTML, jqPrepend } from './utils.js';\nimport { MDCTextField } from \"@material/textfield\";\nimport { MDCNotchedOutline } from \"@material/notched-outline\";\nimport droll from \"../lib/droll.js\";\n\nfunction onLoad(rootEl) {\n  let outputEl = rootEl.querySelector(\"div#output\");\n  let total = 0,\n  historyIndex = -1;\n  \n  let diceField = new MDCTextField(rootEl.querySelector(\".mdc-text-field\"));\n  new MDCNotchedOutline(rootEl.querySelector(\".mdc-notched-outline\"));\n  \n  diceField.useNativeValidation = false;\n  \n  let outputRollResult = (roll) => {\n    let rollResult = droll.roll(roll.replace(/\\s/g, \"\"));\n    if (rollResult) {\n      let newOutput = parseHTML(`<div>\n        <em><a class='roll' data-roll='${roll}'>${roll}</a></em> rolled for <strong>${rollResult.total}</strong>${rollResult.rolls.length > 1 ? `<br>(${rollResult.rolls.join(\", \")})` : ''}\n        </div>`)\n      \n      jqPrepend(outputEl, newOutput);\n      outputEl.style.display = null;\n      addRollHandler(newOutput);\n\n      total += rollResult.total;\n      rootEl.querySelector('#total').innerHTML = total;\n      rootEl.querySelector(\".roll-total-wrap\").style.display = null;\n      rootEl.querySelector(\".roll-clear\").style.display = null;\n      diceField.value = \"\";\n    } else {\n      rootEl.querySelector(\".dice-field-container .mdc-text-field\").classList.add(\"error\");\n    }\n  };\n  \n  rootEl.querySelector(\".roll-clear\").addEventListener(\"click\", e => {\n    e.preventDefault();\n    \n    historyIndex = -1;\n    outputEl.innerHTML = '';\n    rootEl.querySelector(\".roll-total-wrap\").style.display = 'none';\n    rootEl.querySelector(\".roll-clear\").style.display = \"none\";\n    total = 0;\n  });\n  \n  rootEl.querySelector(\".roll-submit\").addEventListener(\"click\", e => {\n    e.preventDefault();\n    \n    historyIndex = -1;\n    rootEl.querySelector(\".dice-field-container .mdc-text-field\").classList.remove(\"error\");\n    let roll = rootEl.querySelector(\".roll-field\").value;\n    if (roll) {\n      outputRollResult(roll);\n    } else {\n      rootEl.querySelector(\".dice-field-container .mdc-text-field\").classList.add(\"error\");\n    }\n    rootEl.querySelector(\".roll-field\").focus();\n  });\n  \n  rootEl.querySelector(\".roll-field\").addEventListener(\"keydown\", e => {\n    let keyCode = e.keyCode || e.which,\n    historyCount = rootEl.querySelectorAll(\"#output > div\").length;\n    \n    // up\n    if (keyCode === 38) {\n      e.preventDefault();\n      if (historyIndex + 1 < historyCount) {\n        historyIndex++;\n        diceField.value = rootEl.querySelector(`#output div:eq(${historyIndex}) a.roll`).getAttribute(\"data-roll\");\n      }\n      \n      // down\n    } else if (keyCode === 40) {\n      e.preventDefault();\n      if (historyIndex - 1 > -1) {\n        historyIndex--;\n        diceField.value = rootEl.querySelector(`#output div:eq(${historyIndex}) a.roll`).getAttribute(\"data-roll\");\n      }\n      \n      // enter\n    } else if (keyCode === 13) {\n      e.preventDefault();\n      rootEl.querySelector(\".roll-submit\").click();\n      \n      // comma or period\n    } else if (keyCode === 190 || keyCode === 188) {\n      e.preventDefault();\n      diceField.value = diceField.value + \"d\";\n    } else if (keyCode === 32 || keyCode === 189 || keyCode === 187) {\n      e.preventDefault();\n      diceField.value = diceField.value + \" + \";\n    }\n  });\n  rootEl.querySelector(\".roll-field\").addEventListener(\"submit\", e => {\n    e.preventDefault();\n    rootEl.querySelector(\".roll-submit\").click();\n  })\n  rootEl.querySelector(\".roll-field\").addEventListener(\"textInput\", e => {\n    var keyData = e.originalEvent.data;\n    if (keyData && (keyData === \".\" || keyData === \",\")) {\n      e.preventDefault();\n      diceField.value = diceField.value + \"d\";\n    } else if (keyData && (keyData === \" \" || keyData === \"+\")) {\n      e.preventDefault();\n      diceField.value = diceField.value + \"+\";\n    }\n  });\n  rootEl.querySelector(\".roll-field\").addEventListener(\"focus\", e => {\n    rootEl.querySelector(\".dice-field-label\").style.display = null;\n  });\n  rootEl.querySelector(\".roll-field\").addEventListener(\"blur\", e => {\n    rootEl.querySelector(\".dice-field-label\").style.display = 'none';\n  });\n\n  let rolls = rootEl.querySelectorAll(\".roll[data-roll]\");\n  for (let roll of rolls) {\n    addRollHandler(roll);\n  }\n  \n  function addRollHandler(roll) {\n    roll.addEventListener(\"click\", e => {\n      e.preventDefault();\n\n      let roll = e.target.closest(\".roll\").getAttribute(\"data-roll\");\n      if (roll) {\n        outputRollResult(roll);\n      }\n    });\n  }\n};\n\nexport { onLoad };","import EntryRenderer from \"../util/entryrender.js\";\r\nimport Parser from \"../util/Parser.js\";\r\n\r\nconst renderer = new EntryRenderer();\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t</div>`;\r\n\r\nfunction renderSelection(spell, rootEl) {\r\n\trootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n\r\n\tconst spellHtmlString = spellHtml(spell);\r\n\r\n\trootEl.querySelector(\".stats-wrapper\").innerHTML = spellHtmlString;\r\n}\r\n\r\nfunction spellHtml(spell) {\r\n\tconst renderStack = [];\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span class=\"source source${spell.source}\" title=\"${Parser.sourceJsonToAbv(spell.source)}\">${Parser.sourceJsonToFull(spell.source)}</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span>${Parser.spLevelSchoolMetaToFull(spell.level, spell.school, spell.meta)}</span></div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span class=\"stat-name\">Casting Time: </span>${Parser.spTimeListToFull(spell.time)}</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span class=\"stat-name\">Range: </span>${Parser.spRangeToFull(spell.range)}</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span class=\"stat-name\">Components: </span>${Parser.spComponentsToFull(spell.components)}</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_med\"><span class=\"stat-name\">Duration: </span>${Parser.spDurationToFull(spell.duration)}</div>`);\r\n\trenderStack.push(`<div class='text'>`);\r\n\r\n\trenderer.recursiveEntryRender({type: \"entries\", entries: spell.entries}, renderStack, 1);\r\n\r\n\tif (spell.entriesHigherLevel) {\r\n\t\tconst higherLevelsEntryList = {type: \"entries\", entries: spell.entriesHigherLevel};\r\n\t\trenderer.recursiveEntryRender(higherLevelsEntryList, renderStack, 2);\r\n\t}\r\n\r\n\trenderStack.push(`</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_med\"><span class=\"stat-name\">Classes: </span>${Parser.spMainClassesToFull(spell.classes)}</div>`);\r\n\r\n\tif (spell.classes && spell.classes.fromSubclass) {\r\n\t\tconst currentAndLegacy = Parser.spSubclassesToCurrentAndLegacyFull(spell.classes);\r\n\t\trenderStack.push(`<div class=\"margin-bottom_med\"><span class=\"stat-name\">Subclasses: </span>${currentAndLegacy[0]}</div>`);\r\n\t\tif (currentAndLegacy[1]) {\r\n\t\t\trenderStack.push(`<div class=\"mdc-theme--text-disabled-on-background margin-bottom_med\"><span class=\"stat-name\">Subclasses (legacy): </span>${currentAndLegacy[1]}</div>`);\r\n\t\t}\r\n\t}\r\n\r\n\tif (spell.scrollNote) {\r\n\t\trenderStack.push(`<div class=\"mdc-theme--text-disabled-on-background\">`);\r\n\t\trenderer.recursiveEntryRender(\r\n\t\t\t`{@italic Note: Both the {@class ${\"Fighter\"} (${\"Eldritch Knight\"})} and the {@class ${\"Rogue\"} (${\"Arcane Trickster\"})} spell lists include all {@class ${\"Wizard\"}} spells. Spells of 5th level or higher may be cast with the aid of a spell scroll or similar.}`\r\n\t\t\t, renderStack, 2);\r\n\t\trenderStack.push(`</div>`);\r\n\t}\r\n\r\n\treturn renderStack.join('');\r\n}\r\n\r\nexport { renderSelection, spellHtml };","const HASH_SUBCLASS = \"sub:\";\r\nconst HASH_FEATURE = \"f:\";\r\nconst HASH_HIDE_FEATURES = \"hideclassfs:\";\r\nconst HASH_ALL_SOURCES = \"allsrc:\";\r\n\r\nconst CLSS_FEATURE_LINK = \"feature-link\";\r\nconst CLSS_ACTIVE = \"mdc-chip--selected\";\r\nconst CLSS_SUBCLASS_PILL = \"mdc-chip\";\r\nconst CLSS_CLASS_FEATURES_ACTIVE = \"cf-active\";\r\nconst CLSS_OTHER_SOURCES_ACTIVE = \"os-active\";\r\nconst CLSS_SUBCLASS_PREFIX = \"subclass-prefix\";\r\nconst CLSS_CLASS_FEATURE = \"class-feature\";\r\nconst CLSS_GAIN_SUBCLASS_FEATURE = \"gain-subclass-feature\";\r\nconst ID_CLASS_FEATURES_TOGGLE = \"cf-toggle\";\r\nconst ID_OTHER_SOURCES_TOGGLE = \"os-toggle\";\r\n\r\nconst STR_PROF_NONE = \"none\";\r\n\r\nconst ATB_DATA_FEATURE_LINK = \"data-flink\";\r\nconst ATB_DATA_FEATURE_ID = \"data-flink-id\";\r\nconst ATB_DATA_SC_LIST = \"data-subclass-list\";\r\n\r\nimport {\r\n  jqHeight,\r\n  parseHTML,\r\n  ascSort,\r\n  encodeForHash,\r\n  jqAfter,\r\n  jqEmpty,\r\n  isNonstandardSource,\r\n  joinConjunct,\r\n  hasBeenReprinted\r\n} from \"../js/utils.js\";\r\nimport {\r\n  HASH_LIST_SEP,\r\n  HASH_PART_SEP,\r\n  CLSS_SUBCLASS_FEATURE,\r\n  ATB_DATA_SC,\r\n  ATB_DATA_SRC,\r\n  CLSS_NON_STANDARD_SOURCE,\r\n  ATB_DATA_PART_SEP,\r\n  ATB_DATA_LIST_SEP,\r\n  HASH_START\r\n} from \"../util/consts.js\";\r\nimport EntryRenderer from '../util/entryrender.js';\r\nimport Parser from '../util/Parser.js';\r\nimport { setRouteSelection, readRouteSelection } from \"../util/routing.js\";\r\nimport renderGrid from \"../util/renderGrid.js\";\r\nimport renderList from \"../util/renderList.js\";\r\n\r\nconst renderer = new EntryRenderer();\r\nexport { onDataLoad, onClassChange, onSubChange };\r\n\r\nfunction renderStr(string) {\r\n  let renderStack = []\r\n  renderer.recursiveEntryRender(string, renderStack, 0);\r\n  return renderStack.join(\" \");\r\n}\r\n\r\nfunction onDataLoad(classes, rootEl) {\r\n\t// alphabetically sort subclasses\r\n\tfor (const c of classes) {\r\n    if (c.subclasses) {\r\n      c.subclasses = c.subclasses.sort((a, b) => {\r\n        return ascSort(a.name, b.name)\r\n      });\r\n    }\r\n\t}\r\n\r\n  const sortedClasses = classes.filter(c => !c.name.includes('Sidekick'));\r\n\r\n  // store classTable template from inital dom\r\n  window.classTableDefault = rootEl.querySelector(\"#classtable\").innerHTML;\r\n  \r\n  renderList(rootEl, sortedClasses);\r\n}\r\n\r\nfunction onClassChange(curClass, rootEl) {\r\n  rootEl.querySelector(\"#classtable\").innerHTML = window.classTableDefault;\r\n  rootEl.querySelector(\"#subclasses\").classList.remove(\"fixed\");\r\n  rootEl.querySelector(\"#subclasses\").classList.remove(\"closed\");\r\n  rootEl.querySelector(\"#subclasses\").classList.remove(\"hidden\");\r\n  rootEl.querySelector(\".mobile-clone-spells\") && rootEl.querySelector(\".mobile-clone-spells\").remove();\r\n\r\n  // SUMMARY SIDEBAR =================================================================================================\r\n  // hit dice and HP\r\n  if (curClass.hd) {\r\n    rootEl.querySelector(\"#hp\").classList.remove(\"hidden\");\r\n    rootEl.querySelector(\"#hp div#hitdice span\").innerHTML = EntryRenderer.getEntryDice(curClass.hd);\r\n    rootEl.querySelector(\"#hp div#hp1stlevel span\").innerHTML = curClass.hd.faces + \" + your Constitution modifier\";\r\n    rootEl.querySelector(\"#hp div#hphigherlevels span\").innerHTML =\r\n      `${EntryRenderer.getEntryDice(curClass.hd)} (or ${curClass.hd.faces / 2 + 1}) + your Constitution modifier per ${\r\n        curClass.name\r\n      } level after 1st`;\r\n  } else {\r\n    rootEl.querySelector(\"#hp\").classList.add(\"hidden\");\r\n  }\r\n\r\n  // save proficiency\r\n  if (curClass.proficiency) {\r\n    rootEl.querySelector(\"#prof\").classList.remove(\"hidden\");\r\n    rootEl.querySelector(\"#prof div#saves span\").innerHTML = curClass.proficiency.map(p => Parser.attAbvToFull(p)).join(\", \");\r\n  } else {\r\n    rootEl.querySelector(\"#prof\").classList.add(\"hidden\");\r\n  }\r\n\r\n  // starting proficiencies\r\n  const sProfs = curClass.startingProficiencies;\r\n  if (sProfs) {\r\n    rootEl.querySelector(\"#armor\").classList.remove(\"hidden\");\r\n    rootEl.querySelector(\"#weapons\").classList.remove(\"hidden\");\r\n    rootEl.querySelector(\"#tools\").classList.remove(\"hidden\");\r\n    rootEl.querySelector(\"#skills\").classList.remove(\"hidden\");\r\n    rootEl.querySelector(\"div#armor span\").innerHTML =\r\n      sProfs.armor === undefined\r\n        ? STR_PROF_NONE\r\n        : sProfs.armor.map(a => (a === \"light\" || a === \"medium\" || a === \"heavy\" ? a + \" armor\" : a)).join(\", \");\r\n    rootEl.querySelector(\"div#weapons span\").innerHTML =\r\n      sProfs.weapons === undefined\r\n        ? STR_PROF_NONE\r\n        : sProfs.weapons.map(w => (w === \"simple\" || w === \"martial\" ? w + \" weapons\" : w)).join(\", \");\r\n    rootEl.querySelector(\"div#tools span\").innerHTML =\r\n      sProfs.tools === undefined ? STR_PROF_NONE : sProfs.tools.join(\", \");\r\n    rootEl.querySelector(\"div#skills span\").innerHTML =\r\n      sProfs.skills === undefined ? STR_PROF_NONE : getSkillProfString(sProfs.skills);\r\n  } else {\r\n    rootEl.querySelector(\"#armor\").classList.add(\"hidden\");\r\n    rootEl.querySelector(\"#weapons\").classList.add(\"hidden\");\r\n    rootEl.querySelector(\"#tools\").classList.add(\"hidden\");\r\n    rootEl.querySelector(\"#skills\").classList.add(\"hidden\");\r\n  }\r\n\r\n  function getSkillProfString(skills) {\r\n    let numString, skillOptions, result = '';\r\n    // Different data structure for v2 classes\r\n    if (Array.isArray(skills)) {\r\n      for (let skill of skills) {\r\n        if (skill.choose) {\r\n          numString = Parser.numberToString(skill.choose.count);\r\n          skillOptions = skill.choose.from;\r\n          result += skillOptions.length === 18\r\n            ? `Choose any ${numString}.`\r\n            : `Choose ${numString} from ${joinConjunct(skillOptions, \", \", \", and \")}.`;\r\n        }\r\n      }\r\n    } else {\r\n      numString = Parser.numberToString(skills.choose);\r\n      skillOptions = skills.from;\r\n      result += skillOptions.length === 18\r\n        ? `Choose any ${numString}.`\r\n        : `Choose ${numString} from ${joinConjunct(skillOptions, \", \", \", and \")}.`;\r\n    }\r\n    return result;\r\n  }\r\n\r\n  // starting equipment\r\n  const sEquip = curClass.startingEquipment;\r\n  if (sEquip) {\r\n    rootEl.querySelector(\"#equipment\").classList.remove(\"hidden\");\r\n    const fromBackground = sEquip.additionalFromBackground\r\n      ? \"<p>You start with the following items, plus anything provided by your background.</p>\"\r\n      : \"\";\r\n    const defList = sEquip.default.length === 0 ? \"\" : `<ul><li>${sEquip.default.map(i => renderStr(i)).join(\"</li><li>\")}</ul>`;\r\n    const goldAlt =\r\n      sEquip.goldAlternative === undefined\r\n        ? \"\"\r\n        : `<p>Alternatively, you may start with ${renderStr(sEquip.goldAlternative)} gp to buy your own equipment.</p>`;\r\n    rootEl.querySelector(\"#equipment div\").innerHTML = `${fromBackground}${defList}${goldAlt}`;\r\n  } else {\r\n    rootEl.querySelector(\"#equipment\").classList.add(\"hidden\");\r\n  }\r\n\r\n  // FEATURE TABLE ===================================================================================================\r\n  let tData = curClass.classTableGroups || [];\r\n  const groupHeaders = rootEl.querySelector(\"#groupHeaders\");\r\n  const colHeaders = rootEl.querySelector(\"#colHeaders\");\r\n  const levelTrs = [];\r\n  let spellsFlag = false;\r\n  for (let subclassDef of curClass.subclasses) {\r\n    if (subclassDef.subclassTableGroups) {\r\n      tData = tData.concat(subclassDef.subclassTableGroups);\r\n    }\r\n  }\r\n  if (tData) {\r\n    for (let i = 0; i < tData.length; i++) {\r\n      const tGroup = tData[i];\r\n\r\n      const hasTitle = tGroup.title !== undefined;\r\n      let subclassData = \"\";\r\n      if (tGroup.subclasses !== undefined) {\r\n        subclassData = `${ATB_DATA_SC_LIST}=\"${tGroup.subclasses\r\n          .map(s => s.name+ATB_DATA_PART_SEP+s.source)\r\n          .join(ATB_DATA_LIST_SEP)}\"`;\r\n      }\r\n      groupHeaders.append(parseHTML(\r\n        `<th ${hasTitle ? `class=\"colGroupTitle table-cell\"` : \"\"} colspan=\"${tGroup.colLabels.length}\" ${subclassData}>${\r\n          hasTitle ? tGroup.title : \"\"\r\n        }</th>`, true, true));\r\n\r\n      for (let j = 0; j < tGroup.colLabels.length; j++) {\r\n        let lbl = tGroup.colLabels[j];\r\n        if (lbl.indexOf(\"@\") > -1) {\r\n          let renderStack = []\r\n          renderer.recursiveEntryRender(lbl, renderStack, 0);\r\n          lbl = renderStack.join(\" \");\r\n        }\r\n        colHeaders.append(parseHTML(`<th class=\"centred-col table-cell\" ${subclassData}>${lbl}</th>`, true, true));\r\n      }\r\n\r\n      if (tGroup.rows) {\r\n        for (let j = 0; j < 20; j++) {\r\n          const tr = rootEl.querySelector(`#level${j + 1}`);\r\n          levelTrs[j] = tr;\r\n          for (let k = 0; k < tGroup.rows[j].length; k++) {\r\n            let entry = tGroup.rows[j][k];\r\n            if (entry === 0) entry = \"\\u2014\";\r\n            const stack = [];\r\n            renderer.recursiveEntryRender(entry, stack, \"\", \"\");\r\n            tr.append(parseHTML(`<td class=\"centred-col\" ${subclassData}>${stack.join(\"\")}</td>`, true, true));\r\n          }\r\n        }\r\n      }\r\n      if (tGroup.rowsSpellProgression) {\r\n        for (let j = 0; j < 20; j++) {\r\n          const tr = rootEl.querySelector(`#level${j + 1}`);\r\n          levelTrs[j] = tr;\r\n          for (let k = 0; k < tGroup.rowsSpellProgression[j].length; k++) {\r\n            let entry = tGroup.rowsSpellProgression[j][k];\r\n            if (entry === 0) entry = \"\\u2014\";\r\n            const stack = [];\r\n            renderer.recursiveEntryRender(entry, stack, \"\", \"\");\r\n            tr.append(parseHTML(`<td class=\"centred-col\" ${subclassData}>${stack.join(\"\")}</td>`, true, true));\r\n          }\r\n        }\r\n      }\r\n      let combinedLabels = tGroup.colLabels.join(' ');\r\n      if (\r\n        !spellsFlag &&\r\n        (combinedLabels.indexOf(\"Spells Known\") > -1 ||\r\n          combinedLabels.indexOf(\"Cantrips Known\") > -1 ||\r\n          combinedLabels.indexOf(\"1st\") > -1 ||\r\n          combinedLabels.indexOf(\"Ki Points\") > -1 ||\r\n          combinedLabels.indexOf(\"Rages\") > -1 ||\r\n          combinedLabels.indexOf(\"Talents Known\") > -1)\r\n      ) {\r\n        spellsFlag = true;\r\n      }\r\n    }\r\n  // uses different data structure for Fighter, since no classTableGroups\r\n  } else if (curClass.classFeatures.length) {\r\n    // for each level, find and index the feature cell\r\n    for (let i = 0; i < 20; i++) {\r\n      const tr = rootEl.querySelector(`#level${i + 1}`);\r\n      levelTrs[i] = tr;\r\n    }\r\n  }\r\n\r\n  rootEl.querySelector(\"#classtable\").classList.remove(\"mobile-clone-features\");\r\n  \r\n  // Add second feature table for mobile\r\n  if (spellsFlag) {\r\n    rootEl.querySelector(\"#classtable\").classList.add(\"mobile-clone-features\");\r\n\t\tlet mobileClone = parseHTML('<div class=\"mobile-clone-spells\"></div>');\r\n\t\tmobileClone.append(rootEl.querySelector(\"#classtable\").cloneNode(true));\r\n    mobileClone.querySelector(\"#classtable\").classList.remove(\"mobile-clone-features\");\r\n    mobileClone.querySelector(\"#groupHeaders th:not(.colGroupTitle)\").remove();\r\n    mobileClone.querySelector(\"#groupHeaders .colGroupTitle\") &&\r\n      mobileClone.querySelector(\"#groupHeaders .colGroupTitle\").setAttribute(\"colspan\", \"12\");\r\n\t\tlet colHeaderEls = mobileClone.querySelectorAll(\"#colHeaders th\");\r\n\t\tfor (let colHeaderEl of colHeaderEls) {\r\n      if (colHeaderEl.textContent.toLowerCase().indexOf(\"sneak attack\") > -1) {\r\n        colHeaderEl.innerHTML = '<span title=\"Sneak Attack\">Snk Atk</span>';\r\n      } else if (colHeaderEl.textContent.toLowerCase().indexOf(\"sorcery points\") > -1) {\r\n        colHeaderEl.innerHTML = '<span title=\"Sorcery Points\">SP</span>';\r\n      } else if (colHeaderEl.textContent.toLowerCase().indexOf(\"spells known\") > -1) {\r\n        colHeaderEl.innerHTML = '<span title=\"Spells Known\">S</span>';\r\n      } else if (colHeaderEl.textContent.toLowerCase().indexOf(\"cantrips known\") > -1) {\r\n        colHeaderEl.innerHTML = '<span title=\"Cantrips Known\">C</span>';\r\n      }\r\n\t\t}\r\n    jqAfter(rootEl.querySelector(\"#classtable\"), mobileClone);\r\n  }\r\n\r\n  // FEATURE DESCRIPTIONS ============================================================================================\r\n  const renderStack = [];\r\n  let subclassIndex = 0; // the subclass array is not 20 elements\r\n  for (let i = 0; i < 20; i++) {\r\n    // track class table feature names\r\n    const tblLvlFeatures = levelTrs[i].querySelector(\".features\");\r\n    const featureNames = [];\r\n\r\n    // add class features to render stack\r\n    const lvlFeatureList = curClass.classFeatures[i];\r\n    for (let j = 0; j < lvlFeatureList.length; j++) {\r\n      const feature = lvlFeatureList[j];\r\n      console.error('feature', feature);\r\n      const featureId = HASH_FEATURE + encodeForHash(feature.name) + \"_\" + i;\r\n      const featureLinkPart = HASH_FEATURE + encodeForHash(feature.name) + i;\r\n      const featureLinkClasses = [CLSS_FEATURE_LINK];\r\n      if (isNonstandardSource(feature.source)) featureLinkClasses.push(CLSS_NON_STANDARD_SOURCE);\r\n      const featureLink = parseHTML(\r\n        `<a href=\"#${encodeForHash([curClass.name, curClass.source])}${HASH_PART_SEP}${featureLinkPart}\"\r\n          class=\"${featureLinkClasses.join(\" \")}\"\r\n          ${ATB_DATA_FEATURE_LINK}=\"${featureLinkPart}\"\r\n          ${ATB_DATA_FEATURE_ID}=\"${featureId}\">${feature.name}</a>`\r\n      );\r\n      featureLink.addEventListener(\"click\", function(e) {\r\n        e.preventDefault();\r\n        rootEl.getElementById(featureId).scrollIntoView(true);\r\n        let offset = -84 - jqHeight(rootEl.querySelector(\"#subclasses\"));\r\n        window.scrollBy(0, offset);\r\n      });\r\n      featureNames.push(featureLink);\r\n\r\n      const styleClasses = [CLSS_CLASS_FEATURE];\r\n      if (feature.gainSubclassFeature) {\r\n        styleClasses.push(CLSS_GAIN_SUBCLASS_FEATURE);\r\n      }\r\n\r\n      renderer.recursiveEntryRender(\r\n        feature,\r\n        renderStack,\r\n        0,\r\n        `<div id=\"${featureId}\" class=\"${styleClasses.join(\" \")}\" level=\"${feature.level}\">`,\r\n        `</div>`,\r\n        true\r\n      );\r\n\r\n      // add subclass features to render stack if appropriate\r\n      if (feature.gainSubclassFeature) {\r\n        for (const subClass of curClass.subclasses) {\r\n          if (subClass.subclassFeatures) {\r\n            const subFeatureList = subClass.subclassFeatures[subclassIndex];\r\n\r\n            for (let i = 0; i < subFeatureList.length; i++) {\r\n              const subFeature = subFeatureList[i];\r\n              // if this is not the subclass intro, add the subclass to the feature name\r\n              // this will only be shown if there are multiple subclasses displayed\r\n              if (subFeature.name === undefined) {\r\n                for (let m = 0; m < subFeature.entries.length; m++) {\r\n                  const childEntry = subFeature.entries[m];\r\n                  if (\r\n                    childEntry.name !== undefined &&\r\n                    !childEntry.name.startsWith(`<span class=\"${CLSS_SUBCLASS_PREFIX}\">`)\r\n                  ) {\r\n                    childEntry.name = `<span class=\"${CLSS_SUBCLASS_PREFIX}\">${subClass.name}: </span>${childEntry.name}`;\r\n                  }\r\n                }\r\n              }\r\n\r\n              const styleClasses = [CLSS_SUBCLASS_FEATURE];\r\n              const hideSource =\r\n                isNonstandardSource(subClass.source) || hasBeenReprinted(subClass.shortName, subClass.source);\r\n              if (hideSource) styleClasses.push(CLSS_NON_STANDARD_SOURCE);\r\n              if (i !== 0) styleClasses.push(\"referenced-subclass-feature\");\r\n              renderer.recursiveEntryRender(\r\n                subFeature,\r\n                renderStack,\r\n                0,\r\n                `<div class=\"${styleClasses.join(\" \")}\" ${ATB_DATA_SC}=\"${subClass.name}\" ${ATB_DATA_SRC}=\"${\r\n                  subClass.source\r\n                }\">`,\r\n                `</div>`,\r\n                true\r\n              );\r\n            }\r\n          }\r\n        }\r\n        subclassIndex++;\r\n      }\r\n    }\r\n\r\n    // render class table feature names\r\n    if (featureNames.length === 0) tblLvlFeatures.innerHTML = \"\\u2014\";\r\n    else {\r\n      for (let j = 0; j < featureNames.length; j++) {\r\n        tblLvlFeatures.append(featureNames[j]);\r\n      }\r\n    }\r\n  }\r\n  rootEl.querySelector(\"#stats\").innerHTML = renderStack.join(\"\");\r\n\r\n  // show UA/other features by default\r\n  toggleUAFeatures(true);\r\n\r\n  // CLASS FEATURE/UA/SUBCLASS PILL BUTTONS ==========================================================================\r\n  let subclassPillWrapper = rootEl.querySelector(\"div#subclasses\");\r\n  // remove any from previous class\r\n  jqEmpty(subclassPillWrapper);\r\n  subclassPillWrapper.append(parseHTML(`<div class='title'>Subclasses</div>`));\r\n  subclassPillWrapper.append(parseHTML(`<div class='subclass-wrapper'></div>`));\r\n  subclassPillWrapper = subclassPillWrapper.querySelector('.subclass-wrapper');\r\n\r\n  // show/hide UA/other sources\r\n  const allSourcesToggle = makeGenericTogglePill(\r\n    \"Show UA\",\r\n    CLSS_OTHER_SOURCES_ACTIVE,\r\n    ID_OTHER_SOURCES_TOGGLE,\r\n    HASH_ALL_SOURCES,\r\n    false,\r\n    true\r\n  );\r\n\r\n  // show/hide class features pill\r\n  makeGenericTogglePill(\r\n    \"Class Features\",\r\n    CLSS_CLASS_FEATURES_ACTIVE,\r\n    ID_CLASS_FEATURES_TOGGLE,\r\n    HASH_HIDE_FEATURES,\r\n    true\r\n  );\r\n\r\n  // subclass pills\r\n  if (curClass.subclasses) {\r\n    const subClasses = curClass.subclasses\r\n      .map(sc => ({ name: sc.name, source: sc.source, shortName: sc.shortName }))\r\n      .sort(function(a, b) {\r\n        return ascSort(a.shortName, b.shortName);\r\n      });\r\n    for (let i = 0; i < subClasses.length; i++) {\r\n      const nonStandardSource =\r\n        isNonstandardSource(subClasses[i].source) || hasBeenReprinted(subClasses[i].shortName, subClasses[i].source);\r\n      const styleClasses = [CLSS_ACTIVE, CLSS_SUBCLASS_PILL];\r\n      if (nonStandardSource) styleClasses.push(CLSS_NON_STANDARD_SOURCE);\r\n      const pillText = hasBeenReprinted(subClasses[i].shortName, subClasses[i].source)\r\n        ? `${subClasses[i].shortName} (${Parser.sourceJsonToAbv(subClasses[i].source)})`\r\n        : subClasses[i].shortName;\r\n      const pill = parseHTML(\r\n        `<div class=\"${styleClasses.join(\" \")}\" ${ATB_DATA_SC}=\"${subClasses[i].name}\" ${ATB_DATA_SRC}=\"${\r\n          subClasses[i].source\r\n        }\" title=\"Source: ${Parser.sourceJsonToFull(\r\n          subClasses[i].source\r\n        )}\"><span class='mdc-chip__text'>${pillText}</span></div>`\r\n      );\r\n      pill.addEventListener(\"click\", function() {\r\n        handleSubclassClick(pill.classList.contains(CLSS_ACTIVE), subClasses[i].name, subClasses[i].source);\r\n      });\r\n      if (nonStandardSource) pill.style.display = 'none';\r\n      subclassPillWrapper.append(pill);\r\n    }\r\n    subclassPillWrapper.append(parseHTML(`<div class='tab material-icons'>expand_less</div>`));\r\n\r\n    rootEl.querySelector(\"#subclasses .tab\").addEventListener(\"click\", () => {\r\n      rootEl.querySelector(\"#subclasses\").classList.toggle(\"closed\");\r\n    });\r\n\r\n    // if this is a UA class, toggle the \"All Sources\" button\r\n    const showUA = readRouteSelection().indexOf(HASH_ALL_SOURCES + 'true') > -1 || readRouteSelection().indexOf(HASH_ALL_SOURCES + 'false') === -1\r\n    if (showUA) {\r\n      allSourcesToggle.click();\r\n    }\r\n  } else {\r\n    rootEl.querySelector(\"#subclasses\").classList.add(\"hidden\");\r\n  }\r\n\r\n  // helper functions\r\n  function makeGenericTogglePill(pillText, pillActiveClass, pillId, hashKey, defaultActive, isUA) {\r\n    const pill = parseHTML(`<div id=\"${pillId}\" class=\"mdc-chip\"><span class=\"mdc-chip__text\">${pillText}</span></div>`);\r\n    subclassPillWrapper.append(pill);\r\n    pill.addEventListener(\"click\", function() {\r\n      let active = pill.classList.contains(pillActiveClass);\r\n      if (!defaultActive) active = !active;\r\n      handleToggleFeaturesClicks(active);\r\n      // enable UA features\r\n      if (isUA) {\r\n        toggleUAFeatures(active);\r\n        pill.querySelector('.mdc-chip__text').innerHTML = active ? \"Hide UA\" : \"Show UA\";\r\n      }\r\n    });\r\n    return pill;\r\n\r\n    function handleToggleFeaturesClicks(isPillActive) {\r\n      const outStack = [];\r\n      const split = readRouteSelection().split(HASH_PART_SEP);\r\n\r\n      for (let i = 0; i < split.length; i++) {\r\n        const hashPart = split[i];\r\n        if (!hashPart.startsWith(hashKey)) outStack.push(hashPart);\r\n      }\r\n      if (isPillActive) {\r\n        outStack.push(hashKey + \"true\");\r\n      } else {\r\n        outStack.push(hashKey + \"false\");\r\n      }\r\n      const newHash = outStack.join(HASH_PART_SEP);\r\n      setRouteSelection(newHash, true);\r\n    }\r\n  }\r\n\r\n  function handleSubclassClick(isPillActive, subclassName, subclassSource) {\r\n    const outStack = [];\r\n    const routeSelection = readRouteSelection();\r\n    const split = routeSelection.split(HASH_PART_SEP);\r\n\r\n    const encodedSubClass = encodeForHash([subclassName]);\r\n    const subclassLink = HASH_SUBCLASS + encodedSubClass;\r\n\r\n    if (isPillActive && routeSelection.includes(HASH_SUBCLASS)) {\r\n      for (let i = 0; i < split.length; i++) {\r\n        const hashPart = split[i];\r\n        if (!hashPart.startsWith(HASH_SUBCLASS)) {\r\n\t\t\t\t\toutStack.push(hashPart);\r\n\t\t\t\t} else {\r\n          const subClassStack = [];\r\n          const subClasses = hashPart.substr(HASH_SUBCLASS.length).split(HASH_LIST_SEP);\r\n          for (let j = 0; j < subClasses.length; j++) {\r\n            const subClass = subClasses[j];\r\n            if (subClass !== encodedSubClass) subClassStack.push(subClass);\r\n          }\r\n          if (subClassStack.length > 0) outStack.push(HASH_SUBCLASS + subClassStack.join(HASH_LIST_SEP));\r\n        }\r\n      }\r\n    } else {\r\n      let hasSubclassHash = false;\r\n\r\n      for (let i = 0; i < split.length; i++) {\r\n        const hashPart = split[i];\r\n        if (!hashPart.startsWith(HASH_SUBCLASS)) outStack.push(hashPart);\r\n        else {\r\n          const subClassStack = [];\r\n          const subClasses = hashPart.substr(HASH_SUBCLASS.length).split(HASH_LIST_SEP);\r\n          for (let j = 0; j < subClasses.length; j++) {\r\n            const subClass = subClasses[j];\r\n            if (subClass !== encodedSubClass) subClassStack.push(subClass);\r\n          }\r\n          subClassStack.push(encodedSubClass);\r\n          if (subClassStack.length > 0) outStack.push(HASH_SUBCLASS + subClassStack.join(HASH_LIST_SEP));\r\n\r\n          hasSubclassHash = true;\r\n        }\r\n      }\r\n\r\n      if (!hasSubclassHash) outStack.push(subclassLink);\r\n    }\r\n    const newHash = outStack.join(HASH_PART_SEP);\r\n    setRouteSelection(newHash, true);\r\n  }\r\n\r\n  function toggleUAFeatures(active) {\r\n    let nonStandardPills = rootEl.querySelectorAll(`.${CLSS_NON_STANDARD_SOURCE}`);\r\n    for (let nonStandardPill of nonStandardPills) {\r\n      if (!nonStandardPill.classList.contains(CLSS_SUBCLASS_PILL)) {\r\n        nonStandardPill.style.display = active ? null : 'none';\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction onSubChange(sub, curHash, rootEl) {\r\n\tlet subclasses = null;\r\n\tlet feature = null;\r\n\tlet hideClassFeatures = null;\r\n\tlet showAllSources = null;\r\n\r\n\tfor (let i = 0; i < sub.length; i++) {\r\n\t\tconst hashPart = sub[i];\r\n\r\n\t\tif (hashPart.startsWith(HASH_SUBCLASS)) subclasses = hashPart.slice(HASH_SUBCLASS.length).split(HASH_LIST_SEP);\r\n\t\tif (hashPart.startsWith(HASH_FEATURE)) feature = hashPart;\r\n\t\tif (hashPart.startsWith(HASH_HIDE_FEATURES)) hideClassFeatures = hashPart.slice(HASH_HIDE_FEATURES.length) === \"true\";\r\n\t\tif (hashPart.startsWith(HASH_ALL_SOURCES)) showAllSources = hashPart.slice(HASH_ALL_SOURCES.length) === \"true\";\r\n\t}\r\n\r\n\tconst hideOtherSources = showAllSources === null || showAllSources === false;\r\n\r\n\tif (subclasses !== null) {\r\n\t\tupdateClassTableLinks();\r\n\r\n\t\tconst $toShow = [];\r\n\t\tconst $toHide = [];\r\n\t\tconst $subClassSpanList = rootEl.querySelectorAll(`.${CLSS_SUBCLASS_PILL}`);\r\n\t\tfor (let classSpan of $subClassSpanList) {\r\n\t\t\tconst $this = classSpan;\r\n      const name = $this.getAttribute(ATB_DATA_SC);\r\n\t\t\tconst thisSc = encodeForHash([name]);\r\n\t\t\tlet shown = false;\r\n\r\n\t\t\tfor (let j = 0; j < subclasses.length; j++) {\r\n\t\t\t\tconst sc = subclasses[j];\r\n\t\t\t\tif (sc.trim() === thisSc) {\r\n\t\t\t\t\tshown = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (shown) {\r\n\t\t\t\t$toShow.push($this);\r\n\t\t\t} else {\r\n\t\t\t\t$toHide.push($this);\r\n\t\t\t}\r\n\t\t}\r\n\r\n    const otherSrcSubFeats = rootEl.querySelectorAll(`p.${CLSS_NON_STANDARD_SOURCE}`);\r\n    const shownInTable = [];\r\n\r\n    for (let v of $toShow) {\r\n      v.classList.add(CLSS_ACTIVE);\r\n      let selectedSCFeatures = rootEl.querySelectorAll(`.${CLSS_SUBCLASS_FEATURE}[${ATB_DATA_SC}=\"${v.getAttribute(ATB_DATA_SC)}\"][${ATB_DATA_SRC}=\"${v.getAttribute(ATB_DATA_SRC)}\"]`);\r\n      for (let selectedSCFeature of selectedSCFeatures) {\r\n        selectedSCFeature.style.display = null;\r\n      }\r\n      if (hideOtherSources) {\r\n        for (let otherSrcSubFeat of otherSrcSubFeats) {\r\n          if (\r\n            otherSrcSubFeat.getAttribute(ATB_DATA_SC) === v.getAttribute(ATB_DATA_SC) &&\r\n            otherSrcSubFeat.getAttribute(ATB_DATA_SRC) === v.getAttribute(ATB_DATA_SRC)\r\n          ) {\r\n            otherSrcSubFeat.style.display = \"none\";\r\n          }\r\n        }\r\n      } else {\r\n        for (let otherSrcSubFeat of otherSrcSubFeats) {\r\n          if (\r\n            otherSrcSubFeat.getAttribute(ATB_DATA_SC) === v.getAttribute(ATB_DATA_SC) &&\r\n            otherSrcSubFeat.getAttribute(ATB_DATA_SRC) === v.getAttribute(ATB_DATA_SRC)\r\n          ) {\r\n            otherSrcSubFeat.style.display = null;\r\n          }\r\n        }\r\n      }\r\n\r\n      const asInTable = v.getAttribute(ATB_DATA_SC) + ATB_DATA_PART_SEP + v.getAttribute(ATB_DATA_SRC);\r\n      shownInTable.push(asInTable);\r\n    }\r\n\r\n    for (let v of $toHide) {\r\n      v.classList.remove(CLSS_ACTIVE);\r\n      let selectedSCFeatures = rootEl.querySelectorAll(`.${CLSS_SUBCLASS_FEATURE}[${ATB_DATA_SC}=\"${v.getAttribute(ATB_DATA_SC)}\"][${ATB_DATA_SRC}=\"${v.getAttribute(ATB_DATA_SRC)}\"]`);\r\n      for (let selectedSCFeature of selectedSCFeatures) {\r\n        selectedSCFeature.style.display = 'none';\r\n      }\r\n      for (let otherSrcSubFeat of otherSrcSubFeats) {\r\n        if (\r\n          otherSrcSubFeat.getAttribute(ATB_DATA_SC) === v.getAttribute(ATB_DATA_SC) &&\r\n          otherSrcSubFeat.getAttribute(ATB_DATA_SRC) === v.getAttribute(ATB_DATA_SRC)\r\n        ) {\r\n          otherSrcSubFeat.style.display = \"none\";\r\n        }\r\n      }\r\n      v.getAttribute(ATB_DATA_SC);\r\n    }\r\n    \r\n    handleTableGroups(shownInTable);\r\n\r\n    if (hideOtherSources) {\r\n      for (let otherSrcSubFeat of otherSrcSubFeats) {\r\n        if (\r\n          !otherSrcSubFeat.classList.contains(CLSS_SUBCLASS_FEATURE) &&\r\n          otherSrcSubFeat.getAttribute(ATB_DATA_SC) === EntryRenderer.DATA_NONE &&\r\n          otherSrcSubFeat.getAttribute(ATB_DATA_SRC) === EntryRenderer.DATA_NONE\r\n        ) {\r\n          otherSrcSubFeat.style.display = \"none\";\r\n        }\r\n      }\r\n    } else {\r\n      for (let otherSrcSubFeat of otherSrcSubFeats) {\r\n        if (\r\n          !otherSrcSubFeat.classList.contains(CLSS_SUBCLASS_FEATURE) &&\r\n          otherSrcSubFeat.getAttribute(ATB_DATA_SC) === EntryRenderer.DATA_NONE &&\r\n          otherSrcSubFeat.getAttribute(ATB_DATA_SRC) === EntryRenderer.DATA_NONE\r\n        ) {\r\n          otherSrcSubFeat.style.display = null;\r\n        }\r\n      }\r\n    }\r\n\r\n\t\t// show subclass prefixes if we're displaying more than 1 subclass\r\n\t\tlet subClassEls = rootEl.querySelectorAll(`.${CLSS_SUBCLASS_PREFIX}`);\r\n\t\tif ($toShow.length !== 1) {\r\n\t\t\tfor (let subClassEl of subClassEls) {\r\n\t\t\t\tsubClassEl.style.display = null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (let subClassEl of subClassEls) {\r\n\t\t\t\tsubClassEl.style.display = 'none';\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// hide class features as required\r\n\tconst cfToggle = rootEl.querySelector(`#${ID_CLASS_FEATURES_TOGGLE}`);\r\n\tconst toToggleCf= rootEl.querySelectorAll(`.${CLSS_CLASS_FEATURE}`);\r\n\tif (hideClassFeatures !== null && hideClassFeatures) {\r\n\t\tcfToggle.classList.remove(CLSS_CLASS_FEATURES_ACTIVE);\r\n\t\tfor (let el of toToggleCf) {\r\n\t\t\tif (!el.classList.contains(CLSS_GAIN_SUBCLASS_FEATURE)) {\r\n        el.style.display = \"none\";\r\n      }\r\n\t\t}\r\n\t} else {\r\n\t\tcfToggle.classList.add(CLSS_CLASS_FEATURES_ACTIVE);\r\n\t\tfor (let el of toToggleCf) {\r\n\t\t\tif (!el.classList.contains(CLSS_GAIN_SUBCLASS_FEATURE)) {\r\n        el.style.display = null;\r\n      }\r\n\t\t}\r\n\t}\r\n\r\n\t// show UA/etc content as required\r\n\tconst srcToggle = rootEl.querySelector(`#${ID_OTHER_SOURCES_TOGGLE}`);\r\n\tconst toToggleSrc = rootEl.querySelectorAll(`.${CLSS_SUBCLASS_PILL}.${CLSS_NON_STANDARD_SOURCE}`);\r\n\tif (hideOtherSources) {\r\n\t\tsrcToggle.classList.remove(CLSS_OTHER_SOURCES_ACTIVE);\r\n\t\tfor (let el of toToggleSrc) {\r\n\t\t\tel.style.display = \"none\";\r\n\t\t}\r\n\t} else {\r\n\t\tsrcToggle.classList.add(CLSS_OTHER_SOURCES_ACTIVE);\r\n\t\tfor (let el of toToggleSrc) {\r\n\t\t\tel.style.display = null;\r\n\t\t}\r\n\t}\r\n\r\n\t// scroll to the linked feature if required\r\n\tif (feature !== null && (window.prevFeature === undefined || window.prevFeature !== feature)) {\r\n\t\trootEl.getElementById(rootEl.querySelectorAll(`[${ATB_DATA_FEATURE_LINK}=\"${feature}\"]`).getAttribute(ATB_DATA_FEATURE_ID)).scrollIntoView();\r\n\t\twindow.prevFeature = feature;\r\n\t}\r\n\r\n\tupdateClassTableLinks();\r\n\r\n  function handleTableGroups(toShow) {\r\n    let listEls = rootEl.querySelectorAll(`[${ATB_DATA_SC_LIST}]`);\r\n    for (let el of listEls) {\r\n      const scs = el.getAttribute(ATB_DATA_SC_LIST).split(ATB_DATA_LIST_SEP);\r\n\r\n      for (let shown of toShow) {\r\n        if (scs.includes(shown)) {\r\n          el.style.display = null;\r\n          break;\r\n        }\r\n          el.style.display = 'none';\r\n        }\r\n      }\r\n\t}\r\n\r\n\tfunction updateClassTableLinks () {\r\n\t\tconst hashParts = curHash.slice(1).split(HASH_PART_SEP);\r\n\t\tconst outParts = [];\r\n\t\tfor (let i = 0; i < hashParts.length; i++) {\r\n\t\t\tconst part = hashParts[i];\r\n\t\t\tif (!part.startsWith(HASH_FEATURE)) outParts.push(part);\r\n\t\t}\r\n\t\tlet els = rootEl.querySelectorAll(`.${CLSS_FEATURE_LINK}`);\r\n\t\tfor (let el of els) {\r\n\t\t\tel.href = HASH_START+outParts.join(HASH_PART_SEP)+HASH_PART_SEP+el.getAttribute(ATB_DATA_FEATURE_LINK);\r\n\t\t}\r\n\t}\r\n}\r\n","import { setRouteSelection } from \"./routing\";\nimport { encodeForHash, parseHTML } from \"../js/utils\";\nimport Parser from \"./Parser\";\n\nexport default function renderList(rootEl, items) {\n  const container = rootEl.querySelector('.class-container');\n  container.appendChild(parseHTML(\"<div class='list-container'></div>\"))\n  const listWrapper = container.querySelector('.list-container');\n\n  let htmlString = \"\";\n\tfor (let i = 0; i < items.length; i++) {\n\t\tconst curItem = items[i];\n\t\tlet svg = curItem.name.replace(/(\\s|\\(|\\))/g, \"\");\n\t\tlet link = encodeForHash([curItem.name, curItem.source]);\n\n\t\thtmlString += \n\t\t\t`<div class='list-item history-link grid-item__${svg}' data-link='${link}' data-title='${curItem.name}'>\n\t\t\t\t<div>\n\t\t\t\t\t<dnd-svg id='${svg}' default-color class='list-item--image grid-item__${svg}'></dnd-svg>\n\t\t\t\t\t<span class='list-item--text'>${curItem.name}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"list-item--subtext\">${Parser.sourceJsonToFull(curItem.source)}</div>\n\t\t\t</div>`\n\t}\n\tlet itemElements = parseHTML(htmlString);\n\twhile (itemElements.length > 0) {\n\t\titemElements[0].addEventListener(\"click\", (e) => {\n\t\t\tlet tar = e.target.closest(\".list-item\");\n\t\t\tsetRouteSelection(tar.getAttribute(\"data-link\"));\n\t\t});\n\t\tlistWrapper.appendChild(itemElements[0]);\n\t}\n};","var map = {\n\t\"./backgrounds.js\": 123,\n\t\"./bestiary.js\": 118,\n\t\"./classes.js\": 121,\n\t\"./conditions.js\": 124,\n\t\"./cults.js\": 125,\n\t\"./dice.js\": 119,\n\t\"./feats.js\": 126,\n\t\"./features.js\": 127,\n\t\"./items.js\": 117,\n\t\"./psionics.js\": 128,\n\t\"./races.js\": 129,\n\t\"./rewards.js\": 130,\n\t\"./spells.js\": 120,\n\t\"./utils.js\": 1,\n\t\"./variantrules.js\": 131\n};\n\n\nfunction webpackAsyncContext(req) {\n\treturn webpackAsyncContextResolve(req).then(__webpack_require__);\n}\nfunction webpackAsyncContextResolve(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tif(!__webpack_require__.o(map, req)) {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t}\n\t\treturn map[req];\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.resolve = webpackAsyncContextResolve;\nwebpackAsyncContext.id = 122;\nmodule.exports = webpackAsyncContext;","import {parseHTML, jqHeight, jqPrepend, encodeForHash } from \"../js/utils.js\";\r\nimport Parser from \"../util/Parser.js\";\r\nimport EntryRenderer from \"../util/entryrender.js\";\r\nimport { resolveHash } from \"../util/renderTable.js\";\r\n\r\nconst renderer = new EntryRenderer();\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"source margin-bottom_small\"></div>\r\n\t\t<div class=\"stats margin-bottom_small\"></div>\r\n\t\t<div class=\"table-container collapse collapse--left-arrow disabled\">\r\n\t\t\t<div class=\"collapse-toggle\">\r\n\t\t\t\t<div class=\"mdc-list-item stat-name\">Suggested Characteristics</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"collapse-wrapper\">\r\n\t\t\t\t<div class=\"collapse-list\"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(curbg, rootEl, allBgs) {\r\n  if (rootEl.querySelector(\".selection-wrapper\")) {\r\n    rootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n  } else {\r\n    rootEl.innerHTML = stats_wrapper;\r\n  }\r\n  while (curbg._copy) {\r\n    const foundCopy = resolveHash(allBgs, encodeForHash([curbg._copy.name, curbg._copy.source]));\r\n    curbg = foundCopy;\r\n  }\r\n  const source = curbg.source;\r\n  const sourceAbv = Parser.sourceJsonToAbv(source);\r\n  const sourceFull = Parser.sourceJsonToFull(source);\r\n\r\n  const sourceEl = rootEl.querySelector(\".stats-wrapper .source\");\r\n  sourceEl.classList.add(`source${sourceAbv}`);\r\n\tsourceEl.setAttribute(\"title\", sourceFull);\r\n\tsourceEl.innerHTML = sourceFull;\r\n\r\n  const entries = curbg.entries;\r\n\r\n  if (entries && entries.length) {\r\n    for (let n = entries.length - 1; n >= 0; n--) {\r\n      let entry = entries[n],\r\n        outStack = [];\r\n      renderer.recursiveEntryRender(entry, outStack, 0);\r\n      let texthtml = outStack.join(' ');\r\n\r\n      if (entry.name === \"Suggested Characteristics\") {\r\n        rootEl.querySelector(\".stats-wrapper .table-container\").classList.remove(\"disabled\");\r\n        const collapseList = rootEl.querySelector(\".stats-wrapper .table-container .collapse-list\");\r\n        const traitTables = parseHTML(texthtml);\r\n        traitTables.querySelector(\".stat-name\").remove();\r\n        jqPrepend(collapseList, traitTables);\r\n      } else {\r\n        const statsEl = rootEl.querySelector(\".stats-wrapper .stats\");\r\n        jqPrepend(statsEl, parseHTML(texthtml));\r\n      }\r\n    }\r\n  }\r\n\r\n  window.setTimeout(() => {\r\n    let list = rootEl.querySelector(\".stats-wrapper .table-container .collapse-list\");\r\n    list.style[\"margin-top\"] = \"-\" + jqHeight(list) + \"px\";\r\n  }, 0);\r\n}\r\n\r\nexport { renderSelection };\r\n","import { utils_combineText } from \"../js/utils.js\";\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(curcondition, rootEl) {\r\n  rootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n  rootEl.querySelector(\".stats-wrapper .text\").innerHTML = utils_combineText(curcondition.entries, \"p\");\r\n}\r\n\r\nexport { renderSelection };","import {\r\n  utils_combineText,\r\n} from \"../js/utils.js\";\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(curcult, rootEl) {\r\n\trootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n\r\n  const textlist = curcult.text;\r\n  let texthtml = \"\";\r\n\r\n  if (curcult.goal !== undefined)\r\n    texthtml += utils_combineText(curcult.goal.text, \"p\", \"<span class='stat-name'>Goals:</span> \");\r\n  if (curcult.cultists !== undefined)\r\n    texthtml += utils_combineText(curcult.cultists.text, \"p\", \"<span class='stat-name'>Typical Cultist:</span> \");\r\n  if (curcult.signaturespells !== undefined)\r\n    texthtml += utils_combineText(\r\n      curcult.signaturespells.text,\r\n      \"p\",\r\n      \"<span class='stat-name'>Signature Spells:</span> \"\r\n    );\r\n  texthtml += utils_combineText(textlist, \"p\");\r\n\r\n  rootEl.querySelector(\".stats-wrapper .text\").innerHTML = texthtml;\r\n}\r\n\r\nexport {renderSelection};","import { utils_makePrerequisite } from \"../js/utils.js\";\r\nimport { parse_abilityLong } from \"../util/ability.js\";\r\nimport Parser from '../util/Parser.js';\r\nimport EntryRenderer from \"../util/entryrender.js\";\r\n\r\nconst renderer = new EntryRenderer();\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"source margin-bottom_small\"></div>\r\n\t\t<div class=\"prerequisite margin-bottom_small\"></div>\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(feat, rootEl) {\r\n\trootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n\r\n\tlet sourceEl = rootEl.querySelector('.stats-wrapper .source');\r\n\tlet sourceAbr = Parser.sourceJsonToAbv(feat.source);\r\n\tlet sourceFull =  Parser.sourceJsonToFull(feat.source);\r\n\tsourceEl.classList.add(`source${feat.source}`);\r\n\tsourceEl.setAttribute(\"title\", sourceAbr);\r\n\tsourceEl.innerHTML = sourceFull;\r\n\r\n\tconst prerequisite = utils_makePrerequisite(feat.prerequisite);\r\n\trootEl.querySelector('.stats-wrapper .prerequisite').innerHTML = (prerequisite ? \"Prerequisite: \" + prerequisite : \"\");\r\n\t\r\n\tif (feat.ability) {\r\n\t\tfor (let entry of feat.entries) { \r\n\t\t\t// insert the new list item at the head of the first list we find list; flag with \"hasabilityitem\" so we don't do it more than once\r\n\t\t\tif (entry.type === \"list\" && !entry.hasabilityitem) {\r\n\t\t\t\tentry.hasabilityitem = true;\r\n\t\t\t\tentry.items.unshift(parse_abilityLong(feat.ability))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tif (feat.entries.length) {\r\n\t\tlet outstack = [];\r\n\t\tfor (let entry of feat.entries) {\r\n\t\t\trenderer.recursiveEntryRender(entry, outstack, 0);\r\n\t\t}\r\n\t\trootEl.querySelector('.stats-wrapper .text').innerHTML = outstack.join(' ');\r\n\t}\r\n}\r\n\r\nexport { renderSelection };","import { utils_makePrerequisite, utils_joinPhraseArray } from \"../js/utils.js\";\nimport { parse_abilityLong } from \"../util/ability.js\";\nimport Parser from '../util/Parser.js';\nimport EntryRenderer from \"../util/entryrender.js\";\n\nconst renderer = new EntryRenderer();\n\nconst stats_wrapper = `\n\t<div class=\"stats-wrapper margin-bottom_large\">\n    <div class=\"source margin-bottom_small\"></div>\n    <div class=\"type margin-bottom_small\"></div>\n\t\t<div class=\"prerequisite margin-bottom_small\"></div>\n\t\t<div class=\"text\"></div>\n\t</div>`;\n\nfunction renderSelection(feature, rootEl) {\n\trootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\n\n\tconst sourceEl = rootEl.querySelector('.stats-wrapper .source'),\n\t\tsourceAbr = Parser.sourceJsonToAbv(feature.source),\n\t\tsourceFull =  Parser.sourceJsonToFull(feature.source);\n\tsourceEl.classList.add(`source${feature.source}`);\n\tsourceEl.setAttribute(\"title\", sourceAbr);\n\tsourceEl.innerHTML = sourceFull;\n\n  let typeArray = feature.featureType ? Array.isArray(feature.featureType) ? feature.featureType : [feature.featureType] : [];\n\trootEl.querySelector('.stats-wrapper .type').innerHTML = utils_joinPhraseArray(typeArray.map(t => {return Parser.featureJsonToAbv(t)}), \", \", \" and \")\n\n\tconst prerequisite = utils_makePrerequisite(feature.prerequisite);\n\trootEl.querySelector('.stats-wrapper .prerequisite').innerHTML = (prerequisite ? \"Prerequisite: \" + prerequisite : \"\");\n\t\n\tif (feature.ability) {\n\t\tfor (let entry of feature.entries) { \n\t\t\t// insert the new list item at the head of the first list we find list; flag with \"hasabilityitem\" so we don't do it more than once\n\t\t\tif (entry.type === \"list\" && !entry.hasabilityitem) {\n\t\t\t\tentry.hasabilityitem = true;\n\t\t\t\tentry.items.unshift(parse_abilityLong(feature.ability))\n\t\t\t}\n\t\t}\n\t}\n\t\n\tif (feature.entries.length) {\n\t\tlet outstack = [];\n\t\tfor (let entry of feature.entries) {\n\t\t\trenderer.recursiveEntryRender(entry, outstack, 0);\n\t\t}\n\t\trootEl.querySelector('.stats-wrapper .text').innerHTML = outstack.join(' ');\n\t}\n}\n\nexport { renderSelection };","import { utils_combineText, parse_psionicTypeToFull } from \"../js/utils.js\";\r\nimport { ELE_P, STR_EMPTY } from \"../util/consts.js\";\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"order margin-bottom_small\"></div>\r\n\t\t<div class=\"duration margin-bottom_small\"></div>\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(selectedPsionic, rootEl) {\r\n  rootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n  const STATS_ORDER_AND_TYPE = rootEl.querySelector(\".stats-wrapper .order\");\r\n  const STATS_DURATION = rootEl.querySelector(\".stats-wrapper .duration\");\r\n  const STATS_TEXT = rootEl.querySelector(\".stats-wrapper .text\");\r\n\r\n  if (selectedPsionic.type === \"T\") loadTalent();\r\n  else if (selectedPsionic.type === \"D\") loadDiscipline();\r\n\r\n  function loadTalent() {\r\n    STATS_ORDER_AND_TYPE.innerHTML = parse_psionicTypeToFull(selectedPsionic.type);\r\n    STATS_TEXT.innerHTML = utils_combineText(selectedPsionic.text, ELE_P);\r\n    STATS_DURATION.innerHTML = STR_EMPTY;\r\n  }\r\n  function loadDiscipline() {\r\n    STATS_ORDER_AND_TYPE.innerHTML = `${selectedPsionic.order} ${parse_psionicTypeToFull(selectedPsionic.type)}`;\r\n    STATS_TEXT.innerHTML = getTextString();\r\n    STATS_DURATION.innerHTML = getDurationString();\r\n\r\n    function getTextString() {\r\n      const modeStringArray = [];\r\n      for (let i = 0; i < selectedPsionic.modes.length; ++i) {\r\n        modeStringArray.push(getModeString(i));\r\n      }\r\n\r\n      return `${getDescriptionString()}${getFocusString()}${modeStringArray.join(STR_EMPTY)}`;\r\n    }\r\n    function getDescriptionString() {\r\n      return `<p>${selectedPsionic.description}</p>`;\r\n    }\r\n    function getFocusString() {\r\n      return `<p><span class='stat-name'>Psycic Focus.</span> ${selectedPsionic.focus}</p>`;\r\n    }\r\n    function getModeString(modeIndex) {\r\n      const modeString = utils_combineText(\r\n        selectedPsionic.modes[modeIndex].text,\r\n        ELE_P,\r\n        getModeTitle(selectedPsionic.modes[modeIndex])\r\n      );\r\n      if (selectedPsionic.modes[modeIndex].submodes === undefined) return modeString;\r\n      const subModeString = getSubModeString();\r\n      return `${modeString}${subModeString}`;\r\n\r\n      function getSubModeString() {\r\n        const modeStrings = [];\r\n        const subModes = selectedPsionic.modes[modeIndex].submodes;\r\n        for (let i = 0; i < subModes.length; ++i) {\r\n          modeStrings.push(utils_combineText(subModes[i].text, ELE_P, getModeTitle(subModes[i], true)));\r\n        }\r\n        return modeStrings.join(STR_EMPTY);\r\n      }\r\n\r\n      function getModeTitle(mode, subMode) {\r\n        subMode = subMode === undefined || subMode === null ? false : subMode;\r\n        const modeTitleArray = [];\r\n        modeTitleArray.push(mode.title);\r\n        const bracketPart = getModeTitleBracketPart();\r\n        if (bracketPart !== null) modeTitleArray.push(bracketPart);\r\n        if (subMode) return `<span class='stat-name'>${modeTitleArray.join(\" \")}.</span> `;\r\n        else return `<span class='stat-name'>${modeTitleArray.join(\" \")}.</span> `;\r\n\r\n        function getModeTitleBracketPart() {\r\n          const modeTitleBracketArray = [];\r\n\r\n          if (mode.cost) modeTitleBracketArray.push(getModeTitleCost());\r\n          if (mode.concentration) modeTitleBracketArray.push(getModeTitleConcentration());\r\n\r\n          if (modeTitleBracketArray.length === 0) return null;\r\n          return `(${modeTitleBracketArray.join(\"; \")})`;\r\n\r\n          function getModeTitleCost() {\r\n            const costMin = mode.cost.min;\r\n            const costMax = mode.cost.max;\r\n            const costString = costMin === costMax ? costMin : `${costMin}-${costMax}`;\r\n            return `${costString} psi`;\r\n          }\r\n          function getModeTitleConcentration() {\r\n            return `conc., ${mode.concentration.duration} ${mode.concentration.unit}.`;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  function getDurationString() {\r\n    const duration = selectedPsionic.duration;\r\n    if (duration === undefined) return STR_EMPTY;\r\n    else return getDurationElement();\r\n\r\n    function getDurationElement() {}\r\n  }\r\n}\r\n\r\nexport { renderSelection };\r\n","import { utils_combineText } from \"../js/utils.js\";\r\nimport EntryRenderer from \"../util/entryrender.js\";\r\nimport Parser from \"../util/Parser.js\";\r\nimport { parse_abilityShort } from \"../util/ability.js\";\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"source margin-bottom_small\"></div>\r\n\t\t<div class=\"size margin-bottom_small\"></div>\r\n\t\t<div class=\"ability margin-bottom_small\"></div>\r\n\t\t<div class=\"speed margin-bottom_small\"></div>\r\n\t\t<div class=\"stats\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(race, rootEl) {\r\n  if (rootEl.querySelector(\".selection-wrapper\")) {\r\n    rootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n  } else {\r\n    rootEl.innerHTML = stats_wrapper;\r\n  }\r\n  const sourceEl = rootEl.querySelector(\".stats-wrapper .source\");\r\n  sourceEl.classList.add(`source${race.source}`);\r\n  sourceEl.setAttribute(\"title\", Parser.sourceJsonToAbv(race.source));\r\n  sourceEl.innerHTML = Parser.sourceJsonToFull(race.source);\r\n\r\n  const size = Parser.sizeAbvToFull(race.size);\r\n  rootEl.querySelector(\".stats-wrapper .size\").innerHTML = size;\r\n  if (size === \"\") {\r\n    rootEl.querySelector(\".stats-wrapper .size\").style.display = \"none\";\r\n  }\r\n\r\n  const ability = parse_abilityShort(race.ability);\r\n  rootEl.querySelector(\".stats-wrapper .ability\").innerHTML = ability;\r\n\r\n  let speed;\r\n  if (race.speed) {\r\n    if (race.speed.walk) {\r\n      speed = race.speed.walk + \" ft.\";\r\n      if (race.speed.climb) speed += `, climb ${race.speed.climb} ft.`;\r\n      if (race.speed.fly) speed += `, fly ${race.speed.fly} ft.`;\r\n    } else {\r\n      speed = race.speed + (race.speed === \"Varies\" ? \"\" : \" ft. \");\r\n    }\r\n  }\r\n  rootEl.querySelector(\".stats-wrapper .speed\").innerHTML = speed;\r\n  if (speed === \"\") {\r\n    rootEl.querySelector(\".stats-wrapper .speed\").style.display = \"none\";\r\n  }\r\n\r\n  const traitlist = race.trait;\r\n  if (traitlist) {\r\n    let statsText = \"<div class='stat-item'>\";\r\n    for (let n = 0; n < traitlist.length; ++n) {\r\n      const trait = traitlist[n];\r\n\r\n      const header = `<span class='stat-name'>${trait.name}.</span> `;\r\n      statsText += utils_combineText(traitlist[n].text, \"p\", header);\r\n    }\r\n    statsText += \"</div>\";\r\n    rootEl.querySelector(\".stats-wrapper .stats\").innerHTML = statsText;\r\n  } else if (race.entries) {\r\n    const renderStack = [];\r\n    const faux = { type: \"entries\", entries: race.entries };\r\n\r\n    // Grung to test with\r\n    new EntryRenderer().recursiveEntryRender(faux, renderStack, 1, \"<div class='renderer-output'>\", \"</div>\", true);\r\n\r\n    rootEl.querySelector(\".stats-wrapper .stats\").innerHTML = renderStack.join(\"\");\r\n  }\r\n}\r\n\r\nexport { renderSelection };\r\n","import { utils_combineText } from \"../js/utils.js\";\r\nimport Parser from \"../util/Parser.js\";\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"source margin-bottom_small\"></div>\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(reward, rootEl) {\r\n\trootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\t\r\n\tconst sourceEl = rootEl.querySelector('.stats-wrapper .source');\r\n\tsourceEl.classList.add(`source${reward.source}`);\r\n\tsourceEl.setAttribute('title',Parser.sourceJsonToAbv(reward.source));\r\n\tsourceEl.innerHTML =  Parser.sourceJsonToFull(reward.source);\r\n\r\n\tconst textlist = reward.text;\r\n\tlet texthtml = \"\";\r\n\r\n\tif (reward.ability !== undefined) texthtml += utils_combineText(reward.ability.text, \"p\", \"<span class='stat-name'>Ability Score Adjustment:</span> \");\r\n\tif (reward.signaturespells !== undefined) texthtml += utils_combineText(reward.signaturespells.text ? reward.signaturespells.text : \"None\", \"p\", \"<span class='stat-name'>Signature Spells:</span> \");\r\n\ttexthtml += utils_combineText(textlist, \"p\");\r\n\r\n\trootEl.querySelector(\".stats-wrapper .text\").innerHTML = \"<tr class='text'><td colspan='6'>\"+texthtml+\"</td></tr>\";\r\n}\r\n\r\nexport { renderSelection };\r\n","import EntryRenderer from \"../util/entryrender.js\";\r\nimport Parser from \"../util/Parser.js\";\r\n\r\nconst entryRenderer = new EntryRenderer();\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"source margin-bottom_small\"></div>\r\n\t\t<div class=\"text variantrules\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(curRule, rootEl) {\r\n  rootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n  const sourceEl = rootEl.querySelector(\".stats-wrapper .source\");\r\n  sourceEl.classList.add(`source${curRule.source}`);\r\n  sourceEl.setAttribute(\"title\", Parser.sourceJsonToAbv(curRule.source));\r\n\tsourceEl.innerHTML =  Parser.sourceJsonToFull(curRule.source)\r\n\r\n  const textStack = [];\r\n  entryRenderer.recursiveEntryRender(curRule, textStack);\r\n  rootEl.querySelector(\".stats-wrapper .text\").innerHTML = textStack.join(\"\");\r\n}\r\n\r\nexport { renderSelection };","import {PolymerElement, html} from '@polymer/polymer';\nimport \"@polymer/polymer/lib/elements/dom-repeat.js\";\nimport '@polymer/polymer/lib/elements/dom-if.js';\nimport \"@vaadin/vaadin-select\";\nimport \"@vaadin/vaadin-grid\";\nimport \"@vaadin/vaadin-combo-box\";\nimport \"@vaadin/vaadin-grid/vaadin-grid-filter\";\nimport \"@vaadin/vaadin-grid/vaadin-grid-filter-column\"\nimport \"@vaadin/vaadin-grid/vaadin-grid-sorter\";\nimport './styles/material-styles.js';\nimport \"./styles/my-styles.js\";\nimport \"./dnd-spinner.js\";\nimport \"./dnd-button.js\";\nimport { setRouteSelection } from '../util/routing';\nimport { cloneDeep, encodeForHash, isFirstCharNum } from '../js/utils.js';\nimport Parser from \"../util/Parser.js\";\nimport { RARITY_TYPES } from '../util/consts.js';\n\nclass DndList extends PolymerElement {\n  static get properties() {\n    return {\n      columns: {\n        type: Array\n      },\n      listItems: {\n        type: Array\n      },\n      filters: {\n        type: Array\n      },\n      isMobile: {\n        type: Boolean\n      },\n      searchString: {\n        type: String\n      },\n      selectedFilters: {\n        type: Object\n      },\n      resultsCount: {\n        type: Number\n      }\n    };\n  }\n\n  ready() {\n    super.ready();\n\n    setTimeout(() => {\n      this.$.grid.addEventListener('active-item-changed', (e) => {\n        const item = e.detail.value;\n        this.$.grid.selectedItems = item ? [item] : [];\n        const linkData = [item.name];\n        if (item.source) {\n          linkData.push(item.source);\n        }\n        setRouteSelection(encodeForHash(linkData));\n      });\n    }, 0);\n\n    window.addEventListener('resize', () => {\n      this._checkBreakpoint();\n      this._adjustHeight();\n    });\n    this._checkBreakpoint();\n    this._adjustHeight();\n    setInterval(() => {\n      this._checkBreakpoint();\n      this._adjustHeight();\n    }, 500);\n  }\n\n  _checkBreakpoint() {\n    this.isMobile = window.innerWidth <= 768;\n  }\n\n  _adjustHeight() {\n    if (window.innerWidth < 921) {\n      const top = this.$.grid.getBoundingClientRect().top;\n      if (top) {\n        this.$.grid.style.height = `${window.innerHeight - top - 85}px`;\n      }\n    } else {\n      this.$.grid.style.height = `600px`;\n    }\n  }\n\n  _renderPath(id) {\n    return `render-${id}`;\n  }\n\n  _getPathValue(item, col) {\n    return item && item[`render-${col.id}`];\n  }\n\n  _filterOptions(listItems, id) {\n    let options = [{label: '', value: ''}];\n    let skipSort = false;\n\n    if (listItems && listItems.length > 0) {\n      listItems = listItems.flat();\n  \n      // special parsing for specific filter types\n      if (id === 'proficiencies') {\n        skipSort = true;\n        const profOptions = Object.keys(Parser.SKILL_JSON_TO_FULL)\n          .map(profAbv => ({\n            label: profAbv,\n            value: profAbv\n          }));\n        options = options.concat(profOptions);\n  \n      } else if (id === 'ability') {\n        skipSort = true;\n        const abilityOptions = Object.keys(Parser.ATB_ABV_TO_FULL)\n          .map(abilityAbv => ({\n            label: Parser.ATB_ABV_TO_FULL[abilityAbv],\n            value: abilityAbv\n          }));\n        options = options.concat({ label: '\"Any\"', value: 'any'}, abilityOptions);\n\n      } else if (id === 'item-rarity') {\n        skipSort = true;\n        options = RARITY_TYPES\n          .map(rarity => ({\n            label: rarity,\n            value: rarity\n          }));\n  \n      } else if (id ==='source') {\n        listItems.forEach(item => {\n          const val = item[`render-${id}`];\n          if (!options.some(option => option.value === val)) {\n            options.push({\n              label: Parser.sourceJsonToFullCompactPrefix(val) || val,\n              value: val\n            })\n          }\n        });\n\n      } else {\n        // 'general' parsing for other filter types\n        listItems.forEach(item => {\n          const val = item[`render-${id}`];\n          if (Array.isArray(val)) {\n            options = options.concat(val.map(valItem => ({label: valItem, value: valItem})));\n          } else if (id === 'prerequisite' && val.includes('/')) {\n            options = options.concat(val.split('/').map(i => ({label: i.trim(), value: i.trim()})));\n          } else if ((id !== 'monster-type') && val.includes(',')) {\n            options = options.concat(val.split(',').map(i => ({label: i.trim(), value: i.trim()})));\n          } else {\n            options.push({label: val, value: val});\n          }\n        });\n      }\n    }\n\n    // De-duping options\n    const uniqueVals = [];\n    options = options.filter(option => {\n      if (!uniqueVals.includes(option.value)) {\n        uniqueVals.push(option.value);\n        return true;\n      }\n      return false;\n    });\n\n    // Sorting options\n    if (!skipSort) {\n      options =  options.sort((a, b) => {\n        const labelA = a.label,\n          labelB = b.label,\n          startsWithNumA = isFirstCharNum(labelA),\n          startsWithNumB = isFirstCharNum(labelB);\n        if (startsWithNumA && !startsWithNumB) {\n          return 1\n        }\n        if (startsWithNumB && !startsWithNumA) {\n          return -1\n        }\n        if (startsWithNumA && startsWithNumB) {\n          const numA = parseFloat(labelA);\n          const numB = parseFloat(labelB);\n          return (numA < numB) ? -1 : (numA > numB) ? 1 : 0;\n        }\n        return (labelA < labelB) ? -1 : (labelA > labelB) ? 1 : 0;\n      });\n    }\n    return options;\n  }\n\n  _filterValue(id, selectedFilters) {\n    if (selectedFilters && selectedFilters[id]) {\n      return selectedFilters[id];\n    }\n  }\n\n  _selectFilter(e) {\n    const id = e.model ? e.model.__data.col.id : 'name';\n    const newFilters = this.selectedFilters ? cloneDeep(this.selectedFilters) : {};\n    newFilters[id] = e.target.value;\n    this.set('selectedFilters', newFilters);\n  }\n\n  _clearFilters() {\n    const filters = this.root.querySelectorAll('vaadin-select, vaadin-combo-box, vaadin-grid-filter, vaadin-text-field');\n    filters.forEach(filter => {\n      filter.value = '';\n    });\n  }\n\n  _isComboBoxFilter(colId) {\n    switch (colId) {\n      case 'subclasses':\n      case 'source':\n      case 'rules-search':\n        return true;\n    }\n    return false;\n  }\n\n  _nameColWidth(isMobile) {\n    return isMobile ? '175px' : '300px';\n  }\n\n  _colWidth(index, columns) {\n    if (columns.length && index === columns.length - 1) {\n      return '200px';\n    }\n    return '175px'\n  }\n\n  _optionValue(option) {\n    return option.value !== undefined ? option.value : option;\n  }\n\n  _optionLabel(option) {\n    if (option.label !== undefined) {\n      return option.label\n    } else {\n      return option;\n    }\n  }\n  \n  _optionLabelClass(option, col) {\n    if (option && option.value && col && col.id === 'source') {\n      return `source${option.value}`\n    }\n    return '';\n  }\n\n  _dataItemClass(item, col) {\n    if (col && item && col.id === 'source') {\n      return `source${item.source}`\n    }\n    return '';\n  }\n\n  _isLast(index, columns) {\n    return columns.length && index === columns.length - 1\n  }\n\n  static get template() {\n    return html`\n      <style include=\"material-styles my-styles\">\n        :host {\n          display: block;\n        }\n\n\n        .search-wrap {\n          margin-bottom: 20px;\n          display: flex;\n          align-items: flex-end;\n          flex-wrap: wrap;\n        }\n        .search-reset {\n          margin-top: 16px;\n        }\n\n        .col-header-wrap {\n          display: flex;\n          justify-content: space-between;\n          width: calc(100% - 20px);\n          height: 44px;\n        }\n\n        .col-header-wrap[last-item] {\n          margin-right: 40px;\n        }\n\n        .col-header-wrap--name {\n          align-items: center;\n          width: 100%;\n        }\n\n        .col-header-wrap--name vaadin-grid-sorter {\n          position: absolute;\n          right: 0px;\n          top: 16px;\n          padding-right: 0;\n          width:100%;\n        }\n        .name-label {\n          display: inline-flex;\n          font-size: 16px;\n          color: var(--lumo-secondary-text-color);\n        }\n        .search-count {\n          color: var(--lumo-secondary-text-color);\n          margin-left: auto;\n          font-size: 12px;\n          margin-top: 4px;\n        }\n\n        .data-item {\n          width: 100%;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        vaadin-grid-sorter {\n          padding: 0 8px;\n        }\n\n        vaadin-text-field {\n          flex-grow: 1;\n          max-width: 350px;\n          margin-bottom: -4px;\n          margin-right: 16px;\n          padding-top: 0;\n        }\n\n        vaadin-combo-box,\n        vaadin-select {\n          width: 100%;\n        }\n\n        vaadin-combo-box {\n          --vaadin-combo-box-overlay-width: 250px;\n        }\n\n        vaadin-grid {\n          width: calc(100% + 32px);\n          margin-left: -16px;\n        }\n\n        vaadin-grid-filter {\n          display: none;\n        }\n\n        @media(min-width: 921px) {\n          vaadin-grid {\n            width: 100%;\n            margin-left: 0;\n          }\n        }\n      </style>\n\n      <div class=\"search-wrap\">\n        <vaadin-text-field theme=\"label--secondary\" on-keyup=\"_selectFilter\" label=\"Search\"></vaadin-text-field>\n        <dnd-button class=\"search-reset\" on-click=\"_clearFilters\" label=\"Reset\"></dnd-button>\n      </div>\n\n      <vaadin-grid id=\"grid\" items=\"[[listItems]]\" theme=\"no-border no-row-borders hover\" size=\"{{resultsCount}}\">\n        <vaadin-grid-column frozen width=\"[[_nameColWidth(isMobile)]]\">\n          <template class=\"header\">\n            <div class=\"col-header-wrap col-header-wrap--name\">\n              <span class=\"name-label\">Name</span>\n              <span class=\"search-count\">[[resultsCount]] result(s)</span>\n              <vaadin-grid-sorter path=\"name\" ></vaadin-grid-sorter>\n              <vaadin-grid-filter path=\"name\" value='[[_filterValue(\"name\", selectedFilters)]]'></vaadin-grid-filter>\n            </div>\n          </template>\n          <template>\n            <span>[[item.name]]</span>\n          </template>\n        </vaadin-grid-column>\n\n        <template is=\"dom-repeat\" items=\"[[columns]]\" as=\"col\">\n          <vaadin-grid-column width=\"[[_colWidth(index, columns)]]\" >\n            <template class=\"header\">\n              <div class=\"col-header-wrap\" last-item$=\"[[_isLast(index, columns)]]\">\n                <vaadin-grid-filter path=\"[[_renderPath(col.id)]]\" value=\"[[_filterValue(col.id, selectedFilters)]]\"></vaadin-grid-filter>\n                    \n                <template is=\"dom-if\" if=\"[[!_isComboBoxFilter(col.id)]]\">\n                  <vaadin-select placeholder=\"[[col.label]]\" on-change=\"_selectFilter\">\n                    <template>\n                      <vaadin-list-box>\n                        <template is=\"dom-repeat\" items=\"[[_filterOptions(listItems, col.id)]]\" as=\"option\">\n                          <vaadin-item value=\"[[_optionValue(option)]]\">[[_optionLabel(option)]]</vaadin-item>\n                        </template>\n                      </vaadin-list-box>\n                    </template>\n                  </vaadin-select>\n                </template>\n\n                <template is=\"dom-if\" if=\"[[_isComboBoxFilter(col.id)]]\">\n                  <vaadin-combo-box placeholder=\"[[col.label]]\" on-change=\"_selectFilter\" items=\"[[_filterOptions(listItems, col.id)]]\">\n                  </vaadin-combo-box>\n                </template>\n\n                <vaadin-grid-sorter path=\"[[_renderPath(col.id)]]\" ></vaadin-grid-sorter>\n              </div>\n            </template>\n            <template>\n              <div class=\"data-item\">\n                [[_getPathValue(item, col)]]\n                <!-- <span class$=\"[[_dataItemClass(item, col)]]\">[[_getPathValue(item, col)]]</span> -->\n              </div>\n            </template>\n          </vaadin-grid-column>\n        </template>\n      </vaadin-grid>\n    `;\n  }\n}\n\ncustomElements.define('dnd-list', DndList);","import {PolymerElement, html} from '@polymer/polymer';\nimport \"./styles/material-styles.js\";\nimport \"./styles/my-styles.js\";\nimport \"./dnd-spinner.js\";\nimport {initCollapseToggles} from '../js/utils.js';\nimport { clearRouteSelection } from '../util/routing.js';\n\nclass DndSelectedItem extends PolymerElement {\n  static get properties() {\n    return {\n      modelId: {\n        type: String,\n        observer: \"_modelChange\"\n      },\n      selectedItem: {\n        type: Object\n      },\n      allItems: {\n        type: Array\n      },\n      loading: {\n        type: Boolean,\n        value: false,\n        observer: \"_loadingChange\"\n      },\n      _modelsRenderSelection: {\n        type: Function\n      },\n      characterOption: {\n        type: Boolean,\n        value: false\n      }\n    };\n  }\n\n  static get observers() {\n    return [\"__renderSelection(_modelsRenderSelection, selectedItem)\"];\n  }\n  \n  _loadingChange() {\n    this.dispatchEvent(new CustomEvent(\"loading-render\", {\n      bubbles: true,\n      composed: true,\n      detail: {\n        loading: this.loading\n      }\n    }));\n  }\n\n  __renderSelection() {\n    if (this._modelsRenderSelection && this.selectedItem) {\n      console.error('Selected Item:', this.selectedItem);\n      this._modelsRenderSelection(this.selectedItem, this.shadowRoot, this.allItems);\n      initCollapseToggles(this.shadowRoot);\n    }\n  }\n\n  _modelChange() {\n    if (this.modelId) {\n      this.loading = true;\n      this.set(\"_modelsRenderSelection\", undefined);\n\n      // Dynamically load the model page's renderSelection JS\n      import(/* webpackMode: \"eager\" */ `../js/${this.modelId}.js`)\n        .then(module => {\n          if (typeof module.renderSelection === \"function\") {\n            this._modelsRenderSelection = module.renderSelection;\n            this.loading = false;\n          } else {\n            console.error(\"Model module is missing the renderSelection export.\");\n          }\n        })\n        .catch(e => {\n          console.error(\"Model module failed to load.\", e);\n        });\n    }\n  }\n\n  _exists(thing) {\n    return !!thing;\n  }\n\n  _mainClass() {\n    return this.selectedItem ? \"main item-opened\" : \"main\";\n  }\n\n  clearSelection() {\n    clearRouteSelection(true);\n  }\n\n  static get template() {\n    return html`\n      <style include=\"material-styles my-styles\">\n        :host {\n          display: block;\n        }\n        .main {\n          max-width: 100vw;\n        }\n        .main.item-opened .class-container {\n          display: none;\n        }\n        .main:not(.item-opened) .class-page--class-container {\n          display: none;\n        }\n        .main.item-opened #listcontainer {\n          display: none;\n        }\n        .main.item-opened .close-item {\n          display: block;\n        }\n        .main.item-opened .rules-wrapper {\n          display: none;\n        }\n        .main:not(.item-opened) #rulescontent {\n          display: none;\n        }\n        .main:not(.item-opened) .selection-wrapper {\n          display: none;\n        }\n        .close-item {\n          position: fixed;\n          height: 64px;\n          width: 64px;\n          font-size: 44px;\n          display: none;\n          right: 0;\n          top: -4px;\n          z-index: 12;\n        }\n        .main.item-opened {\n          margin-bottom: 120px;\n        }\n        @media(min-width: 921px) {\n          .main.item-opened {\n            padding-bottom: 0;\n          }\n        }\n      </style>\n\n      <div class$=\"[[_mainClass(selectedItem)]]\">\n        <button class=\"mdc-icon-button close-item material-icons\" on-click=\"clearSelection\">close</button>\n        <div class=\"selection-wrapper\"></div>\n      </div>\n    `;\n  }\n}\n\ncustomElements.define('dnd-selected-item', DndSelectedItem);","import {PolymerElement, html} from '@polymer/polymer';\nimport \"./dnd-list.js\";\nimport \"./dnd-selected-item.js\";\nimport {loadModel} from \"../util/data.js\";\nimport { parseListData, resolveHash } from \"../util/renderTable.js\";\nimport { readRouteSelection, routeEventChannel, clearRouteSelection } from '../util/routing.js';\n\nclass DndSelectionList extends PolymerElement {\n  static get properties() {\n    return {\n      modelId: {\n        type: String,\n        observer: \"_modelChange\"\n      },\n      columns: {\n        type: Array\n      },\n      enableHashRouting: {\n        type: Boolean,\n        value: false,\n        reflectToAttribute: true\n      },\n      disableScrollBack: {\n        type: Boolean,\n        reflectToAttribute: true,\n        value: false\n      },\n      hasSelection: {\n        type: Boolean,\n        reflectToAttribute: true,\n        value: false\n      },\n      _data: {\n        type: Array\n      },\n      _filters: {\n        type: Array\n      },\n      _selectedItem: {\n        type: Object\n      },\n      _selectedHash: {\n        type: String\n      },\n      loading: {\n        type: Boolean,\n        value: true,\n        observer: '_loadingChange'\n      },\n      characterOption: {\n        type: Boolean,\n        value: false\n      }\n    };\n  }\n\n  _loadingChange() {\n    this.dispatchEvent(new CustomEvent(\"loading-data\", {\n      bubbles: true,\n      composed: true,\n      detail: {\n        loading: this.loading\n      }\n    }));\n  }\n\n  /**\n   * Connects to route eventing channel and checks for loaded selection\n   * from hash.\n   */\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.selectionEventHandler = (e) => {\n      this._checkHashForSelection(e.detail.selection);\n    };\n\n    this.deselectionEventHandler = () => {\n      this._selectedItem = undefined;\n      this.hasSelection = false;\n    };\n\n    // In case the list data has already been loaded, check if the hash is there\n    this._checkHashForSelection();\n\n    routeEventChannel().addEventListener(\"selection-change\", this.selectionEventHandler);\n    routeEventChannel().addEventListener(\"selection-deselected\", this.deselectionEventHandler);\n    routeEventChannel().addEventListener(\"view-change\", this.deselectionEventHandler);\n  }\n\n  /**\n   * Disconnects from route eventing channel.\n   */\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    routeEventChannel().removeEventListener(\"selection-change\", this.selectionEventHandler);\n    routeEventChannel().removeEventListener(\"selection-deselected\", this.deselectionEventHandler);\n  }\n\n  /**\n   * Loads the JSON data for the given modelId, then checks to see if \n   * the current routed selection is present in the data.\n   */\n  _modelChange() {\n    if (this.modelId) {\n      this.set(\"_data\", undefined);\n      this.set(\"_filters\", undefined);\n      this.loading = true;\n\n      loadModel(this.modelId)\n        .then(result => {\n          const filters = parseListData(result, this.columns);\n          this.set(\"_data\", result);\n          console.error('loadedModel', filters);\n          this.set(\"_filters\", filters);\n          this._checkHashForSelection();\n          this.loading = false;\n        })\n        .catch(e => {\n          console.error(\"Model requested for list did not return.\", e);\n        });\n    }\n  }\n\n  /**\n   * Looks through the loaded Data array for an item that matches the \n   * selection string.\n   * @param {String} [newSelection] Optional. If selection isn't provided,\n   * checks the current hash for the second pathed variable.\n   */\n  _checkHashForSelection(newSelection) {\n    let hashSelection = newSelection;\n    if (!hashSelection) {\n      hashSelection = readRouteSelection();\n    }\n    if (hashSelection && this.enableHashRouting && Array.isArray(this._data)) {\n      const itemFromHash = resolveHash(this._data, hashSelection);\n      if (itemFromHash) {\n        this.set(\"_selectedItem\", itemFromHash);\n        this.hasSelection = true;\n        if (!this.disableScrollBack) {\n          window.scrollTo(0, 0);\n        }\n        routeEventChannel().dispatchEvent(new CustomEvent(\"title-change\", {\n          bubbles: true,\n          composed: true,\n          detail: itemFromHash\n        }));\n      } else {\n        clearRouteSelection(true);\n      }\n    }\n  }\n\n  static get template() {\n    return html`\n      <style>\n        :host([has-selection]) dnd-list {\n          display: none;\n        }\n        @media(min-width: 921px) {\n          dnd-list {\n            display: block !important;\n          }\n        }\n      </style>\n      <dnd-selected-item model-id=\"[[modelId]]\" selected-item=\"[[_selectedItem]]\" all-items=\"[[_data]]\" character-option=\"[[characterOption]]\"></dnd-selected-item>\n      <dnd-list list-items=\"[[_data]]\" columns=\"[[columns]]\" filters=\"[[_filters]]\"></dnd-list>\n    `;\n  }\n}\n\ncustomElements.define('dnd-selection-list', DndSelectionList);"],"sourceRoot":""}