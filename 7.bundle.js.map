{"version":3,"sources":["webpack:///./components/dnd-select-add.js","webpack:///./components/views/character/dnd-character-builder-equipment-item-detail.js","webpack:///./components/views/character/dnd-character-builder-equipment.js"],"names":["DndSelectAdd","test","type","Boolean","reflectToAttribute","value","options","Array","observer","model","String","addCallback","Function","choices","Number","paren","label","placeholder","multiValue","disabled","this","listBox","remove","$","select","render","isArray","choiceArray","map","v","indexOf","findIndex","o","name","source","filter","selectedValues","i","join","super","ready","setTimeout","async","renderer","root","document","createElement","setAttribute","addEventListener","e","opened","wasPreviouslySelected","srcElement","getAttribute","length","splice","selectedOptions","option","item","optionName","innerHTML","appendChild","_assignMenuElement","valueUpdated","connectedCallback","selectChangeHandler","val","selected","undefined","disconnectedCallback","removeEventListener","a","result","customElements","define","DndCharacterBuilderEquipmentItemDetail","isEditMode","hasRenderedOutput","hasAC","armorAC","isArmor","isMartial","weaponMagicModifier","itemRarity","itemName","itemWeight","weaponProperties","itemResist","itemQuantity","Object","storedItem","itemType","smallRender","itemTypes","rarityTypes","damageTypes","resistTypes","weaponPropertyOptions","weaponPropertyValues","editModeHandler","detail","console","error","itemRef","lookupFailed","renderedOutput","_getItemType","armor","ac","weaponCategory","weapon","parseInt","genericBonus","propStr","property","props","split","prop","propObj","find","trim","damages","dmg1","roll","dmgTypeToFull","dmgType","rarity","weight","canHaveResist","resist","canHaveQuantity","quantity","canHaveSpell","ITEM_TYPE_JSON_TO_ABV","newType","querySelector","isEquipped","isAttuned","hasQuantity","typeVal","entries","key","push","rollDamageIndexAttr","rollDamageIndex","parsedMod","isNaN","propCodes","bind","parsedAC","parsedWeight","parseFloat","parsedQuantity","bools","bool","DndCharacterBuilderEquipment","inventory","character","expandedItems","expandedIds","activeItem","isMobile","uniqueId","openedItemID","grid","closeItemDetails","window","scrollTo","originalScrollHeight","scrollY","characterChangeHandler","updateFromCharacter","notifyResize","_checkBreakpoint","draggedItem","draggedItems","dropMode","dropTargetItem","isChild","container","removeId","itemCounter","dropLocation","children","dropTargetId","id","finalAddIndex","substring","lastIndexOf","parentItemREF","dataProvider","params","callback","startIndex","page","pageSize","parentItem","slice","clearCache","openedItem","openItemDetails","dispatchEvent","CustomEvent","bubbles","composed","data","__data","stayClosed","detailsOpenedItems","checkboxEl","classList","add","preventDefault","stopPropagation","itemModel","checkbox","target","_flashCheckbox","getEventContext","newQuantity","innerWidth","rowDetailsRenderer","rowData","detailsOpened","firstElementChild","detailEl","unique","Date","now","viewId"],"mappings":"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","file":"7.bundle.js","sourcesContent":["import { PolymerElement, html } from '@polymer/polymer';\nimport { mergeFeature } from '../util/charBuilder';\nimport { jqEmpty, util_capitalizeAll } from \"../js/utils\";\nimport \"@vaadin/vaadin-select\";\nimport {loadModel} from \"../util/data\";\n\nclass DndSelectAdd extends PolymerElement {\n  static get properties() {\n    return {\n      test: {\n        type: Boolean,\n        reflectToAttribute: true,\n        value: false\n      },\n      options: {\n        type: Array,\n        observer: \"optionsUpdated\"\n      },\n      model: {\n        type: String\n      },\n      addCallback: {\n        type: Function\n      },\n      value: {\n        type: String,\n        value: \"\",\n        observer: \"valueUpdated\"\n      },\n      choices: {\n        type: Number,\n        observer: \"choicesUpdated\"\n      },\n      paren: {\n        type: String,\n      },\n      label: {\n        type: String\n      },\n      placeholder: {\n        type: String,\n      },\n      multiValue: {\n        type: String,\n        value: \"\"\n      },\n      disabled: {\n        type: Boolean,\n        value: false,\n        reflectToAttribute: true\n      }\n    }\n  }\n\n  choicesUpdated() {\n    if (this.listBox) {\n      this.listBox.remove();\n      delete this.listBox;\n    }\n    this.$.select.render();\n  }\n\n  optionsUpdated() {\n    if (this.listBox) {\n      this.listBox.remove();\n      delete this.listBox;\n    }\n    this.$.select.render();\n  }\n\n  valueUpdated() {\n    if (this.choices) {\n      if (Array.isArray(this.value) && this.options) {\n        const choiceArray = this.value\n          .map(v => {\n            if (this.options.indexOf(v) !== -1) {\n              return this.options.indexOf(v);\n            } else {\n              return this.options.findIndex((o) => {\n                return o.name === v.name && o.source === v.source;\n              });\n            }\n          })\n          .filter(v => { return v !== -1 });\n\n        if (this.listBox) {\n          this.listBox.selectedValues = choiceArray;\n        }\n        this.multiValue = choiceArray.map(i => {\n          let value = this.options[i];\n          return value.name ? value.name : util_capitalizeAll(value) \n        }).join(\", \");\n      } else {\n        if (this.listBox) {\n          this.listBox.selectedValues = [];\n        }\n        this.multiValue = \"\";\n      }\n    } else {\n      if (this.value && this.options) {\n        if (this.value.source) {\n          this.$.select.value = this.options.findIndex(i => { return i.name === this.value.name && i.source === this.value.source || i === this.value.name }) + \"\";\n        } else if (this.value.name) {\n          this.$.select.value = this.options.findIndex(i => { return i.name === this.value.name || i === this.value.name }) + \"\";\n        } else {\n          this.$.select.value = this.options.findIndex(i => { return i.name === this.value || i === this.value }) + \"\";\n        }\n      } else {\n        this.$.select.value = \"\";\n      }\n    }\n  }\n\n  ready() {\n    super.ready();\n\n    setTimeout(async () => {\n      if (this.model) {\n        this.options = await loadModel(this.model);\n      }\n\n      this.$.select.renderer = (root, select) => {\n        if (!this.listBox) {\n          this.listBox = document.createElement('vaadin-list-box');\n\n          // setting up for multi-select\n          if (this.choices) {\n            this.listBox.setAttribute(\"multiple\", true);\n\n            this.listBox.addEventListener(\"click\", (e) => {\n              select.opened = true;\n              let wasPreviouslySelected = e.srcElement.getAttribute(\"selected\") !== null\n              setTimeout(() => {\n                if (this.listBox.selectedValues.length > this.choices\n                    && !wasPreviouslySelected) {\n                  this.listBox.selectedValues.splice(this.listBox.selectedValues.length - 2, 1)\n                }\n                let selectedOptions = this.listBox.selectedValues.map(v => { return this.options[v] });\n                this.multiValue = selectedOptions.map(o => { return o.name ? o.name : util_capitalizeAll(o) }).join(', ');\n                if (this.addCallback) {\n                  this.addCallback(selectedOptions);\n                }\n              }, 0);\n            });\n\n          }\n\n          // Adding options\n          if (this.options && this.options.length) {\n            for (let i = 0; i < this.options.length; i ++) {\n              const option = this.options[i],\n                item = document.createElement('vaadin-item');\n              const optionName = option.name || util_capitalizeAll(option);\n              item.innerHTML = `<span>${optionName}</span> ${option.name ? `<span style='font-size: 14px;color: var(--lumo-primary-color-50pct);'>${option.source}</span>` : ''}`\n              item.setAttribute(\"value\", i);\n              this.listBox.appendChild(item);\n            }\n          }\n          root.appendChild(this.listBox);\n          this.$.select._assignMenuElement();\n\n          this.valueUpdated();\n        }\n      };\n    }, 0);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.selectChangeHandler = () => {\n      const val = this.$.select.value;\n      if (val) {\n        if (!this.choices) {\n          const selected = this.options[val];\n          if (this.addCallback) {\n            this.addCallback(selected, this.model);\n          } else {\n            mergeFeature(undefined, selected, this.model);\n          }\n          if (!this.value) {\n            this.$.select.value = \"\";\n          }\n        }\n      }\n    };\n\n    this.$.select.addEventListener(\"change\", this.selectChangeHandler);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n\n    this.$.select.removeEventListener(\"change\", this.selectChangeHandler);\n  }\n\n  _exists(a) {\n    return !!a;\n  }\n\n  _label(label, choices, paren) {\n    let result = '';\n    if (label) {\n      result = label;\n      if (choices && choices !== 1 && choices !== 100) {\n        result += ` (pick ${choices})`;\n      }\n      if (paren) {\n        result += ` (${paren})`;\n      }\n    }\n    return result;\n  }\n  \n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: inline-block;\n        }\n        [slot=\"prefix\"] {\n          width: calc(100% - 46px);\n          padding: 12px;\n          line-height: 1.4;\n        }\n        vaadin-select {\n          width: 100%;\n        }\n        .prefix {\n          white-space: normal;\n          color: var(--lumo-body-text-color);\n        }\n      </style>\n      <vaadin-select test$=\"[[test]]\" theme=\"dark\" add id=\"select\" label=\"[[_label(label, choices, paren)]]\" placeholder=\"[[placeholder]]\" disabled$=\"[[disabled]]\">\n        <div hidden$=\"[[!_exists(multiValue)]]\" slot=\"prefix\">\n          <span class=\"prefix\">[[multiValue]]</span>\n        </div>\n      </vaadin-select>\n      \n    `;\n  }\n}\ncustomElements.define('dnd-select-add', DndSelectAdd);","import { PolymerElement, html } from \"@polymer/polymer\";\nimport {\n  setItem\n} from \"../../../util/charBuilder\";\nimport { getEditModeChannel, isEditMode } from \"../../../util/editMode\";\nimport { renderSelection } from \"../../../js/items\";\nimport { DAMAGE_TYPES, RARITY_TYPES } from \"../../../util/consts\";\nimport { findInPath, util_capitalizeAll } from \"../../../js/utils\";\nimport \"@vaadin/vaadin-text-field/vaadin-text-field\";\nimport \"@vaadin/vaadin-text-field/vaadin-integer-field\";\nimport \"@vaadin/vaadin-text-field/vaadin-text-area\";\nimport Parser from '../../../util/Parser';\nimport \"../../dnd-select-add\";\nimport \"../../dnd-button\";\n\n\n//// BOONS\n// Resistance\n// DC+\n// Proficiency?\n// Spells known\nclass DndCharacterBuilderEquipmentItemDetail extends PolymerElement {\n  \n  static get properties() {\n    return {\n      isEditMode: {\n        type: Boolean,\n        value: false\n      },\n      hasRenderedOutput: {\n        type: Boolean,\n        value: false\n      },\n      hasAC: {\n        type: Boolean,\n        value: false\n      },\n      armorAC: {\n        type: Number,\n        value: 0\n      },\n      isArmor: {\n        type: Boolean,\n        value: false\n      },\n      isMartial: {\n        type: Boolean,\n        value: false\n      },\n      weaponMagicModifier: {\n        type: Number,\n        value: 0\n      },\n      itemRarity: {\n        type: String,\n      },\n      itemName: {\n        type: String,\n      },\n      itemWeight: {\n        type: Number,\n        value: 0\n      },\n      weaponProperties: {\n        type: Array,\n      },\n      itemResist: {\n        type: String,\n      },\n      itemQuantity: {\n        type: Number,\n        value: 0\n      },\n      item: {\n        type: Object\n      },\n      storedItem: {\n        type: Object\n      },\n      itemType: {\n        type: String,\n        value: ''\n      },\n      smallRender: {\n        type: Boolean,\n        reflectToAttribute: true,\n        value: false\n      }\n    };\n  }\n\n  static get observers() {\n    return [\n      '_itemChanged(item)'\n    ]\n  }\n\n  constructor() {\n    super();\n\n    this.itemTypes = [\n      'Currency',\n      'Armor (Light)',\n      'Armor (Medium)',\n      'Armor (Heavy)',\n      'Melee Weapon',\n      'Ranged Weapon',\n      'Shield',\n      'Adventuring Gear',\n      'Ammunition',\n      'Artisan Tool',\n      'Explosive',\n      'Gaming Set',\n      'Instrument',\n      'Mount',\n      'Potion',\n      'Rod',\n      'Ring',\n      'Scroll',\n      'Spellcasting Focus',\n      'Tool',\n      'Tack and Harness',\n      'Trade Good',\n      'Vehicle',\n      'Wand'\n    ];\n\n    this.rarityTypes = RARITY_TYPES;\n    this.damageTypes = DAMAGE_TYPES;\n    this.resistTypes = ['<None>', ...DAMAGE_TYPES];\n    this.weaponPropertyOptions = [\n      { name: 'Two-Handed', value: '2H' },\n      { name: 'Ammunition', value: 'A' },\n      { name: 'Finesse', value: 'F' },\n      { name: 'Heavy', value: 'H' },\n      { name: 'Light', value: 'L' },\n      { name: 'Loading', value: 'LD' },\n      { name: 'Reach', value: 'R' },\n      { name: 'Reload', value: 'RLD' },\n      { name: 'Special', value: 'S' },\n      { name: 'Thrown', value: 'T' },\n      { name: 'Versatile', value: 'V' },\n    ]\n    this.weaponPropertyValues = [\n      'Two-Handed',\n      'Ammunition',\n      'Finesse',\n      'Heavy',\n      'Light',\n      'Loading',\n      'Reach',\n      'Reload',\n      'Special',\n      'Thrown',\n      'Versatile'\n    ]\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.editModeHandler = (e) => {\n      this.isEditMode = e.detail.isEditMode;\n    }\n    getEditModeChannel().addEventListener('editModeChange', this.editModeHandler);\n    this.isEditMode = isEditMode();\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n\n    getEditModeChannel().removeEventListener('editModeChange', this.editModeHandler);\n  }\n\n  _itemChanged() {\n    if (!this.item) {\n      return;\n    }\n    console.error('itemDetail:', this.item);\n\n    if (this.item.itemRef && !this.item.lookupFailed) {\n      this.hasRenderedOutput = true;\n      renderSelection(this.item, this.$.renderedOutput, undefined, this.smallRender);\n    } else {\n      this.hasRenderedOutput = false;\n    }\n    this.itemType = this._getItemType();\n    this.hasAC = this.item.type === 'S' || !!this.item.armor;\n    if (this.hasAC) {\n      this.armorAC = this.item.ac;\n    }\n    this.isArmor = !!this.item.armor;\n    this.isMartial = this.item.weaponCategory === 'Martial';\n    if (this.item.weapon) {\n      this.weaponMagicModifier = parseInt(this.item.genericBonus, 10);\n      const propStr = this.item.property;\n      if (propStr) {\n        const props = propStr.split(',').map(prop => {\n          const propObj = this.weaponPropertyOptions.find((option) => option.value === prop.trim());\n          if (propObj) {\n            return propObj.name;\n          }\n        }).filter(prop => !!prop);\n        this.weaponProperties = props;\n        if (!this.item.damages) {\n          if (this.item.dmg1) {\n            this.item.storedItem.damages = [{roll: this.item.dmg1, type: util_capitalizeAll(Parser.dmgTypeToFull(this.item.dmgType))}];\n          } else {\n            this.item.storedItem.damages = [];\n          }\n        }\n      }\n    }\n    this.itemRarity = this.item.rarity;\n    this.itemName = this.item.name;\n    this.itemWeight = this.item.weight;\n    this.canHaveResist = this.item.armor || this.item.type === 'P' || this.item.type === 'RG';\n    this.itemResist = this.item.resist;\n    this.canHaveQuantity = this.item.type === 'P' || this.item.type === 'A' || this.item.type === 'EXP' || this.item.type === '$';\n    this.itemQuantity = this.item.quantity;\n    this.canHaveSpell = this.item.type === 'SC';\n\n    if (this.item.storedItem) {\n      this.storedItem = this.item.storedItem;\n    }\n  }\n\n  _getItemType() {\n    if (this.item) {\n      return Parser.ITEM_TYPE_JSON_TO_ABV[this.item.type];  \n    }\n    return '';\n  }\n\n  _selectItemType() {\n    const newType = this.root.querySelector('#typeSelect').value\n    this.storedItem.armor = false;\n    this.storedItem.weapon = false;\n    this.storedItem.type = '';\n    this.storedItem.isEquipped = false;\n    this.storedItem.isAttuned = false;\n\n    switch (newType) {\n      case 'Armor (Light)':\n        this.storedItem.armor = true;\n        this.storedItem.weaponCategory = null;\n        this.storedItem.type = 'LA';\n        break;\n      case 'Armor (Medium)':\n        this.storedItem.armor = true;\n        this.storedItem.weaponCategory = null;\n        this.storedItem.type = 'MA';\n        break;\n      case 'Armor (Heavy)':\n        this.storedItem.armor = true;\n        this.storedItem.weaponCategory = null;\n        this.storedItem.type = 'HA';\n        break;\n      case 'Ranged Weapon':\n        this.storedItem.weapon = true;\n        this.storedItem.weaponCategory = 'Simple';\n        this.storedItem.type = 'R';\n        this.storedItem.resist = null;\n        break;\n      case 'Melee Weapon':\n        this.storedItem.weapon = true;\n        this.storedItem.weaponCategory = 'Simple';\n        this.storedItem.type = 'M';\n        this.storedItem.resist = null;\n        break;\n      case 'Shield':\n        this.storedItem.type = 'S';\n        this.storedItem.weaponCategory = null;\n        this.storedItem.ac = 2;\n        this.storedItem.resist = null;\n        break;\n      case 'Adventuring Gear':\n        this.storedItem.weaponCategory = null;\n        this.storedItem.type = 'G';\n        this.storedItem.resist = null;\n        break;\n      case 'Currency':\n        this.storedItem.weaponCategory = null;\n        this.storedItem.type = '$'\n        this.storedItem.resist = null;\n        this.storedItem.quantity = 1;\n        this.storedItem.hasQuantity = true;\n        break;\n      default:\n        const typeVal = Object.entries(Parser.ITEM_TYPE_JSON_TO_ABV).find(([key, value]) => value === newType);\n        if (typeVal) {\n          this.storedItem.type = typeVal[0];\n        }\n        if (newType !== 'P' || newType !== 'RG') {\n          this.storedItem.resist = null;\n        }\n        break;\n    }\n    if (!(this.storedItem.type === 'P' || this.storedItem.type === 'A' || this.storedItem.type === 'EXP' || this.storedItem.type === '$')) {\n      this.storedItem.hasQuantity = false;\n    }\n    setItem(this.item);\n  }\n\n  _updateItem() {\n    setItem(this.item);\n  }\n\n  _addDamage() {\n    if (!this.storedItem.damages) {\n      this.storedItem.damages = [];\n    }\n    this.storedItem.damages.push({roll: '', type: ''});\n    setItem(this.item);\n  }\n\n  _removeDamage(e) {\n    const rollDamageEl = findInPath('.roll__damage', e);\n    const rollDamageIndexAttr = rollDamageEl.getAttribute('index');\n    const rollDamageIndex = parseInt(rollDamageIndexAttr, 10);\n    this.storedItem.damages.splice(rollDamageIndex, 1);\n    setItem(this.item);\n  }\n\n  _changeWeaponType() {\n    if (this.item.weapon) {\n      if (this.isMartial) {\n        this.storedItem.weaponCategory = 'Martial';\n      } else {\n        this.storedItem.weaponCategory = 'Simple';\n      }\n      setItem(this.item);\n    }\n  }\n\n  _weaponMagicModifierChange() {\n    let parsedMod = parseInt(this.weaponMagicModifier, 10);\n\n    if (isNaN(parsedMod)) {\n      parsedMod = 0;\n    }\n    this.storedItem.genericBonus = parsedMod > 0 ? `+${parsedMod}` : parsedMod;\n    setItem(this.item);\n  }\n\n  _itemRarityChange() {\n    if (this.itemRarity) {\n      this.storedItem.rarity = this.itemRarity;\n      setItem(this.item);\n    }\n  }\n\n  _itemNameChange() {\n    if (this.itemName) {\n      this.storedItem.name = this.itemName;\n      setItem(this.item);\n    }\n  }\n\n  _addWeaponProperty() {\n    return ((props) => {\n      if (props && props.length) {\n        const propCodes = props.map((prop) => {\n          const propObj = this.weaponPropertyOptions.find((option) => option.name === prop.trim());\n          if (propObj) {\n            return propObj.value;\n          }\n        }).filter(prop => !!prop);\n        this.storedItem.property = propCodes.join(',');\n        setItem(this.item);\n      }\n    }).bind(this);\n  }\n\n  _armorACChange() {\n    let parsedAC = parseInt(this.armorAC, 10);\n\n    if (isNaN(parsedAC)) {\n      parsedAC = 0;\n    }\n    this.storedItem.ac = parsedAC;\n    setItem(this.item);\n  }\n\n  _itemWeightChange() {\n    let parsedWeight = parseFloat(this.itemWeight, 10);\n\n    if (isNaN(parsedWeight)) {\n      parsedWeight = 0;\n    }\n    this.storedItem.weight = parsedWeight;\n    setItem(this.item);\n\n  }\n\n  _itemResistChange() {\n    if (this.itemResist) {\n      this.storedItem.resist = this.itemResist === '<None>' ? null : this.itemResist;\n      setItem(this.item);\n    }\n  }\n\n  _itemQuantityChange() {\n    let parsedQuantity = parseInt(this.itemQuantity, 10);\n\n    if (isNaN(parsedQuantity)) {\n      parsedQuantity = 0;\n    }\n    this.storedItem.quantity = parsedQuantity;\n    this.storedItem.hasQuantity = true;\n    setItem(this.item);\n  }\n\n  _or(...bools) {\n    for (let bool of bools) {\n      if (bool) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  static get template() {\n    return html`\n      <style include=\"material-styles my-styles\"></style>\n      <style>\n        :host {}\n        [hidden] {\n          display: none !important;\n        }\n\n        .edit__wrap {\n          margin-right: -10px;\n        }\n        .edit__name {\n          width: calc(65% - 10px);\n          padding-top: 0;\n        }\n        .edit__notes {\n          width: calc(100% - 10px);\n          min-height: 200px;\n        }\n        .edit__checkboxes {\n          display: flex;\n          flex-direction: column;\n          margin: 10px 10px 0 0;\n        }\n\n        .section_heading {\n          margin: 16px 0 0px;\n          font-size: 17px;\n          color: var(--mdc-theme-secondary);\n        }\n\n        .roll__damages {\n          display: flex;\n          flex-direction: column;\n        }\n        .roll__damage {\n          display: flex;\n          margin-right: 10px;\n        }\n        .roll__damage vaadin-text-field,\n        .roll__damage vaadin-select {\n          max-width: 100%;\n        }\n        .roll__damage-roll--edit,\n        .roll__damage-type--edit {\n          width: calc(50% - 40px);\n        }\n        .roll__damage-roll--edit {\n          margin: 0 16px;\n        }\n        .roll__damage-remove {\n          margin: auto -5px 4px;\n        }\n\n        dnd-switch {\n          margin: 10px auto 0;\n          display: block;\n        }\n\n        h2 {\n          margin-top: 0;\n          font-size: 16px;\n          font-weight: bold;\n          margin-bottom: 8px;\n        }\n\n        vaadin-checkbox {\n          width: fit-content;\n        }\n\n        vaadin-select {\n          max-width: calc(50% - 14px);\n        }\n        vaadin-number-field,\n        vaadin-integer-field {\n          width: calc(33% - 10px);\n        }\n        vaadin-text-field,\n        vaadin-text-area,\n        vaadin-integer-field,\n        vaadin-number-field,\n        vaadin-select {\n          margin-right: 10px;\n        }\n        dnd-select-add {\n          width: calc(66% - 22px);\n          margin-right: 10px;\n          margin-left: 10px;\n        }\n\n        .margin-bottom_large {\n          margin-bottom: 0 !important;\n        }\n\n        @media(min-width: 921px) {\n          h2 {\n            font-size: 24px;\n          }\n        }\n      </style>\n\n      <div hidden$=\"[[!item]]\">\n        <div hidden$=\"[[isEditMode]]\">\n          <div hidden$=\"[[!hasRenderedOutput]]\">\n            <h2>[[item.name]]</h4>\n            <div>[[item.notes]]</div>\n            <div hidden$=\"[[item.hideRef]]\" id=\"renderedOutput\"></div>\n          </div>\n\n          <div hidden$=\"[[hasRenderedOutput]]\">\n            <h2>[[item.name]]</h4>\n            <div>[[item.notes]]</div>\n          </div>\n        </div>\n\n        <template is=\"dom-if\" if=\"[[isEditMode]]\">\n          <div class=\"edit__wrap\">\n            <vaadin-text-field class=\"edit__name\" theme=\"label--secondary\" value=\"{{itemName}}\" label=\"Name\" on-change=\"_itemNameChange\"></vaadin-text-field>\n            <vaadin-number-field theme=\"label--secondary\" has-controls value=\"{{itemWeight}}\" label=\"Weight\" min=\"0\" on-change=\"_itemWeightChange\"></vaadin-number-field>\n\n            <vaadin-select id=\"typeSelect\" value=\"[[itemType]]\" on-change=\"_selectItemType\" label=\"Type\" >\n              <template>\n                <vaadin-list-box>\n                  <template is=\"dom-repeat\" items=\"[[itemTypes]]\">\n                    <vaadin-item>[[item]]</vaadin-item>\n                  </template>\n                </vaadin-list-box>\n              </template>\n            </vaadin-select>\n\n            <vaadin-select id=\"raritySelect\" value=\"{{itemRarity}}\" on-change=\"_itemRarityChange\" label=\"Rarity\" >\n              <template>\n                <vaadin-list-box>\n                  <template is=\"dom-repeat\" items=\"[[rarityTypes]]\">\n                    <vaadin-item>[[item]]</vaadin-item>\n                  </template>\n                </vaadin-list-box>\n              </template>\n            </vaadin-select>\n\n            <div class=\"edit__weapon\" hidden$=\"[[!item.weapon]]\">\n              <h4 class=\"section_heading\">Weapon</h4>\n              <dnd-select-add choices=\"100\" label=\"Weapon Properties\" options=\"[[weaponPropertyValues]]\" value=\"[[weaponProperties]]\" add-callback=\"[[_addWeaponProperty()]]\"></dnd-select-add>\n              <vaadin-integer-field theme=\"label--secondary\"  min=\"0\" max=\"5\" has-controls value=\"{{weaponMagicModifier}}\" label=\"Magic Modifier\" on-change=\"_weaponMagicModifierChange\"></vaadin-integer-field>\n              <dnd-switch label='Simple Weapon' secondary-label='Martial Weapon' initial-value=\"[[isMartial]]\" checked={{isMartial}} on-switch-change=\"_changeWeaponType\" ></dnd-switch>\n\n              <template is=\"dom-repeat\" items=\"[[storedItem.damages]]\" as=\"damage\">\n                <div class=\"roll__damage\" index$=\"[[index]]\">\n                  <dnd-button on-click=\"_removeDamage\" icon=\"remove\" class='roll__damage-remove icon-only'></dnd-button>\n                  <div class=\"roll__damage-roll--edit\">\n                    <vaadin-text-field theme=\"label--secondary\" value=\"{{damage.roll}}\" on-change=\"_updateItem\" label=\"Damage Roll\"></vaadin-text-field>\n                  </div>\n                  <div class=\"roll__damage-type--edit\">\n                    <vaadin-select value=\"{{damage.type}}\" on-change=\"_updateItem\" label=\"Damage Type\" >\n                      <template>\n                        <vaadin-list-box>\n                          <template is=\"dom-repeat\" items=\"[[damageTypes]]\">\n                            <vaadin-item>[[item]]</vaadin-item>\n                          </template>\n                        </vaadin-list-box>\n                      </template>\n                    </vaadin-select>\n                  </div>\n                </div>\n              </template>\n              <dnd-button on-click=\"_addDamage\" label=\"Add Damage\" icon=\"add\" class=\"roll__add-damage\"></dnd-button>\n            </div>\n\n            <vaadin-integer-field theme=\"label--secondary\"  hidden$=\"[[!hasAC]]\" min=\"0\" max=\"30\" has-controls value=\"{{armorAC}}\" label=\"AC\" on-change=\"_armorACChange\"></vaadin-integer-field>\n            \n            <vaadin-integer-field theme=\"label--secondary\"  hidden$=\"[[!item.hasQuantity]]\" min=\"0\" has-controls value=\"{{itemQuantity}}\" label=\"Quantity\" on-change=\"_itemQuantityChange\"></vaadin-integer-field>\n\n            <!-- <vaadin-select hidden$=\"[[!canHaveResist]]\" value=\"{{itemResist}}\" on-change=\"_itemResistChange\" label=\"Resistance\">\n              <template>\n                <vaadin-list-box>\n                  <template is=\"dom-repeat\" items=\"[[resistTypes]]\">\n                    <vaadin-item>[[item]]</vaadin-item>\n                  </template>\n                </vaadin-list-box>\n              </template>\n            </vaadin-select> -->\n\n            <div class=\"edit__checkboxes\">\n              <vaadin-checkbox hidden$=\"[[!canHaveQuantity]]\" checked=\"{{storedItem.hasQuantity}}\" on-change=\"_updateItem\">Has Quantity</vaadin-checkbox>\n              <vaadin-checkbox hidden$=\"[[!isArmor]]\" checked=\"{{storedItem.stealth}}\" on-change=\"_updateItem\">Disadvantage on Stealth</vaadin-checkbox>\n              <vaadin-checkbox checked=\"{{storedItem.reqAttune}}\" on-change=\"_updateItem\">Requires Attunement</vaadin-checkbox>\n              <vaadin-checkbox checked=\"{{storedItem.wondrous}}\" on-change=\"_updateItem\">Wondrous</vaadin-checkbox>\n              <vaadin-checkbox hidden$=\"[[!storedItem.itemRef]]\" checked=\"{{storedItem.hideRef}}\" on-change=\"_updateItem\">Hide Reference</vaadin-checkbox>\n            </div>\n\n            <vaadin-text-area  theme=\"label--secondary\" class=\"edit__notes\" value=\"{{storedItem.notes}}\" label=\"Notes\" on-change=\"_updateItem\"></vaadin-text-area>\n          </div>\n        </template>\n      </div>\n    `;\n  }\n}\n\ncustomElements.define(\"dnd-character-builder-equipment-item-detail\", DndCharacterBuilderEquipmentItemDetail);","import { PolymerElement, html } from \"@polymer/polymer\";\nimport { \n  getCharacterChannel,\n  getSelectedCharacter,\n  getItems,\n  removeItem,\n  canAttuneItem,\n  canEquipItem,\n  toggleItemEquipped,\n  toggleItemAttuned,\n  setItem,\n  spliceItems,\n  isChildItem,\n  getItemAtId,\n  addItem\n} from \"../../../util/charBuilder\";\nimport { getEditModeChannel, isEditMode } from \"../../../util/editMode\";\nimport \"@vaadin/vaadin-checkbox\";\nimport \"@vaadin/vaadin-grid\";\nimport \"@vaadin/vaadin-grid/vaadin-grid-tree-toggle\";\nimport \"@vaadin/vaadin-grid/vaadin-grid-column\";\nimport \"./dnd-character-builder-equipment-item-detail\";\n\nclass DndCharacterBuilderEquipment extends PolymerElement {\n  \n  static get properties() {\n    return {\n      inventory: {\n        type: Array\n      },\n      isEditMode: {\n        type: Boolean,\n        value: false\n      },\n      character: {\n        type: Object,\n      },\n      expandedItems: {\n        type: Array\n      },\n      expandedIds: {\n        type: Array\n      },\n      activeItem: {\n        type: Object,\n      },\n      isMobile: {\n        type: Boolean\n      },\n    };\n  }\n\n  static get observers() {\n    return [\n      '_expandedItemsChange(expandedItems.*)'\n    ]\n  }\n\n  _expandedItemsChange() {\n    if (this.expandedItems && this.expandedItems.length) {\n      this.expandedIds = this.expandedItems.filter(item => !!item).map((item) => item.uniqueId);\n      console.error(this.expandedIds);\n\n      if (this.openedItemID) {\n        this.$.grid.closeItemDetails(this.openedItemID);\n        this.openedItemID = undefined;\n      }\n    }\n    window.scrollTo(0, this.originalScrollHeight);\n  }\n\n  _recordScrollHeight(e) {\n    // Fix reposition issue after tree expand/collapse toggle\n    this.originalScrollHeight = window.scrollY;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.characterChangeHandler = (e) => {\n      let character = e.detail.character;\n      this.updateFromCharacter(character);\n    };\n    \n    this.updateFromCharacter(getSelectedCharacter());\n    getCharacterChannel().addEventListener(\"character-selected\", this.characterChangeHandler);\n\n    this.editModeHandler = (e) => {\n      this.isEditMode = e.detail.isEditMode;\n      if (this.$.grid) {\n        setTimeout(() => {\n          this.$.grid.notifyResize();\n        }, 0);\n      }\n    }\n    getEditModeChannel().addEventListener('editModeChange', this.editModeHandler);\n    this.isEditMode = isEditMode();\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n\n    getCharacterChannel().removeEventListener(\"character-selected\", this.characterChangeHandler);\n    getEditModeChannel().removeEventListener('editModeChange', this.editModeHandler);\n  }\n\n  ready() {\n    super.ready();\n    this._checkBreakpoint();\n    window.addEventListener('resize', () => {\n      this._checkBreakpoint();\n    });\n    \n    setTimeout(() => {\n      const grid = this.$.grid;\n\n      // Add Drag and Drop\n      let draggedItem;\n\n      grid.addEventListener('grid-dragstart', function(e) {\n        draggedItem = e.detail.draggedItems[0];\n        grid.dropMode = 'on-top-or-between';\n      });\n\n      grid.addEventListener('grid-dragend', function(e) {\n        draggedItem = grid.dropMode = null;\n      });\n\n      grid.addEventListener('grid-drop', (e) => {\n        const dropTargetItem = e.detail.dropTargetItem;\n        if (draggedItem && draggedItem !== dropTargetItem) {\n\n          // Prevent loops\n          const isChild = isChildItem(draggedItem, dropTargetItem.uniqueId);\n          if (draggedItem.container && isChild) {\n            return;\n          }\n\n          const removeId = draggedItem.storedItem.uniqueId;\n          draggedItem.storedItem.uniqueId = this.character.itemCounter ++;\n\n          // Dropping into container\n          if (e.detail.dropLocation === 'on-top') {\n            if (dropTargetItem.container) {\n              if (dropTargetItem.storedItem && dropTargetItem.storedItem.children) {\n                // Add child item\n                dropTargetItem.storedItem.children.push(draggedItem.storedItem);\n                setItem(dropTargetItem, undefined, true);\n                // Remove original\n                removeItem(removeId);\n              }\n              return;\n            }\n          }\n\n          // Re-ordering items, default action if 'on-top' of non-container\n          if (this.inventory) {\n            // Adjust final add index for dropLocation 'below' or 'above'\n            const dropTargetId = `${dropTargetItem.id}`;\n            let finalAddIndex = parseInt(dropTargetId.substring(dropTargetId.lastIndexOf('_')), 10);\n            if (e.detail.dropLocation === 'below') {\n              finalAddIndex++;\n            }\n\n            if (dropTargetItem.parentItemREF) {\n              // Add child item\n              dropTargetItem.parentItemREF.storedItem.children.splice(finalAddIndex, 0, draggedItem.storedItem);\n              setItem(dropTargetItem.parentItemREF, undefined, true);\n            } else {\n              // Add top-level item\n              spliceItems(finalAddIndex, draggedItem.storedItem);\n            }\n\n            // Remove original item\n            removeItem(removeId);\n          }\n        }\n      });\n\n      // Set Data Provider\n      grid.dataProvider = ((params, callback) => {\n        const startIndex = params.page * params.pageSize;\n        let children = params.parentItem ? params.parentItem.children : this.inventory;\n        if (children && children.length) {\n          const page = children.slice(startIndex, startIndex + params.pageSize);\n          callback(page, children.length);\n        }\n      }).bind(this);\n    }, 0);\n    \n  }\n\n  async updateFromCharacter(character) {\n    if (character) {\n      this.character = character;\n      this.inventory = await getItems(character);\n      console.error('inventory:', this.inventory);\n      const originalScrollHeight = window.scrollY;\n      this.$.grid.clearCache();\n      if (this.openedItemID) {\n        const openedItem = getItemAtId(this.inventory, this.openedItemID.uniqueId);\n        if (openedItem) {\n          this.$.grid.openItemDetails(openedItem);\n        }\n      }\n      if (this.expandedIds) {\n        const expandedItems = this.expandedIds.map((id) => {\n          return getItemAtId(this.inventory, id);\n        });\n        this.expandedItems = expandedItems;\n      }\n      if (this.activeItem) {\n        this.activeItem = getItemAtId(this.inventory, this.activeItem.uniqueId);\n      }\n      window.scrollTo(0, originalScrollHeight);\n      this.dispatchEvent(new CustomEvent(\"loadingChange\", { bubbles: true, composed: true }));\n    }\n  }\n\n  _expandDetails(e) {\n    let data = e.model.__data.item,\n      stayClosed = this.$.grid.detailsOpenedItems.indexOf(data) > -1;\n\n    const originalScrollHeight = window.scrollY;\n\n    for (let item of this.$.grid.detailsOpenedItems) {\n      this.$.grid.closeItemDetails(item);\n    }\n\n    if (stayClosed) {\n      this.$.grid.closeItemDetails(data);\n      this.openedItemID = undefined;\n    } else {\n      this.$.grid.openItemDetails(data);\n      this.openedItemID = data;\n    }\n    this.$.grid.notifyResize();\n    window.scrollTo(0, originalScrollHeight);\n  }\n\n  _flashCheckbox(checkboxEl) {\n    if (checkboxEl) {\n      checkboxEl.classList.add('transition-bg');\n      checkboxEl.classList.add('flash-error');\n      setTimeout(() => {\n        checkboxEl.classList.remove('flash-error');\n        setTimeout(() => {\n          checkboxEl.classList.remove('transition-bg');\n        }, 200);\n      }, 200);\n    }\n  }\n\n  _deleteItem(e) {\n    let uniqueId = e.model.__data.item && e.model.__data.item.uniqueId !== undefined ? e.model.__data.item.uniqueId : undefined;\n    removeItem(uniqueId);\n  }\n\n  async _setItemEquipped(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let itemModel = e.model.__data.item;\n    let uniqueId = itemModel ? itemModel.uniqueId : undefined;\n    let isEquipped = itemModel ? itemModel.isEquipped : false;\n    \n    if (isEquipped) {\n      toggleItemEquipped(uniqueId);\n    } else if (await canEquipItem(itemModel)) {\n      toggleItemEquipped(uniqueId);\n    } else {\n      let checkbox = e.target.querySelector('vaadin-checkbox')\n      this._flashCheckbox(checkbox)\n    }\n  }\n\n  async _setItemAttuned(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let itemModel = e.model.__data.item;\n    let uniqueId = itemModel ? itemModel.uniqueId : undefined;\n    let isAttuned = itemModel ? itemModel.isAttuned : false;\n\n    if (isAttuned) {\n      toggleItemAttuned(uniqueId);\n    } else if (await canAttuneItem(itemModel)) {\n      toggleItemAttuned(uniqueId);\n    } else {\n      let checkbox = e.target.querySelector('vaadin-checkbox')\n      this._flashCheckbox(checkbox)\n    }\n  }\n\n  _quantityChange(e) {\n    const item = this.$.grid.getEventContext(e).item;\n    let newQuantity = parseInt(item.quantity, 10);\n    if (isNaN(newQuantity)) {\n      newQuantity = 0;\n    }\n\n    item.storedItem.quantity = newQuantity;\n    setItem(item);\n  }\n\n  _addItem() {\n    addItem({}, false);\n  }\n\n  _preventDefault(e) {\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  _or(...bools) {\n    for (let bool of bools) {\n      if (bool) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  _noRarity(rarity) {\n    return !rarity || rarity === 'None';\n  }\n\n  _toggleTheme(item) {\n    return item.children && item.children.length === 0 ? 'no-children' : '';\n  }\n\n  _checkBreakpoint() {\n    const grid = this.$.grid;\n    this.isMobile = window.innerWidth < 921;\n    // Define Row Details\n    if (this.isMobile) {\n      grid.rowDetailsRenderer = ((root, grid, rowData) => {\n        if (rowData.detailsOpened) {\n          if (!root.firstElementChild) {\n            root.innerHTML = '<div class=\"details\"></div>';\n          }\n          if (!this.detailEl) {\n            this.detailEl = document.createElement('dnd-character-builder-equipment-item-detail');\n            this.detailEl.smallRender = true;\n            this.detailEl.unique = Date.now();\n          }\n          root.querySelector('.details').appendChild(this.detailEl);\n          this.detailEl.item = rowData.item;\n        }\n      }).bind(this);\n    } else if (grid.rowDetailsRenderer) {\n      console.error('removing rowDetailsRenderer')\n      grid.rowDetailsRenderer = () => {};\n    }\n  }\n\n  _linkClick() {\n    this.dispatchEvent(new CustomEvent(\"open-drawer\", {\n      bubbles: true,\n      composed: true,\n      detail: {\n        viewId: 'items'\n      }\n    }));\n  }\n  \n  _isActive(activeItem, item) {\n    return activeItem === item;\n  }\n\n  static get template() {\n    return html`\n      <style include=\"material-styles\"></style>\n      <style>\n        :host {\n          display: block;\n          padding: 14px;\n        }\n        [hidden] {\n          display: none !important;\n        }\n        a {\n          color: var(--mdc-theme-secondary);\n        }\n\n        vaadin-grid {\n          margin-bottom: 200px;\n        }\n\n        .heading {\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          justify-content: space-between;\n          border-bottom: 1px solid var(--lumo-contrast-10pct);\n        }\n        .reference-link:hover {\n          color: var(--mdc-theme-secondary);\n        }\n\n        .col-wrap {\n          display: flex; \n          justify-content: space-between;\n          flex-wrap: wrap;\n        }\n\n        .row-wrap {\n          width: 100%;\n        }\n        .row-wrap:not(:last-child) {\n          margin-bottom: 24px;\n        }\n\n        .row-wrap > *:not(h2):not(:last-child) {\n          margin-bottom: 10px;\n        }\n\n        .no-content {\n          font-size: 14px;\n          font-style: italic;\n        }\n\n        .item-wrap {\n          display: flex;\n          flex-wrap: nowrap;\n          flex-direction: row;\n          justify-content: space-between;\n          align-items: flex-start;\n          padding: 10px 6px;\n          min-height: 28px;\n          border-bottom: 1px solid var(--_lumo-grid-secondary-border-color);\n        }\n        .item-wrap__name-wrap {\n          flex-basis: 100%;\n          min-width: 0;\n          display: flex;\n          flex-direction: column;\n          cursor: pointer;\n        }\n        .item-wrap__name-wrap:hover {\n          color: var(--mdc-theme-secondary);\n        }\n        .item-wrap__name {\n          font-weight: bold;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          position: relative;\n        }\n        .item-wrap__edited,\n        .item-wrap__from {\n          background-color: var(--mdc-theme-text-disabled-on-background);\n          color: var(--mdc-theme-on-secondary);\n          border: none;\n          border-radius: 4px;\n          outline: none;\n          display: inline-block;\n          justify-content: center;\n          white-space: normal;\n          font-size: 10px;\n          padding: 1px 4px;\n          margin-right: 4px;\n          font-style: italic;\n        }\n        .item-wrap__edited {\n          top: -1px;\n          position: relative;\n          font-weight: normal;\n        }\n        .item-wrap__type {\n          font-style: italic;\n          font-size: 12px;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          position: relative;\n        }\n        .item-wrap__type--fromBackground {\n          padding-right: 38px;\n        }\n        .item-wrap__type--fromClass {\n          padding-right: 50px;\n        }\n        .item-wrap__close {\n          font-size: 14px;\n          margin-top: 6px;\n          cursor: pointer;\n        }\n        .item-wrap__checkboxes {\n          display: flex;\n          flex-direction: column;\n          width: 80px;\n          flex-grow: 0;\n          flex-shrink: 0;\n          margin-left: auto;\n        }\n        .item-wrap__checkboxes > span {\n          cursor: pointer;\n        }\n        .item-wrap__quantity {\n          display: flex;\n          flex-direction: column;\n          width: 80px;\n          flex-grow: 0;\n          flex-shrink: 0;\n          margin-left: auto;\n        }\n        vaadin-integer-field {\n          margin: -13px 0 8px;\n        }\n        vaadin-checkbox {\n          pointer-events: none;\n          font-size: 13px;\n        }\n        vaadin-checkbox.flash-error {\n          color: var(--mdc-theme-error);\n          transition: color 0.2s ease-out;\n          --lumo-contrast-20pct: var(--mdc-theme-error);\n        }\n        vaadin-checkbox.transition-bg {\n          transition: color 0.2s ease-in;\n        }\n\n        .details {\n          font-size: 14px;\n          width: calc(100% - 30px);\n          margin: 0 auto 13px !important;\n          background: var(--lumo-contrast-10pct);\n          border-radius: 4px;\n          padding: 14px;\n        }\n        \n        .details-row {\n          padding-top: 14px;\n        }\n\n        .details-wrap {\n          display: none;\n          font-size: 14px;\n          background: var(--lumo-contrast-10pct);\n          border-radius: 4px;\n          line-height: 1.5;\n          padding: 14px;\n        }\n\n        @media(min-width: 420px) {\n          .heading {\n            justify-content: flex-start;\n          }\n          .reference-link {\n            margin-left: 8px;\n          }\n        }\n\n        @media(min-width: 921px) {\n          .item-wrap[active] {\n            background: var(--_lumo-grid-selected-row-color);\n          }\n          .row-wrap {\n            width: calc(50% - 10px);\n          }\n          .row-wrap:first-child {\n            margin-bottom: 0;\n          }\n          .details {\n            display: none;\n          }\n          .details-wrap {\n            display: block;\n          }\n        }\n      </style>\n\n      <div class=\"heading\">\n        <h2>Inventory</h2>\n        <button class=\"mdc-icon-button material-icons\" on-click=\"_linkClick\">logout</button>\n      </div>\n      <div class=\"col-wrap\">\n        <div class=\"row-wrap\">\n          <vaadin-grid id=\"grid\" expanded-items=\"{{expandedItems}}\" active-item=\"{{activeItem}}\" height-by-rows rows-draggable theme=\"no-border no-row-borders no-row-padding\" >\n            <vaadin-grid-column>\n              <template>\n                <div class=\"item-wrap\" active$=\"[[_isActive(activeItem, item)]]\">\n                  <vaadin-grid-tree-toggle level$=[[level]] leaf=\"[[!item.container]]\" expanded=\"{{expanded}}\" theme$=[[_toggleTheme(item)]] on-click='_recordScrollHeight'></vaadin-grid-tree-toggle>\n                  <div class=\"item-wrap__name-wrap\" on-click=\"_expandDetails\">\n                    <span class=\"item-wrap__name\">[[item.name]]\n                      <span hidden$=\"[[!item.isEdited]]\" class=\"item-wrap__edited\">Edited</span>\n                    </span>\n                    <span class=\"item-wrap__type\">\n                      <span class=\"item-wrap__from\" hidden$=\"[[!item.fromBackground]]\">BG</span>\n                      <span class=\"item-wrap__from\" hidden$=\"[[!item.fromClass]]\">Class</span>\n                      <span>[[item.typeText]]<span hidden$=\"[[_noRarity(item.rarity, item)]]\">, [[item.rarity]]</span></span>\n                    </span>\n                  </div>\n                  <div hidden$=\"[[item.hasQuantity]]\" class=\"item-wrap__checkboxes\">\n                    <span on-click=\"_setItemEquipped\">\n                      <vaadin-checkbox checked=\"[[item.isEquipped]]\" hidden$=\"[[!item.canEquip]]\">Equip</vaadin-checkbox>\n                    </span>\n                    <span on-click=\"_setItemAttuned\">\n                      <vaadin-checkbox checked=\"[[item.isAttuned]]\" hidden$=\"[[!item.reqAttune]]\">Attune</vaadin-checkbox>\n                    </span>\n                  </div>\n                  <div hidden$=\"[[!item.hasQuantity]]\" class=\"item-wrap__quantity\">\n                    <vaadin-integer-field min=\"0\" value=\"{{item.quantity}}\" theme=\"mini\" has-controls on-change=\"_quantityChange\"></vaadin-integer-field>\n                  </div>\n                  <div class=\"mdc-buttom-icon material-icons item-wrap__close\" on-click=\"_deleteItem\">close</div>\n                </div>\n              </template>\n            </vaadin-grid-column>\n          </vaadin-grid>\n        </div>\n        <template is=\"dom-if\" if=\"[[!isMobile]]\">\n          <div class=\"row-wrap details-row\" hidden$=\"[[!activeItem]]\">\n            <div class=\"details-wrap\">          \n              <dnd-character-builder-equipment-item-detail small-render item=\"{{activeItem}}\"></dnd-character-builder-equipment-item-detail>\n            </div>\n          </div>\n        </template>\n      </div>\n    `;\n  }\n}\n\ncustomElements.define(\"dnd-character-builder-equipment\", DndCharacterBuilderEquipment);"],"sourceRoot":""}