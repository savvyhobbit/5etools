{"version":3,"sources":["webpack:///./components/dnd-button.js","webpack:///./js/bestiary.js","webpack:///./js/dice.js","webpack:///./js/items.js","webpack:///./js/spells.js","webpack:///./js eager ^\\.\\/.*\\.js$ namespace object","webpack:///./js/backgrounds.js","webpack:///./js/conditions.js","webpack:///./js/cults.js","webpack:///./js/feats.js","webpack:///./js/features.js","webpack:///./js/psionics.js","webpack:///./js/races.js","webpack:///./js/rewards.js","webpack:///./js/variantrules.js","webpack:///./node_modules/@vaadin/vaadin-grid/src/vaadin-grid-filter.js","webpack:///./node_modules/@vaadin/vaadin-grid/src/vaadin-grid-filter-column.js","webpack:///./node_modules/@vaadin/vaadin-grid/theme/lumo/vaadin-grid-sorter-styles.js","webpack:///./node_modules/@vaadin/vaadin-grid/src/vaadin-grid-sorter.js","webpack:///./components/dnd-list.js","webpack:///./components/dnd-selected-item.js","webpack:///./components/dnd-selection-list.js","webpack:///./components/views/dnd-races-view.js"],"names":["DndButton","label","type","String","value","icon","svg","background","border","svgFill","svgStroke","setTimeout","this","button","$","i","result","fill","stroke","customElements","define","getProfBonusFromCr","cr","CR_TO_PROF","SKILL_TO_ATB_ABV","athletics","acrobatics","stealth","arcana","history","investigation","nature","religion","insight","medicine","perception","survival","deception","intimidation","performance","persuasion","renderer","renderSelection","mon","rootEl","querySelector","innerHTML","renderStack","entryList","name","window","monsterName","source","_pTypes","asText","sourceJsonToAbv","sourceJsonToFull","sizeAbvToFull","size","getAbilityModifier","str","dex","con","int","wis","cha","saves","save","parentElement","style","display","skills","skill","obj","Object","keys","map","k","uppercaseFirst","join","parseInt","dmgvuln","vulnerable","dmgres","resist","dmgimm","immune","conimm","conditionImmune","senses","passive","toString","languages","undefined","crToXp","traits","trait","length","traitname","traittext","text","traittexthtml","renderedcount","n","firstsecond","spells","indexOf","replace","newTrait","spellLinks","querySelectorAll","spellLink","spellslist","split","encodeURIComponent","toLowerCase","actions","action","actionname","actiontext","actiontexthtml","newAction","reactions","reaction","reactionname","reactiontext","reactiontexthtml","newNonReaction","newReaction","legendaries","legendary","shouldAddCap","legendaryname","legendarytext","legendarytexthtml","newLegendary","trim","legendaryActions","legendaryName","newLegendaryCap","renderSection","sectionClass","sectionEntries","entries","recursiveEntryRender","newThing","renderSkillOrSaveRoller","itemName","profBonusString","profDiceString","isSave","lairActions","regionalEffects","element","$this","s","out","spl","match","skillName","skillString","b","bonus","Number","fromAbility","getAbilityModNumber","pB","expert","push","makeSkillRoller","pBonusStr","pDiceStr","makeSaveRoller","statPEls","statPEl","addNonD20Rollers","titleMaybe","attemptToGetTitle","mode","expectedPB","withoutPB","capture","dc","ele","substring","statsRollerEls","statsRollerEl","addEventListener","roll","rollResult","getAttribute","multi","res2","rolls","concat","total","outputRollResult","statsDCRollerEls","statsDCRollerEl","$ele","newResult","outputEl","MAX_ROLLS","children","remove","onLoad","historyIndex","diceField","useNativeValidation","newOutput","addRollHandler","classList","add","e","preventDefault","focus","keyCode","which","historyCount","click","keyData","originalEvent","data","target","closest","item","hasParsed","noDisplay","category","itemTypeList","j","property","properties","itemPropertyList","armor","strength","scfType","adjustItem","weight","tier","rarity","reqAttune","weaponCategory","damages","damage","isLast","dmgTypeToFull","dmg1","dmgType","ac","speed","capacity","carryingcapacity","append","prop","a","dmg2","range","reload","spell","spellHtmlString","spellHtml","spLevelSchoolMetaToFull","level","school","meta","spTimeListToFull","time","spRangeToFull","spComponentsToFull","components","spDurationToFull","duration","entriesHigherLevel","higherLevelsEntryList","spMainClassesToFull","classes","fromSubclass","currentAndLegacy","spSubclassesToCurrentAndLegacyFull","scrollNote","webpackAsyncContext","req","webpackAsyncContextResolve","then","__webpack_require__","Promise","resolve","o","Error","code","id","module","exports","stats_wrapper","curbg","allBgs","_copy","sourceAbv","sourceFull","sourceEl","setAttribute","entry","outStack","texthtml","collapseList","traitTables","statsEl","list","curcondition","curcult","textlist","goal","cultists","signaturespells","feat","sourceAbr","prerequisite","ability","hasabilityitem","items","unshift","outstack","feature","typeArray","featureType","Array","isArray","t","featureJsonToAbv","selectedPsionic","STATS_ORDER_AND_TYPE","STATS_DURATION","STATS_TEXT","getModeString","modeIndex","modeString","modes","getModeTitle","submodes","modeStrings","subModes","getSubModeString","subMode","modeTitleArray","title","bracketPart","modeTitleBracketArray","cost","costMin","min","costMax","max","getModeTitleCost","concentration","unit","getModeTitleBracketPart","order","modeStringArray","description","getTextString","loadDiscipline","race","walk","climb","fly","traitlist","statsText","header","faux","reward","entryRenderer","curRule","textStack","path","notify","_connected","Boolean","super","connectedCallback","ready","child","firstElementChild","console","warn","connected","_previousValue","_debouncerFilterChanged","debounce","after","dispatchEvent","CustomEvent","bubbles","filter","is","headerTemplate","_prepareTemplatizer","templatizer","dataHost","_generateHeader","$_documentContainer","document","head","appendChild","content","createElement","direction","reflectToAttribute","_order","_isConnected","_onClick","bind","disconnectedCallback","isConnected","composed","activeElement","getRootNode","contains","test","navigator","userAgent","root","forEach","el","columns","listItems","filters","isMobile","searchString","selectedFilters","resultsCount","grid","detail","selectedItems","linkData","_checkBreakpoint","_adjustHeight","setInterval","innerWidth","top","getBoundingClientRect","height","innerHeight","col","options","skipSort","flat","profOptions","Parser","SKILL_JSON_TO_FULL","profAbv","abilityOptions","ATB_ABV_TO_FULL","abilityAbv","val","some","option","sourceJsonToFullCompactPrefix","valItem","includes","uniqueVals","sort","labelA","labelB","startsWithNumA","startsWithNumB","numA","parseFloat","numB","error","model","__data","newFilters","set","index","modelId","observer","selectedItem","allItems","loading","_modelsRenderSelection","Function","characterOption","shadowRoot","catch","thing","enableHashRouting","disableScrollBack","hasSelection","_data","_filters","_selectedItem","_selectedHash","selectionEventHandler","_checkHashForSelection","selection","deselectionEventHandler","removeEventListener","newSelection","hashSelection","itemFromHash","scrollTo","DndRacesView"],"mappings":"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","file":"22.bundle.js","sourcesContent":["import { PolymerElement, html } from '@polymer/polymer';\nimport { MDCRipple } from '@material/ripple';\nimport { } from '@polymer/polymer/lib/elements/dom-if.js';\nimport \"./dnd-svg\";\n\nclass DndButton extends PolymerElement {\n  static get properties() {\n    return {\n      label: {\n        type: String,\n        value: ''\n      },\n      icon: {\n        type: String,\n        value: ''\n      },\n      svg: {\n        type: String,\n        value: ''\n      },\n      background: {\n        type: String,\n        value: ''\n      },\n      border: {\n        type: String,\n        value: ''\n      },\n      svgFill: {\n        type: String,\n        value: ''\n      },\n      svgStroke: {\n        type: String,\n        value: ''\n      }\n    }\n  }\n\n  connectedCallback() {\n    setTimeout(()=> {\n      this.button = new MDCRipple(this.$.button);\n    }, 10)\n  }\n\n  _exists(i) {\n    return !!i;\n  }\n\n  _styleStr(background, border, label) {\n    let result = '';\n    if (background) {\n      result+= `background: ${background}; `\n    }\n    if (border) {\n      result+= `border: ${border}; `\n    }\n    return result;\n  }\n\n  _svgStyleStr(fill, stroke) {\n    let result = '';\n    if (fill) {\n      result+= `fill: ${fill}; `\n    }\n    if (stroke) {\n      result+= `stroke: ${stroke}; `\n    }\n    return result;\n  }\n\n  static get template() {\n    return html`\n      <style include=\"material-styles\">\n        .mdc-tab-scroller__scroll-area--scroll {\n          overflow-x: auto;\n          background-color: var(--mdc-theme-surface);\n          border: 1px solid var(--mdc-theme-text-divider-on-background);\n          border-bottom: none;\n        }\n        :host {\n          display: inline;\n          overflow: hidden;\n          white-space: nowrap;\n        }\n        .mdc-button {\n          display: inline-flex;\n          justify-content: center;\n          align-items: center;\n          width: 100%;\n        }\n        .mdc-button .mdc-button__icon {\n          margin-right: 0px;\n          margin-left: 8px;\n        }\n        .mdc-button [background] {\n          background: var(--lumo-contrast-10pct);\n        }\n        dnd-svg {\n          height: 20px;\n          width: 20px;\n          flex-shrink: 0;\n          flex-grow: 0;\n          padding-left: 8px;\n          fill: var(--mdc-theme-primary);\n          stroke: var(--mdc-theme-primary);\n        }\n        i {\n          flex-shrink: 0;\n          flex-grow: 0;\n        }\n\n        \n        :host(.btn-field__btn) dnd-svg {\n          padding-left: 0;\n        }\n        :host(.btn-field__btn) i {\n          margin-left: 0;\n        }\n\n        :host(.icon-only) dnd-svg {\n          margin-left: -24px;\n          padding-left: 0;\n        }\n        :host(.icon-only) i {\n          margin-left: -18px;\n          padding-left: 0;\n        }\n\n        :host(.link) .mdc-button__label {\n          text-transform: none;\n          color: var(--lumo-body-text-color);\n          letter-spacing: normal;\n        }\n        :host(.link) i {\n          color: var(--lumo-body-text-color);\n        }\n        :host(.link) button:hover::before {\n          background: none;\n        }\n        :host(.link) button:hover i,\n        :host(.link) button:hover .mdc-button__label {\n          color: var(--mdc-theme-secondary);\n        }\n\n        :host([edit-mode]) button {\n          background-color: var(--mdc-theme-secondary);\n          color: var(--mdc-theme-on-secondary)\n        }\n        :host([edit-mode]) .mdc-button__label {\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([edit-mode]) i {\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([edit-mode]) button:hover i,\n        :host([edit-mode]) button:hover .mdc-button__label {\n          color: var(--mdc-theme-on-secondary);\n        }\n\n        :host([not-edit-mode]) button {\n          background-color: var(--mdc-theme-primary);\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([not-edit-mode]) .mdc-button__label {\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([not-edit-mode]) i {\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([not-edit-mode]) button:hover i,\n        :host([not-edit-mode]) button:hover .mdc-button__label {\n          color: var(--mdc-theme-on-primary);\n        }\n\n      </style>\n      <button id=\"button\" class=\"mdc-button\" style$=\"[[_styleStr(background, border, label)]]\">\n        <div class=\"mdc-button__ripple\"></div>\n        <span class=\"mdc-button__label\">[[label]]</span>\n        <slot name=\"label\"></slot>\n        <template is=\"dom-if\" if=\"[[_exists(icon)]]\">\n          <i class=\"material-icons mdc-button__icon\" aria-hidden=\"true\">[[icon]]</i>\n        </template>\n        <template is=\"dom-if\" if=\"[[_exists(svg)]]\">\n          <dnd-svg id=\"[[svg]]\" style$=\"[[_svgStyleStr(svgFill, svgStroke)]]\"></dnd-svg>\n        </template>\n      </button>\n    `;\n  }\n\n}\ncustomElements.define('dnd-button', DndButton);","import { parseHTML, utils_makeRoller, jqAfter, jqPrepend} from \"../js/utils.js\";\r\nimport EntryRenderer from \"../util/entryrender.js\";\r\nimport Parser from \"../util/Parser.js\"\r\nimport droll from \"../lib/droll.js\"\r\n\r\nconst MAX_ROLLS = 5\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"margin-bottom_large stats-wrapper\">\r\n\t\t<div id=\"stats\" class=\"monster\">\r\n\t\t\t<div id=\"name\">\r\n\t\t\t\tName <span class=\"source\" title=\"Source book\">SRC</span>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"sizetypealignment\">\r\n\t\t\t\t<span id=\"size\">Size</span> <span id=\"type\">type</span>, <span id=\"alignment\">alignment</span>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"divider\"></div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Armor Class</strong> <span id=\"ac\">## (source)</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Hit Points</strong> <span id=\"hp\">hp</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Speed</strong> <span id=\"speed\">30 ft.</span>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"abilitynames\">\r\n\t\t\t\t<div>STR</div>\r\n\t\t\t\t<div>DEX</div>\r\n\t\t\t\t<div>CON</div>\r\n\t\t\t\t<div>INT</div>\r\n\t\t\t\t<div>WIS</div>\r\n\t\t\t\t<div>CHA</div>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"abilityscores\">\r\n\t\t\t\t<div id=\"str\"><span class=\"score\">10</span> (<span class=\"mod\">0</span>)</div>\r\n\t\t\t\t<div id=\"dex\"><span class=\"score\">10</span> (<span class=\"mod\">0</span>)</div>\r\n\t\t\t\t<div id=\"con\"><span class=\"score\">10</span> (<span class=\"mod\">0</span>)</div>\r\n\t\t\t\t<div id=\"int\"><span class=\"score\">10</span> (<span class=\"mod\">0</span>)</div>\r\n\t\t\t\t<div id=\"wis\"><span class=\"score\">10</span> (<span class=\"mod\">0</span>)</div>\r\n\t\t\t\t<div id=\"cha\"><span class=\"score\">10</span> (<span class=\"mod\">0</span>)</div>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Saving Throws</strong> <span id=\"saves\">Str +0</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Skills</strong> <span id=\"skills\">Perception +0</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Damage Vulnerabilities</strong> <span id=\"dmgvuln\">fire</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Damage Resistances</strong> <span id=\"dmgres\">cold</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Damage Immunities</strong> <span id=\"dmgimm\">lightning</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Condition Immunities</strong> <span id=\"conimm\">exhaustion</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Senses</strong> <span id=\"senses\">darkvision 30 ft.</span> passive Perception <span id=\"pp\">10</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Languages</strong> <span id=\"languages\">Common</span>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<strong>Challenge</strong> <span id=\"cr\">1</span> (<span id=\"xp\">450</span> XP)\r\n\t\t\t</div>\r\n\t\t\t<div id=\"traits\">\r\n\t\t\t</div>\r\n\t\t\t<div id=\"actions\">\r\n\t\t\t\t<span>Actions</span>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"reactions\">\r\n\t\t\t\t<span>Reactions</span>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"legendaries\">\r\n\t\t\t\t<span>Legendary Actions</span>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"lairactions\">\r\n\t\t\t\t<span>Lair Actions</span>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"regionaleffects\">\r\n\t\t\t\t<span>Regional Effects</span>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div id=\"output\"></div>\r\n\t</div>`;\r\n\r\nfunction objToTitleCaseStringWithCommas(obj) {\r\n  return Object.keys(obj)\r\n    .map(function(k) {\r\n      return k.uppercaseFirst() + \" \" + obj[k];\r\n    })\r\n    .join(\", \");\r\n}\r\nconst ATB_PROF_MODE = \"mode\";\r\nconst ATB_PROF_BONUS_STR = \"profBonusStr\";\r\nconst ATB_PROF_DICE_STR = \"profDiceStr\";\r\nconst PROF_MODE_BONUS = \"bonus\";\r\nconst PROF_MODE_DICE = \"dice\";\r\nfunction getProfBonusFromCr(cr) {\r\n  if (CR_TO_PROF[cr]) return CR_TO_PROF[cr];\r\n  return 0;\r\n}\r\nconst CR_TO_PROF = {\r\n  \"0\": 2,\r\n  \"1/8\": 2,\r\n  \"1/4\": 2,\r\n  \"1/2\": 2,\r\n  \"1\": 2,\r\n  \"2\": 2,\r\n  \"3\": 2,\r\n  \"4\": 2,\r\n  \"5\": 3,\r\n  \"6\": 3,\r\n  \"7\": 3,\r\n  \"8\": 3,\r\n  \"9\": 4,\r\n  \"10\": 4,\r\n  \"11\": 4,\r\n  \"12\": 4,\r\n  \"13\": 5,\r\n  \"14\": 5,\r\n  \"15\": 5,\r\n  \"16\": 5,\r\n  \"17\": 6,\r\n  \"18\": 6,\r\n  \"19\": 6,\r\n  \"20\": 6,\r\n  \"21\": 7,\r\n  \"22\": 7,\r\n  \"23\": 7,\r\n  \"24\": 7,\r\n  \"25\": 8,\r\n  \"26\": 8,\r\n  \"27\": 8,\r\n  \"28\": 8,\r\n  \"29\": 9,\r\n  \"30\": 9\r\n};\r\nconst SKILL_TO_ATB_ABV = {\r\n  athletics: \"dex\",\r\n  acrobatics: \"dex\",\r\n  \"sleight of hand\": \"dex\",\r\n  stealth: \"dex\",\r\n  arcana: \"int\",\r\n  history: \"int\",\r\n  investigation: \"int\",\r\n  nature: \"int\",\r\n  religion: \"int\",\r\n  \"animal handling\": \"wis\",\r\n  insight: \"wis\",\r\n  medicine: \"wis\",\r\n  perception: \"wis\",\r\n  survival: \"wis\",\r\n  deception: \"cha\",\r\n  intimidation: \"cha\",\r\n  performance: \"cha\",\r\n  persuasion: \"cha\"\r\n};\r\nfunction getAttribute(skill) {\r\n  return SKILL_TO_ATB_ABV[skill.toLowerCase().trim()];\r\n}\r\n\r\nconst renderer = new EntryRenderer();\r\nfunction renderSelection(mon, rootEl) {\r\n  rootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n\tlet renderStack = [];\r\n\tlet entryList = {};\r\n\tvar name = mon.name;\r\n\twindow.monsterName = name;\r\n\tvar source = mon.source;\r\n\tvar type = mon._pTypes.asText;\r\n\r\n\trootEl.querySelector(\"#name\").innerHTML = (\r\n\t\t`<span class=\"source source${source}\" title=\"${Parser.sourceJsonToAbv(source)}\">${Parser.sourceJsonToFull(source)}</span>`\r\n\t);\r\n\trootEl.querySelector(\"#size\").innerHTML = (Parser.sizeAbvToFull(mon.size));\r\n\trootEl.querySelector(\"#type\").innerHTML = (type);\r\n\trootEl.querySelector(\"#alignment\").innerHTML = (mon.alignment);\r\n\trootEl.querySelector(\"#ac\").innerHTML = (mon.ac);\r\n\trootEl.querySelector(\"#hp\").innerHTML = (mon.hp);\r\n\trootEl.querySelector(\"#speed\").innerHTML = (mon.speed);\r\n\trootEl.querySelector(\"#str span.score\").innerHTML = (mon.str);\r\n\trootEl.querySelector(\"#str span.mod\").innerHTML = (Parser.getAbilityModifier(mon.str));\r\n\trootEl.querySelector(\"#dex span.score\").innerHTML = (mon.dex);\r\n\trootEl.querySelector(\"#dex span.mod\").innerHTML = (Parser.getAbilityModifier(mon.dex));\r\n\trootEl.querySelector(\"#con span.score\").innerHTML = (mon.con);\r\n\trootEl.querySelector(\"#con span.mod\").innerHTML = (Parser.getAbilityModifier(mon.con));\r\n\trootEl.querySelector(\"#int span.score\").innerHTML = (mon.int);\r\n\trootEl.querySelector(\"#int span.mod\").innerHTML = (Parser.getAbilityModifier(mon.int));\r\n\trootEl.querySelector(\"#wis span.score\").innerHTML = (mon.wis);\r\n\trootEl.querySelector(\"#wis span.mod\").innerHTML = (Parser.getAbilityModifier(mon.wis));\r\n\trootEl.querySelector(\"#cha span.score\").innerHTML = (mon.cha);\r\n\trootEl.querySelector(\"#cha span.mod\").innerHTML = (Parser.getAbilityModifier(mon.cha));\r\n\r\n\tvar saves = mon.save;\r\n\tif (saves) {\r\n\t\trootEl.querySelector(\"#saves\").parentElement.style.display = 'block';\r\n\t\trootEl.querySelector(\"#saves\").innerHTML = (saves);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#saves\").parentElement.style.display = 'none';\r\n\t}\r\n\r\n\tvar skills = mon.skill;\r\n\tlet perception = 0;\r\n\tif (skills) {\r\n\t\trootEl.querySelector(\"#skills\").parentElement.style.display = 'block';\r\n\t\trootEl.querySelector(\"#skills\").innerHTML = (objToTitleCaseStringWithCommas(skills));\r\n\t\tif (skills.perception) perception = parseInt(skills.perception);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#skills\").parentElement.style.display = 'none';\r\n\t}\r\n\r\n\tvar dmgvuln = mon.vulnerable;\r\n\tif (dmgvuln) {\r\n\t\trootEl.querySelector(\"#dmgvuln\").parentElement.style.display = 'block';\r\n\t\trootEl.querySelector(\"#dmgvuln\").innerHTML = (dmgvuln);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#dmgvuln\").parentElement.style.display = 'none';\r\n\t}\r\n\r\n\tvar dmgres = mon.resist;\r\n\tif (dmgres) {\r\n\t\trootEl.querySelector(\"#dmgres\").parentElement.style.display = 'block';\r\n\t\trootEl.querySelector(\"#dmgres\").innerHTML = (dmgres);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#dmgres\").parentElement.style.display = 'none';\r\n\t}\r\n\r\n\tvar dmgimm = mon.immune;\r\n\tif (dmgimm) {\r\n\t\trootEl.querySelector(\"#dmgimm\").parentElement.style.display = 'block';\r\n\t\trootEl.querySelector(\"#dmgimm\").innerHTML = (dmgimm);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#dmgimm\").parentElement.style.display = 'none';\r\n\t}\r\n\r\n\tvar conimm = mon.conditionImmune;\r\n\tif (conimm) {\r\n\t\trootEl.querySelector(\"#conimm\").parentElement.style.display = 'block';\r\n\t\trootEl.querySelector(\"#conimm\").innerHTML = (conimm);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#conimm\").parentElement.style.display = 'none';\r\n\t}\r\n\r\n\tvar senses = mon.senses;\r\n\tif (senses) {\r\n\t\trootEl.querySelector(\"#senses\").innerHTML = (senses + \", \");\r\n\t} else {\r\n\t\trootEl.querySelector(\"#senses\").innerHTML = (\"\");\r\n\t}\r\n\r\n\tvar passive = mon.passive || (10 + perception).toString;\r\n\trootEl.querySelector(\"#pp\").innerHTML = (passive)\r\n\r\n\tvar languages = mon.languages;\r\n\tif (languages) {\r\n\t\trootEl.querySelector(\"#languages\").innerHTML = (languages);\r\n\t} else {\r\n\t\trootEl.querySelector(\"#languages\").innerHTML = (\"\\u2014\");\r\n\t}\r\n\r\n\tvar cr = mon.cr === undefined ? \"Unknown\" : mon.cr;\r\n\trootEl.querySelector(\"#cr\").innerHTML = (cr);\r\n\trootEl.querySelector(\"#xp\").innerHTML = (Parser.crToXp(cr));\r\n\r\n\tvar traits = mon.trait;\r\n\trootEl.querySelector(\"#traits\").style.display = 'none';\r\n\r\n\tif (traits && traits.length > 0) {\r\n\t\trootEl.querySelector(\"#traits\").style.display = 'block';\r\n\t\tfor (var i = traits.length - 1; i >= 0; i--) {\r\n\t\t\tvar traitname = traits[i].name;\r\n\t\t\tvar traittext = traits[i].text;\r\n\t\t\tvar traittexthtml = \"\";\r\n\t\t\tvar renderedcount = 0;\r\n\t\t\tfor (var n = 0; n < traittext.length; n++) {\r\n\t\t\t\tif (!traittext[n]) continue;\r\n\r\n\t\t\t\trenderedcount++;\r\n\t\t\t\tvar firstsecond = \"\";\r\n\t\t\t\tif (renderedcount === 1) firstsecond = \"first \";\r\n\t\t\t\tif (renderedcount === 2) firstsecond = \"second \";\r\n\r\n\t\t\t\tvar spells = \"\";\r\n\t\t\t\tif (traitname.indexOf(\"Spellcasting\") !== -1 && traittext[n].indexOf(\": \") !== -1) spells = \"spells\";\r\n\t\t\t\tif (traitname.indexOf(\"Variant\") !== -1 && traitname.indexOf(\"Coven\") !== -1 && traittext[n].indexOf(\": \") !== -1) spells = \"spells\";\r\n\r\n\t\t\t\ttraittexthtml = traittexthtml + \"<p class='\" + firstsecond + spells + \"'>\" + traittext[n].replace(/\\u2022\\s?(?=C|\\d|At\\swill)/g, \"\")+\"</p>\";\r\n\t\t\t}\r\n\t\t\tconst newTrait = parseHTML(\"<div class='trait'><div class='trait\" + i + \"'><span class='name'>\" + traitname + \".</span> \" + traittexthtml + \"</div></div>\");\r\n\t\t\tjqAfter(rootEl.querySelector(\"#traits\"), newTrait);\r\n\r\n\t\t\t// parse spells, make hyperlinks\r\n\t\t\tconst spellLinks = rootEl.querySelectorAll('.trait div p.spells');\r\n\t\t\tfor (let spellLink of spellLinks) {\r\n\t\t\t\tlet spellslist = spellLink.innerHTML;\r\n\t\t\t\tif (spellslist[0] === \"*\") return;\r\n\t\t\t\tspellslist = spellslist.split(\": \")[1].split(/\\, (?!\\+|\\dd|appears|inside gems)/g);\r\n\t\t\t\tfor (let i = 0; i < spellslist.length; i++) {\r\n\t\t\t\t\tspellslist[i] = \"<a href='#/spells/\" + encodeURIComponent((spellslist[i].replace(/(\\*)| \\(([^\\)]+)\\)/g, \"\"))).toLowerCase().replace(\"'\", \"%27\") + \"_\" + \"phb'>\" + spellslist[i] + \"</a>\";\r\n\t\t\t\t\tif (i !== spellslist.length - 1) spellslist[i] = spellslist[i] + \", \";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tspellLink.innerHTML = (spellLink.innerHTML.split(\": \")[0] + \": \" + spellslist.join(\"\"));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tconst actions = mon.action;\r\n\r\n\tif (actions && actions.length) for (let i = actions.length - 1; i >= 0; i--) {\r\n\t\tconst actionname = actions[i].name;\r\n\t\tconst actiontext = actions[i].text;\r\n\t\tlet actiontexthtml = \"\";\r\n\t\tlet renderedcount = 0;\r\n\t\tfor (let n = 0; n < actiontext.length; n++) {\r\n\t\t\tif (!actiontext[n]) continue;\r\n\r\n\t\t\trenderedcount++;\r\n\t\t\tlet firstsecond = \"\";\r\n\t\t\tif (renderedcount === 1) firstsecond = \"first \";\r\n\t\t\tif (renderedcount === 2) firstsecond = \"second \";\r\n\r\n\t\t\tactiontexthtml = actiontexthtml + \"<p class='\"+firstsecond+\"'>\"+actiontext[n]+\"</p>\";\r\n\t\t}\r\n\t\tconst newAction = parseHTML(\"<div class='action'><div class='action\"+i+\"'><span class='name'>\"+actionname+\".</span> \"+actiontexthtml+\"</div></div>\")\r\n\t\tjqAfter(rootEl.querySelector('#actions'), newAction);\r\n\t}\r\n\r\n\tconst reactions = mon.reaction;\r\n\trootEl.querySelector(\"#reactions\").style.display = 'none';\r\n\r\n\tif (reactions && (reactions.text || reactions.length)) {\r\n\r\n\t\trootEl.querySelector(\"#reactions\").style.display = 'block';\r\n\r\n\t\tif (!reactions.length) {\r\n\t\t\tconst reactionname = reactions.name;\r\n\t\t\tconst reactiontext = reactions.text;\r\n\t\t\tlet reactiontexthtml = \"\";\r\n\t\t\tlet renderedcount = 0;\r\n\t\t\tfor (let n = 0; n < reactiontext.length; n++) {\r\n\t\t\t\tif (!reactiontext[n]) continue;\r\n\r\n\t\t\t\trenderedcount++;\r\n\t\t\t\tlet firstsecond = \"\";\r\n\t\t\t\tif (renderedcount === 1) firstsecond = \"first \";\r\n\t\t\t\tif (renderedcount === 2) firstsecond = \"second \";\r\n\r\n\t\t\t\treactiontexthtml = reactiontexthtml + \"<p class='\" + firstsecond + \"'>\" + reactiontext[n] + \"</p>\";\r\n\t\t\t}\r\n\r\n\t\t\tconst newNonReaction = parseHTML(\"<div class='reaction'><div class='reaction0'><span class='name'>\" + reactionname + \".</span> \" + reactiontexthtml + \"</div></div>\")\r\n\t\t\tjqAfter(rootEl.querySelector(\"#reactions\"), newNonReaction);\r\n\t\t}\r\n\r\n\t\tif (reactions.length) for (let i = reactions.length - 1; i >= 0; i--) {\r\n\t\t\tconst reactionname = reactions[i].name;\r\n\r\n\t\t\tconst reactiontext = reactions[i].text;\r\n\t\t\tlet reactiontexthtml = \"<span>\" + reactiontext + \"</span>\";\r\n\t\t\tfor (let n = 1; n < reactiontext.length; n++) {\r\n\t\t\t\tif (!reactiontext[n]) continue;\r\n\t\t\t\treactiontexthtml = reactiontexthtml + \"<p>\" + reactiontext[n] + \"</p>\";\r\n\t\t\t}\r\n\r\n\t\t\tconst newReaction = parseHTML(\"<div class='reaction'><div class='reaction\" + i + \"'><span class='name'>\" + reactionname + \".</span> \" + reactiontexthtml + \"</div></div>\")\r\n\t\t\tjqAfter(rootEl.querySelector(\"#reactions\"), newReaction);\r\n\t\t}\r\n\t}\r\n\r\n\tconst legendaries = mon.legendary;\r\n\trootEl.querySelector(\"#legendaries\").style.display = 'none';\r\n\tif (legendaries) {\r\n\t\trootEl.querySelector(\"#legendaries\").style.display = 'block';\r\n\t\tlet shouldAddCap = legendaries.length > 0;\r\n\t\tfor (let i = legendaries.length - 1; i >= 0; i--) {\r\n\t\t\tconst legendaryname = legendaries[i].name ? legendaries[i].name + \".\" : \"\";\r\n\t\t\tconst legendarytext = legendaries[i].text;\r\n\t\t\tlet legendarytexthtml = \"\";\r\n\t\t\tlet renderedcount = 0;\r\n\t\t\tfor (let n = 0; n < legendarytext.length; n++) {\r\n\t\t\t\tif (!legendarytext[n]) continue;\r\n\t\t\t\trenderedcount++;\r\n\t\t\t\tlet firstsecond = \"\";\r\n\t\t\t\tif (renderedcount === 1) firstsecond = \"first \";\r\n\t\t\t\tif (renderedcount === 2) firstsecond = \"second \";\r\n\t\t\t\tlegendarytexthtml += `<p class='${firstsecond}'>${legendarytext[n]}</p>`;\r\n\t\t\t}\r\n\t\t\tconst newLegendary = parseHTML(`<div class='legendary'><div class='legendary'><span class='name'>${legendaryname}</span> ${legendarytexthtml}</div></div>`)\r\n\t\t\tjqAfter(rootEl.querySelector(\"#legendaries\"), newLegendary);\r\n\t\t\tif (legendaryname.trim() === '' || legendaryname.indexOf('Legendary Actions') > -1) {\r\n\t\t\t\tshouldAddCap = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (shouldAddCap) {\r\n\t\t\tconst legendaryActions = mon.legendaryActions || 3;\r\n\t\t\tconst legendaryName = name.split(\",\");\r\n\t\t\tconst newLegendaryCap = parseHTML(`<div class='legendary'><div class='legendary'><span class='name'></span> <span>${legendaryName[0]} can take ${legendaryActions} legendary action${legendaryActions > 1 ? \"s\" : \"\"}, choosing from the options below. Only one legendary action can be used at a time and only at the end of another creature's turn. ${legendaryName[0]} regains spent legendary actions at the start of its turn.</span></div></div>`)\r\n\t\t\tjqAfter(rootEl.querySelector(\"#legendaries\"), newLegendaryCap);\r\n\t\t}\r\n\t}\r\n\r\n\trootEl.querySelector(\"#lairactions\").style.display = 'none';\r\n\trootEl.querySelector(\"#regionaleffects\").style.display = 'none';\r\n\tif (mon.lairActions) renderSection(\"lairaction\", mon.lairActions);\r\n\tif (mon.regionalEffects) renderSection(\"regionaleffect\", mon.regionalEffects);\r\n\r\n\tfunction renderSection(sectionClass, sectionEntries) {\r\n\t\trootEl.querySelector(`#${sectionClass}s`).style.display = 'block';\r\n\t\tentryList = {type: \"entries\", entries: sectionEntries};\r\n\t\trenderStack = [];\r\n\t\trenderer.recursiveEntryRender(entryList, renderStack);\r\n\t\tconst newThing = parseHTML(`<div class='${sectionClass}'><div class='legendary'>${utils_makeRoller(renderStack.join(\"\"))}</div></div>`)\r\n\t\tjqAfter(rootEl.querySelector(`#${sectionClass}s`), newThing);\r\n\t}\r\n\r\n\tif (mon.skill) {\r\n\t\tmakeSkillRoller(rootEl.querySelector(\"#skills\"));\r\n\t}\r\n\tif (mon.save) {\r\n\t\tmakeSaveRoller(rootEl.querySelector(\"#saves\"));\r\n\t}\r\n\tfunction makeSkillRoller(element) {\r\n\t\tconst $this = element;\r\n\r\n\t\tconst re = /,\\s*(?![^()]*\\))/g; // Don't split commas within parentheses\r\n\t\tconst skills = $this.innerHTML.split(re).map(s => s.trim());\r\n\t\tconst out = [];\r\n\r\n\t\tskills.map(s => {\r\n\t\t\tconst re = /(\\-|\\+)?\\d+|(?:[^\\+]|\\n(?!\\+))+/g; // Split before and after each bonus\r\n\t\t\tconst spl = s.match(re);\r\n\r\n\t\t\tconst skillName = spl[0].trim();\r\n\r\n\t\t\tvar skillString = \"\";\r\n\t\t\tspl.map(b => {\r\n\t\t\t\tconst re = /(\\-|\\+)?\\d+/;\r\n\r\n\t\t\t\tif (b.match(re)){\r\n\t\t\t\t\tconst bonus = Number(b);\r\n\t\t\t\t\tconst fromAbility = Parser.getAbilityModNumber(mon[getAttribute(skillName)]);\r\n\t\t\t\t\tconst expectedPB = getProfBonusFromCr(mon.cr);\r\n\t\t\t\t\tconst pB = bonus - fromAbility;\r\n\t\t\r\n\t\t\t\t\tconst expert = (pB === expectedPB * 2) ? 2 : 1;\r\n\t\t\t\t\tconst pBonusStr = `+${bonus}`;\r\n\t\t\t\t\tconst pDiceStr = `${expert}d${pB*(3-expert)}${fromAbility >= 0 ? \"+\" : \"\"}${fromAbility}`;\r\n\t\t\r\n\t\t\t\t\tskillString += renderSkillOrSaveRoller(skillName, pBonusStr, pDiceStr, false);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tskillString += b;\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t});\r\n\r\n\t\t\tout.push(skillString);\r\n\t\t});\t\t\r\n\r\n\t\t$this.innerHTML = (out.join(\", \"));\r\n\t}\r\n\tfunction makeSaveRoller(element) {\r\n\t\tconst $this = element;\r\n\t\tconst saves = $this.innerHTML.split(\",\").map(s => s.trim());\r\n\t\tconst out = [];\r\n\t\tsaves.map(s => {\r\n\t\t\tconst spl = s.split(\"+\").map(s => s.trim());\r\n\t\t\tconst bonus = Number(spl[1]);\r\n\t\t\tconst fromAbility = Parser.getAbilityModNumber(mon[spl[0].toLowerCase()]);\r\n\t\t\tconst expectedPB = getProfBonusFromCr(mon.cr);\r\n\t\t\tconst pB = bonus - fromAbility;\r\n\r\n\t\t\tconst expert = (pB === expectedPB * 2) ? 2 : 1;\r\n\t\t\tconst pBonusStr = `+${bonus}`;\r\n\t\t\tconst pDiceStr = `${expert}d${pB*(3-expert)}${fromAbility >= 0 ? \"+\" : \"\"}${fromAbility}`;\r\n\r\n\t\t\tout.push(spl[0] + ' ' + renderSkillOrSaveRoller(spl[0], pBonusStr, pDiceStr, true));\r\n\t\t});\r\n\t\t$this.innerHTML = (out.join(\", \"));\r\n\t}\r\n\tfunction renderSkillOrSaveRoller(itemName, profBonusString, profDiceString, isSave) {\r\n\t\tconst mode = PROF_MODE_BONUS;\r\n\t\treturn `<span class='roller' title=\"${itemName} ${isSave ? \" save\" : \"\"}\" data-roll-alt=\"1d20;${profDiceString}\" data-roll='1d20${profBonusString}' ${ATB_PROF_MODE}='${mode}' ${ATB_PROF_DICE_STR}=\"+${profDiceString}\" ${ATB_PROF_BONUS_STR}=\"${profBonusString}\">${profBonusString}</span>`;\r\n\t}\r\n\r\n\t// inline rollers\r\n\tconst statPEls = rootEl.querySelectorAll(\"#stats p\");\r\n\tfor (let statPEl of statPEls) {\r\n\t\taddNonD20Rollers(statPEl);\r\n\r\n\t\t// add proficiency dice stuff for attack rolls, since those _generally_ have proficiency\r\n\t\t// this is not 100% accurate; for example, ghouls don't get their prof bonus on bite attacks\r\n\t\t// fixing it would probably involve machine learning though; we need an AI to figure it out on-the-fly\r\n\t\t// (Siri integration forthcoming)\r\n\t\tconst titleMaybe = attemptToGetTitle(statPEl);\r\n\t\tconst mode = PROF_MODE_BONUS;\r\n\r\n\t\tstatPEl.innerHTML = (statPEl.innerHTML.replace(/(\\-|\\+)?\\d+(?= to hit)/g, function(match) {\r\n\t\t\tconst bonus = Number(match);\r\n\r\n\t\t\tconst expectedPB = getProfBonusFromCr(mon.cr);\r\n\t\t\tconst withoutPB = bonus - expectedPB;\r\n\r\n\t\t\tif (expectedPB > 0) {\r\n\t\t\t\tconst profDiceString = `1d${expectedPB*2}${withoutPB >= 0 ? \"+\" : \"\"}${withoutPB}`;\r\n\r\n\t\t\t\treturn `<span class='roller' ${titleMaybe ? `title=\"${titleMaybe}\"` : \"\"} data-roll-alt='1d20;${profDiceString}' data-roll='1d20${match}' ${ATB_PROF_MODE}='${mode}' ${ATB_PROF_DICE_STR}=\"+${profDiceString}\" ${ATB_PROF_BONUS_STR}=\"${match}\">${match}</span>`\r\n\t\t\t} else {\r\n\t\t\t\treturn `<span class='roller' data-roll='1d20${match}'>${match}</span>`; // if there was no proficiency bonus to work with, fall back on this\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tstatPEl.innerHTML = (statPEl.innerHTML.replace(/DC\\s*(\\d+)/g, function(match, capture) {\r\n\t\t\tconst dc = Number(capture);\r\n\r\n\t\t\tconst expectedPB = getProfBonusFromCr(mon.cr);\r\n\r\n\t\t\tif (expectedPB > 0) {\r\n\t\t\t\tconst withoutPB = dc - expectedPB;\r\n\t\t\t\tconst profDiceString = `1d${(expectedPB*2)}${withoutPB >= 0 ? \"+\" : \"\"}${withoutPB}`;\r\n\r\n\t\t\t\treturn `DC <span class=\"dc-roller\" ${titleMaybe ? `title=\"${titleMaybe}\"` : \"\"} ${ATB_PROF_MODE}=\"${mode}\" data-roll-alt=\"${profDiceString}\" data-bonus=\"${capture}\" ${ATB_PROF_DICE_STR}=\"+${profDiceString}\" ${ATB_PROF_BONUS_STR}=\"${capture}\">${capture}</span>`;\r\n\t\t\t} else {\r\n\t\t\t\treturn match; // if there was no proficiency bonus to work with, fall back on this\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\taddNonD20Rollers(rootEl.querySelector(\"#stats #hp\"));\r\n\tfunction addNonD20Rollers (ele) {\r\n\t\tele.innerHTML = ele.innerHTML.replace(/\\d+d\\d+(\\s?(\\-|\\+)\\s?\\d+\\s?)?/g, function(match) {\r\n      const titleMaybe = attemptToGetTitle(ele);\r\n      return `<span class='roller' ${titleMaybe ? `title=\"${titleMaybe}\"` : \"\"} data-roll='${match}'>${match}</span>`;\r\n    });\r\n\t}\r\n\tfunction attemptToGetTitle(ele) {\r\n\t\tlet titleMaybe = ele.parentElement.querySelector(\".name\");\r\n\t\tif (titleMaybe) {\r\n\t\t\ttitleMaybe = titleMaybe.innerHTML;\r\n\t\t\tif (titleMaybe) {\r\n\t\t\t\ttitleMaybe = titleMaybe.substring(0, titleMaybe.length-1).trim();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn titleMaybe;\r\n\t}\r\n\r\n\t//$(\".spells span.roller\").contents().unwrap();\r\n\tlet statsRollerEls = rootEl.querySelectorAll(\"#stats span.roller\");\r\n\tfor (let statsRollerEl of statsRollerEls) {\r\n\t\tstatsRollerEl.addEventListener('click', () => {\r\n\t\t\tconst $this = statsRollerEl;\r\n\t\t\tlet roll;\r\n\t\t\tlet rollResult;\r\n\t\t\tif ($this.getAttribute(ATB_PROF_MODE) === PROF_MODE_DICE) {\r\n\t\t\t\troll = $this.getAttribute(\"data-roll-alt\").replace(/\\s+/g, \"\");\r\n\t\t\t\t// hacks because droll doesn't support e.g. \"1d20+1d4+2\" :joy: :ok_hand:\r\n\t\t\t\tconst multi = roll.split(\";\");\r\n\t\t\t\troll = roll.replace(\";\", \"+\");\r\n\t\t\t\trollResult = droll.roll(multi[0]);\r\n\t\t\t\tconst res2 = droll.roll(multi[1]);\r\n\t\t\t\trollResult.rolls = rollResult.rolls.concat(res2.rolls);\r\n\t\t\t\trollResult.total += res2.total;\r\n\t\t\t} else {\r\n\t\t\t\troll = $this.getAttribute(\"data-roll\").replace(/\\s+/g, \"\");\r\n\t\t\t\trollResult = droll.roll(roll);\r\n\t\t\t}\r\n\t\t\toutputRollResult($this, roll, rollResult);\r\n\t\t});\r\n\t}\r\n\t\r\n\tlet statsDCRollerEls = rootEl.querySelectorAll(\"#stats span.roller\");\r\n\tfor (let statsDCRollerEl of statsDCRollerEls) {\r\n\t\tconst $this = statsDCRollerEl;\r\n    let roll;\r\n    let rollResult;\r\n    if ($this.getAttribute(ATB_PROF_MODE) === PROF_MODE_DICE) {\r\n      roll = $this.getAttribute(\"data-roll-alt\").replace(/\\s+/g, \"\");\r\n      rollResult = droll.roll(roll);\r\n      outputRollResult($this, roll, rollResult);\r\n    }\r\n\t}\r\n\r\n\tfunction outputRollResult($ele, roll, rollResult) {\r\n\t\tconst name = window.monsterName;\r\n\t\tconst newResult = parseHTML(\r\n      `<span>${name}: <em>${roll}</em> rolled ${\r\n        $ele.getAttribute(\"title\") ? `${$ele.getAttribute(\"title\")} ` : \"\"\r\n      }for <strong>${rollResult.total}</strong> (<em>${rollResult.rolls.join(\", \")}</em>)<br></span>`\r\n\t\t);\r\n\t\tconst outputEl = rootEl.querySelector(\"#output\");\r\n\t\tjqPrepend(outputEl, newResult);\r\n\t\toutputEl.style.display = 'block';\r\n\t\tif (outputEl.children.length === MAX_ROLLS + 1) {\r\n\t\t\toutputEl.children[MAX_ROLLS].remove();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport { renderSelection, SKILL_TO_ATB_ABV };\r\n","import { parseHTML, jqPrepend } from './utils.js';\nimport { MDCTextField } from \"@material/textfield\";\nimport { MDCNotchedOutline } from \"@material/notched-outline\";\nimport droll from \"../lib/droll.js\";\n\nfunction onLoad(rootEl) {\n  let outputEl = rootEl.querySelector(\"div#output\");\n  let total = 0,\n  historyIndex = -1;\n  \n  let diceField = new MDCTextField(rootEl.querySelector(\".mdc-text-field\"));\n  new MDCNotchedOutline(rootEl.querySelector(\".mdc-notched-outline\"));\n  \n  diceField.useNativeValidation = false;\n  \n  let outputRollResult = (roll) => {\n    let rollResult = droll.roll(roll.replace(/\\s/g, \"\"));\n    if (rollResult) {\n      let newOutput = parseHTML(`<div>\n        <em><a class='roll' data-roll='${roll}'>${roll}</a></em> rolled for <strong>${rollResult.total}</strong>${rollResult.rolls.length > 1 ? `<br>(${rollResult.rolls.join(\", \")})` : ''}\n        </div>`)\n      \n      jqPrepend(outputEl, newOutput);\n      outputEl.style.display = null;\n      addRollHandler(newOutput);\n\n      total += rollResult.total;\n      rootEl.querySelector('#total').innerHTML = total;\n      rootEl.querySelector(\".roll-total-wrap\").style.display = null;\n      rootEl.querySelector(\".roll-clear\").style.display = null;\n      diceField.value = \"\";\n    } else {\n      rootEl.querySelector(\".dice-field-container .mdc-text-field\").classList.add(\"error\");\n    }\n  };\n  \n  rootEl.querySelector(\".roll-clear\").addEventListener(\"click\", e => {\n    e.preventDefault();\n    \n    historyIndex = -1;\n    outputEl.innerHTML = '';\n    rootEl.querySelector(\".roll-total-wrap\").style.display = 'none';\n    rootEl.querySelector(\".roll-clear\").style.display = \"none\";\n    total = 0;\n  });\n  \n  rootEl.querySelector(\".roll-submit\").addEventListener(\"click\", e => {\n    e.preventDefault();\n    \n    historyIndex = -1;\n    rootEl.querySelector(\".dice-field-container .mdc-text-field\").classList.remove(\"error\");\n    let roll = rootEl.querySelector(\".roll-field\").value;\n    if (roll) {\n      outputRollResult(roll);\n    } else {\n      rootEl.querySelector(\".dice-field-container .mdc-text-field\").classList.add(\"error\");\n    }\n    rootEl.querySelector(\".roll-field\").focus();\n  });\n  \n  rootEl.querySelector(\".roll-field\").addEventListener(\"keydown\", e => {\n    let keyCode = e.keyCode || e.which,\n    historyCount = rootEl.querySelectorAll(\"#output > div\").length;\n    \n    // up\n    if (keyCode === 38) {\n      e.preventDefault();\n      if (historyIndex + 1 < historyCount) {\n        historyIndex++;\n        diceField.value = rootEl.querySelector(`#output div:eq(${historyIndex}) a.roll`).getAttribute(\"data-roll\");\n      }\n      \n      // down\n    } else if (keyCode === 40) {\n      e.preventDefault();\n      if (historyIndex - 1 > -1) {\n        historyIndex--;\n        diceField.value = rootEl.querySelector(`#output div:eq(${historyIndex}) a.roll`).getAttribute(\"data-roll\");\n      }\n      \n      // enter\n    } else if (keyCode === 13) {\n      e.preventDefault();\n      rootEl.querySelector(\".roll-submit\").click();\n      \n      // comma or period\n    } else if (keyCode === 190 || keyCode === 188) {\n      e.preventDefault();\n      diceField.value = diceField.value + \"d\";\n    } else if (keyCode === 32 || keyCode === 189 || keyCode === 187) {\n      e.preventDefault();\n      diceField.value = diceField.value + \" + \";\n    }\n  });\n  rootEl.querySelector(\".roll-field\").addEventListener(\"submit\", e => {\n    e.preventDefault();\n    rootEl.querySelector(\".roll-submit\").click();\n  })\n  rootEl.querySelector(\".roll-field\").addEventListener(\"textInput\", e => {\n    var keyData = e.originalEvent.data;\n    if (keyData && (keyData === \".\" || keyData === \",\")) {\n      e.preventDefault();\n      diceField.value = diceField.value + \"d\";\n    } else if (keyData && (keyData === \" \" || keyData === \"+\")) {\n      e.preventDefault();\n      diceField.value = diceField.value + \"+\";\n    }\n  });\n  rootEl.querySelector(\".roll-field\").addEventListener(\"focus\", e => {\n    rootEl.querySelector(\".dice-field-label\").style.display = null;\n  });\n  rootEl.querySelector(\".roll-field\").addEventListener(\"blur\", e => {\n    rootEl.querySelector(\".dice-field-label\").style.display = 'none';\n  });\n\n  let rolls = rootEl.querySelectorAll(\".roll[data-roll]\");\n  for (let roll of rolls) {\n    addRollHandler(roll);\n  }\n  \n  function addRollHandler(roll) {\n    roll.addEventListener(\"click\", e => {\n      e.preventDefault();\n\n      let roll = e.target.closest(\".roll\").getAttribute(\"data-roll\");\n      if (roll) {\n        outputRollResult(roll);\n      }\n    });\n  }\n};\n\nexport { onLoad };","import EntryRenderer from '../util/entryrender.js';\r\nimport Parser from '../util/Parser.js';\r\nimport { cloneDeep, utils_makeRoller } from '../js/utils.js';\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"margin-bottom_small\">\r\n\t\t\t<span class=\"type\"></span><span class=\"rarity\"></span>\r\n\t\t\t<span class=\"attunement\"></span>\r\n\t\t</div>\r\n\t\t<div class=\"margin-bottom_small\">\r\n\t\t\t<span class=\"value\"></span><span class=\"weight\"></span>\r\n\t\t</div>\r\n\t\t<div class=\"margin-bottom_small\">\r\n\t\t\t<span class=\"damage\"></span>\r\n\t\t\t<span class=\"damageType\"></span>\r\n\t\t\t<span class=\"properties\"></span>\r\n\t\t</div>\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nconst renderer = new EntryRenderer();\r\nfunction renderSelection(item, rootEl) {\r\n\tadjustItem(item);\r\n\tconst wrap = rootEl.querySelector(\".selection-wrapper\") || rootEl;\r\n\twrap.innerHTML = stats_wrapper;\r\n\t\r\n\t// const sourceEl = rootEl.querySelector(\".stats-wrapper .source\")\r\n\t// const source = item.source;\r\n\t// const sourceFull = Parser.sourceJsonToFull(source);\r\n\t// sourceEl.innerHTML = (`<span class=\"source${item.source}\">${sourceFull},</span> page ${item.page}`);\r\n\r\n\trootEl.querySelector(\".stats-wrapper .value\").innerHTML = (item.value ? item.value+(item.weight ? \", \" : \"\") : \"\");\r\n\trootEl.querySelector(\".stats-wrapper .weight\").innerHTML = (item.weight ? item.weight+(item.weight == 1 ? \" lb.\" : \" lbs.\") : \"\");\r\n\trootEl.querySelector(\".stats-wrapper .rarity\").innerHTML = ((item.tier ? \", \"+item.tier : \"\")+(item.rarity ? \", \"+item.rarity : \"\"));\r\n\trootEl.querySelector(\".stats-wrapper .attunement\").innerHTML = (item.reqAttune ? item.reqAttune : \"\");\r\n\trootEl.querySelector(\".stats-wrapper .type\").innerHTML = (item.typeText);\r\n\r\n\trootEl.querySelector(\".stats-wrapper .damage\").innerHTML = (\"\");\r\n\trootEl.querySelector(\".stats-wrapper .damageType\").innerHTML = (\"\");\r\n\tconst type = item.type || \"\";\r\n\tif (item.weaponCategory) {\r\n\t\tif (item.damages && item.damages.length) {\r\n\t\t\tfor (let i = 0; i < item.damages.length; i++) {\r\n\t\t\t\tconst damage = item.damages[i];\r\n\t\t\t\tconst isLast = i === item.damages.length - 1;\r\n\t\t\t\tif (damage.roll && damage.type) {\r\n\t\t\t\t\trootEl.querySelector(\".stats-wrapper .damage\").innerHTML += `<span>${utils_makeRoller(damage.roll)} ${Parser.dmgTypeToFull(damage.type)}</span>${isLast ? '': ' + '}`\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(item.dmg1) rootEl.querySelector(\".stats-wrapper .damage\").innerHTML = (utils_makeRoller(item.dmg1));\r\n\t\t\tif(item.dmgType) rootEl.querySelector(\".stats-wrapper .damageType\").innerHTML = (Parser.dmgTypeToFull(item.dmgType));\r\n\t\t}\r\n\t} else if (type === \"LA\" ||type === \"MA\"|| type === \"HA\") {\r\n\t\trootEl.querySelector(\".stats-wrapper .damage\").innerHTML = (\"AC \"+item.ac+(type === \"LA\" ? \" + Dex\" : type === \"MA\" ? \" + Dex (max 2)\" : \"\"));\r\n\t} else if (type === \"S\") {\r\n\t\trootEl.querySelector(\".stats-wrapper .damage\").innerHTML = (\"AC +\"+item.ac);\r\n\t} else if (type === \"MNT\" || type === \"VEH\") {\r\n\t\tconst speed = item.speed;\r\n\t\tconst capacity = item.carryingcapacity;\r\n\t\tif (speed) rootEl.querySelector(\".stats-wrapper .damage\").append(\"Speed=\"+speed);\r\n\t\tif (speed && capacity) rootEl.querySelector(\".stats-wrapper .damage\").append(type === \"MNT\" ? \", \" : \"<br/>\");\r\n\t\tif (capacity) {\r\n\t\t\trootEl.querySelector(\".stats-wrapper .damage\").append(\"Carrying Capacity=\"+capacity);\r\n\r\n\t\t\tif (capacity.indexOf(\"ton\") === -1 && capacity.indexOf(\"passenger\") === -1) {\r\n\t\t\t\trootEl.querySelector(\".stats-wrapper .damage\").append(capacity == 1 ? \" lb.\" : \" lbs.\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trootEl.querySelector(\".stats-wrapper .properties\").innerHTML = (\"\");\r\n\tif (item.property) {\r\n\t\tconst properties = item.property.split(\",\");\r\n\t\tfor (let i = 0; i < properties.length; i++) {\r\n\t\t\tconst prop = properties[i];\r\n\t\t\tlet a = window.itemPropertyList[prop].name;\r\n\t\t\tif (prop === \"V\" && item.dmg2) a = `${a} (${item.dmg2})`;\r\n\t\t\tif (prop === \"T\" || prop === \"A\" || prop === \"AF\") a = `${a} (${item.range}ft.)`;\r\n\t\t\tif (prop === \"RLD\") a = `${a} (${item.reload} shots)`;\r\n\t\t\ta = (i > 0 ? \", \" : item.dmg1 ? \"- \" : \"\") + a;\r\n\t\t\trootEl.querySelector(\".stats-wrapper .properties\").append(a);\r\n\t\t}\r\n\t}\r\n\r\n\tconst entryList = {type: \"entries\", entries: item.entries};\r\n\tconst renderStack = [];\r\n\trenderer.recursiveEntryRender(entryList, renderStack, 1);\r\n\trootEl.querySelector(\".stats-wrapper .text\").innerHTML = (utils_makeRoller(renderStack.join(\"\")).split(item.name.toLowerCase()).join(\"<i>\"+item.name.toLowerCase()+\"</i>\"));\r\n}\r\n\r\nfunction adjustItem(item) {\r\n\tif (item.hasParsed) {\r\n\t\treturn;\r\n\t}\r\n\titem.hasParsed = true;\r\n\tif (item.noDisplay) {\r\n\t\treturn;\r\n\t}\r\n\tif (item.type === \"GV\") {\r\n\t\titem.category = \"Generic Variant\";\r\n\t}\r\n\tif (item.category === undefined) {\r\n\t\titem.category = \"Other\";\r\n\t}\r\n\tif (item.entries === undefined) {\r\n\t\titem.entries = [];\r\n\t} else {\r\n\t\titem.entries = cloneDeep(item.entries);\r\n\t}\r\n\tif (item.type && window.itemTypeList[item.type]) {\r\n\t\tfor (let j = 0; j < window.itemTypeList[item.type].entries.length; j++) {\r\n\t\t\titem.entries.push(window.itemTypeList[item.type].entries[j]);\r\n\t\t}\r\n\t}\r\n\tif (item.property) {\r\n\t\tconst properties = item.property.split(\",\");\r\n\t\tfor (let j = 0; j < properties.length; j++) {\r\n\t\t\tif (window.itemPropertyList[properties[j]].entries) {\r\n\t\t\t\tfor (let k = 0; k < window.itemPropertyList[properties[j]].entries.length; k++) {\r\n\t\t\t\t\titem.entries.push(window.itemPropertyList[properties[j]].entries[k]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//The following could be encoded in JSON, but they depend on more than one JSON property; maybe fix if really bored later\r\n\tif (item.armor) {\r\n\t\tif (item.resist) {\r\n\t\t\titem.entries.push(\"You have resistance to \"+item.resist+\" damage while you wear this armor.\");\r\n\t\t}\r\n\t\tif (item.armor && item.stealth) {\r\n\t\t\titem.entries.push(\"The wearer has disadvantage on Stealth (Dexterity) checks.\");\r\n\t\t}\r\n\t\tif (item.type === \"HA\" && item.strength) {\r\n\t\t\titem.entries.push(\"If the wearer has a Strength score lower than \" + item.strength + \", their speed is reduced by 10 feet.\");\r\n\t\t}\r\n\t} else if (item.resist) {\r\n\t\tif (item.type === \"P\") {\r\n\t\t\titem.entries.push(\"When you drink this potion, you gain resistance to \"+item.resist+\" damage for 1 hour.\");\r\n\t\t}\r\n\t\tif (item.type === \"RG\") {\r\n\t\t\titem.entries.push(\"You have resistance to \"+item.resist+\" damage while wearing this ring.\");\r\n\t\t}\r\n\t}\r\n\tif (item.type === \"SCF\") {\r\n\t\tif (item.scfType === \"arcane\") {\r\n\t\t\titem.entries.push(\"An arcane focus is a special item designed to channel the power of arcane spells. A sorcerer, warlock, or wizard can use such an item as a spellcasting focus, using it in place of any material component which does not list a cost.\");\r\n\t\t}\r\n\t\tif (item.scfType === \"druid\") {\r\n\t\t\titem.entries.push(\"A druid can use such a druidic focus as a spellcasting focus, using it in place of any material component that does not have a cost.\");\r\n\t\t}\r\n\t\tif (item.scfType === \"holy\") {\r\n\t\t\titem.entries.push(\"A holy symbol is a representation of a god or pantheon.\");\r\n\t\t\titem.entries.push(\"A cleric or paladin can use a holy symbol as a spellcasting focus, using it in place of any material components which do not list a cost. To use the symbol in this way, the caster must hold it in hand, wear it visibly, or bear it on a shield.\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport { renderSelection };","import EntryRenderer from \"../util/entryrender.js\";\r\nimport Parser from \"../util/Parser.js\";\r\n\r\nconst renderer = new EntryRenderer();\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t</div>`;\r\n\r\nfunction renderSelection(spell, rootEl) {\r\n\trootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n\r\n\tconst spellHtmlString = spellHtml(spell);\r\n\r\n\trootEl.querySelector(\".stats-wrapper\").innerHTML = spellHtmlString;\r\n}\r\n\r\nfunction spellHtml(spell) {\r\n\tconst renderStack = [];\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span class=\"source source${spell.source}\" title=\"${Parser.sourceJsonToAbv(spell.source)}\">${Parser.sourceJsonToFull(spell.source)}</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span>${Parser.spLevelSchoolMetaToFull(spell.level, spell.school, spell.meta)}</span></div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span class=\"stat-name\">Casting Time: </span>${Parser.spTimeListToFull(spell.time)}</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span class=\"stat-name\">Range: </span>${Parser.spRangeToFull(spell.range)}</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span class=\"stat-name\">Components: </span>${Parser.spComponentsToFull(spell.components)}</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_med\"><span class=\"stat-name\">Duration: </span>${Parser.spDurationToFull(spell.duration)}</div>`);\r\n\trenderStack.push(`<div class='text'>`);\r\n\r\n\trenderer.recursiveEntryRender({type: \"entries\", entries: spell.entries}, renderStack, 1);\r\n\r\n\tif (spell.entriesHigherLevel) {\r\n\t\tconst higherLevelsEntryList = {type: \"entries\", entries: spell.entriesHigherLevel};\r\n\t\trenderer.recursiveEntryRender(higherLevelsEntryList, renderStack, 2);\r\n\t}\r\n\r\n\trenderStack.push(`</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_med\"><span class=\"stat-name\">Classes: </span>${Parser.spMainClassesToFull(spell.classes)}</div>`);\r\n\r\n\tif (spell.classes.fromSubclass) {\r\n\t\tconst currentAndLegacy = Parser.spSubclassesToCurrentAndLegacyFull(spell.classes);\r\n\t\trenderStack.push(`<div class=\"margin-bottom_med\"><span class=\"stat-name\">Subclasses: </span>${currentAndLegacy[0]}</div>`);\r\n\t\tif (currentAndLegacy[1]) {\r\n\t\t\trenderStack.push(`<div class=\"mdc-theme--text-disabled-on-background margin-bottom_med\"><span class=\"stat-name\">Subclasses (legacy): </span>${currentAndLegacy[1]}</div>`);\r\n\t\t}\r\n\t}\r\n\r\n\tif (spell.scrollNote) {\r\n\t\trenderStack.push(`<div class=\"mdc-theme--text-disabled-on-background\">`);\r\n\t\trenderer.recursiveEntryRender(\r\n\t\t\t`{@italic Note: Both the {@class ${\"Fighter\"} (${\"Eldritch Knight\"})} and the {@class ${\"Rogue\"} (${\"Arcane Trickster\"})} spell lists include all {@class ${\"Wizard\"}} spells. Spells of 5th level or higher may be cast with the aid of a spell scroll or similar.}`\r\n\t\t\t, renderStack, 2);\r\n\t\trenderStack.push(`</div>`);\r\n\t}\r\n\r\n\treturn renderStack.join('');\r\n}\r\n\r\nexport { renderSelection, spellHtml };","var map = {\n\t\"./backgrounds.js\": 115,\n\t\"./bestiary.js\": 110,\n\t\"./classes.js\": 129,\n\t\"./conditions.js\": 116,\n\t\"./cults.js\": 117,\n\t\"./dice.js\": 111,\n\t\"./feats.js\": 118,\n\t\"./features.js\": 119,\n\t\"./items.js\": 112,\n\t\"./psionics.js\": 120,\n\t\"./races.js\": 121,\n\t\"./rewards.js\": 122,\n\t\"./spells.js\": 113,\n\t\"./utils.js\": 1,\n\t\"./variantrules.js\": 123\n};\n\n\nfunction webpackAsyncContext(req) {\n\treturn webpackAsyncContextResolve(req).then(__webpack_require__);\n}\nfunction webpackAsyncContextResolve(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tif(!__webpack_require__.o(map, req)) {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t}\n\t\treturn map[req];\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.resolve = webpackAsyncContextResolve;\nwebpackAsyncContext.id = 114;\nmodule.exports = webpackAsyncContext;","import {parseHTML, jqHeight, jqPrepend, encodeForHash } from \"../js/utils.js\";\r\nimport Parser from \"../util/Parser.js\";\r\nimport EntryRenderer from \"../util/entryrender.js\";\r\nimport { resolveHash } from \"../util/renderTable.js\";\r\n\r\nconst renderer = new EntryRenderer();\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"source margin-bottom_small\"></div>\r\n\t\t<div class=\"stats margin-bottom_small\"></div>\r\n\t\t<div class=\"table-container collapse collapse--left-arrow disabled\">\r\n\t\t\t<div class=\"collapse-toggle\">\r\n\t\t\t\t<div class=\"mdc-list-item stat-name\">Suggested Characteristics</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"collapse-wrapper\">\r\n\t\t\t\t<div class=\"collapse-list\"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(curbg, rootEl, allBgs) {\r\n  if (rootEl.querySelector(\".selection-wrapper\")) {\r\n    rootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n  } else {\r\n    rootEl.innerHTML = stats_wrapper;\r\n  }\r\n  while (curbg._copy) {\r\n    const foundCopy = resolveHash(allBgs, encodeForHash([curbg._copy.name, curbg._copy.source]));\r\n    curbg = foundCopy;\r\n  }\r\n  const source = curbg.source;\r\n  const sourceAbv = Parser.sourceJsonToAbv(source);\r\n  const sourceFull = Parser.sourceJsonToFull(source);\r\n\r\n  const sourceEl = rootEl.querySelector(\".stats-wrapper .source\");\r\n  sourceEl.classList.add(`source${sourceAbv}`);\r\n\tsourceEl.setAttribute(\"title\", sourceFull);\r\n\tsourceEl.innerHTML = sourceFull;\r\n\r\n  const entries = curbg.entries;\r\n\r\n  if (entries && entries.length) {\r\n    for (let n = entries.length - 1; n >= 0; n--) {\r\n      let entry = entries[n],\r\n        outStack = [];\r\n      renderer.recursiveEntryRender(entry, outStack, 0);\r\n      let texthtml = outStack.join(' ');\r\n\r\n      if (entry.name === \"Suggested Characteristics\") {\r\n        rootEl.querySelector(\".stats-wrapper .table-container\").classList.remove(\"disabled\");\r\n        const collapseList = rootEl.querySelector(\".stats-wrapper .table-container .collapse-list\");\r\n        const traitTables = parseHTML(texthtml);\r\n        traitTables.querySelector(\".stat-name\").remove();\r\n        jqPrepend(collapseList, traitTables);\r\n      } else {\r\n        const statsEl = rootEl.querySelector(\".stats-wrapper .stats\");\r\n        jqPrepend(statsEl, parseHTML(texthtml));\r\n      }\r\n    }\r\n  }\r\n\r\n  window.setTimeout(() => {\r\n    let list = rootEl.querySelector(\".stats-wrapper .table-container .collapse-list\");\r\n    list.style[\"margin-top\"] = \"-\" + jqHeight(list) + \"px\";\r\n  }, 0);\r\n}\r\n\r\nexport { renderSelection };\r\n","import { utils_combineText } from \"../js/utils.js\";\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(curcondition, rootEl) {\r\n  rootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n  rootEl.querySelector(\".stats-wrapper .text\").innerHTML = utils_combineText(curcondition.entries, \"p\");\r\n}\r\n\r\nexport { renderSelection };","import {\r\n  utils_combineText,\r\n} from \"../js/utils.js\";\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(curcult, rootEl) {\r\n\trootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n\r\n  const textlist = curcult.text;\r\n  let texthtml = \"\";\r\n\r\n  if (curcult.goal !== undefined)\r\n    texthtml += utils_combineText(curcult.goal.text, \"p\", \"<span class='stat-name'>Goals:</span> \");\r\n  if (curcult.cultists !== undefined)\r\n    texthtml += utils_combineText(curcult.cultists.text, \"p\", \"<span class='stat-name'>Typical Cultist:</span> \");\r\n  if (curcult.signaturespells !== undefined)\r\n    texthtml += utils_combineText(\r\n      curcult.signaturespells.text,\r\n      \"p\",\r\n      \"<span class='stat-name'>Signature Spells:</span> \"\r\n    );\r\n  texthtml += utils_combineText(textlist, \"p\");\r\n\r\n  rootEl.querySelector(\".stats-wrapper .text\").innerHTML = texthtml;\r\n}\r\n\r\nexport {renderSelection};","import { utils_makePrerequisite } from \"../js/utils.js\";\r\nimport { parse_abilityLong } from \"../util/ability.js\";\r\nimport Parser from '../util/Parser.js';\r\nimport EntryRenderer from \"../util/entryrender.js\";\r\n\r\nconst renderer = new EntryRenderer();\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"source margin-bottom_small\"></div>\r\n\t\t<div class=\"prerequisite margin-bottom_small\"></div>\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(feat, rootEl) {\r\n\trootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n\r\n\tlet sourceEl = rootEl.querySelector('.stats-wrapper .source');\r\n\tlet sourceAbr = Parser.sourceJsonToAbv(feat.source);\r\n\tlet sourceFull =  Parser.sourceJsonToFull(feat.source);\r\n\tsourceEl.classList.add(`source${feat.source}`);\r\n\tsourceEl.setAttribute(\"title\", sourceAbr);\r\n\tsourceEl.innerHTML = sourceFull;\r\n\r\n\tconst prerequisite = utils_makePrerequisite(feat.prerequisite);\r\n\trootEl.querySelector('.stats-wrapper .prerequisite').innerHTML = (prerequisite ? \"Prerequisite: \" + prerequisite : \"\");\r\n\t\r\n\tif (feat.ability) {\r\n\t\tfor (let entry of feat.entries) { \r\n\t\t\t// insert the new list item at the head of the first list we find list; flag with \"hasabilityitem\" so we don't do it more than once\r\n\t\t\tif (entry.type === \"list\" && !entry.hasabilityitem) {\r\n\t\t\t\tentry.hasabilityitem = true;\r\n\t\t\t\tentry.items.unshift(parse_abilityLong(feat.ability))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tif (feat.entries.length) {\r\n\t\tlet outstack = [];\r\n\t\tfor (let entry of feat.entries) {\r\n\t\t\trenderer.recursiveEntryRender(entry, outstack, 0);\r\n\t\t}\r\n\t\trootEl.querySelector('.stats-wrapper .text').innerHTML = outstack.join(' ');\r\n\t}\r\n}\r\n\r\nexport { renderSelection };","import { utils_makePrerequisite, utils_joinPhraseArray } from \"../js/utils.js\";\nimport { parse_abilityLong } from \"../util/ability.js\";\nimport Parser from '../util/Parser.js';\nimport EntryRenderer from \"../util/entryrender.js\";\n\nconst renderer = new EntryRenderer();\n\nconst stats_wrapper = `\n\t<div class=\"stats-wrapper margin-bottom_large\">\n    <div class=\"source margin-bottom_small\"></div>\n    <div class=\"type margin-bottom_small\"></div>\n\t\t<div class=\"prerequisite margin-bottom_small\"></div>\n\t\t<div class=\"text\"></div>\n\t</div>`;\n\nfunction renderSelection(feature, rootEl) {\n\trootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\n\n\tconst sourceEl = rootEl.querySelector('.stats-wrapper .source'),\n\t\tsourceAbr = Parser.sourceJsonToAbv(feature.source),\n\t\tsourceFull =  Parser.sourceJsonToFull(feature.source);\n\tsourceEl.classList.add(`source${feature.source}`);\n\tsourceEl.setAttribute(\"title\", sourceAbr);\n\tsourceEl.innerHTML = sourceFull;\n\n  let typeArray = feature.featureType ? Array.isArray(feature.featureType) ? feature.featureType : [feature.featureType] : [];\n\trootEl.querySelector('.stats-wrapper .type').innerHTML = utils_joinPhraseArray(typeArray.map(t => {return Parser.featureJsonToAbv(t)}), \", \", \" and \")\n\n\tconst prerequisite = utils_makePrerequisite(feature.prerequisite);\n\trootEl.querySelector('.stats-wrapper .prerequisite').innerHTML = (prerequisite ? \"Prerequisite: \" + prerequisite : \"\");\n\t\n\tif (feature.ability) {\n\t\tfor (let entry of feature.entries) { \n\t\t\t// insert the new list item at the head of the first list we find list; flag with \"hasabilityitem\" so we don't do it more than once\n\t\t\tif (entry.type === \"list\" && !entry.hasabilityitem) {\n\t\t\t\tentry.hasabilityitem = true;\n\t\t\t\tentry.items.unshift(parse_abilityLong(feature.ability))\n\t\t\t}\n\t\t}\n\t}\n\t\n\tif (feature.entries.length) {\n\t\tlet outstack = [];\n\t\tfor (let entry of feature.entries) {\n\t\t\trenderer.recursiveEntryRender(entry, outstack, 0);\n\t\t}\n\t\trootEl.querySelector('.stats-wrapper .text').innerHTML = outstack.join(' ');\n\t}\n}\n\nexport { renderSelection };","import { utils_combineText, parse_psionicTypeToFull } from \"../js/utils.js\";\r\nimport { ELE_P, STR_EMPTY } from \"../util/consts.js\";\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"order margin-bottom_small\"></div>\r\n\t\t<div class=\"duration margin-bottom_small\"></div>\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(selectedPsionic, rootEl) {\r\n  rootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n  const STATS_ORDER_AND_TYPE = rootEl.querySelector(\".stats-wrapper .order\");\r\n  const STATS_DURATION = rootEl.querySelector(\".stats-wrapper .duration\");\r\n  const STATS_TEXT = rootEl.querySelector(\".stats-wrapper .text\");\r\n\r\n  if (selectedPsionic.type === \"T\") loadTalent();\r\n  else if (selectedPsionic.type === \"D\") loadDiscipline();\r\n\r\n  function loadTalent() {\r\n    STATS_ORDER_AND_TYPE.innerHTML = parse_psionicTypeToFull(selectedPsionic.type);\r\n    STATS_TEXT.innerHTML = utils_combineText(selectedPsionic.text, ELE_P);\r\n    STATS_DURATION.innerHTML = STR_EMPTY;\r\n  }\r\n  function loadDiscipline() {\r\n    STATS_ORDER_AND_TYPE.innerHTML = `${selectedPsionic.order} ${parse_psionicTypeToFull(selectedPsionic.type)}`;\r\n    STATS_TEXT.innerHTML = getTextString();\r\n    STATS_DURATION.innerHTML = getDurationString();\r\n\r\n    function getTextString() {\r\n      const modeStringArray = [];\r\n      for (let i = 0; i < selectedPsionic.modes.length; ++i) {\r\n        modeStringArray.push(getModeString(i));\r\n      }\r\n\r\n      return `${getDescriptionString()}${getFocusString()}${modeStringArray.join(STR_EMPTY)}`;\r\n    }\r\n    function getDescriptionString() {\r\n      return `<p>${selectedPsionic.description}</p>`;\r\n    }\r\n    function getFocusString() {\r\n      return `<p><span class='stat-name'>Psycic Focus.</span> ${selectedPsionic.focus}</p>`;\r\n    }\r\n    function getModeString(modeIndex) {\r\n      const modeString = utils_combineText(\r\n        selectedPsionic.modes[modeIndex].text,\r\n        ELE_P,\r\n        getModeTitle(selectedPsionic.modes[modeIndex])\r\n      );\r\n      if (selectedPsionic.modes[modeIndex].submodes === undefined) return modeString;\r\n      const subModeString = getSubModeString();\r\n      return `${modeString}${subModeString}`;\r\n\r\n      function getSubModeString() {\r\n        const modeStrings = [];\r\n        const subModes = selectedPsionic.modes[modeIndex].submodes;\r\n        for (let i = 0; i < subModes.length; ++i) {\r\n          modeStrings.push(utils_combineText(subModes[i].text, ELE_P, getModeTitle(subModes[i], true)));\r\n        }\r\n        return modeStrings.join(STR_EMPTY);\r\n      }\r\n\r\n      function getModeTitle(mode, subMode) {\r\n        subMode = subMode === undefined || subMode === null ? false : subMode;\r\n        const modeTitleArray = [];\r\n        modeTitleArray.push(mode.title);\r\n        const bracketPart = getModeTitleBracketPart();\r\n        if (bracketPart !== null) modeTitleArray.push(bracketPart);\r\n        if (subMode) return `<span class='stat-name'>${modeTitleArray.join(\" \")}.</span> `;\r\n        else return `<span class='stat-name'>${modeTitleArray.join(\" \")}.</span> `;\r\n\r\n        function getModeTitleBracketPart() {\r\n          const modeTitleBracketArray = [];\r\n\r\n          if (mode.cost) modeTitleBracketArray.push(getModeTitleCost());\r\n          if (mode.concentration) modeTitleBracketArray.push(getModeTitleConcentration());\r\n\r\n          if (modeTitleBracketArray.length === 0) return null;\r\n          return `(${modeTitleBracketArray.join(\"; \")})`;\r\n\r\n          function getModeTitleCost() {\r\n            const costMin = mode.cost.min;\r\n            const costMax = mode.cost.max;\r\n            const costString = costMin === costMax ? costMin : `${costMin}-${costMax}`;\r\n            return `${costString} psi`;\r\n          }\r\n          function getModeTitleConcentration() {\r\n            return `conc., ${mode.concentration.duration} ${mode.concentration.unit}.`;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  function getDurationString() {\r\n    const duration = selectedPsionic.duration;\r\n    if (duration === undefined) return STR_EMPTY;\r\n    else return getDurationElement();\r\n\r\n    function getDurationElement() {}\r\n  }\r\n}\r\n\r\nexport { renderSelection };\r\n","import { utils_combineText } from \"../js/utils.js\";\r\nimport EntryRenderer from \"../util/entryrender.js\";\r\nimport Parser from \"../util/Parser.js\";\r\nimport { parse_abilityShort } from \"../util/ability.js\";\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"source margin-bottom_small\"></div>\r\n\t\t<div class=\"size margin-bottom_small\"></div>\r\n\t\t<div class=\"ability margin-bottom_small\"></div>\r\n\t\t<div class=\"speed margin-bottom_small\"></div>\r\n\t\t<div class=\"stats\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(race, rootEl) {\r\n  if (rootEl.querySelector(\".selection-wrapper\")) {\r\n    rootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n  } else {\r\n    rootEl.innerHTML = stats_wrapper;\r\n  }\r\n  const sourceEl = rootEl.querySelector(\".stats-wrapper .source\");\r\n  sourceEl.classList.add(`source${race.source}`);\r\n  sourceEl.setAttribute(\"title\", Parser.sourceJsonToAbv(race.source));\r\n  sourceEl.innerHTML = Parser.sourceJsonToFull(race.source);\r\n\r\n  const size = Parser.sizeAbvToFull(race.size);\r\n  rootEl.querySelector(\".stats-wrapper .size\").innerHTML = size;\r\n  if (size === \"\") {\r\n    rootEl.querySelector(\".stats-wrapper .size\").style.display = \"none\";\r\n  }\r\n\r\n  const ability = parse_abilityShort(race.ability);\r\n  rootEl.querySelector(\".stats-wrapper .ability\").innerHTML = ability;\r\n\r\n  let speed;\r\n  if (race.speed) {\r\n    if (race.speed.walk) {\r\n      speed = race.speed.walk + \" ft.\";\r\n      if (race.speed.climb) speed += `, climb ${race.speed.climb} ft.`;\r\n      if (race.speed.fly) speed += `, fly ${race.speed.fly} ft.`;\r\n    } else {\r\n      speed = race.speed + (race.speed === \"Varies\" ? \"\" : \" ft. \");\r\n    }\r\n  }\r\n  rootEl.querySelector(\".stats-wrapper .speed\").innerHTML = speed;\r\n  if (speed === \"\") {\r\n    rootEl.querySelector(\".stats-wrapper .speed\").style.display = \"none\";\r\n  }\r\n\r\n  const traitlist = race.trait;\r\n  if (traitlist) {\r\n    let statsText = \"<div class='stat-item'>\";\r\n    for (let n = 0; n < traitlist.length; ++n) {\r\n      const trait = traitlist[n];\r\n\r\n      const header = `<span class='stat-name'>${trait.name}.</span> `;\r\n      statsText += utils_combineText(traitlist[n].text, \"p\", header);\r\n    }\r\n    statsText += \"</div>\";\r\n    rootEl.querySelector(\".stats-wrapper .stats\").innerHTML = statsText;\r\n  } else if (race.entries) {\r\n    const renderStack = [];\r\n    const faux = { type: \"entries\", entries: race.entries };\r\n\r\n    // Grung to test with\r\n    new EntryRenderer().recursiveEntryRender(faux, renderStack, 1, \"<div class='renderer-output'>\", \"</div>\", true);\r\n\r\n    rootEl.querySelector(\".stats-wrapper .stats\").innerHTML = renderStack.join(\"\");\r\n  }\r\n}\r\n\r\nexport { renderSelection };\r\n","import { utils_combineText } from \"../js/utils.js\";\r\nimport Parser from \"../util/Parser.js\";\r\n\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"source margin-bottom_small\"></div>\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(reward, rootEl) {\r\n\trootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\t\r\n\tconst sourceEl = rootEl.querySelector('.stats-wrapper .source');\r\n\tsourceEl.classList.add(`source${reward.source}`);\r\n\tsourceEl.setAttribute('title',Parser.sourceJsonToAbv(reward.source));\r\n\tsourceEl.innerHTML =  Parser.sourceJsonToFull(reward.source);\r\n\r\n\tconst textlist = reward.text;\r\n\tlet texthtml = \"\";\r\n\r\n\tif (reward.ability !== undefined) texthtml += utils_combineText(reward.ability.text, \"p\", \"<span class='stat-name'>Ability Score Adjustment:</span> \");\r\n\tif (reward.signaturespells !== undefined) texthtml += utils_combineText(reward.signaturespells.text ? reward.signaturespells.text : \"None\", \"p\", \"<span class='stat-name'>Signature Spells:</span> \");\r\n\ttexthtml += utils_combineText(textlist, \"p\");\r\n\r\n\trootEl.querySelector(\".stats-wrapper .text\").innerHTML = \"<tr class='text'><td colspan='6'>\"+texthtml+\"</td></tr>\";\r\n}\r\n\r\nexport { renderSelection };\r\n","import EntryRenderer from \"../util/entryrender.js\";\r\nimport Parser from \"../util/Parser.js\";\r\n\r\nconst entryRenderer = new EntryRenderer();\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t\t<div class=\"source margin-bottom_small\"></div>\r\n\t\t<div class=\"text\"></div>\r\n\t</div>`;\r\n\r\nfunction renderSelection(curRule, rootEl) {\r\n  rootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n  const sourceEl = rootEl.querySelector(\".stats-wrapper .source\");\r\n  sourceEl.classList.add(`source${curRule.source}`);\r\n  sourceEl.setAttribute(\"title\", Parser.sourceJsonToAbv(curRule.source));\r\n\tsourceEl.innerHTML =  Parser.sourceJsonToFull(reward.source)\r\n\r\n  const textStack = [];\r\n  entryRenderer.recursiveEntryRender(curRule, textStack);\r\n  rootEl.querySelector(\".stats-wrapper .text\").innerHTML = textStack.join(\"\");\r\n}\r\n\r\nexport { renderSelection };","/**\n@license\nCopyright (c) 2017 Vaadin Ltd.\nThis program is available under Apache License Version 2.0, available at https://vaadin.com/license/\n*/\nimport '@polymer/polymer/polymer-legacy.js';\n\nimport '@vaadin/vaadin-text-field/src/vaadin-text-field.js';\nimport { html } from '@polymer/polymer/lib/utils/html-tag.js';\nimport { dom } from '@polymer/polymer/lib/legacy/polymer.dom.js';\nimport { Debouncer } from '@polymer/polymer/lib/utils/debounce.js';\nimport { timeOut } from '@polymer/polymer/lib/utils/async.js';\nimport { PolymerElement } from '@polymer/polymer/polymer-element.js';\n/**\n * `<vaadin-grid-filter>` is a helper element for the `<vaadin-grid>` that provides out-of-the-box UI controls,\n * and handlers for filtering the grid data.\n *\n * #### Example:\n * ```html\n * <vaadin-grid-column>\n *   <template class=\"header\">\n *     <vaadin-grid-filter path=\"name.first\"></vaadin-grid-filter>\n *   </template>\n *   <template>[[item.name.first]]</template>\n * </vaadin-grid-column>\n * ```\n *\n * @extends PolymerElement\n */\nclass GridFilterElement extends (class extends PolymerElement {}) {\n  static get template() {\n    return html`\n    <style>\n      :host {\n        display: inline-flex;\n        max-width: 100%;\n      }\n\n      #filter {\n        width: 100%;\n        box-sizing: border-box;\n      }\n    </style>\n    <slot name=\"filter\">\n      <vaadin-text-field id=\"filter\" value=\"{{value}}\"></vaadin-text-field>\n    </slot>\n`;\n  }\n\n  static get is() {\n    return 'vaadin-grid-filter';\n  }\n\n  static get properties() {\n    return {\n\n      /**\n       * JS Path of the property in the item used for filtering the data.\n       */\n      path: String,\n\n      /**\n       * Current filter value.\n       */\n      value: {\n        type: String,\n        notify: true\n      },\n\n      _connected: Boolean\n    };\n  }\n\n  /** @protected */\n  connectedCallback() {\n    super.connectedCallback();\n    this._connected = true;\n  }\n\n  static get observers() {\n    return ['_filterChanged(path, value, _connected)'];\n  }\n\n  ready() {\n    super.ready();\n\n    const child = dom(this).firstElementChild;\n    if (child && child.getAttribute('slot') !== 'filter') {\n      console.warn('Make sure you have assigned slot=\"filter\" to the child elements of <vaadin-grid-filter>');\n      child.setAttribute('slot', 'filter');\n    }\n  }\n\n  _filterChanged(path, value, connected) {\n    if (path === undefined || value === undefined || !connected) {\n      return;\n    }\n    if (this._previousValue === undefined && value === '') {\n      return;\n    }\n    this._previousValue = value;\n\n    this._debouncerFilterChanged = Debouncer.debounce(\n      this._debouncerFilterChanged,\n      timeOut.after(200),\n      () => {\n        this.dispatchEvent(new CustomEvent('filter-changed', {bubbles: true}));\n      });\n  }\n\n  focus() {\n    this.$.filter.focus();\n  }\n}\n\ncustomElements.define(GridFilterElement.is, GridFilterElement);\n\nexport { GridFilterElement };\n","/**\n@license\nCopyright (c) 2018 Vaadin Ltd.\nThis program is available under Apache License Version 2.0, available at https://vaadin.com/license/\n*/\nimport { GridColumnElement } from './vaadin-grid-column.js';\n\nimport './vaadin-grid-filter.js';\nimport { html } from '@polymer/polymer/lib/utils/html-tag.js';\n/**\n * `<vaadin-grid-filter-column>` is a helper element for the `<vaadin-grid>`\n * that provides default header template and functionality for filtering.\n *\n * #### Example:\n * ```html\n * <vaadin-grid items=\"[[items]]\">\n *  <vaadin-grid-filter-column path=\"name.first\"></vaadin-grid-filter-column>\n *\n *  <vaadin-grid-column>\n *    ...\n * ```\n *\n * @extends PolymerElement\n */\nclass GridFilterColumnElement extends GridColumnElement {\n  static get template() {\n    return html`\n    <template class=\"header\" id=\"headerTemplate\">\n      <vaadin-grid-filter path=\"[[path]]\" value=\"[[_filterValue]]\">\n        <vaadin-text-field theme=\"small\" focus-target=\"\" style=\"max-width: 100%;\" slot=\"filter\" value=\"{{_filterValue}}\" label=\"[[_getHeader(header, path)]]\"></vaadin-text-field>\n      </vaadin-grid-filter>\n    </template>\n`;\n  }\n\n  static get is() {\n    return 'vaadin-grid-filter-column';\n  }\n\n  static get properties() {\n    return {\n      /**\n       * JS Path of the property in the item used for filtering the data.\n       */\n      path: String,\n\n      /**\n       * Text to display as the label of the column filter text-field.\n       */\n      header: String\n    };\n  }\n\n  _prepareHeaderTemplate() {\n    const headerTemplate = this._prepareTemplatizer(this.$.headerTemplate);\n    // needed to override the dataHost correctly in case internal template is used.\n    headerTemplate.templatizer.dataHost = this;\n    return headerTemplate;\n  }\n\n  _getHeader(header, path) {\n    return header || this._generateHeader(path);\n  }\n}\n\ncustomElements.define(GridFilterColumnElement.is, GridFilterColumnElement);\n\nexport { GridFilterColumnElement };\n","import '@vaadin/vaadin-lumo-styles/color.js';\nimport { html } from '@polymer/polymer/lib/utils/html-tag.js';\n\nconst $_documentContainer = html`<dom-module id=\"lumo-grid-sorter\" theme-for=\"vaadin-grid-sorter\">\n  <template>\n    <style>\n      :host {\n        justify-content: flex-start;\n        align-items: baseline;\n        -webkit-user-select: none;\n        -moz-user-select: none;\n        user-select: none;\n      }\n\n      [part=\"content\"] {\n        display: inline-block;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n\n      [part=\"indicators\"] {\n        margin-left: var(--lumo-space-s);\n      }\n\n      :host(:not([direction])) [part=\"indicators\"]::before {\n        opacity: 0.2;\n      }\n\n      :host([direction]) {\n        color: var(--lumo-primary-text-color);\n      }\n\n      [part=\"order\"] {\n        font-size: var(--lumo-font-size-xxs);\n        line-height: 1;\n      }\n\n      /* RTL specific styles */\n\n      :host([dir=\"rtl\"]) [part=\"indicators\"] {\n        margin-right: var(--lumo-space-s);\n        margin-left: 0;\n      }\n    </style>\n  </template>\n</dom-module>`;\n\ndocument.head.appendChild($_documentContainer.content);\n","/**\n@license\nCopyright (c) 2017 Vaadin Ltd.\nThis program is available under Apache License Version 2.0, available at https://vaadin.com/license/\n*/\nimport '@polymer/polymer/polymer-legacy.js';\n\nimport '@polymer/polymer/lib/elements/custom-style.js';\nimport { ThemableMixin } from '@vaadin/vaadin-themable-mixin/vaadin-themable-mixin.js';\nimport { DirMixin } from '@vaadin/vaadin-element-mixin/vaadin-dir-mixin.js';\nimport { html } from '@polymer/polymer/lib/utils/html-tag.js';\nimport { PolymerElement } from '@polymer/polymer/polymer-element.js';\nconst $_documentContainer = document.createElement('template');\n\n$_documentContainer.innerHTML = `<custom-style>\n  <style>\n    @font-face {\n      font-family: 'vaadin-grid-sorter-icons';\n      src: url(data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAQwAA0AAAAABuwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAAEFAAAABkAAAAcfep+mUdERUYAAAP4AAAAHAAAAB4AJwAOT1MvMgAAAZgAAAA/AAAAYA8TBPpjbWFwAAAB7AAAAFUAAAFeF1fZ4mdhc3AAAAPwAAAACAAAAAgAAAAQZ2x5ZgAAAlgAAABcAAAAnMvguMloZWFkAAABMAAAAC8AAAA2C5Ap72hoZWEAAAFgAAAAHQAAACQGbQPHaG10eAAAAdgAAAAUAAAAHAoAAABsb2NhAAACRAAAABIAAAASAIwAYG1heHAAAAGAAAAAFgAAACAACwAKbmFtZQAAArQAAAECAAACZxWCgKhwb3N0AAADuAAAADUAAABZCrApUXicY2BkYGAA4rDECVrx/DZfGbhZGEDgyqNPOxH0/wNMq5kPALkcDEwgUQBWRA0dAHicY2BkYGA+8P8AAwMLAwgwrWZgZEAFbABY4QM8AAAAeJxjYGRgYOAAQiYGEICQSAAAAi8AFgAAeJxjYGY6yziBgZWBgWkm0xkGBoZ+CM34msGYkZMBFTAKoAkwODAwvmRiPvD/AIMDMxCD1CDJKjAwAgBktQsXAHicY2GAAMZQCM0EwqshbAALxAEKeJxjYGBgZoBgGQZGBhCIAPIYwXwWBhsgzcXAwcAEhIwMCi+Z/v/9/x+sSuElA4T9/4k4K1gHFwMMMILMY2QDYmaoABOQYGJABUA7WBiGNwAAJd4NIQAAAAAAAAAACAAIABAAGAAmAEAATgAAeJyNjLENgDAMBP9tIURJwQCMQccSZgk2i5fIYBDAidJjycXr7x5EPwE2wY8si7jmyBNXGo/bNBerxJNrpxhbO3/fEFpx8ZICpV+ghxJ74fAMe+h7Ox14AbrsHB14nK2QQWrDMBRER4mTkhQK3ZRQKOgCNk7oGQqhhEIX2WSlWEI1BAlkJ5CDdNsj5Ey9Rncdi38ES+jzNJo/HwTgATcoDEthhY3wBHc4CE+pfwsX5F/hGe7Vo/AcK/UhvMSz+mGXKhZU6pww8ISz3oWn1BvhgnwTnuEJf8Jz1OpFeIlX9YULDLdFi4ASHolkSR0iuYdjLak1vAequBhj21D61Nqyi6l3qWybGPjySbPHGScGJl6dP58MYcQRI0bts7mjebBqrFENH7t3qWtj0OuqHnXcW7b0HOTZFnKryRGW2hFX1m0O2vEM3opNMfTau+CS6Z3Vx6veNnEXY6jwDxhsc2gAAHicY2BiwA84GBgYmRiYGJkZmBlZGFkZ2djScyoLMgzZS/MyDQwMwLSrpYEBlIbxjQDrzgsuAAAAAAEAAf//AA94nGNgZGBg4AFiMSBmYmAEQnYgZgHzGAAD6wA2eJxjYGBgZACCKyoz1cD0o087YTQATOcIewAAAA==) format('woff');\n      font-weight: normal;\n      font-style: normal;\n    }\n  </style>\n</custom-style>`;\n\ndocument.head.appendChild($_documentContainer.content);\n/**\n * `<vaadin-grid-sorter>` is a helper element for the `<vaadin-grid>` that provides out-of-the-box UI controls,\n * visual feedback, and handlers for sorting the grid data.\n *\n * #### Example:\n * ```html\n * <vaadin-grid-column>\n *   <template class=\"header\">\n *     <vaadin-grid-sorter path=\"name.first\">First name</vaadin-grid-sorter>\n *   </template>\n *   <template>[[item.name.first]]</template>\n * </vaadin-grid-column>\n * ```\n *\n * ### Styling\n *\n * The following shadow DOM parts are available for styling:\n *\n * Part name | Description\n * ----------------|----------------\n * `content` | The slotted content wrapper\n * `indicators` | The internal sorter indicators.\n * `order` | The internal sorter order\n *\n * The following state attributes are available for styling:\n *\n * Attribute    | Description | Part name\n * -------------|-------------|------------\n * `direction` | Sort direction of a sorter | :host\n *\n * @extends PolymerElement\n */\nclass GridSorterElement extends ThemableMixin(DirMixin(PolymerElement)) {\n  static get template() {\n    return html`\n    <style>\n      :host {\n        display: inline-flex;\n        cursor: pointer;\n        max-width: 100%;\n      }\n\n      [part=\"content\"] {\n        flex: 1 1 auto;\n      }\n\n      [part=\"indicators\"] {\n        position: relative;\n        align-self: center;\n        flex: none;\n      }\n\n      [part=\"order\"] {\n        display: inline;\n        vertical-align: super;\n      }\n\n      [part=\"indicators\"]::before {\n        font-family: 'vaadin-grid-sorter-icons';\n        display: inline-block;\n      }\n\n      :host(:not([direction])) [part=\"indicators\"]::before {\n        content: \"\\\\e901\";\n      }\n\n      :host([direction=asc]) [part=\"indicators\"]::before {\n        content: \"\\\\e900\";\n      }\n\n      :host([direction=desc]) [part=\"indicators\"]::before {\n        content: \"\\\\e902\";\n      }\n    </style>\n\n    <div part=\"content\">\n      <slot></slot>\n    </div>\n    <div part=\"indicators\">\n      <span part=\"order\">[[_getDisplayOrder(_order)]]</span>\n    </div>\n`;\n  }\n\n  static get is() {\n    return 'vaadin-grid-sorter';\n  }\n\n  static get properties() {\n    return {\n      /**\n       * JS Path of the property in the item used for sorting the data.\n       */\n      path: String,\n\n      /**\n       * How to sort the data.\n       * Possible values are `asc` to use an ascending algorithm, `desc` to sort the data in\n       * descending direction, or `null` for not sorting the data.\n       */\n      direction: {\n        type: String,\n        reflectToAttribute: true,\n        notify: true,\n        value: null\n      },\n\n      _order: {\n        type: Number,\n        value: null\n      },\n\n      _isConnected: {\n        type: Boolean,\n        value: false\n      }\n    };\n  }\n\n  static get observers() {\n    return [\n      '_pathOrDirectionChanged(path, direction, _isConnected)',\n      '_directionOrOrderChanged(direction, _order)'\n    ];\n  }\n\n  ready() {\n    super.ready();\n    this.addEventListener('click', this._onClick.bind(this));\n  }\n\n  /** @protected */\n  connectedCallback() {\n    super.connectedCallback();\n    this._isConnected = true;\n  }\n\n  /** @protected */\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this._isConnected = false;\n  }\n\n  _pathOrDirectionChanged(path, direction, isConnected) {\n    if (path === undefined || direction === undefined || isConnected === undefined) {\n      return;\n    }\n\n    if (isConnected) {\n      this.dispatchEvent(new CustomEvent('sorter-changed', {bubbles: true, composed: true}));\n    }\n  }\n\n  _getDisplayOrder(order) {\n    return order === null ? '' : order + 1;\n  }\n\n  _onClick(e) {\n    const activeElement = this.getRootNode().activeElement;\n    if (this !== activeElement && this.contains(activeElement)) {\n      // Some focusable content inside the sorter was clicked, do nothing.\n      return;\n    }\n\n    e.preventDefault();\n    if (this.direction === 'asc') {\n      this.direction = 'desc';\n    } else if (this.direction === 'desc') {\n      this.direction = null;\n    } else {\n      this.direction = 'asc';\n    }\n  }\n\n  _directionOrOrderChanged(direction, order) {\n    if (direction === undefined || order === undefined) {\n      return;\n    }\n\n    // Safari has an issue with repainting shadow root element styles when a host attribute changes.\n    // Need this workaround (toggle any inline css property on and off) until the issue gets fixed.\n    var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n    if (isSafari && this.root) {\n      this.root.querySelectorAll('*').forEach(function(el) {\n        el.style['-webkit-backface-visibility'] = 'visible';\n        el.style['-webkit-backface-visibility'] = '';\n      });\n    }\n  }\n}\n\ncustomElements.define(GridSorterElement.is, GridSorterElement);\n\nexport { GridSorterElement };\n","import {PolymerElement, html} from '@polymer/polymer';\nimport \"@polymer/polymer/lib/elements/dom-repeat.js\";\nimport \"@vaadin/vaadin-select\";\nimport \"@vaadin/vaadin-grid\";\nimport \"@vaadin/vaadin-grid/vaadin-grid-filter\";\nimport \"@vaadin/vaadin-grid/vaadin-grid-filter-column\"\nimport \"@vaadin/vaadin-grid/vaadin-grid-sorter\";\nimport './styles/material-styles.js';\nimport \"./styles/my-styles.js\";\nimport \"./dnd-spinner.js\";\nimport \"./dnd-button.js\";\nimport { setRouteSelection } from '../util/routing';\nimport { cloneDeep, encodeForHash, isFirstCharNum } from '../js/utils.js';\nimport Parser from \"../util/Parser.js\";\nimport { RARITY_TYPES } from '../util/consts.js';\n\nclass DndList extends PolymerElement {\n  static get properties() {\n    return {\n      columns: {\n        type: Array\n      },\n      listItems: {\n        type: Array\n      },\n      filters: {\n        type: Array\n      },\n      isMobile: {\n        type: Boolean\n      },\n      searchString: {\n        type: String\n      },\n      selectedFilters: {\n        type: Object\n      },\n      resultsCount: {\n        type: Number\n      }\n    };\n  }\n\n  ready() {\n    super.ready();\n\n    setTimeout(() => {\n      this.$.grid.addEventListener('active-item-changed', (e) => {\n        const item = e.detail.value;\n        this.$.grid.selectedItems = item ? [item] : [];\n        const linkData = [item.name];\n        if (item.source) {\n          linkData.push(item.source);\n        }\n        setRouteSelection(encodeForHash(linkData));\n      });\n    }, 0);\n\n    window.addEventListener('resize', () => {\n      this._checkBreakpoint();\n      this._adjustHeight();\n    });\n    this._checkBreakpoint();\n    this._adjustHeight();\n    setInterval(() => {\n      this._checkBreakpoint();\n      this._adjustHeight();\n    }, 500);\n  }\n\n  _checkBreakpoint() {\n    this.isMobile = window.innerWidth <= 768;\n  }\n\n  _adjustHeight() {\n    if (window.innerWidth < 921) {\n      const top = this.$.grid.getBoundingClientRect().top;\n      if (top) {\n        this.$.grid.style.height = `${window.innerHeight - top - 85}px`;\n      }\n    } else {\n      this.$.grid.style.height = `600px`;\n    }\n  }\n\n  _renderPath(id) {\n    return `render-${id}`;\n  }\n\n  _getPathValue(item, col) {\n    return item && item[`render-${col.id}`];\n  }\n\n  _filterOptions(listItems, id) {\n    let options = [{label: '', value: ''}];\n    let skipSort = false;\n\n    if (listItems && listItems.length > 0) {\n      listItems = listItems.flat();\n  \n      // special parsing for specific filter types\n      if (id === 'proficiencies') {\n        skipSort = true;\n        const profOptions = Object.keys(Parser.SKILL_JSON_TO_FULL)\n          .map(profAbv => ({\n            label: profAbv,\n            value: profAbv\n          }));\n        options = options.concat(profOptions);\n  \n      } else if (id === 'ability') {\n        skipSort = true;\n        const abilityOptions = Object.keys(Parser.ATB_ABV_TO_FULL)\n          .map(abilityAbv => ({\n            label: Parser.ATB_ABV_TO_FULL[abilityAbv],\n            value: abilityAbv\n          }));\n        options = options.concat({ label: '\"Any\"', value: 'any'}, abilityOptions);\n\n      } else if (id === 'item-rarity') {\n        skipSort = true;\n        options = RARITY_TYPES\n          .map(rarity => ({\n            label: rarity,\n            value: rarity\n          }));\n  \n      } else if (id ==='source') {\n        listItems.forEach(item => {\n          const val = item[`render-${id}`];\n          if (!options.some(option => option.value === val)) {\n            options.push({\n              label: Parser.sourceJsonToFullCompactPrefix(val) || val,\n              value: val\n            })\n          }\n        });\n\n      } else {\n        // 'general' parsing for other filter types\n        listItems.forEach(item => {\n          const val = item[`render-${id}`];\n          if (Array.isArray(val)) {\n            options = options.concat(val.map(valItem => ({label: valItem, value: valItem})));\n          } else if (id === 'prerequisite' && val.includes('/')) {\n            options = options.concat(val.split('/').map(i => ({label: i.trim(), value: i.trim()})));\n          } else if ((id !== 'monster-type') && val.includes(',')) {\n            options = options.concat(val.split(',').map(i => ({label: i.trim(), value: i.trim()})));\n          } else {\n            options.push({label: val, value: val});\n          }\n        });\n      }\n    }\n\n    // De-duping options\n    const uniqueVals = [];\n    options = options.filter(option => {\n      if (!uniqueVals.includes(option.value)) {\n        uniqueVals.push(option.value);\n        return true;\n      }\n      return false;\n    });\n\n    // Sorting options\n    if (!skipSort) {\n      options =  options.sort((a, b) => {\n        const labelA = a.label,\n          labelB = b.label,\n          startsWithNumA = isFirstCharNum(labelA),\n          startsWithNumB = isFirstCharNum(labelB);\n        if (startsWithNumA && !startsWithNumB) {\n          return 1\n        }\n        if (startsWithNumB && !startsWithNumA) {\n          return -1\n        }\n        if (startsWithNumA && startsWithNumB) {\n          const numA = parseFloat(labelA);\n          const numB = parseFloat(labelB);\n          return (numA < numB) ? -1 : (numA > numB) ? 1 : 0;\n        }\n        return (labelA < labelB) ? -1 : (labelA > labelB) ? 1 : 0;\n      });\n    }\n\n    console.error('_filterOptions', options);\n    return options;\n  }\n\n  _filterValue(id, selectedFilters) {\n    if (selectedFilters && selectedFilters[id]) {\n      return selectedFilters[id];\n    }\n  }\n\n  _selectFilter(e) {\n    const id = e.model ? e.model.__data.col.id : 'name';\n    console.error('_selectFilter', e)\n    \n    const newFilters = this.selectedFilters ? cloneDeep(this.selectedFilters) : {};\n    newFilters[id] = e.target.value;\n    this.set('selectedFilters', newFilters);\n  }\n\n  _clearFilters() {\n    const filters = this.root.querySelectorAll('vaadin-select, vaadin-grid-filter, vaadin-text-field');\n    filters.forEach(filter => {\n      filter.value = '';\n    });\n  }\n\n  _nameColWidth(isMobile) {\n    return isMobile ? '175px' : '300px';\n  }\n\n  _colWidth(index, columns) {\n    if (columns.length && index === columns.length - 1) {\n      return '200px';\n    }\n    return '175px'\n  }\n\n  _optionValue(option) {\n    return option.value !== undefined ? option.value : option;\n  }\n\n  _optionLabel(option) {\n    if (option.label !== undefined) {\n      return option.label\n    } else {\n      return option;\n    }\n  }\n  \n  _optionLabelClass(option, col) {\n    if (option && option.value && col && col.id === 'source') {\n      return `source${option.value}`\n    }\n    return '';\n  }\n\n  _dataItemClass(item, col) {\n    if (col && item && col.id === 'source') {\n      return `source${item.source}`\n    }\n    return '';\n  }\n\n  _isLast(index, columns) {\n    return columns.length && index === columns.length - 1\n  }\n\n  static get template() {\n    return html`\n      <style include=\"material-styles my-styles\">\n        :host {\n          display: block;\n        }\n\n\n        .search-wrap {\n          margin-bottom: 20px;\n          display: flex;\n          align-items: flex-end;\n          flex-wrap: wrap;\n        }\n        .search-reset {\n          margin-top: 16px;\n        }\n\n        .col-header-wrap {\n          display: flex;\n          justify-content: space-between;\n          width: 100%;\n          height: 44px;\n        }\n\n        .col-header-wrap[last-item] {\n          margin-right: 20px;\n        }\n\n        .col-header-wrap--name {\n          align-items: center;\n        }\n\n        .col-header-wrap--name vaadin-grid-sorter {\n          position: absolute;\n          right: 0px;\n          top: 16px;\n          padding-right: 0;\n          width:100%;\n        }\n        .name-label {\n          display: inline-flex;\n          font-size: 16px;\n          color: var(--lumo-secondary-text-color);\n        }\n        .search-count {\n          color: var(--lumo-secondary-text-color);\n          margin-left: auto;\n          font-size: 12px;\n          margin-top: 4px;\n        }\n\n        .data-item {\n          width: 100%;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        vaadin-grid-sorter {\n          padding: 0 8px;\n        }\n\n        vaadin-text-field {\n          margin-bottom: -4px;\n          margin-right: 16px;\n        }\n\n        vaadin-select {\n          width: 120px;\n        }\n\n        vaadin-grid {\n          width: calc(100% + 32px);\n          margin-left: -16px;\n        }\n\n        vaadin-grid-filter[path=\"name\"] {\n          display: none;\n        }\n\n        @media(min-width: 921px) {\n          vaadin-select {\n            width: 134px;\n          }\n\n          vaadin-grid {\n            width: 100%;\n            margin-left: 0;\n          }\n        }\n      </style>\n\n      <div class=\"search-wrap\">\n        <vaadin-text-field on-keyup=\"_selectFilter\" label=\"Search\"></vaadin-text-field>\n        <dnd-button class=\"search-reset\" on-click=\"_clearFilters\" label=\"Reset\"></dnd-button>\n      </div>\n\n      <vaadin-grid id=\"grid\" items=\"[[listItems]]\" theme=\"no-border no-row-borders\" size=\"{{resultsCount}}\">\n        <vaadin-grid-column frozen width=\"[[_nameColWidth(isMobile)]]\">\n          <template class=\"header\">\n            <div class=\"col-header-wrap col-header-wrap--name\">\n              <span class=\"name-label\">Name</span>\n              <span class=\"search-count\">[[resultsCount]] result(s)</span>\n              <vaadin-grid-sorter path=\"name\" ></vaadin-grid-sorter>\n              <vaadin-grid-filter path=\"name\" value='[[_filterValue(\"name\", selectedFilters)]]'></vaadin-grid-filter>\n            </div>\n          </template>\n          <template>\n            <span>[[item.name]]</span>\n          </template>\n        </vaadin-grid-column>\n\n        <template is=\"dom-repeat\" items=\"[[columns]]\" as=\"col\">\n          <vaadin-grid-column width=\"[[_colWidth(index, columns)]]\" >\n            <template class=\"header\">\n              <div class=\"col-header-wrap\" last-item$=\"[[_isLast(index, columns)]]\">\n                <vaadin-grid-filter aria-label=\"[[col.label]]\" path=\"[[_renderPath(col.id)]]\" value=\"[[_filterValue(col.id, selectedFilters)]]\">\n                  <vaadin-select placeholder=\"[[col.label]]\" on-change=\"_selectFilter\">\n                    <template>\n                      <vaadin-list-box>\n                        <template is=\"dom-repeat\" items=\"[[_filterOptions(listItems, col.id)]]\" as=\"option\">\n                          <vaadin-item value=\"[[_optionValue(option)]]\">[[_optionLabel(option)]]</vaadin-item>\n                        </template>\n                      </vaadin-list-box>\n                    </template>\n                  </vaadin-select>\n                </vaadin-grid-filter>\n\n                <vaadin-grid-sorter path=\"[[_renderPath(col.id)]]\" ></vaadin-grid-sorter>\n              </div>\n            </template>\n            <template>\n              <div class=\"data-item\">\n                [[_getPathValue(item, col)]]\n                <!-- <span class$=\"[[_dataItemClass(item, col)]]\">[[_getPathValue(item, col)]]</span> -->\n              </div>\n            </template>\n          </vaadin-grid-column>\n        </template>\n      </vaadin-grid>\n    `;\n  }\n}\n\ncustomElements.define('dnd-list', DndList);","import {PolymerElement, html} from '@polymer/polymer';\nimport \"./styles/material-styles.js\";\nimport \"./styles/my-styles.js\";\nimport \"./dnd-spinner.js\";\nimport {initCollapseToggles} from '../js/utils.js';\nimport { clearRouteSelection } from '../util/routing.js';\n\nclass DndSelectedItem extends PolymerElement {\n  static get properties() {\n    return {\n      modelId: {\n        type: String,\n        observer: \"_modelChange\"\n      },\n      selectedItem: {\n        type: Object\n      },\n      allItems: {\n        type: Array\n      },\n      loading: {\n        type: Boolean,\n        value: false,\n        observer: \"_loadingChange\"\n      },\n      _modelsRenderSelection: {\n        type: Function\n      },\n      characterOption: {\n        type: Boolean,\n        value: false\n      }\n    };\n  }\n\n  static get observers() {\n    return [\"__renderSelection(_modelsRenderSelection, selectedItem)\"];\n  }\n  \n  _loadingChange() {\n    this.dispatchEvent(new CustomEvent(\"loading-render\", {\n      bubbles: true,\n      composed: true,\n      detail: {\n        loading: this.loading\n      }\n    }));\n  }\n\n  __renderSelection() {\n    if (this._modelsRenderSelection && this.selectedItem) {\n      console.error('Selected Item:', this.selectedItem);\n      this._modelsRenderSelection(this.selectedItem, this.shadowRoot, this.allItems);\n      initCollapseToggles(this.shadowRoot);\n    }\n  }\n\n  _modelChange() {\n    if (this.modelId) {\n      this.loading = true;\n      this.set(\"_modelsRenderSelection\", undefined);\n\n      // Dynamically load the model page's renderSelection JS\n      import(/* webpackMode: \"eager\" */ `../js/${this.modelId}.js`)\n        .then(module => {\n          if (typeof module.renderSelection === \"function\") {\n            this._modelsRenderSelection = module.renderSelection;\n            this.loading = false;\n          } else {\n            console.error(\"Model module is missing the renderSelection export.\");\n          }\n        })\n        .catch(e => {\n          console.error(\"Model module failed to load.\", e);\n        });\n    }\n  }\n\n  _exists(thing) {\n    return !!thing;\n  }\n\n  _mainClass() {\n    return this.selectedItem ? \"main item-opened\" : \"main\";\n  }\n\n  clearSelection() {\n    clearRouteSelection(true);\n  }\n\n  static get template() {\n    return html`\n      <style include=\"material-styles my-styles\">\n        :host {\n          display: block;\n        }\n        .main {\n          max-width: 100vw;\n        }\n        .main.item-opened .class-container {\n          display: none;\n        }\n        .main:not(.item-opened) .class-page--class-container {\n          display: none;\n        }\n        .main.item-opened #listcontainer {\n          display: none;\n        }\n        .main.item-opened .close-item {\n          display: block;\n        }\n        .main.item-opened .rules-wrapper {\n          display: none;\n        }\n        .main:not(.item-opened) #rulescontent {\n          display: none;\n        }\n        .main:not(.item-opened) .selection-wrapper {\n          display: none;\n        }\n        .close-item {\n          position: fixed;\n          height: 64px;\n          width: 64px;\n          font-size: 44px;\n          display: none;\n          right: 0;\n          top: -4px;\n          z-index: 12;\n        }\n        .main.item-opened {\n          margin-bottom: 120px;\n        }\n        @media(min-width: 921px) {\n          .main.item-opened {\n            padding-bottom: 0;\n          }\n        }\n      </style>\n\n      <div class$=\"[[_mainClass(selectedItem)]]\">\n        <button class=\"mdc-icon-button close-item material-icons\" on-click=\"clearSelection\">close</button>\n        <div class=\"selection-wrapper\"></div>\n      </div>\n    `;\n  }\n}\n\ncustomElements.define('dnd-selected-item', DndSelectedItem);","import {PolymerElement, html} from '@polymer/polymer';\nimport \"./dnd-list.js\";\nimport \"./dnd-selected-item.js\";\nimport {loadModel} from \"../util/data.js\";\nimport { parseListData, resolveHash } from \"../util/renderTable.js\";\nimport { readRouteSelection, routeEventChannel, clearRouteSelection } from '../util/routing.js';\n\nclass DndSelectionList extends PolymerElement {\n  static get properties() {\n    return {\n      modelId: {\n        type: String,\n        observer: \"_modelChange\"\n      },\n      columns: {\n        type: Array\n      },\n      enableHashRouting: {\n        type: Boolean,\n        value: false,\n        reflectToAttribute: true\n      },\n      disableScrollBack: {\n        type: Boolean,\n        reflectToAttribute: true,\n        value: false\n      },\n      hasSelection: {\n        type: Boolean,\n        reflectToAttribute: true,\n        value: false\n      },\n      _data: {\n        type: Array\n      },\n      _filters: {\n        type: Array\n      },\n      _selectedItem: {\n        type: Object\n      },\n      _selectedHash: {\n        type: String\n      },\n      loading: {\n        type: Boolean,\n        value: true,\n        observer: '_loadingChange'\n      },\n      characterOption: {\n        type: Boolean,\n        value: false\n      }\n    };\n  }\n\n  _loadingChange() {\n    this.dispatchEvent(new CustomEvent(\"loading-data\", {\n      bubbles: true,\n      composed: true,\n      detail: {\n        loading: this.loading\n      }\n    }));\n  }\n\n  /**\n   * Connects to route eventing channel and checks for loaded selection\n   * from hash.\n   */\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.selectionEventHandler = (e) => {\n      this._checkHashForSelection(e.detail.selection);\n    };\n\n    this.deselectionEventHandler = () => {\n      this._selectedItem = undefined;\n      this.hasSelection = false;\n    };\n\n    // In case the list data has already been loaded, check if the hash is there\n    this._checkHashForSelection();\n\n    routeEventChannel().addEventListener(\"selection-change\", this.selectionEventHandler);\n    routeEventChannel().addEventListener(\"selection-deselected\", this.deselectionEventHandler);\n    routeEventChannel().addEventListener(\"view-change\", this.deselectionEventHandler);\n  }\n\n  /**\n   * Disconnects from route eventing channel.\n   */\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    routeEventChannel().removeEventListener(\"selection-change\", this.selectionEventHandler);\n    routeEventChannel().removeEventListener(\"selection-deselected\", this.deselectionEventHandler);\n  }\n\n  /**\n   * Loads the JSON data for the given modelId, then checks to see if \n   * the current routed selection is present in the data.\n   */\n  _modelChange() {\n    if (this.modelId) {\n      this.set(\"_data\", undefined);\n      this.set(\"_filters\", undefined);\n      this.loading = true;\n\n      loadModel(this.modelId)\n        .then(result => {\n          const filters = parseListData(result, this.columns);\n          this.set(\"_data\", result);\n          console.error('loadedModel', filters);\n          this.set(\"_filters\", filters);\n          this._checkHashForSelection();\n          this.loading = false;\n        })\n        .catch(e => {\n          console.error(\"Model requested for list did not return.\", e);\n        });\n    }\n  }\n\n  /**\n   * Looks through the loaded Data array for an item that matches the \n   * selection string.\n   * @param {String} [newSelection] Optional. If selection isn't provided,\n   * checks the current hash for the second pathed variable.\n   */\n  _checkHashForSelection(newSelection) {\n    let hashSelection = newSelection;\n    if (!hashSelection) {\n      hashSelection = readRouteSelection();\n    }\n    if (hashSelection && this.enableHashRouting && Array.isArray(this._data)) {\n      const itemFromHash = resolveHash(this._data, hashSelection);\n      if (itemFromHash) {\n        this.set(\"_selectedItem\", itemFromHash);\n        this.hasSelection = true;\n        if (!this.disableScrollBack) {\n          window.scrollTo(0, 0);\n        }\n        routeEventChannel().dispatchEvent(new CustomEvent(\"title-change\", {\n          bubbles: true,\n          composed: true,\n          detail: itemFromHash\n        }));\n      } else {\n        clearRouteSelection(true);\n      }\n    }\n  }\n\n  static get template() {\n    return html`\n      <style>\n        :host([has-selection]) dnd-list {\n          display: none;\n        }\n        @media(min-width: 921px) {\n          dnd-list {\n            display: block !important;\n          }\n        }\n      </style>\n      <dnd-selected-item model-id=\"[[modelId]]\" selected-item=\"[[_selectedItem]]\" all-items=\"[[_data]]\" character-option=\"[[characterOption]]\"></dnd-selected-item>\n      <dnd-list list-items=\"[[_data]]\" columns=\"[[columns]]\" filters=\"[[_filters]]\"></dnd-list>\n    `;\n  }\n}\n\ncustomElements.define('dnd-selection-list', DndSelectionList);","import {PolymerElement, html} from '@polymer/polymer';\nimport '../styles/material-styles.js';\nimport '../styles/my-styles.js';\nimport '../dnd-selection-list';\n\nclass DndRacesView extends PolymerElement {\n  static get template() {\n    return html`\n      <style include=\"material-styles my-styles\"></style>\n\n      <dnd-selection-list\n        enable-hash-routing\n        model-id=\"races\"\n        columns='[\n          {\"id\":\"ability\",\"label\":\"Ability\"},\n          {\"id\":\"source\",\"label\":\"Source\",\"hideMobile\":true},\n          {\"id\":\"size\",\"label\":\"Size\",\"hideMobile\":true}\n        ]'\n      >\n      </dnd-selection-list>\n    `;\n  }\n}\n\ncustomElements.define('dnd-races-view', DndRacesView);"],"sourceRoot":""}