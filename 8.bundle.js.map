{"version":3,"sources":["webpack:///./components/dnd-button.js","webpack:///./js/spells.js","webpack:///./node_modules/@vaadin/vaadin-checkbox/vaadin-checkbox.js","webpack:///./node_modules/@vaadin/vaadin-text-field/vaadin-text-field.js","webpack:///./node_modules/@vaadin/vaadin-grid/theme/lumo/vaadin-grid-tree-toggle-styles.js","webpack:///./node_modules/@vaadin/vaadin-grid/src/vaadin-grid-tree-toggle.js","webpack:///./components/views/character/dnd-character-builder-spells.js"],"names":["DndButton","label","type","String","value","icon","svg","background","border","svgFill","svgStroke","setTimeout","this","button","$","i","result","fill","stroke","customElements","define","renderer","renderSelection","spell","rootEl","querySelector","innerHTML","spellHtmlString","spellHtml","renderStack","push","source","sourceJsonToAbv","sourceJsonToFull","spLevelSchoolMetaToFull","level","school","meta","spTimeListToFull","time","spRangeToFull","range","spComponentsToFull","components","spDurationToFull","duration","recursiveEntryRender","entries","entriesHigherLevel","higherLevelsEntryList","spMainClassesToFull","classes","fromSubclass","currentAndLegacy","spSubclassesToCurrentAndLegacyFull","scrollNote","join","$_documentContainer","document","head","appendChild","content","createElement","Number","observer","leaf","Boolean","reflectToAttribute","expanded","notify","super","ready","addEventListener","e","_onClick","preventDefault","toString","style","_debouncerUpdateLevel","debounce","updateStyles","is","DndCharacterBuilderSpells","spellsKnown","Object","preparedSpells","noContentMessage","isEditMode","filterStr","expandedItems","Array","window","scrollTo","originalScrollHeight","scrollY","length","oldExpanded","grid","expandAll","clearCache","undefined","_filterChange","__filterChangeThrottled","bind","connectedCallback","characterChangeHandler","character","detail","updateFromCharacter","refresh","editModeHandler","disconnectedCallback","removeEventListener","multiclassSlotsDef","fullCasterSlotsDef","halfCasterSlotsDef","thirdCasterSlotsDef","dataProvider","params","callback","startIndex","page","pageSize","children","parentItem","spellDisplay","filter","child","hasDecendentWithFilter","toLowerCase","slice","node","name","indexOf","findExpandables","array","id","classRefs","classLevels","newSpellMods","overalLevel","reduce","total","className","profBonus","classRef","casterProgression","alreadyAdded","find","spellMod","spellcastingAbility","attributeModifier","spellAttackBonus","dc","mod","spellMods","spellsKnownObj","updateSpellStats","casterSourceRef","isSubclass","tableGroups","classTableGroups","casterName","subclassLevel","subclasses","subclassDef","shortName","subclassTableGroups","spellsKnownOrPrepared","cantripsKnown","warlockSpellLevel","warlockSpellSlots","spellsKnowPreparedType","forEach","tableGroup","colLabels","spellsColIndex","findIndex","rows","cantripsColIndex","warlockSpellLevelColIndex","warlockSpellLevelMatches","match","parseInt","warlockSpellSlotsColIndex","levelMultiplier","Math","floor","subclassName","classSpellList","searchSource","searchName","replaceAll","trim","key","subclassSpellList","divineAffinityChoice","map","isSubclassSpell","Set","concat","divineSoulSpellList","spellTable","title","spellSlotEntries","rowsSpellProgression","spellSlots","hasCantrips","oldSpellsPrepared","JSON","parse","stringify","oldCantripsPrepared","preparedCantrips","index","spellList","sort","a","b","isCantrip","isPrepared","hasChildren","parentClass","parentLevel","isWarlock","levelObj","currentSlots","some","item","slots","current","keys","max","maxCantrips","currentCantrips","classObj","spellPrepType","multiclassingLevels","newSpellDisplay","multiclassLevel","isMulticlass","spellClass","spellLevel","adjIndex","multiclassSlotsArray","currentWarlockSlots","dispatchEvent","CustomEvent","bubbles","composed","stopPropagation","model","_toggleCantripPrepared","_isPreparedSpell","currentPreparedCount","_currentSpellsKnownCount","maxPreparedCount","_maxSpellsKnownCount","spellsKnownCopy","splice","_flashPreparedButton","_isPreparedCantrip","_currentCantripsKnownCount","_maxCantripsKnownCount","buttonEl","classList","add","remove","isInput","maxSlots","checked","_setSpellSlotsChecked","count","el","checkboxes","querySelectorAll","spellName","prepareType","data","spLevelToFull","tooltipStr","target","dataset","tooltip","hasTooltip","from","childEl","matches","tooltipCloseListener","tooltips","tooltipEl","spellParent","ritual","d","concentration","t","unit","SP_SCHOOL_ABV_TO_FULL","values","clas","num"],"mappings":"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","file":"8.bundle.js","sourcesContent":["import { PolymerElement, html } from '@polymer/polymer';\nimport { MDCRipple } from '@material/ripple';\nimport { } from '@polymer/polymer/lib/elements/dom-if.js';\nimport \"./dnd-svg\";\n\nclass DndButton extends PolymerElement {\n  static get properties() {\n    return {\n      label: {\n        type: String,\n        value: ''\n      },\n      icon: {\n        type: String,\n        value: ''\n      },\n      svg: {\n        type: String,\n        value: ''\n      },\n      background: {\n        type: String,\n        value: ''\n      },\n      border: {\n        type: String,\n        value: ''\n      },\n      svgFill: {\n        type: String,\n        value: ''\n      },\n      svgStroke: {\n        type: String,\n        value: ''\n      }\n    }\n  }\n\n  connectedCallback() {\n    setTimeout(()=> {\n      this.button = new MDCRipple(this.$.button);\n    }, 10)\n  }\n\n  _exists(i) {\n    return !!i;\n  }\n\n  _styleStr(background, border, label) {\n    let result = '';\n    if (background) {\n      result+= `background: ${background}; `\n    }\n    if (border) {\n      result+= `border: ${border}; `\n    }\n    return result;\n  }\n\n  _svgStyleStr(fill, stroke) {\n    let result = '';\n    if (fill) {\n      result+= `fill: ${fill}; `\n    }\n    if (stroke) {\n      result+= `stroke: ${stroke}; `\n    }\n    return result;\n  }\n\n  static get template() {\n    return html`\n      <style include=\"material-styles\">\n        .mdc-tab-scroller__scroll-area--scroll {\n          overflow-x: auto;\n          background-color: var(--mdc-theme-surface);\n          border: 1px solid var(--mdc-theme-text-divider-on-background);\n          border-bottom: none;\n        }\n        :host {\n          display: inline;\n          overflow: hidden;\n          white-space: nowrap;\n        }\n        .mdc-button {\n          display: inline-flex;\n          justify-content: center;\n          align-items: center;\n          width: 100%;\n        }\n        .mdc-button .mdc-button__icon {\n          margin-right: 0px;\n          margin-left: 8px;\n        }\n        .mdc-button [background] {\n          background: var(--lumo-contrast-10pct);\n        }\n        dnd-svg {\n          height: 20px;\n          width: 20px;\n          flex-shrink: 0;\n          flex-grow: 0;\n          padding-left: 8px;\n          fill: var(--mdc-theme-primary);\n          stroke: var(--mdc-theme-primary);\n        }\n        i {\n          flex-shrink: 0;\n          flex-grow: 0;\n        }\n\n        \n        :host(.btn-field__btn) dnd-svg {\n          padding-left: 0;\n        }\n        :host(.btn-field__btn) i {\n          margin-left: 0;\n        }\n\n        :host(.icon-only) dnd-svg {\n          margin-left: -24px;\n          padding-left: 0;\n        }\n        :host(.icon-only) i {\n          margin-left: -18px;\n          padding-left: 0;\n        }\n\n        :host(.link) .mdc-button__label {\n          text-transform: none;\n          color: var(--lumo-body-text-color);\n          letter-spacing: normal;\n        }\n        :host(.link) i {\n          color: var(--lumo-body-text-color);\n        }\n        :host(.link) button:hover::before {\n          background: none;\n        }\n        :host(.link) button:hover i,\n        :host(.link) button:hover .mdc-button__label {\n          color: var(--mdc-theme-secondary);\n        }\n\n        :host([edit-mode]) button {\n          background-color: var(--mdc-theme-secondary);\n          color: var(--mdc-theme-on-secondary)\n        }\n        :host([edit-mode]) .mdc-button__label {\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([edit-mode]) i {\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([edit-mode]) button:hover i,\n        :host([edit-mode]) button:hover .mdc-button__label {\n          color: var(--mdc-theme-on-secondary);\n        }\n\n        :host([not-edit-mode]) button {\n          background-color: var(--mdc-theme-primary);\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([not-edit-mode]) .mdc-button__label {\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([not-edit-mode]) i {\n          color: var(--mdc-theme-on-primary);\n        }\n        :host([not-edit-mode]) button:hover i,\n        :host([not-edit-mode]) button:hover .mdc-button__label {\n          color: var(--mdc-theme-on-primary);\n        }\n\n      </style>\n      <button id=\"button\" class=\"mdc-button\" style$=\"[[_styleStr(background, border, label)]]\">\n        <div class=\"mdc-button__ripple\"></div>\n        <span class=\"mdc-button__label\">[[label]]</span>\n        <slot name=\"label\"></slot>\n        <template is=\"dom-if\" if=\"[[_exists(icon)]]\">\n          <i class=\"material-icons mdc-button__icon\" aria-hidden=\"true\">[[icon]]</i>\n        </template>\n        <template is=\"dom-if\" if=\"[[_exists(svg)]]\">\n          <dnd-svg id=\"[[svg]]\" style$=\"[[_svgStyleStr(svgFill, svgStroke)]]\"></dnd-svg>\n        </template>\n      </button>\n    `;\n  }\n\n}\ncustomElements.define('dnd-button', DndButton);","import EntryRenderer from \"../util/entryrender.js\";\r\nimport Parser from \"../util/Parser.js\";\r\n\r\nconst renderer = new EntryRenderer();\r\nconst stats_wrapper = `\r\n\t<div class=\"stats-wrapper margin-bottom_large\">\r\n\t</div>`;\r\n\r\nfunction renderSelection(spell, rootEl) {\r\n\trootEl.querySelector(\".selection-wrapper\").innerHTML = stats_wrapper;\r\n\r\n\tconst spellHtmlString = spellHtml(spell);\r\n\r\n\trootEl.querySelector(\".stats-wrapper\").innerHTML = spellHtmlString;\r\n}\r\n\r\nfunction spellHtml(spell) {\r\n\tconst renderStack = [];\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span class=\"source source${spell.source}\" title=\"${Parser.sourceJsonToAbv(spell.source)}\">${Parser.sourceJsonToFull(spell.source)}</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span>${Parser.spLevelSchoolMetaToFull(spell.level, spell.school, spell.meta)}</span></div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span class=\"stat-name\">Casting Time: </span>${Parser.spTimeListToFull(spell.time)}</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span class=\"stat-name\">Range: </span>${Parser.spRangeToFull(spell.range)}</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_small\"><span class=\"stat-name\">Components: </span>${Parser.spComponentsToFull(spell.components)}</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_med\"><span class=\"stat-name\">Duration: </span>${Parser.spDurationToFull(spell.duration)}</div>`);\r\n\trenderStack.push(`<div class='text'>`);\r\n\r\n\trenderer.recursiveEntryRender({type: \"entries\", entries: spell.entries}, renderStack, 1);\r\n\r\n\tif (spell.entriesHigherLevel) {\r\n\t\tconst higherLevelsEntryList = {type: \"entries\", entries: spell.entriesHigherLevel};\r\n\t\trenderer.recursiveEntryRender(higherLevelsEntryList, renderStack, 2);\r\n\t}\r\n\r\n\trenderStack.push(`</div>`);\r\n\trenderStack.push(`<div class=\"margin-bottom_med\"><span class=\"stat-name\">Classes: </span>${Parser.spMainClassesToFull(spell.classes)}</div>`);\r\n\r\n\tif (spell.classes.fromSubclass) {\r\n\t\tconst currentAndLegacy = Parser.spSubclassesToCurrentAndLegacyFull(spell.classes);\r\n\t\trenderStack.push(`<div class=\"margin-bottom_med\"><span class=\"stat-name\">Subclasses: </span>${currentAndLegacy[0]}</div>`);\r\n\t\tif (currentAndLegacy[1]) {\r\n\t\t\trenderStack.push(`<div class=\"mdc-theme--text-disabled-on-background margin-bottom_med\"><span class=\"stat-name\">Subclasses (legacy): </span>${currentAndLegacy[1]}</div>`);\r\n\t\t}\r\n\t}\r\n\r\n\tif (spell.scrollNote) {\r\n\t\trenderStack.push(`<div class=\"mdc-theme--text-disabled-on-background\">`);\r\n\t\trenderer.recursiveEntryRender(\r\n\t\t\t`{@italic Note: Both the {@class ${\"Fighter\"} (${\"Eldritch Knight\"})} and the {@class ${\"Rogue\"} (${\"Arcane Trickster\"})} spell lists include all {@class ${\"Wizard\"}} spells. Spells of 5th level or higher may be cast with the aid of a spell scroll or similar.}`\r\n\t\t\t, renderStack, 2);\r\n\t\trenderStack.push(`</div>`);\r\n\t}\r\n\r\n\treturn renderStack.join('');\r\n}\r\n\r\nexport { renderSelection, spellHtml };","import './theme/lumo/vaadin-checkbox.js';\nexport * from './src/vaadin-checkbox.js';\n","import './theme/lumo/vaadin-text-field.js';\n","import '@vaadin/vaadin-lumo-styles/color.js';\nimport '@vaadin/vaadin-lumo-styles/spacing.js';\nimport { html } from '@polymer/polymer/lib/utils/html-tag.js';\n\nconst $_documentContainer = html`<dom-module id=\"lumo-grid-tree-toggle\" theme-for=\"vaadin-grid-tree-toggle\">\n  <template>\n    <style>\n      :host {\n        --vaadin-grid-tree-toggle-level-offset: 2em;\n        align-items: center;\n        vertical-align: middle;\n        margin-left: calc(var(--lumo-space-s) * -1);\n        -webkit-tap-highlight-color: transparent;\n      }\n\n      :host(:not([leaf])) {\n        cursor: default;\n      }\n\n      [part=\"toggle\"] {\n        display: inline-block;\n        font-size: 1.5em;\n        line-height: 1;\n        width: 1em;\n        height: 1em;\n        text-align: center;\n        color: var(--lumo-contrast-50pct);\n        /* Increase touch target area */\n        padding: calc(1em / 3);\n        margin: calc(1em / -3);\n      }\n\n      :host(:not([dir=\"rtl\"])) [part=\"toggle\"] {\n        margin-right: 0;\n      }\n\n      @media (hover: hover) {\n        :host(:hover) [part=\"toggle\"] {\n          color: var(--lumo-contrast-80pct);\n        }\n      }\n\n      [part=\"toggle\"]::before {\n        font-family: \"lumo-icons\";\n        display: inline-block;\n        height: 100%;\n      }\n\n      :host(:not([expanded])) [part=\"toggle\"]::before {\n        content: var(--lumo-icons-angle-right);\n      }\n\n      :host([expanded]) [part=\"toggle\"]::before {\n        content: var(--lumo-icons-angle-right);\n        transform: rotate(90deg);\n      }\n\n      /* Experimental support for hierarchy connectors, using an unsupported selector */\n      :host([theme~=\"connectors\"]) #level-spacer {\n        position: relative;\n        z-index: -1;\n        font-size: 1em;\n        height: 1.5em;\n      }\n\n      :host([theme~=\"connectors\"]) #level-spacer::before {\n        display: block;\n        content: \"\";\n        margin-top: calc(var(--lumo-space-m) * -1);\n        height: calc(var(--lumo-space-m) + 3em);\n        background-image: linear-gradient(to right, transparent calc(var(--vaadin-grid-tree-toggle-level-offset) - 1px), var(--lumo-contrast-10pct) calc(var(--vaadin-grid-tree-toggle-level-offset) - 1px));\n        background-size: var(--vaadin-grid-tree-toggle-level-offset) var(--vaadin-grid-tree-toggle-level-offset);\n        background-position: calc(var(--vaadin-grid-tree-toggle-level-offset) / 2 - 2px) 0;\n      }\n\n      /* RTL specific styles */\n\n      :host([dir=\"rtl\"]) {\n        margin-left: 0;\n        margin-right: calc(var(--lumo-space-s) * -1);\n      }\n\n      :host([dir=\"rtl\"]) [part=\"toggle\"] {\n        margin-left: 0;\n      }\n\n      :host([dir=\"rtl\"][expanded]) [part=\"toggle\"]::before {\n        transform: rotate(-90deg);\n      }\n\n      :host([dir=\"rtl\"][theme~=\"connectors\"]) #level-spacer::before {\n        background-image: linear-gradient(to left, transparent calc(var(--vaadin-grid-tree-toggle-level-offset) - 1px), var(--lumo-contrast-10pct) calc(var(--vaadin-grid-tree-toggle-level-offset) - 1px));\n        background-position: calc(100% - (var(--vaadin-grid-tree-toggle-level-offset) / 2 - 2px)) 0;\n      }\n\n      :host([dir=\"rtl\"]:not([expanded])) [part=\"toggle\"]::before,\n      :host([dir=\"rtl\"][expanded]) [part=\"toggle\"]::before {\n        content: var(--lumo-icons-angle-left);\n      }\n    </style>\n  </template>\n</dom-module>`;\n\ndocument.head.appendChild($_documentContainer.content);\n","/**\n@license\nCopyright (c) 2017 Vaadin Ltd.\nThis program is available under Apache License Version 2.0, available at https://vaadin.com/license/\n*/\nimport { PolymerElement } from '@polymer/polymer/polymer-element.js';\n\nimport '@polymer/polymer/lib/elements/custom-style.js';\nimport { Debouncer } from '@polymer/polymer/lib/utils/debounce.js';\nimport { ThemableMixin } from '@vaadin/vaadin-themable-mixin/vaadin-themable-mixin.js';\nimport { DirMixin } from '@vaadin/vaadin-element-mixin/vaadin-dir-mixin.js';\nimport { html } from '@polymer/polymer/lib/utils/html-tag.js';\nimport { microTask } from '@polymer/polymer/lib/utils/async.js';\nconst $_documentContainer = document.createElement('template');\n\n$_documentContainer.innerHTML = `<custom-style>\n  <style>\n    @font-face {\n      font-family: \"vaadin-grid-tree-icons\";\n      src: url(data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAQkAA0AAAAABrwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAAECAAAABoAAAAcgHwa6EdERUYAAAPsAAAAHAAAAB4AJwAOT1MvMgAAAZQAAAA/AAAAYA8TBIJjbWFwAAAB8AAAAFUAAAFeGJvXWmdhc3AAAAPkAAAACAAAAAgAAAAQZ2x5ZgAAAlwAAABLAAAAhIrPOhFoZWFkAAABMAAAACsAAAA2DsJI02hoZWEAAAFcAAAAHQAAACQHAgPHaG10eAAAAdQAAAAZAAAAHAxVAgBsb2NhAAACSAAAABIAAAASAIAAVG1heHAAAAF8AAAAGAAAACAACgAFbmFtZQAAAqgAAAECAAACTwflzbdwb3N0AAADrAAAADYAAABZQ7Ajh3icY2BkYGAA4twv3Vfi+W2+MnCzMIDANSOmbGSa2YEZRHEwMIEoAAoiB6sAeJxjYGRgYD7w/wADAwsDCDA7MDAyoAI2AFEEAtIAAAB4nGNgZGBg4GBgZgDRDAxMDGgAAAGbABB4nGNgZp7JOIGBlYGBaSbTGQYGhn4IzfiawZiRkwEVMAqgCTA4MDA+38d84P8BBgdmIAapQZJVYGAEAGc/C54AeJxjYYAAxlAIzQTELAwMBxgZGB0ACy0BYwAAAHicY2BgYGaAYBkGRgYQiADyGMF8FgYbIM3FwMHABISMDArP9/3/+/8/WJXC8z0Q9v8nEp5gHVwMMMAIMo+RDYiZoQJMQIKJARUA7WBhGN4AACFKDtoAAAAAAAAAAAgACAAQABgAJgA0AEIAAHichYvBEYBADAKBVHBjBT4swl9KS2k05o0XHd/yW1hAfBFwCv9sIlJu3nZaNS3PXAaXXHI8Lge7DlzF7C1RgXc7xkK6+gvcD2URmQB4nK2RQWoCMRiFX3RUqtCli65yADModOMBLLgQSqHddRFnQghIAnEUvEA3vUUP0LP0Fj1G+yb8R5iEhO9/ef/7FwFwj28o9EthiVp4hBlehcfUP4Ur8o/wBAv8CU+xVFvhOR7UB7tUdUdlVRJ6HnHWTnhM/V24In8JT5j/KzzFSi2E53hUz7jCcrcIiDDwyKSW1JEct2HdIPH1DFytbUM0PofWdNk5E5oUqb/Q6HHBiVGZpfOXkyUMEj5IyBuNmYZQjBobfsuassvnkKLe1OuBBj0VQ8cRni2xjLWsHaM0jrjx3peYA0/vrdmUYqe9iy7bzrX6eNP7Jh1SijX+AaUVbB8AAHicY2BiwA84GBgYmRiYGJkZmBlZGFkZ2djScyoLMgzZS/MyDQwMwLSruZMzlHaB0q4A76kLlwAAAAEAAf//AA94nGNgZGBg4AFiMSBmYmAEQnYgZgHzGAAD6wA2eJxjYGBgZACCKxJigiD6mhFTNowGACmcA/8AAA==) format('woff');\n      font-weight: normal;\n      font-style: normal;\n    }\n  </style>\n</custom-style>`;\n\ndocument.head.appendChild($_documentContainer.content);\n/**\n * `<vaadin-grid-tree-toggle>` is a helper element for the `<vaadin-grid>`\n * that provides toggle and level display functionality for the item tree.\n *\n * #### Example:\n * ```html\n * <vaadin-grid-column>\n *   <template class=\"header\">Package name</template>\n *   <template>\n *     <vaadin-grid-tree-toggle\n *         leaf=\"[[!item.hasChildren]]\"\n *         expanded=\"{{expanded}}\"\n *         level=\"[[level]]\">\n *       [[item.name]]\n *     </vaadin-grid-tree-toggle>\n *   </template>\n * </vaadin-grid-column>\n * ```\n *\n * ### Styling\n *\n * The following shadow DOM parts are available for styling:\n *\n * Part name | Description\n * ---|---\n * `toggle` | The tree toggle icon\n *\n * The following state attributes are available for styling:\n *\n * Attribute    | Description | Part name\n * ---|---|---\n * `expanded` | When present, the toggle is expanded | :host\n * `leaf` | When present, the toggle is not expandable, i. e., the current item is a leaf | :host\n *\n * The following custom CSS properties are available on\n * the `<vaadin-grid-tree-toggle>` element:\n *\n * Custom CSS property | Description | Default\n * ---|---|---\n * `--vaadin-grid-tree-toggle-level-offset` | Visual offset step for each tree sublevel | `1em`\n *\n * @extends PolymerElement\n * @mixes ThemableMixin\n */\nclass GridTreeToggleElement extends ThemableMixin(DirMixin(PolymerElement)) {\n  static get template() {\n    return html`\n    <style>\n      :host {\n        display: inline-flex;\n        align-items: baseline;\n\n        /* CSS API for :host */\n        --vaadin-grid-tree-toggle-level-offset: 1em;\n\n        /*\n          ShadyCSS seems to polyfill :dir(rtl) only for :host, thus using\n          a host custom CSS property for ltr/rtl toggle icon choice.\n         */\n        ---collapsed-icon: \"\\\\e7be\\\\00a0\";\n      }\n\n      :host(:dir(rtl)) {\n        ---collapsed-icon: \"\\\\e7bd\\\\00a0\";\n      }\n\n      :host([hidden]) {\n        display: none !important;\n      }\n\n      :host(:not([leaf])) {\n        cursor: pointer;\n      }\n\n      #level-spacer,\n      [part=\"toggle\"] {\n        flex: none;\n      }\n\n      #level-spacer {\n        display: inline-block;\n        width: calc(var(---level, '0') * var(--vaadin-grid-tree-toggle-level-offset));\n      }\n\n      [part=\"toggle\"]::before {\n        font-family: \"vaadin-grid-tree-icons\";\n        line-height: 1em; /* make icon font metrics not affect baseline */\n      }\n\n      :host(:not([expanded])) [part=\"toggle\"]::before {\n        content: var(---collapsed-icon);\n      }\n\n      :host([expanded]) [part=\"toggle\"]::before {\n        content: \"\\\\e7bc\\\\00a0\"; /* icon glyph + single non-breaking space */\n      }\n\n      :host([leaf]) [part=\"toggle\"] {\n        visibility: hidden;\n      }\n    </style>\n\n    <span id=\"level-spacer\"></span>\n    <span part=\"toggle\"></span>\n    <slot></slot>\n`;\n  }\n\n  static get is() {\n    return 'vaadin-grid-tree-toggle';\n  }\n\n  static get properties() {\n    return {\n      /**\n       * Current level of the tree represented with a horizontal offset\n       * of the toggle button.\n       */\n      level: {\n        type: Number,\n        value: 0,\n        observer: '_levelChanged'\n      },\n\n      /**\n       * Hides the toggle icon and disables toggling a tree sublevel.\n       */\n      leaf: {\n        type: Boolean,\n        value: false,\n        reflectToAttribute: true\n      },\n\n      /**\n       * Sublevel toggle state.\n       */\n      expanded: {\n        type: Boolean,\n        value: false,\n        reflectToAttribute: true,\n        notify: true\n      }\n    };\n  }\n\n  ready() {\n    super.ready();\n\n    this.addEventListener('click', e => this._onClick(e));\n  }\n\n  _onClick(e) {\n    if (this.leaf) {\n      return;\n    }\n\n    e.preventDefault();\n    this.expanded = !this.expanded;\n  }\n\n  _levelChanged(level) {\n    const value = Number(level).toString();\n    this.style['---level'] = value;\n    // Async is to make DOM updates applied before evaluating the style\n    // update, required for polyfilled RTL support in MSIE and Edge.\n    this._debouncerUpdateLevel = Debouncer.debounce(\n      this._debouncerUpdateLevel,\n      microTask,\n      () => this.updateStyles({'---level': value})\n    );\n  }\n}\n\ncustomElements.define(GridTreeToggleElement.is, GridTreeToggleElement);\n\nexport { GridTreeToggleElement };\n","import { PolymerElement,html } from \"@polymer/polymer\";\nimport \"@vaadin/vaadin-grid\";\nimport \"@vaadin/vaadin-grid/vaadin-grid-tree-toggle\";\nimport { getCharacterChannel, getSelectedCharacter, getClassReferences, getClassLevelGroups, toggleSpellPrepared, saveCharacter, getAttributeModifier, isSpellPreparedFromObj, setSpellSlots, getSpellSlots, toggleCantripPrepared, getSubclassChoiceLevel, getSubclassChoice } from \"../../../util/charBuilder\";\nimport { filterModel } from \"../../../util/data\";\nimport { dispatchEditModeChange, getEditModeChannel, isEditMode } from \"../../../util/editMode\";\nimport { spellHtml } from \"../../../js/spells\";\nimport { findInPath, util_capitalize, util_capitalizeAll, getProfBonus, throttle, debounce } from \"../../../js/utils\";\nimport Parser from \"../../../util/Parser\";\nimport \"@vaadin/vaadin-checkbox\";\nimport \"@vaadin/vaadin-text-field\";\nimport \"../../dnd-button\";\n\nclass DndCharacterBuilderSpells extends PolymerElement {\n  \n  static get properties() {\n    return {\n      spellsKnown: {\n        type: Object,\n        value: {}\n      },\n      preparedSpells: {\n        type: Object,\n        value: {}\n      },\n      noContentMessage: {\n        type: Boolean,\n        value: false\n      },\n      isEditMode: {\n        type: Boolean,\n        value: false\n      },\n      filterStr: {\n        type: String,\n        value: '',\n        observer: '_filterChange'\n      },\n      expandedItems: {\n        type: Array\n      },\n    };\n  }\n\n  static get observers() {\n    return [\n      '_expandedItemsChange(expandedItems.*)'\n    ]\n  }\n\n  _expandedItemsChange() {\n    window.scrollTo(0, this.originalScrollHeight);\n  }\n\n  _recordScrollHeight() {\n    // Fix reposition issue after tree expand/collapse toggle\n    this.originalScrollHeight = window.scrollY;\n  }\n\n  __filterChangeThrottled() {\n    if (this.filterStr.length) {\n      if (!this.oldExpanded) {\n        this.oldExpanded = this.$.grid.expandedItems;\n      }\n      this.expandAll();\n      this.$.grid.clearCache();\n      setTimeout(() => {\n        this.expandAll();\n      }, 10);\n    } else {\n      if (this.oldExpanded) {\n        this.$.grid.expandedItems = this.oldExpanded;\n        this.oldExpanded = undefined;\n      }\n      this.$.grid.clearCache();\n    }\n  }\n\n  constructor() {\n    super();\n\n    this._filterChange = debounce(this.__filterChangeThrottled.bind(this), 250);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.characterChangeHandler = (e) => {\n      let character = e.detail.character;\n      this.updateFromCharacter(character);\n    };\n    this.refresh = true;\n    this.updateFromCharacter(getSelectedCharacter());\n    getCharacterChannel().addEventListener(\"character-selected\",this.characterChangeHandler);\n\n    this.editModeHandler = (e) => {\n      this.isEditMode = e.detail.isEditMode;\n      this.refresh = true;\n      this.updateFromCharacter(getSelectedCharacter());\n    }\n    getEditModeChannel().addEventListener('editModeChange', this.editModeHandler);\n    this.isEditMode = isEditMode();\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n\n    getCharacterChannel().removeEventListener(\"character-selected\",this.characterChangeHandler);\n    getEditModeChannel().removeEventListener('editModeChange', this.editModeHandler);\n  }\n\n  ready() {\n    super.ready();\n\n    this.multiclassSlotsDef = [\n      [2],\n      [3],\n      [4,2],\n      [4,3],\n      [4,3,2],\n      [4,3,3],\n      [4,3,3,1],\n      [4,3,3,2],\n      [4,3,3,3,1],\n      [4,3,3,3,2],\n      [4,3,3,3,2,1],\n      [4,3,3,3,2,1],\n      [4,3,3,3,2,1,1],\n      [4,3,3,3,2,1,1],\n      [4,3,3,3,2,1,1,1],\n      [4,3,3,3,2,1,1,1],\n      [4,3,3,3,2,1,1,1,1],\n      [4,3,3,3,3,1,1,1,1],\n      [4,3,3,3,3,2,1,1,1],\n      [4,3,3,3,3,2,2,1,1]\n    ];\n\n    this.fullCasterSlotsDef = [];\n\n    this.halfCasterSlotsDef = [];\n    \n    this.thirdCasterSlotsDef = [];\n\n    setTimeout(() => {\n      const grid = this.$.grid;\n\n      grid.dataProvider = ((params, callback) => {\n        const startIndex = params.page * params.pageSize;\n        let children = params.parentItem ? params.parentItem.children : this.spellDisplay;\n        if (this.filterStr.length) {\n          children = children.filter((child) => {\n            return this.hasDecendentWithFilter(child, this.filterStr.toLowerCase()) \n          });\n        }\n        if (children && children.length) {\n          const page = children.slice(startIndex, startIndex + params.pageSize);\n          callback(page, children.length);\n        }\n      }).bind(this);\n    }, 0);\n  }\n\n  hasDecendentWithFilter(node, filterStr) {\n    if (!node.name || node.name.toLowerCase().indexOf(filterStr) > -1) {\n      return true;\n    }\n    const children = node.length ? node : node.children;\n    if (children && children.length) {\n      for (let child of children) {\n        return this.hasDecendentWithFilter(child, filterStr);\n      }\n    }\n    return false;\n  }\n\n  clearFilterStr() {\n    this.filterStr = '';\n  }\n\n  expandAll() {\n    this.$.grid.expandedItems = this.findExpandables(this.spellDisplay);\n  }\n\n  findExpandables(node, array = []) {\n    if (node.id === 'level' || node.id === 'class') {\n      array.push(node);\n    }\n    const children = node.length ? node : node.children;\n    if (children && children.length) {\n      for (let child of children) {\n        this.findExpandables(child, array);\n      }\n    }\n    return array;\n  }\n\n  async updateSpellStats(classRefs, classLevels) {\n    if (classLevels && classRefs) {\n      // DCs and Spell Modifier\n      const newSpellMods = [];\n      const overalLevel = Object.entries(classLevels).reduce((total, [className, level]) => total + level, 0);\n      const profBonus = getProfBonus(overalLevel);\n\n      for (const [className, level] of Object.entries(classLevels)) {\n        const classRef = classRefs[className];\n        if (classRef.casterProgression) {\n          const alreadyAdded = newSpellMods.find(spellMod => classRef.spellcastingAbility === spellMod.spellcastingAbility);\n          if (alreadyAdded) {\n            alreadyAdded.classes.push(className);\n          } else {\n            const attributeModifier = await getAttributeModifier(classRef.spellcastingAbility);\n            const spellAttackBonus = attributeModifier + profBonus\n            const dc = 8 + spellAttackBonus;\n            newSpellMods.push({ classes: [className], mod: attributeModifier, spellAttackBonus, dc, spellcastingAbility: classRef.spellcastingAbility});\n          }\n        }\n      }\n\n      this.spellMods = newSpellMods;\n    } else {\n      this.spellMods = [];\n    }\n  }\n\n  async updateFromCharacter(character) {\n    if (character && this.refresh) {\n      this.noContentMessage = true;\n      const classRefs = await getClassReferences(character),\n        classLevels = getClassLevelGroups(character),\n        expandedItems = [],\n        spellsKnownObj = {};\n      let spellDisplay = [];\n\n      this.updateSpellStats(classRefs, classLevels);\n\n      for (const [ className, level ] of Object.entries(classLevels)) {\n        const classRef = classRefs[className];\n        let casterSourceRef = classRef;\n        let isSubclass = false;\n        let tableGroups = classRef.classTableGroups;\n        let casterName = className;\n\n        // Checking the class first for a caster progression, then checking subclass\n        if (!casterSourceRef.casterProgression) {\n          const subclassLevel = getSubclassChoiceLevel(classRef);\n          if (level >= subclassLevel && character.subclasses && character.subclasses[className] && classRef.subclasses && classRef.subclasses.length) {\n            const subclassDef = classRef.subclasses.find(i => character.subclasses[className].name === i.name);\n            if (subclassDef && subclassDef.casterProgression) {\n              // replacing caster parsing references with that from subclass \n              casterSourceRef = subclassDef;\n              casterName = subclassDef.shortName;\n              tableGroups = subclassDef.subclassTableGroups;\n              isSubclass = true;\n            }\n          }\n        }\n\n        if (casterSourceRef.casterProgression) {\n          this.noContentMessage = false;\n          let spellsKnownOrPrepared;\n          let spellsKnowPreparedType = 'known';\n          let cantripsKnown;\n          let warlockSpellLevel;\n          let warlockSpellSlots;\n\n          // Getting spells + cantrips known info from table, also getting warlock info from table\n          tableGroups.forEach((tableGroup) => {\n            if (tableGroup.colLabels && tableGroup.colLabels.length) {\n              const spellsColIndex = tableGroup.colLabels.findIndex((label) => label.toLowerCase().indexOf(\"spells known\") > -1);\n              if (spellsColIndex > -1 && tableGroup.rows && tableGroup.rows.length > level - 1) {\n                spellsKnownOrPrepared = tableGroup.rows[level - 1][spellsColIndex];\n              }\n              const cantripsColIndex = tableGroup.colLabels.findIndex((label) => label.toLowerCase().indexOf(\"cantrips known\") > -1);\n              if (cantripsColIndex > -1 && tableGroup.rows && tableGroup.rows.length > level - 1) {\n                cantripsKnown = tableGroup.rows[level - 1][cantripsColIndex];\n              }\n              const warlockSpellLevelColIndex = tableGroup.colLabels.findIndex((label) => label.toLowerCase().indexOf(\"slot level\") > -1);\n              if (warlockSpellLevelColIndex > -1 && tableGroup.rows && tableGroup.rows.length > level - 1) {\n                const warlockSpellLevelString = tableGroup.rows[level - 1][warlockSpellLevelColIndex];\n                const warlockSpellLevelMatches = warlockSpellLevelString.match(/(\\d+)/g);\n                if (warlockSpellLevelMatches && warlockSpellLevelMatches.length) {\n                  warlockSpellLevel = parseInt(warlockSpellLevelMatches[0]);\n                }\n              }\n              const warlockSpellSlotsColIndex = tableGroup.colLabels.findIndex((label) => label.toLowerCase().indexOf(\"spell slots\") > -1);\n              if (warlockSpellSlotsColIndex > -1 && tableGroup.rows && tableGroup.rows.length > level - 1) {\n                warlockSpellSlots = tableGroup.rows[level - 1][warlockSpellSlotsColIndex];\n              }\n            }\n          });\n\n          // otherwise compute spells prepared\n          if (spellsKnownOrPrepared === undefined) {\n            spellsKnowPreparedType = 'prepared';\n            // todo, check 1/3 caster progression\n            const levelMultiplier = casterSourceRef.casterProgression === 'full' ? 1 : 0.51;\n            const attributeModifier = await getAttributeModifier(casterSourceRef.spellcastingAbility);\n            spellsKnownOrPrepared = Math.floor(level * levelMultiplier) + attributeModifier;\n            spellsKnownOrPrepared = spellsKnownOrPrepared < 1 ? 1 : spellsKnownOrPrepared;\n          }\n\n          /* SPELL LISTS */\n          // Getting class spell list\n          let classSpellList = [];\n          let subclassName;\n          \n          if (isSubclass) {\n            subclassName = casterSourceRef.shortName;\n          } else {\n            // Revised Ranger fix\n            let searchSource = casterSourceRef.name.indexOf('(Revised)') > -1 ? 'PHB' : casterSourceRef.source;\n            let searchName = casterSourceRef.name.indexOf('(Revised)') > -1 ? casterSourceRef.name.replaceAll('(Revised)', '').trim() : casterSourceRef.name;\n            classSpellList = await filterModel('spells', { key: 'classes.fromClassList', value: { name: searchName, source: searchSource } } );\n\n            const subclassLevel = getSubclassChoiceLevel(classRef);\n            if (level >= subclassLevel) {\n              subclassName = character.subclasses && character.subclasses[className] ? character.subclasses[className].shortName : '';\n            }\n          }\n\n          // Getting subclass spell list (always prepared)\n          if (subclassName) {\n            if (subclassName === 'Eldritch Knight') {\n              classSpellList = await filterModel('spells', { key: 'classes.fromClassList', value: { name: 'wizard', source: 'phb' } } );\n            }\n            let subclassSpellList = await filterModel('spells', { key: 'classes.fromSubclass', value: { 'subclass.name': subclassName, 'class.name': className, 'class.source': classRef.source } } );\n            if (subclassName === 'Divine Soul') {\n              let divineAffinityChoice = getSubclassChoice(className.toLowerCase(), subclassName.toLowerCase(), level, 'Divine Magic Affinity', character);\n              if (divineAffinityChoice) {\n                subclassSpellList = subclassSpellList.filter(spell => divineAffinityChoice.indexOf(spell.name) > -1);\n              } else {\n                subclassSpellList = [];\n              }\n            }\n            subclassSpellList = subclassSpellList.map(spell => ({ ...spell, isSubclassSpell: true }));\n            classSpellList = [...new Set(classSpellList.concat(subclassSpellList))];\n          }\n          if (subclassName === 'Divine Soul') {\n            let divineSoulSpellList = await filterModel('spells', { key: 'classes.fromClassList', value: { name: 'cleric', source: 'phb' } } );\n            classSpellList = [...new Set(classSpellList.concat(divineSoulSpellList))];\n          }\n\n          // Getting spell slots per level array\n          const spellTable = tableGroups.find((tableGroup) => tableGroup.title === \"Spell Slots per Spell Level\");\n          let spellSlotEntries;\n          if (spellTable) {\n            spellSlotEntries = spellTable.rowsSpellProgression[level - 1].filter((spellSlots) => spellSlots !== 0);\n          } else {\n            // If no spell slots per level, then we're a warlock, get spell entries for\n            // warlocks with zero spell slots at each level (pact slots will be added later)\n            spellSlotEntries = [];\n            for (let i = 0; i < warlockSpellLevel; i++) {\n              spellSlotEntries.push(0);\n            }\n          }\n\n          // Adding cantrips entry\n          const hasCantrips = cantripsKnown ? 0 : 1;\n          if (cantripsKnown) {\n            spellSlotEntries = [0].concat(spellSlotEntries);\n          }\n\n          // Clearing prepared spells to filter out those that can no longer be prepared\n          let oldSpellsPrepared = JSON.parse(JSON.stringify(character.preparedSpells));\n          let oldCantripsPrepared = JSON.parse(JSON.stringify(character.preparedCantrips));\n          character.preparedSpells[casterName] = {};\n          character.preparedCantrips[casterName] = {};\n\n          // Generating hierarchical structure of classes > levels > spells > spellDef\n          const spellSlots = spellSlotEntries.map((spellSlots, index) => {\n            if (spellSlots !== -1) {\n              let spellList = classSpellList\n                .filter((spell) => {\n                  return spell.level === index + hasCantrips;\n                })\n                .sort((a, b) => {\n                  if (a.name < b.name) { return -1; }\n                  if (a.name > b.name) { return 1; }\n                  return 0;\n                })\n                .map(spell => {\n                  const isCantrip = index + hasCantrips === 0;\n                  const isPrepared = isCantrip ? isSpellPreparedFromObj(casterName, spell, oldCantripsPrepared) : isSpellPreparedFromObj(casterName, spell, oldSpellsPrepared);\n                  if (isPrepared) {\n                    if (isCantrip) {\n                      character.preparedCantrips[casterName][spell.name] = {name: spell.name, source: spell.source};\n                    } else {\n                      character.preparedSpells[casterName][spell.name] = {name: spell.name, source: spell.source};\n                    }\n                  }\n                  if (this.isEditMode || isPrepared || spell.isSubclassSpell) {\n                    return {\n                      id: 'spell',\n                      name: spell.name, \n                      children: [{...spell, hasChildren: false, id: 'spelldef', parentClass: casterName, parentLevel: index + hasCantrips} ],\n                      hasChildren: true,\n                      parentClass: casterName,\n                      parentLevel: index + hasCantrips,\n                      isCantrip,\n                      isSubclassSpell: spell.isSubclassSpell,\n                      isWarlock: !!warlockSpellLevel\n                    };\n                  } else {\n                    return undefined;\n                  }\n                })\n                .filter((spell) => spell !== undefined);\n              const levelObj = {\n                id: 'level',\n                level: index + hasCantrips,\n                spellSlots,\n                currentSlots: getSpellSlots(index + hasCantrips),\n                children: spellList,\n                hasChildren: spellList.length > 0,\n                parentClass: casterName,\n                isWarlock: !!warlockSpellLevel\n              };\n              const isExpanded = this.$.grid.expandedItems.some(item => item.id === 'level' && item.level === levelObj.level && item.parentClass === levelObj.parentClass);\n              if (isExpanded) {\n                expandedItems.push(levelObj);\n              }\n              return levelObj;\n            } else {\n              return null\n            }\n          }).filter(slots => slots !== null);\n\n          spellsKnownObj[casterName] = {\n            current: character.preparedSpells && character.preparedSpells[casterName] ? Object.keys(character.preparedSpells[casterName]) : [],\n            max: spellsKnownOrPrepared,\n            type: spellsKnowPreparedType,\n            maxCantrips: cantripsKnown,\n            currentCantrips: character.preparedCantrips && character.preparedCantrips[casterName] ? Object.keys(character.preparedCantrips[casterName]) : []\n          };\n\n          if (spellSlots.length) {\n            const classObj = {\n              id: 'class',\n              className: casterName,\n              level,\n              hasCantrips,\n              children: spellSlots,\n              spellsKnown: spellsKnownOrPrepared,\n              hasChildren: spellSlots.length > 0,\n              spellPrepType: spellsKnowPreparedType,\n              multiclassingLevels: isSubclass ? 0 : Math.floor((classRef.casterProgression === 'full' ? 1 : 0.5) * level),\n              isWarlock: !!warlockSpellLevel,\n              warlockSpellLevel,\n              warlockSpellSlots\n            };\n            expandedItems.push(classObj);\n            spellDisplay.push(classObj);\n          }\n        }\n      }\n\n      // sorting most levels first\n      spellDisplay.sort((a, b) => a.children.length - b.children.length);\n\n      // Changing structure for non-edit mode & multiclassing\n      if (!this.isEditMode) {\n        let newSpellDisplay = [];\n        if (spellDisplay.length) {\n          let multiclassLevel = 0,\n            isMulticlass = -1,\n            warlockSpellLevel,\n            warlockSpellSlots;\n\n          // Combine all class spell levels into single references\n          for (let spellClass of spellDisplay) {\n            if (!spellClass.isWarlock) {\n              multiclassLevel += spellClass.multiclassingLevels;\n              isMulticlass ++;\n            } else {\n              warlockSpellLevel = spellClass.warlockSpellLevel;\n              warlockSpellSlots = spellClass.warlockSpellSlots;\n            }\n\n            spellClass.children.forEach((spellLevel, index) => {\n              const adjIndex = index + spellClass.hasCantrips;\n              if (!newSpellDisplay[adjIndex]) {\n                newSpellDisplay[adjIndex] = spellLevel;\n              } else if (spellLevel.children[index]) {\n                newSpellDisplay[adjIndex].children = newSpellDisplay[adjIndex].children.concat(spellLevel.children);\n              }\n            });\n          }\n\n          // remove index 0 if no cantrips\n          newSpellDisplay = newSpellDisplay.filter(i => i !== undefined);\n\n          // Changing spell slots for multiclass rules\n          const hasCantrips = newSpellDisplay[0].level === 0;\n          if (isMulticlass > 0) {\n            const multiclassSlotsArray = this.multiclassSlotsDef[multiclassLevel + 1];\n\n            for (let i = (hasCantrips ? 1 : 0); i < multiclassSlotsArray.length; i++) {\n              const spellSlots =  multiclassSlotsArray[i - (hasCantrips ? 1 : 0)];\n              if (newSpellDisplay[i]) {\n                newSpellDisplay[i].spellSlots = spellSlots;\n              } else {\n                newSpellDisplay.push({\n                  children: [],\n                  currentSlots: getSpellSlots(i + 1 - (hasCantrips ? 1 : 0)),\n                  hasChildren: false,\n                  id: \"level\",\n                  isWarlock: false,\n                  level: i,\n                  spellSlots\n                });\n              }\n            }\n          }\n\n          // Adding warlock slots\n          if (warlockSpellLevel) {\n            newSpellDisplay[warlockSpellLevel - (hasCantrips ? 0 : 1)].warlockSpellSlots = warlockSpellSlots;\n            newSpellDisplay[warlockSpellLevel - (hasCantrips ? 0 : 1)].currentWarlockSlots = character.warlockSpellSlots || 0;\n          }\n        }\n        spellDisplay = newSpellDisplay;\n      }\n\n      this.refresh = false;\n      saveCharacter(character);\n      this.spellsKnown = spellsKnownObj;\n      this.spellDisplay = spellDisplay;\n      this.expandedItems = expandedItems;\n      this.dispatchEvent(new CustomEvent(\"loadingChange\", { bubbles: true, composed: true }));\n      this.$.grid.clearCache();\n    }\n  }\n\n  _renderSpell(spell) {\n    return spellHtml(spell);\n  }\n\n  _toggleSpellPrepared(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const isSubclassSpell = e.model.item.isSubclassSpell;\n    if (!isSubclassSpell && this.isEditMode) {\n      const isCantrip = e.model.item.isCantrip;\n      if (isCantrip) {\n        this._toggleCantripPrepared(e);\n      } else {\n        const className = e.model.item.parentClass;\n        const spell = e.model.item.children[0];\n        const isPrepared = this._isPreparedSpell(this.spellsKnown, className, spell.name);\n        const currentPreparedCount = this._currentSpellsKnownCount(className, this.spellsKnown);\n        const maxPreparedCount = this._maxSpellsKnownCount(className, this.spellsKnown);\n\n        if ((isPrepared || currentPreparedCount < maxPreparedCount) && spell.id === 'spelldef') {\n          let spellsKnownCopy = JSON.parse(JSON.stringify(this.spellsKnown));\n          if (isPrepared) {\n            const index = spellsKnownCopy[className].current.indexOf(spell.name);\n            spellsKnownCopy[className].current.splice(index, 1);\n          } else {\n            spellsKnownCopy[className].current.push(spell.name);\n          }\n          this.spellsKnown = spellsKnownCopy;\n          toggleSpellPrepared(className, spell);\n        } else if (currentPreparedCount >= maxPreparedCount) {\n          this._flashPreparedButton(findInPath('button', e));\n        }\n      }\n    }\n  }\n\n  _toggleCantripPrepared(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const className = e.model.item.parentClass;\n    const spell = e.model.item.children[0];\n    const isPrepared = this._isPreparedCantrip(this.spellsKnown, className, spell.name);\n    const currentPreparedCount = this._currentCantripsKnownCount(className, this.spellsKnown);\n    const maxPreparedCount = this._maxCantripsKnownCount(className, this.spellsKnown);\n\n    if ((isPrepared || currentPreparedCount < maxPreparedCount) && spell.id === 'spelldef') {\n      let spellsKnownCopy = JSON.parse(JSON.stringify(this.spellsKnown));\n      if (isPrepared) {\n        const index = spellsKnownCopy[className].currentCantrips.indexOf(spell.name);\n        spellsKnownCopy[className].currentCantrips.splice(index, 1);\n      } else {\n        spellsKnownCopy[className].currentCantrips.push(spell.name);\n      }\n      this.spellsKnown = spellsKnownCopy;\n      toggleCantripPrepared(className, spell);\n    } else if (currentPreparedCount >= maxPreparedCount) {\n      this._flashPreparedButton(findInPath('button', e));\n    }\n  }\n\n  _flashPreparedButton(buttonEl) {\n    if (buttonEl) {\n      buttonEl.classList.add('transition-bg');\n      buttonEl.classList.add('flash-error');\n      setTimeout(() => {\n        buttonEl.classList.remove('flash-error');\n        setTimeout(() => {\n          buttonEl.classList.remove('transition-bg');\n        }, 200);\n      }, 200);\n    }\n  }\n\n  _toggleSpellSlot(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const isInput = findInPath('.checkbox-wrap', e);\n    const isWarlock = !!findInPath('[warlock-spell]', e);\n    const currentSlots = isWarlock ? e.model.item.currentWarlockSlots : e.model.item.currentSlots;\n    const maxSlots = isWarlock ? e.model.item.warlockSpellSlots : e.model.item.spellSlots;\n    const level = e.model.item.level;\n\n    if (isInput) {\n      const isChecked = isInput.children[0].checked;\n      if (!isChecked && currentSlots < maxSlots) {\n        if (isWarlock) {\n          e.model.item.currentWarlockSlots = currentSlots + 1\n        } else {\n          e.model.item.currentSlots = currentSlots + 1;\n        }\n  \n      } else if (currentSlots > 0) {\n        if (isWarlock) {\n          e.model.item.currentWarlockSlots = currentSlots - 1;\n        } else {\n          e.model.item.currentSlots = currentSlots - 1;\n        }\n      }\n    } else {\n      if (currentSlots < maxSlots) {\n        if (isWarlock) {\n          e.model.item.currentWarlockSlots = currentSlots + 1;\n        } else {\n          e.model.item.currentSlots = currentSlots + 1;\n        }\n\n      } else if (currentSlots > 0) {\n        if (isWarlock) {\n          e.model.item.currentWarlockSlots = currentSlots - 1;\n        } else {\n          e.model.item.currentSlots = currentSlots - 1;\n        }\n      }\n    }\n    \n    if (isWarlock) {\n      this._setSpellSlotsChecked(e.model.item.currentWarlockSlots, findInPath('.slot-checkboxes', e));\n      setSpellSlots(level, e.model.item.currentWarlockSlots, undefined, true);\n    } else {\n      this._setSpellSlotsChecked(e.model.item.currentSlots, findInPath('.slot-checkboxes', e));\n      setSpellSlots(level, e.model.item.currentSlots);\n    }\n  }\n\n  _setSpellSlotsChecked(count, el) {\n    const checkboxes = el.querySelectorAll('vaadin-checkbox');\n    for (let i = 0; i < checkboxes.length; i++) {\n      if (i < count) {\n        checkboxes[i].checked = true;\n      } else {\n        checkboxes[i].checked = false\n      }\n    }\n  }\n\n  _isPreparedClass(spellsKnown, item, isEditMode) {\n    const className = item.parentClass;\n    const spellName = item.name;\n    const isCantrip = item.isCantrip;\n    const isSubclassSpell = item.isSubclassSpell;\n    if (isSubclassSpell) {\n      return isEditMode ? 'spell-button always-prepared edit-mode' : 'spell-button always-prepared';\n    }\n    let isPrepared = isCantrip ? this._isPreparedCantrip(spellsKnown, className, spellName) : this._isPreparedSpell(spellsKnown, className, spellName, isSubclassSpell);\n    if (isPrepared) {\n      return isEditMode ? 'spell-prepared spell-button edit-mode' : 'spell-prepared spell-button';\n    }\n    return isEditMode ? 'spell-button edit-mode' : 'spell-button';\n  }\n\n  _isPreparedSpell(spellsKnown, className, spellName, isSubclassSpell){\n    return isSubclassSpell || spellsKnown[className] && spellsKnown[className].current && spellsKnown[className].current.length && spellsKnown[className].current.indexOf(spellName) > -1;\n  }\n\n  _isPreparedCantrip(spellsKnown, className, spellName){\n    return spellsKnown[className] && spellsKnown[className].currentCantrips && spellsKnown[className].currentCantrips.length && spellsKnown[className].currentCantrips.indexOf(spellName) > -1;\n  }\n\n  _isPreparedText(spellsKnown, item) {\n    const className = item.parentClass;\n    const spellName = item.name;\n    const isCantrip = item.isCantrip;\n    const isSubclassSpell = item.isSubclassSpell;\n    const prepareType = spellsKnown[className].type;\n    if (isSubclassSpell) {\n      return prepareType === 'known' ? 'Always' : 'Always';\n    }\n    let isPrepared = isCantrip ? this._isPreparedCantrip(spellsKnown, className, spellName) : this._isPreparedSpell(spellsKnown, className, spellName, isSubclassSpell);\n    \n    if (isPrepared) {\n      return prepareType === 'known' ? 'Learned' : 'Prepared';\n    } else {\n      return prepareType === 'known' ? 'Learn' : 'Prepare';\n    }\n  }\n\n  _countToArray(count) {\n    const data = [];\n    for (var i = 0; i < count; i++) {\n      data.push(null);\n    }\n    return data;\n  }\n\n  _toLevel(level) {\n    if (level === 0) {\n      return Parser.spLevelToFull(level) + 's';\n    } else {\n      return Parser.spLevelToFull(level) + ' Level';\n    }\n  }\n  \n  _currentSpellsKnownCount(className, spellsKnown) {\n    if (spellsKnown && className && spellsKnown[className] && spellsKnown[className].current) {\n      return spellsKnown[className].current.length;\n    }\n    return 0;\n  }\n\n  _maxSpellsKnownCount(className, spellsKnown) {\n    if (spellsKnown && className && spellsKnown[className]) {\n      return spellsKnown[className].max;\n    }\n    return 0;\n  }\n  \n  _currentCantripsKnownCount(className, spellsKnown) {\n    if (spellsKnown && className && spellsKnown[className] && spellsKnown[className].current) {\n      return spellsKnown[className].currentCantrips.length;\n    }\n    return 0;\n  }\n\n  _maxCantripsKnownCount(className, spellsKnown) {\n    if (spellsKnown && className && spellsKnown[className]) {\n      return spellsKnown[className].maxCantrips;\n    }\n    return 0;\n  }\n\n  _toggleTooltip(e) {\n    const tooltipStr = e.target.dataset.tooltip;\n    const hasTooltip = Array.from(e.target.children).find((childEl) => childEl.matches('.tooltip'));\n\n    if (!window.tooltipCloseListener) {\n      window.tooltipCloseListener = true;\n      window.tooltips = [];\n      document.addEventListener('click', () => {\n        window.tooltips.forEach((tooltip) => {\n          tooltip.classList.remove('tooltip--open');\n          setTimeout(() => {\n            tooltip.remove();\n          }, 300);\n        });\n        window.tooltips = [];\n      });\n    }\n\n    if (hasTooltip) {\n      hasTooltip.classList.remove('tooltip--open');\n      setTimeout(() => {\n        hasTooltip.remove();\n      }, 300);\n    } else if (tooltipStr) {\n      const tooltipEl = document.createElement('div');\n      tooltipEl.innerHTML = tooltipStr;\n      tooltipEl.classList.add('tooltip');\n      e.target.appendChild(tooltipEl);\n      setTimeout(() => {\n        tooltipEl.classList.add('tooltip--open');\n        window.tooltips.push(tooltipEl);\n      }, 0);\n    }\n  }\n\n  _toggleEditMode() {\n    dispatchEditModeChange(!this.isEditMode);\n  }\n\n  _spellsKnownString(spellPrepType) {\n    return 'Spells ' + util_capitalize(spellPrepType) + ':'\n  }\n\n  _isRitualSpell(spellParent) {\n    const spell = spellParent.children[0];\n    return spell && spell.meta && spell.meta.ritual;\n  }\n\n  _isConcentrationSpell(spellParent) {\n    const spell = spellParent.children[0];\n    return spell.duration.some((d) => d.concentration);\n  }\n\n  _isBonusActionSpell(spellParent) {\n    const spell = spellParent.children[0];\n    return spell.time.some((t) => t.unit === 'bonus');\n  }\n\n  _getSpellSchool(spellParent) {\n    const spell = spellParent.children[0];\n    return Parser.SP_SCHOOL_ABV_TO_FULL[spell.school];\n  }\n\n  _hidePrepareSpellsButton(isEditMode, spellsKnown) {\n    return isEditMode || !Object.values(spellsKnown).some((clas) => clas.current.length < clas.max - 1 || clas.currentCantrips.length < clas.maxCantrips - 1);\n  }\n\n  _spellLevel(item) {\n    if (item && item.children && item.children.length && item.children[0].level) {\n      return Parser.spLevelToFull(item.children[0].level);\n    }\n  }\n\n  _isSpellSlotChecked(currentSlots, index) {\n    return index < currentSlots;\n  }\n\n  _spellClassText(parentClass) {\n    return parentClass;//util_capitalizeAll(parentClass);\n  }\n\n  _isEmpty(a) {\n    return !a || !a.length;\n  }\n\n  _hideCheckboxes(spellSlots) {\n    return !spellSlots || spellSlots > 0 && this.isEditMode;\n  }\n  \n  _hideSlotsLabel(isEditMode, level) {\n    return !isEditMode || level === 0;\n  }\n  \n  _wrapClassString(isEditMode) {\n    return isEditMode ? 'edit-mode' : 'not-edit-mode';\n  }\n\n  _equal(a, b) {\n    return a === b;\n  }\n\n  _hasTwo(a) {\n    return a && a.length && a.length > 1;\n  }\n\n  _join(a) {\n    return a.join(', ');\n  }\n\n  _abs(num) {\n    return num >= 0 ? `+${num}`: num;\n  }\n\n  static get template() {\n    return html`\n      <style include='my-styles'>\n        :host {}\n        :host {\n          display: block;\n          padding-top: 16px;\n        }\n        [hidden] {\n          display: none !important;\n        }\n\n        .heading {\n          width: calc(100% - 32px);\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          justify-content: space-between;\n          border-bottom: 1px solid var(--lumo-contrast-10pct);\n          margin: 0 16px;\n        }\n\n        h2 {\n          display: block;\n          font-size: 1.5em;\n          margin: 20px 0 20px 0;\n          font-weight: bold;\n        }\n\n        vaadin-grid {\n          margin-bottom: 200px;\n        }\n\n        vaadin-grid-tree-toggle { \n          width: 100%;\n          cursor: pointer;\n        }\n\n        .class-wrap {\n          width: 100%;\n          display: flex;\n          justify-content: space-between;\n          flex-wrap: wrap;\n          align-items: center;\n          padding-top: 4px;\n          /* padding-top: 34px;\n          padding-bottom: 8px; */\n          -youbkit-touch-callout: none;\n          -youbkit-user-select: none;\n          -moz-user-select: none;\n          -ms-user-select: none;\n          user-select: none;\n          left: -16px;\n          border-bottom: 3px solid var(--_lumo-grid-secondary-border-color);;\n          padding: 24px 16px 8px;\n          position: relative;\n        }\n        .class-wrap h3 {\n          font-size: 22px;\n          font-weight: bold;\n        }\n\n        .spells-prepared-text {\n          margin-right: 6px;\n          margin-left: auto;\n        }\n        .prepared-count {\n          color: var(--mdc-theme-primary);\n          font-weight: bold;\n        }\n        .prepared-count[edit-mode] {\n          color: var(--mdc-theme-secondary);\n        }\n        .cantrips-prepared {\n          margin-right: 0;\n        }\n\n        .level-outer-wrap {\n          border-bottom: 1px solid var(--_lumo-grid-secondary-border-color);\n          padding-bottom: 8px;\n          display: flex;\n          height: 32px;\n        }\n\n        .level-wrap {\n          width: 100%;\n          -youbkit-touch-callout: none;\n          -youbkit-user-select: none;\n          -moz-user-select: none;\n          -ms-user-select: none;\n          user-select: none;\n        }\n\n        .level-wrap .label {\n          padding-left: 6px;\n          font-size: 12px;\n          color: var(--lumo-tint-70pct);\n        }\n\n        .slot-checkboxes {\n          cursor: pointer;\n          display: flex;\n          padding: 4px;\n        }\n\n        .slot-checkboxes span {\n          -youbkit-touch-callout: none;\n          -youbkit-user-select: none;\n          -moz-user-select: none;\n          -ms-user-select: none;\n          user-select: none;\n        }\n\n        .slot-checkboxes .label {\n          padding-left: 8px;\n        }\n\n        vaadin-checkbox {\n          pointer-events: none;\n        }\n\n        .spell-outer-wrap {\n          display: flex;\n        }\n\n        .spell-wrap {\n          width: 100%;\n          margin-left: 24px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .spell-inner-wrap {\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          -youbkit-touch-callout: none;\n          -youbkit-user-select: none;\n          -moz-user-select: none;\n          -ms-user-select: none;\n          user-select: none;\n        }\n\n        .spell-level {\n          color: var(--mdc-theme-text-disabled-on-background);\n          margin-left: 8px;\n          margin-right: 4px;\n          font-size: 12px;\n        }\n\n        .ind {\n          display: inline-flex;\n          align-items: center;\n          justify-content: center;\n          border-radius: 8px;\n          color: var(--mdc-theme-on-secondary);\n          background-color: var(--mdc-theme-secondary);\n          font-size: 12px;\n          position: relative;\n          bottom: 2px;\n          margin-left: 0;\n          padding: 0px 4px;\n          font-weight: 500;\n        }\n\n        .rit-ind::before {\n          content: 'R';\n        }\n        .conc-ind::before {\n          content: 'C';\n        }\n        .bonus-ind::before {\n          content: 'BA';\n        }\n        .school-ind {\n          font-size: 10px;\n          height: 16px;\n          bottom: 3px;\n        }\n\n        .spell-inner-wrap[not-edit-mode] .ind {\n          background-color: var(--mdc-theme-primary);\n        }\n\n        .spell-def-wrap {\n          font-size: 14px;\n          width: calc(100% - 20px);\n          margin: 0 auto;\n          background: var(--lumo-contrast-10pct);\n          border-radius: 4px;\n          white-space: pre-line;\n        }\n\n        .spell-def-wrap .margin-bottom_med {\n          margin-bottom: 0px !important;\n        }\n\n        .spell-def-wrap .text {\n          margin-top: 16px;\n        }\n\n        .spell-def-wrap p {\n          margin-bottom: 16px;\n        }\n\n        .stats-wrapper {\n          margin: 0 14px;\n        }\n\n        .spell-button {\n          background-color: var(--mdc-theme-text-disabled-on-background);\n          color: var(--mdc-theme-on-secondary);\n          border: none;\n          border-radius: 4px;\n          outline: none;\n          width: 80px;\n          display: inline-block;\n          justify-content: center;\n          white-space: normal;\n          font-size: 12px;\n          padding: 4px 4px;\n          margin-left: 8px;\n        }\n        .class-icon {\n          border: none;\n          border-radius: 4px;\n          outline: none;\n          width: 60px;\n          display: inline-block;\n          justify-content: center;\n          white-space: normal;\n          font-size: 12px;\n          padding: 4px 4px;\n          width: 20px;\n        }\n        .spell-button.edit-mode {\n          cursor: pointer;\n        }\n        .spell-button.always-prepared {\n          background-color: var(--mdc-theme-secondary-lighter);\n          cursor: not-allowed;\n        }\n        .spell-button.spell-prepared {\n          background-color: var(--mdc-theme-secondary);\n        }\n        .spell-button.flash-error {\n          background-color: var(--mdc-theme-error);\n          transition: background-color 0.2s ease-out;\n        }\n        .spell-button.transition-bg {\n          transition: background-color 0.2s ease-in;\n        }\n\n        .mods {\n          display: flex;\n          flex-wrap: nowrap;\n          justify-content: space-around;\n          margin: 16px 0;\n        }\n        .mod-row {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          font-size: 12px;\n          text-align: center;\n          margin: 0 4px;\n          width: 130px;\n        }\n        .mod-val-wrap {\n          font-size: 16px;\n        }\n        .mod-val:not(:first-child)::before {\n          content: '|';\n          margin-right: 4px;\n          color: var(--lumo-contrast-30pct);\n        }\n        .mod-label {\n          font-weight: bold;\n          color: var(--mdc-theme-primary);\n          font-size: 15px;\n        }\n        .edit-mode .mod-label {\n          font-weight: bold;\n          color: var(--mdc-theme-secondary);\n        }\n        @media(min-width: 420px) {\n          .mods {\n            justify-content: center;\n          }\n          .mod-row {\n            font-size: 14px;\n          }\n          .mod-val-wrap {\n            font-size: 18px;\n          }\n        }\n\n        @media(min-width: 921px) {\n          .mods {\n            justify-content: flex-start;\n          }\n        }\n\n        .filter {\n          margin-left: 16px;\n\n        }\n\n        .tooltip {\n          position: absolute;\n          background: lightgray;\n          color: black;\n          padding: 2px 10px;\n          border-radius: 4px;\n          white-space: nowrap;\n          left: 8px;\n          opacity: 0;\n          transition: opacity 0.3s ease;\n          border-top-left-radius: 0px;\n        }\n        .tooltip--open {\n          opacity: 1;\n        }\n        .tooltip::after {\n          content: '';\n          height: 0;\n          width: 0;\n          position: absolute;\n          border-left: 5px solid transparent;\n          border-right: 5px solid transparent;\n          border-bottom: 5px solid lightgray;\n          top: -5px;\n          left: 0px;\n        }\n        [data-tooltip] {\n          position: relative;\n        }\n\n        .no-content-message {\n          font-size: 14px;\n          padding: 20px;\n          font-style: italic;\n        }\n      </style>\n\n      <div class$=\"[[_wrapClassString(isEditMode)]]\" hidden$=\"[[noContentMessage]]\">\n\n        <div class=\"heading\">\n          <h2>Spells</h2>\n\n          <dnd-button class=\"prepare-spells-button link\" hidden$=\"[[_hidePrepareSpellsButton(isEditMode, spellsKnown)]]\" edit-mode$=\"[[isEditMode]]\" not-edit-mode$=\"[[!isEditMode]]\" label=\"Prepare Your Spells!\" icon=\"edit\" on-click=\"_toggleEditMode\"></dnd-button>\n        </div>\n\n        <!-- Spell Mods -->\n        <div class=\"mods\" >\n          <div class=\"mod-row\">\n            <span class=\"mod-val-wrap\">\n              <template is=\"dom-repeat\" items=\"[[spellMods]]\">\n                <span class=\"mod-val\" data-tooltip$=\"[[_join(item.classes)]]\" on-mouseover=\"_toggleTooltip\" on-mouseout=\"_toggleTooltip\">[[_abs(item.mod)]]</span>\n              </template>\n            </span>\n            <span class=\"mod-label\">Modifier</span>\n          </div>\n          <div class=\"mod-row\">\n            <span class=\"mod-val-wrap\">\n              <template is=\"dom-repeat\" items=\"[[spellMods]]\">\n                <span class=\"mod-val\" data-tooltip$=\"[[_join(item.classes)]]\" on-mouseover=\"_toggleTooltip\" on-mouseout=\"_toggleTooltip\">+[[item.spellAttackBonus]]</span>\n              </template>\n            </span>\n            <span class=\"mod-label\">Attack +</span>\n          </div>\n          <div class=\"mod-row\">\n            <span class=\"mod-val-wrap\">\n              <template is=\"dom-repeat\" items=\"[[spellMods]]\">\n                <span class=\"mod-val\" data-tooltip$=\"[[_join(item.classes)]]\" on-mouseover=\"_toggleTooltip\" on-mouseout=\"_toggleTooltip\">[[item.dc]]</span>\n              </template>\n            </span>\n            <span class=\"mod-label\">DC</span>\n          </div>\n        </div>\n\n        <div class=\"filter\">\n          <vaadin-text-field clear-button-visible value=\"{{filterStr}}\" placeholder='Filter'></vaadin-text-field>\n        </div>\n      </div>\n\n      <div class=\"no-content-message\" hidden$=\"[[!noContentMessage]]\">Enter edit mode to add classes and levels.</div>\n\n      <vaadin-grid id=\"grid\" theme=\"no-border no-row-borders\" expanded-items=\"{{expandedItems}}\" height-by-rows hidden$=\"[[noContentMessage]]\">\n        <vaadin-grid-column flex-grow=\"1\">\n          <template>\n              <template is=\"dom-if\" if=\"[[_equal(item.id, 'class')]]\">\n                <div class=\"class-wrap\">\n                  <h3>[[item.className]]</h3>\n                  <div class='spells-prepared-text'>\n                    <span>[[_spellsKnownString(item.spellPrepType)]]</span>\n                    <span class='prepared-count' edit-mode$=[[isEditMode]]>[[_currentSpellsKnownCount(item.className, spellsKnown)]] / [[_maxSpellsKnownCount(item.className, spellsKnown)]]</span>\n                  </div>\n                </div>\n              </template>\n  \n              <template is=\"dom-if\" if=\"[[_equal(item.id, 'level')]]\">\n                <div class=\"level-outer-wrap\">\n                  <vaadin-grid-tree-toggle leaf=\"[[!item.hasChildren]]\" expanded=\"{{expanded}}\" on-click='_recordScrollHeight'>\n                    <h4 class=\"level-wrap\">[[_toLevel(item.level)]]<span hidden$=\"[[_hideSlotsLabel(isEditMode, item.level)]]\" class=\"label\">([[item.spellSlots]] Slots)</span></h4>\n                    <div class=\"cantrips-prepared spells-prepared-text\" hidden$=\"[[!_equal(item.level, 0)]]\">\n                      <span>Cantrips Known:</span>\n                      <span class='prepared-count' edit-mode$=[[isEditMode]]>[[_currentCantripsKnownCount(item.parentClass, spellsKnown)]] / [[_maxCantripsKnownCount(item.parentClass, spellsKnown)]]</span>\n                    </div>\n                  </vaadin-grid-tree-toggle>\n\n                  <div class=\"slot-checkboxes\" hidden$=\"[[_hideCheckboxes(item.warlockSpellSlots, isEditMode)]]\" on-click=\"_toggleSpellSlot\" warlock-spell>\n                    <template is='dom-repeat' items='[[_countToArray(item.warlockSpellSlots)]]' as=\"thing\">\n                      <span class=\"checkbox-wrap\"><vaadin-checkbox checked=\"[[_isSpellSlotChecked(item.currentWarlockSlots, index)]]\"></vaadin-checkbox></span>\n                    </template>\n                    <span class=\"label\">Pact</span>\n                  </div>\n\n                  <div class=\"slot-checkboxes\" hidden$=\"[[_hideCheckboxes(item.spellSlots, isEditMode)]]\" on-click=\"_toggleSpellSlot\">\n                    <template is='dom-repeat' items='[[_countToArray(item.spellSlots)]]' as=\"thing\">\n                      <span class=\"checkbox-wrap\"><vaadin-checkbox checked=\"[[_isSpellSlotChecked(item.currentSlots, index)]]\"></vaadin-checkbox></span>\n                    </template>\n                    <span class=\"label\">Slots</span>\n                  </div>\n                </div>\n              </template>\n\n              <template is=\"dom-if\" if=\"[[_equal(item.id, 'spell')]]\">\n                <div class=\"spell-outer-wrap\">\n                  <vaadin-grid-tree-toggle leaf=\"[[!item.hasChildren]]\" expanded=\"{{expanded}}\" class=\"spell-wrap\" on-click='_recordScrollHeight'>\n                    <div class=\"spell-inner-wrap\" not-edit-mode$=\"[[!isEditMode]]\">\n                      [[item.name]]\n                      <span class=\"spell-level\" hidden>[[_spellLevel(item)]]</span>\n                      <span class=\"ind rit-ind\" title=\"Ritual\" hidden$=\"[[!_isRitualSpell(item)]]\"></span>\n                      <span class=\"ind conc-ind\" title=\"Concentration\" hidden$=\"[[!_isConcentrationSpell(item)]]\"></span>\n                      <span class=\"ind bonus-ind\" title=\"Bonus Action\" hidden$=\"[[!_isBonusActionSpell(item)]]\"></span>\n                      <span class=\"ind school-ind\" title=\"[[_getSpellSchool(item)]]\">[[_getSpellSchool(item)]]</span>\n                    </div>\n                  </vaadin-grid-tree-toggle>\n                  <button class$=\"[[_isPreparedClass(spellsKnown, item, isEditMode)]]\" hidden$=\"[[!isEditMode]]\" on-click=\"_toggleSpellPrepared\">[[_isPreparedText(spellsKnown, item)]]</button>\n                  <dnd-svg class=\"class-icon\" hidden$=\"[[isEditMode]]\" id='[[_spellClassText(item.parentClass)]]' default-color></dnd-svg>\n                </div>\n              </template>\n\n              <template is=\"dom-if\" if=\"[[_equal(item.id, 'spelldef')]]\">\n                <div class=\"spell-def-wrap\">\n                  <div class= \"stats-wrapper\" inner-h-t-m-l=\"[[_renderSpell(item)]]\"></div>\n                </div>\n              </template>\n          </template>\n        </vaadin-grid-column>\n      </vaadin-grid>\n    `;\n  }\n}\n\ncustomElements.define(\"dnd-character-builder-spells\",DndCharacterBuilderSpells);\n"],"sourceRoot":""}