{"version":3,"sources":["webpack:///./util/entryrender.js","webpack:///./js/classes.js","webpack:///./util/renderList.js"],"names":["EntryRenderer","this","wrapperTag","baseUrl","setWrapperTag","tag","setBaseUrl","url","recursiveEntryRender","entry","textStack","depth","prefix","suffix","forcePrefixSuffix","type","renderPrefix","undefined","handleEntriesOptionsInvocationPatron","self","entries","sort","a","b","name","handleOptions","items","push","style","i","length","source","caption","colLabels","getTableThClassText","rows","j","makeTableTdClassText","colStyles","rowStyles","renderTable","handleInvocation","handlePatron","attributes","renderSuffix","value","getEntryDice","href","path","hash","subhashes","subHash","key","text","renderLink","renderString","incDepth","inlineTitle","nextDepth","styleString","styleClasses","HEAD_2","HEAD_NEG_1","HEAD_0","HEAD_1","subclass","join","getStyleString","dataString","titleString","sourceJsonToFull","DATA_NONE","getDataString","preReqText","prerequisite","headerSpan","tagSplit","char","char2","tagDepth","inTag","out","curStr","charAt","splitByTags","s","string","substr","indexOf","actionToExplanation","skillToExplanation","displayText","others","split","fauxEntry","classMatch","RE_INLINE_CLASS","exec","trim","substring","toAdd","number","faces","String","toRoll","roll","droll","rollable","CLSS_ACTIVE","renderer","renderStr","renderStack","onDataLoad","classes","rootEl","c","subclasses","window","classTableDefault","querySelector","innerHTML","container","appendChild","listWrapper","htmlString","curItem","svg","replace","itemElements","addEventListener","e","tar","target","closest","getAttribute","renderList","onClassChange","curClass","classList","remove","hd","add","proficiency","map","p","Parser","attAbvToFull","sProfs","startingProficiencies","armor","weapons","w","tools","skills","numString","skillOptions","result","Array","isArray","skill","choose","numberToString","count","from","getSkillProfString","sEquip","startingEquipment","fromBackground","additionalFromBackground","defList","default","goldAlt","goldAlternative","tData","classTableGroups","groupHeaders","colHeaders","levelTrs","spellsFlag","subclassDef","subclassTableGroups","concat","tGroup","hasTitle","title","subclassData","append","lbl","tr","k","stack","combinedLabels","classFeatures","mobileClone","cloneNode","setAttribute","colHeaderEls","querySelectorAll","colHeaderEl","textContent","toLowerCase","subclassIndex","tblLvlFeatures","featureNames","lvlFeatureList","feature","featureId","featureLinkPart","featureLinkClasses","featureLink","preventDefault","getElementById","scrollIntoView","offset","scrollBy","gainSubclassFeature","subClass","l","subclassFeatures","subFeature","m","childEntry","startsWith","shortName","toggleUAFeatures","subclassPillWrapper","allSourcesToggle","makeGenericTogglePill","subClasses","sc","nonStandardSource","pillText","sourceJsonToAbv","pill","handleSubclassClick","contains","display","toggle","HASH_ALL_SOURCES","click","pillActiveClass","pillId","hashKey","defaultActive","isUA","active","isPillActive","outStack","hashPart","newHash","handleToggleFeaturesClicks","subclassName","subclassSource","routeSelection","encodedSubClass","subclassLink","includes","subClassStack","hasSubclassHash","nonStandardPills","nonStandardPill","onSubChange","sub","curHash","hideClassFeatures","showAllSources","slice","hideOtherSources","updateClassTableLinks","$toShow","$toHide","$subClassSpanList","classSpan","$this","thisSc","shown","otherSrcSubFeats","shownInTable","v","selectedSCFeatures","selectedSCFeature","otherSrcSubFeat","asInTable","toShow","listEls","el","scs","handleTableGroups","subClassEls","subClassEl","cfToggle","toToggleCf","srcToggle","toToggleSrc","hashParts","outParts","part","els","prevFeature"],"mappings":"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","file":"1.bundle.js","sourcesContent":["import { isNonstandardSource, encodeForHash, ascSort, utils_makeAttChoose } from \"../js/utils.js\";\r\nimport {\r\n  CLSS_NON_STANDARD_SOURCE,\r\n  HASH_LIST_SEP,\r\n  ATB_DATA_SC,\r\n  ATB_DATA_SRC,\r\n  CLSS_SUBCLASS_FEATURE,\r\n\tSRC_MM,\r\n\tSRC_PHB,\r\n\tSRC_DMG\r\n} from \"../util/consts.js\";\r\nimport Parser from \"../util/Parser.js\";\r\n// ENTRY RENDERING =====================================================================================================\r\n/*\r\n * // EXAMPLE USAGE //\r\n *\r\n * const entryRenderer = new EntryRenderer();\r\n *\r\n * const topLevelEntry = mydata[0];\r\n * // prepare an array to hold the string we collect while recursing\r\n * const textStack = [];\r\n *\r\n * // recurse through the entry tree\r\n * entryRenderer.renderEntries(topLevelEntry, textStack);\r\n *\r\n * // render the final product by joining together all the collected strings\r\n * $(\"#myElement\").html(toDisplay.join(\"\"));\r\n */\r\nfunction EntryRenderer() {\r\n\r\n\tthis.wrapperTag = \"div\";\r\n\tthis.baseUrl = \"\";\r\n\r\n\t/**\r\n\t * Set the tag used to group rendered elements\r\n\t * @param tag to use\r\n\t */\r\n\tthis.setWrapperTag = function (tag) {\r\n\t\tthis.wrapperTag = tag;\r\n\t};\r\n\r\n\t/**\r\n\t * Set the base url for rendered links.\r\n\t * Usage: `renderer.setBaseUrl(\"https://www.cool.site/\")` (note the \"http\" prefix and \"/\" suffix)\r\n\t * @param url to use\r\n\t */\r\n\tthis.setBaseUrl = function(url) {\r\n\t\tthis.baseUrl = url;\r\n\t};\r\n\r\n\t/**\r\n\t * Recursively walk down a tree of \"entry\" JSON items, adding to a stack of strings to be finally rendered to the\r\n\t * page. Note that this function does _not_ actually do the rendering, see the example code above for how to display\r\n\t * the result.\r\n\t *\r\n\t * @param entry An \"entry\" usually defined in JSON. A schema is available in tests/schema\r\n\t * @param textStack A reference to an array, which will hold all our strings as we recurse\r\n\t * @param depth The current recursion depth. Optional; default 0, or -1 for type \"section\" entries\r\n\t * @param prefix The (optional) prefix to be added to the textStack before whatever is added by the current call\r\n\t * @param suffix The (optional) suffix to be added to the textStack after whatever is added by the current call\r\n\t * @param forcePrefixSuffix force the prefix and suffix to be added (useful for the first call from external code)\r\n\t */\r\n\tthis.recursiveEntryRender = function(entry, textStack, depth, prefix, suffix, forcePrefixSuffix) {\r\n\t\tdepth = depth === undefined || depth === null ? entry.type === \"section\" ? -1 : 0 : depth;\r\n\t\tprefix = prefix === undefined || prefix === null ? null : prefix;\r\n\t\tsuffix = suffix === undefined || suffix === null ? null : suffix;\r\n\t\tforcePrefixSuffix = forcePrefixSuffix === undefined || forcePrefixSuffix === null ? false : forcePrefixSuffix;\r\n\r\n\t\tif (forcePrefixSuffix) renderPrefix();\r\n\t\tif (typeof entry === \"object\") {\r\n\t\t\t// the root entry (e.g. \"Rage\" in barbarian \"classFeatures\") is assumed to be of type \"entries\"\r\n\t\t\tconst type = entry.type === undefined || entry.type === \"section\" ? \"entries\" : entry.type;\r\n\t\t\tswitch (type) {\r\n\t\t\t\t// TODO add an \"insert box\" type\r\n\r\n\t\t\t\t// recursive\r\n\t\t\t\tcase \"entries\":\r\n\t\t\t\t\thandleEntries(this);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"options\":\r\n\t\t\t\t\thandleOptions(this);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"list\":\r\n\t\t\t\t\tif (entry.items) {\r\n\t\t\t\t\t\ttextStack.push(`<ul ${entry.style ? `class=\"${entry.style}\"` : ''}>`);\r\n\t\t\t\t\t\tfor (let i = 0; i < entry.items.length; i++) {\r\n\t\t\t\t\t\t\tthis.recursiveEntryRender(entry.items[i], textStack, depth + 1, `<li ${isNonstandardSource(entry.items[i].source) ? `class=\"${CLSS_NON_STANDARD_SOURCE}\"` : \"\"}>`, \"</li>\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttextStack.push(\"</ul>\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"table\":\r\n\t\t\t\t\trenderTable(this);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"invocation\":\r\n\t\t\t\t\thandleInvocation(this);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"patron\":\r\n\t\t\t\t\thandlePatron(this);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t// block\r\n\t\t\t\tcase \"abilityDc\":\r\n\t\t\t\t\trenderPrefix();\r\n\t\t\t\t\ttextStack.push(`<span class='spell-ability'><span>${entry.name} save DC</span> = 8 + your proficiency bonus + your ${utils_makeAttChoose(entry.attributes)}</span>`);\r\n\t\t\t\t\trenderSuffix();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"abilityAttackMod\":\r\n\t\t\t\t\tif (prefix !== null) textStack.push(prefix);\r\n\t\t\t\t\ttextStack.push(`<span class='spell-ability'><span>${entry.name} attack modifier</span> = your proficiency bonus + your ${utils_makeAttChoose(entry.attributes)}</span>`);\r\n\t\t\t\t\tif (suffix !== null) textStack.push(suffix);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t// inline\r\n\t\t\t\tcase \"inline\":\r\n\t\t\t\t\tif (entry.entries) {\r\n\t\t\t\t\t\tfor (let i = 0; i < entry.entries.length; i++) {\r\n\t\t\t\t\t\t\tthis.recursiveEntryRender(entry.entries[i], textStack, depth);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"bonus\":\r\n\t\t\t\t\ttextStack.push((entry.value < 0 ? \"\" : \"+\") + entry.value);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"bonusSpeed\":\r\n\t\t\t\t\ttextStack.push((entry.value < 0 ? \"\" : \"+\") + entry.value + \"ft.\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"dice\":\r\n\t\t\t\t\ttextStack.push(EntryRenderer.getEntryDice(entry));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"link\":\r\n\t\t\t\t\trenderLink(this, entry);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"item\":\r\n\t\t\t\t\ttextStack.push(`<li><b>${entry.name}: </b>`);\r\n\t\t\t\t\tthis.recursiveEntryRender(entry.entry, textStack, depth);\r\n\t\t\t\t\ttextStack.push('</li>');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"print\":\r\n\t\t\t\t\ttextStack.push(renderString(entry.entry));\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} else if (typeof entry === \"string\") { // block\r\n\t\t\trenderPrefix();\r\n\t\t\trenderString(this);\r\n\t\t\trenderSuffix();\r\n\t\t} else { // block\r\n\t\t\t// for ints or any other types which do not require specific rendering\r\n\t\t\trenderPrefix();\r\n\t\t\ttextStack.push(entry);\r\n\t\t\trenderSuffix();\r\n\t\t}\r\n\t\tif (forcePrefixSuffix) renderSuffix();\r\n\r\n\t\tfunction renderPrefix() {\r\n\t\t\tif (prefix !== null) {\r\n\t\t\t\ttextStack.push(prefix);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction renderSuffix() {\r\n\t\t\tif (suffix !== null) {\r\n\t\t\t\ttextStack.push(suffix);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction renderTable(self) {\r\n\t\t\t// TODO add handling for rowLabel property\r\n\r\n\t\t\ttextStack.push(\"<table class='table'>\");\r\n\r\n\t\t\tif (entry.caption !== undefined) {\r\n\t\t\t\ttextStack.push(`<caption>${entry.caption}</caption>`);\r\n\t\t\t}\r\n\t\t\ttextStack.push(\"<thead>\");\r\n\t\t\ttextStack.push(\"<tr class='table-row table-row--header'>\");\r\n\r\n\t\t\tif (entry.colLabels) {\r\n\t\t\t\tfor (let i = 0; i < entry.colLabels.length; ++i) {\r\n\t\t\t\t\ttextStack.push(`<th ${getTableThClassText(i)}>${entry.colLabels[i]}</th>`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttextStack.push(\"</tr>\");\r\n\t\t\ttextStack.push(\"</thead>\");\r\n\t\t\ttextStack.push(\"<tbody>\");\r\n\r\n\t\t\tfor (let i = 0; i < entry.rows.length; ++i) {\r\n\t\t\t\ttextStack.push(\"<tr class='table-row'>\");\r\n\t\t\t\tfor (let j = 0; j < entry.rows[i].length; ++j) {\r\n\t\t\t\t\ttextStack.push(`<td ${makeTableTdClassText(j)}>`);\r\n\t\t\t\t\tself.recursiveEntryRender(entry.rows[i][j], textStack, depth + 1);\r\n\t\t\t\t\ttextStack.push(\"</td>\");\r\n\t\t\t\t}\r\n\t\t\t\ttextStack.push(\"</tr>\");\r\n\t\t\t}\r\n\r\n\t\t\ttextStack.push(\"</tbody>\");\r\n\t\t\ttextStack.push(\"</table>\");\r\n\r\n\t\t\tfunction getTableThClassText(i) {\r\n\t\t\t\treturn entry.colStyles === undefined || i >= entry.colStyles.length ? \"class='table-cell'\" :  `class=\"table-cell ${entry.colStyles[i]}\"`;\r\n\t\t\t}\r\n\r\n\t\t\tfunction makeTableTdClassText(i) {\r\n\t\t\t\tif (entry.rowStyles !== undefined) {\r\n\t\t\t\t\treturn entry.rowStyles === undefined || i >= entry.rowStyles.length ? \"class='table-cell'\" : `class=\"table-cell ${entry.rowStyles[i]}\"`;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn getTableThClassText(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction handleEntries(self) {\r\n\t\t\thandleEntriesOptionsInvocationPatron(self, true);\r\n\t\t}\r\n\r\n\t\tfunction handleOptions(self) {\r\n\t\t\tif (entry.entries) {\r\n\t\t\t\tentry.entries = entry.entries.sort((a, b) => a.name && b.name ? ascSort(a.name, b.name) : a.name ? -1 : b.name ? 1 : 0);\r\n\t\t\t\thandleEntriesOptionsInvocationPatron(self, false);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction handleInvocation(self) {\r\n\t\t\thandleEntriesOptionsInvocationPatron(self, true);\r\n\t\t}\r\n\r\n\t\tfunction handlePatron(self) {\r\n\t\t\thandleEntriesOptionsInvocationPatron(self, false);\r\n\t\t}\r\n\r\n\t\tfunction handleEntriesOptionsInvocationPatron(self, incDepth) {\r\n\t\t\tconst inlineTitle = depth >= 2;\r\n\t\t\tconst nextDepth = incDepth ? depth+1 : depth;\r\n\t\t\tconst styleString = getStyleString();\r\n\t\t\tconst dataString = getDataString();\r\n\t\t\tconst preReqText = getPreReqText();\r\n\t\t\tconst headerSpan = entry.name !== undefined ? `<span class=\"stat-name\">${entry.name}${isNonstandardSource(entry.source) ? ' (UA)' : ''}${inlineTitle ? \".\" : \"\"}</span> ` : \"\";\r\n\r\n\t\t\tif (entry.entries || entry.name) {\r\n\t\t\t\ttextStack.push(`<${self.wrapperTag} ${dataString} ${styleString}>${headerSpan}${preReqText}`);\r\n\t\t\t\tif (entry.entries) {\r\n\t\t\t\t\tfor (let i = 0; i < entry.entries.length; i++) {\r\n\t\t\t\t\t\tself.recursiveEntryRender(entry.entries[i], textStack, nextDepth, \"<p>\", \"</p>\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttextStack.push(`</${self.wrapperTag}>`);\r\n\t\t\t}\r\n\r\n\t\t\tfunction getStyleString() {\r\n\t\t\t\tconst styleClasses = [];\r\n\t\t\t\tif (isNonstandardSource(entry.source)) styleClasses.push(CLSS_NON_STANDARD_SOURCE);\r\n\t\t\t\tif (inlineTitle && entry.name !== undefined) styleClasses.push(EntryRenderer.HEAD_2);\r\n\t\t\t\telse styleClasses.push(depth === -1 ? EntryRenderer.HEAD_NEG_1 : depth === 0 ? EntryRenderer.HEAD_0 : EntryRenderer.HEAD_1);\r\n\t\t\t\tif ((entry.type === \"invocation\" || entry.type === \"patron\") && entry.subclass !== undefined) styleClasses.push(CLSS_SUBCLASS_FEATURE);\r\n\t\t\t\treturn styleClasses.length > 0 ? `class=\"${styleClasses.join(\" \")}\"` : \"\";\r\n\t\t\t}\r\n\r\n\t\t\tfunction getDataString() {\r\n\t\t\t\tlet dataString = \"\";\r\n\t\t\t\tif (entry.type === \"invocation\" || entry.type === \"patron\") {\r\n\t\t\t\t\tconst titleString = entry.source ? `title=\"Source: ${Parser.sourceJsonToFull(entry.source)}\"` : \"\";\r\n\t\t\t\t\tif (entry.subclass !== undefined) dataString = `${ATB_DATA_SC}=\"${entry.subclass.name}\" ${ATB_DATA_SRC}=\"${entry.subclass.source}\" ${titleString}`;\r\n\t\t\t\t\telse dataString = `${ATB_DATA_SC}=\"${EntryRenderer.DATA_NONE}\" ${ATB_DATA_SRC}=\"${EntryRenderer.DATA_NONE}\" ${titleString}`;\r\n\t\t\t\t}\r\n\t\t\t\treturn dataString;\r\n\t\t\t}\r\n\r\n\t\t\tfunction getPreReqText() {\r\n\t\t\t\tif (entry.prerequisite) return `<span class=\"prerequisite\">Prerequisite: ${entry.prerequisite}</span>`;\r\n\t\t\t\treturn \"\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction renderLink(self, entry) {\r\n\t\t\tlet href;\r\n\t\t\tif (entry.href.type === \"internal\") {\r\n\t\t\t\t// baseURL is blank by default\r\n\t\t\t\thref = `${self.baseUrl}${entry.href.path}#`;\r\n\t\t\t\tif (entry.href.hash !== undefined) {\r\n\t\t\t\t\thref += entry.href.hash;\r\n\t\t\t\t\tif (entry.href.subhashes !== undefined) {\r\n\t\t\t\t\t\tfor (let i = 0; i < entry.href.subhashes.length; i++) {\r\n\t\t\t\t\t\t\tconst subHash = entry.href.subhashes[i];\r\n\t\t\t\t\t\t\thref += `,${encodeForHash(subHash.key)}:${encodeForHash(subHash.value)}`\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (entry.href.type === \"external\") {\r\n\t\t\t\thref = entry.href.url;\r\n\t\t\t}\r\n\t\t\ttextStack.push(`<a href='${href}'>${entry.text}</a>`);\r\n\t\t}\r\n\r\n\t\tfunction renderString(self) {\r\n\t\t\tconst tagSplit = splitByTags();\r\n\t\t\tfor (let i = 0; i < tagSplit.length; i++) {\r\n\t\t\t\tconst s = tagSplit[i];\r\n\t\t\t\tif (s === undefined || s === null || s === \"\") continue;\r\n\t\t\t\tif (s.charAt(0) === \"@\") {\r\n\t\t\t\t\tconst [tag, text] = splitFirstSpace(s);\r\n\r\n\t\t\t\t\tif (tag === \"@bold\" || tag === \"@b\" || tag === \"@italic\" || tag === \"@i\" || tag === \"@skill\" || tag === \"@action\") {\r\n\t\t\t\t\t\tswitch (tag) {\r\n\t\t\t\t\t\t\tcase \"@b\":\r\n\t\t\t\t\t\t\tcase \"@bold\":\r\n\t\t\t\t\t\t\t\ttextStack.push(`<b>`);\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(text, textStack, depth);\r\n\t\t\t\t\t\t\t\ttextStack.push(`</b>`);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@i\":\r\n\t\t\t\t\t\t\tcase \"@italic\":\r\n\t\t\t\t\t\t\t\ttextStack.push(`<i>`);\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(text, textStack, depth);\r\n\t\t\t\t\t\t\t\ttextStack.push(`</i>`);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@action\": // Convert this to a tag once the rules data are more navigable\r\n\t\t\t\t\t\t\t\ttextStack.push(`<span title=\"${Parser.actionToExplanation(text)}\" class=\"explanation\">${text}</span>`);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@skill\": // Convert this to a tag once the rules data are more navigable\r\n\t\t\t\t\t\t\t\ttextStack.push(`<span title=\"${Parser.skillToExplanation(text)}\" class=\"explanation\">${text}</span>`);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst [name, source, displayText, ...others] = text.split(\"|\");\r\n\t\t\t\t\t\tconst hash = `${name}${source ? `${HASH_LIST_SEP}${source}` : \"\"}`;\r\n\r\n\t\t\t\t\t\tconst fauxEntry = {\r\n\t\t\t\t\t\t\t\"type\": \"link\",\r\n\t\t\t\t\t\t\t\"href\": {\r\n\t\t\t\t\t\t\t\t\"type\": \"internal\",\r\n\t\t\t\t\t\t\t\t\"path\": \"\",\r\n\t\t\t\t\t\t\t\t\"hash\": encodeForHash(hash)\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\"text\": (displayText ? displayText : name)\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tswitch (tag) {\r\n\t\t\t\t\t\t\tcase \"@spell\":\r\n\t\t\t\t\t\t\t\tif (!source) fauxEntry.href.hash += HASH_LIST_SEP + SRC_PHB;\r\n\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/spells/\" + fauxEntry.href.hash;\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(fauxEntry, textStack, depth);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@item\":\r\n\t\t\t\t\t\t\t\tif (!source) fauxEntry.href.hash += HASH_LIST_SEP + SRC_DMG;\r\n\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/items/\" + fauxEntry.href.hash;\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(fauxEntry, textStack, depth);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@condition\":\r\n\t\t\t\t\t\t\t\tif (!source) fauxEntry.href.hash += HASH_LIST_SEP + SRC_PHB;\r\n\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/conditions/\" + fauxEntry.href.hash;\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(fauxEntry, textStack, depth);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@class\":\r\n\t\t\t\t\t\t\t\tconst classMatch = EntryRenderer.RE_INLINE_CLASS.exec(text);\r\n\t\t\t\t\t\t\t\tif (classMatch) {\r\n\t\t\t\t\t\t\t\t\tfauxEntry.href.hash = classMatch[1].trim(); // TODO pass this in\r\n\t\t\t\t\t\t\t\t\tfauxEntry.href.subhashes = [{\"key\": \"sub\", \"value\": classMatch[2].trim() + \"~phb\"}] // TODO pass this in\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (!source) fauxEntry.href.hash += HASH_LIST_SEP + SRC_PHB;\r\n\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/classes/\" + fauxEntry.href.hash;\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(fauxEntry, textStack, depth);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@creature\":\r\n\t\t\t\t\t\t\t\tif (!source) fauxEntry.href.hash += HASH_LIST_SEP + SRC_MM;\r\n\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/bestiary/\" + fauxEntry.href.hash;\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(fauxEntry, textStack, depth);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@filter\":\r\n\t\t\t\t\t\t\t\t// todo... maybe\r\n\t\t\t\t\t\t\t\ttextStack.push(name);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@damage\":\r\n\t\t\t\t\t\t\tcase \"@dice\":\r\n\t\t\t\t\t\t\t\t// todo\r\n\t\t\t\t\t\t\t\ttextStack.push(name);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@book\":\r\n\t\t\t\t\t\t\t\t//todo\r\n\t\t\t\t\t\t\t\ttextStack.push(name);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"@5etools\":\r\n\t\t\t\t\t\t\t\tif (source.indexOf(\".\") > -1) {\r\n\t\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/\" + source.substring(0, source.indexOf(\".\"))\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfauxEntry.href.hash = \"/\" + source;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tself.recursiveEntryRender(fauxEntry, textStack, depth);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttextStack.push(s);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction splitFirstSpace(string) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\tstring.substr(0, string.indexOf(' ')),\r\n\t\t\t\t\tstring.substr(string.indexOf(' ') + 1)\r\n\t\t\t\t]\r\n\t\t\t}\r\n\r\n\t\t\tfunction splitByTags() {\r\n\t\t\t\tlet tagDepth = 0;\r\n\t\t\t\tlet inTag = false;\r\n\t\t\t\tlet char, char2;\r\n\t\t\t\tconst out = [];\r\n\t\t\t\tlet curStr = \"\";\r\n\t\t\t\tfor (let i = 0; i < entry.length; ++i) {\r\n\t\t\t\t\tchar = entry.charAt(i);\r\n\t\t\t\t\tchar2 = i < entry.length-1 ? entry.charAt(i+1) : null;\r\n\r\n\t\t\t\t\tswitch (char) {\r\n\t\t\t\t\t\tcase \"{\":\r\n\t\t\t\t\t\t\tif (char2 === \"@\") {\r\n\t\t\t\t\t\t\t\tif (tagDepth++ > 0) {\r\n\t\t\t\t\t\t\t\t\tcurStr += char;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tout.push(curStr);\r\n\t\t\t\t\t\t\t\t\tinTag = false;\r\n\t\t\t\t\t\t\t\t\tcurStr = \"\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcurStr += char;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"}\":\r\n\t\t\t\t\t\t\tif (--tagDepth === 0) {\r\n\t\t\t\t\t\t\t\tout.push(curStr);\r\n\t\t\t\t\t\t\t\tcurStr = \"\";\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcurStr += char;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tcurStr += char;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (curStr.length > 0) out.push(curStr);\r\n\r\n\t\t\t\treturn out;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nEntryRenderer.getEntryDice = function (entry) {\r\n\t// TODO make droll integration optional\r\n\tlet toAdd;\r\n\tif (entry.number && entry.faces) {\r\n\t\ttoAdd = String(entry.number) + \"d\" + entry.faces;\r\n\t} else if (entry.toRoll && entry.toRoll.length) {\r\n\t\tfor (let roll of entry.toRoll) {\r\n\t\t\ttoAdd = String(roll.number) + \"d\" + roll.faces + \" + \"\r\n\t\t}\r\n\t\ttoAdd = toAdd.substring(0, toAdd.length - 3);\r\n\t}\r\n\tif (typeof droll !== \"undefined\" && entry.rollable === true) {\r\n\t\t// TODO output this somewhere nice\r\n\t\t// TODO make this less revolting\r\n\r\n\t\t// TODO output to small tooltip-stype bubble? Close on mouseout\r\n\t\treturn `<span class='roller unselectable' onclick=\"if (this.rolled) { this.innerHTML = this.innerHTML.split('=')[0].trim()+' = '+droll.roll('${toAdd}').total; } else { this.rolled = true; this.innerHTML += ' = '+droll.roll('${toAdd}').total; }\">${toAdd}</span>`;\r\n\t} else {\r\n\t\treturn toAdd;\r\n\t}\r\n};\r\n\r\nEntryRenderer.RE_INLINE_CLASS = /(.*?) \\((.*?)\\)/;\r\nEntryRenderer.HEAD_NEG_1 = \"statsBlockSectionHead\";\r\nEntryRenderer.HEAD_0 = \"statsBlockHead\";\r\nEntryRenderer.HEAD_1 = \"statsBlockSubHead\";\r\nEntryRenderer.HEAD_2 = \"statsInlineHead\";\r\nEntryRenderer.DATA_NONE = \"data-none\";\r\n\r\nexport default EntryRenderer;","const HASH_SUBCLASS = \"sub:\";\r\nconst HASH_FEATURE = \"f:\";\r\nconst HASH_HIDE_FEATURES = \"hideclassfs:\";\r\nconst HASH_ALL_SOURCES = \"allsrc:\";\r\n\r\nconst CLSS_FEATURE_LINK = \"feature-link\";\r\nconst CLSS_ACTIVE = \"mdc-chip--selected\";\r\nconst CLSS_SUBCLASS_PILL = \"mdc-chip\";\r\nconst CLSS_CLASS_FEATURES_ACTIVE = \"cf-active\";\r\nconst CLSS_OTHER_SOURCES_ACTIVE = \"os-active\";\r\nconst CLSS_SUBCLASS_PREFIX = \"subclass-prefix\";\r\nconst CLSS_CLASS_FEATURE = \"class-feature\";\r\nconst CLSS_GAIN_SUBCLASS_FEATURE = \"gain-subclass-feature\";\r\nconst ID_CLASS_FEATURES_TOGGLE = \"cf-toggle\";\r\nconst ID_OTHER_SOURCES_TOGGLE = \"os-toggle\";\r\n\r\nconst STR_PROF_NONE = \"none\";\r\n\r\nconst ATB_DATA_FEATURE_LINK = \"data-flink\";\r\nconst ATB_DATA_FEATURE_ID = \"data-flink-id\";\r\nconst ATB_DATA_SC_LIST = \"data-subclass-list\";\r\n\r\nimport {\r\n  jqHeight,\r\n  parseHTML,\r\n  ascSort,\r\n  encodeForHash,\r\n  jqAfter,\r\n  jqEmpty,\r\n  isNonstandardSource,\r\n  joinConjunct,\r\n  hasBeenReprinted\r\n} from \"../js/utils.js\";\r\nimport {\r\n  HASH_LIST_SEP,\r\n  HASH_PART_SEP,\r\n  CLSS_SUBCLASS_FEATURE,\r\n  ATB_DATA_SC,\r\n  ATB_DATA_SRC,\r\n  CLSS_NON_STANDARD_SOURCE,\r\n  ATB_DATA_PART_SEP,\r\n  ATB_DATA_LIST_SEP,\r\n  HASH_START\r\n} from \"../util/consts.js\";\r\nimport EntryRenderer from '../util/entryrender.js';\r\nimport Parser from '../util/Parser.js';\r\nimport { setRouteSelection, readRouteSelection } from \"../util/routing.js\";\r\nimport renderGrid from \"../util/renderGrid.js\";\r\nimport renderList from \"../util/renderList.js\";\r\n\r\nconst renderer = new EntryRenderer();\r\nexport { onDataLoad, onClassChange, onSubChange };\r\n\r\nfunction renderStr(string) {\r\n  let renderStack = []\r\n  renderer.recursiveEntryRender(string, renderStack, 0);\r\n  return renderStack.join(\" \");\r\n}\r\n\r\nfunction onDataLoad(classes, rootEl) {\r\n\t// alphabetically sort subclasses\r\n\tfor (const c of classes) {\r\n    if (c.subclasses) {\r\n      c.subclasses = c.subclasses.sort((a, b) => ascSort(a.name, b.name));\r\n    }\r\n\t}\r\n\r\n  // store classTable template from inital dom\r\n  window.classTableDefault = rootEl.querySelector(\"#classtable\").innerHTML;\r\n  \r\n  renderList(rootEl, classes);\r\n}\r\n\r\nfunction onClassChange(curClass, rootEl) {\r\n  rootEl.querySelector(\"#classtable\").innerHTML = window.classTableDefault;\r\n  rootEl.querySelector(\"#subclasses\").classList.remove(\"fixed\");\r\n  rootEl.querySelector(\"#subclasses\").classList.remove(\"closed\");\r\n  rootEl.querySelector(\"#subclasses\").classList.remove(\"hidden\");\r\n  rootEl.querySelector(\".mobile-clone-spells\") && rootEl.querySelector(\".mobile-clone-spells\").remove();\r\n\r\n  // SUMMARY SIDEBAR =================================================================================================\r\n  // hit dice and HP\r\n  if (curClass.hd) {\r\n    rootEl.querySelector(\"#hp\").classList.remove(\"hidden\");\r\n    rootEl.querySelector(\"#hp div#hitdice span\").innerHTML = EntryRenderer.getEntryDice(curClass.hd);\r\n    rootEl.querySelector(\"#hp div#hp1stlevel span\").innerHTML = curClass.hd.faces + \" + your Constitution modifier\";\r\n    rootEl.querySelector(\"#hp div#hphigherlevels span\").innerHTML =\r\n      `${EntryRenderer.getEntryDice(curClass.hd)} (or ${curClass.hd.faces / 2 + 1}) + your Constitution modifier per ${\r\n        curClass.name\r\n      } level after 1st`;\r\n  } else {\r\n    rootEl.querySelector(\"#hp\").classList.add(\"hidden\");\r\n  }\r\n\r\n  // save proficiency\r\n  if (curClass.proficiency) {\r\n    rootEl.querySelector(\"#prof\").classList.remove(\"hidden\");\r\n    rootEl.querySelector(\"#prof div#saves span\").innerHTML = curClass.proficiency.map(p => Parser.attAbvToFull(p)).join(\", \");\r\n  } else {\r\n    rootEl.querySelector(\"#prof\").classList.add(\"hidden\");\r\n  }\r\n\r\n  // starting proficiencies\r\n  const sProfs = curClass.startingProficiencies;\r\n  if (sProfs) {\r\n    rootEl.querySelector(\"#armor\").classList.remove(\"hidden\");\r\n    rootEl.querySelector(\"#weapons\").classList.remove(\"hidden\");\r\n    rootEl.querySelector(\"#tools\").classList.remove(\"hidden\");\r\n    rootEl.querySelector(\"#skills\").classList.remove(\"hidden\");\r\n    rootEl.querySelector(\"div#armor span\").innerHTML =\r\n      sProfs.armor === undefined\r\n        ? STR_PROF_NONE\r\n        : sProfs.armor.map(a => (a === \"light\" || a === \"medium\" || a === \"heavy\" ? a + \" armor\" : a)).join(\", \");\r\n    rootEl.querySelector(\"div#weapons span\").innerHTML =\r\n      sProfs.weapons === undefined\r\n        ? STR_PROF_NONE\r\n        : sProfs.weapons.map(w => (w === \"simple\" || w === \"martial\" ? w + \" weapons\" : w)).join(\", \");\r\n    rootEl.querySelector(\"div#tools span\").innerHTML =\r\n      sProfs.tools === undefined ? STR_PROF_NONE : sProfs.tools.join(\", \");\r\n    rootEl.querySelector(\"div#skills span\").innerHTML =\r\n      sProfs.skills === undefined ? STR_PROF_NONE : getSkillProfString(sProfs.skills);\r\n  } else {\r\n    rootEl.querySelector(\"#armor\").classList.add(\"hidden\");\r\n    rootEl.querySelector(\"#weapons\").classList.add(\"hidden\");\r\n    rootEl.querySelector(\"#tools\").classList.add(\"hidden\");\r\n    rootEl.querySelector(\"#skills\").classList.add(\"hidden\");\r\n  }\r\n\r\n  function getSkillProfString(skills) {\r\n    let numString, skillOptions, result = '';\r\n    // Different data structure for v2 classes\r\n    if (Array.isArray(skills)) {\r\n      for (let skill of skills) {\r\n        if (skill.choose) {\r\n          numString = Parser.numberToString(skill.choose.count);\r\n          skillOptions = skill.choose.from;\r\n          result += skillOptions.length === 18\r\n            ? `Choose any ${numString}.`\r\n            : `Choose ${numString} from ${joinConjunct(skillOptions, \", \", \", and \")}.`;\r\n        }\r\n      }\r\n    } else {\r\n      numString = Parser.numberToString(skills.choose);\r\n      skillOptions = skills.from;\r\n      result += skillOptions.length === 18\r\n        ? `Choose any ${numString}.`\r\n        : `Choose ${numString} from ${joinConjunct(skillOptions, \", \", \", and \")}.`;\r\n    }\r\n    return result;\r\n  }\r\n\r\n  // starting equipment\r\n  const sEquip = curClass.startingEquipment;\r\n  if (sEquip) {\r\n    rootEl.querySelector(\"#equipment\").classList.remove(\"hidden\");\r\n    const fromBackground = sEquip.additionalFromBackground\r\n      ? \"<p>You start with the following items, plus anything provided by your background.</p>\"\r\n      : \"\";\r\n    const defList = sEquip.default.length === 0 ? \"\" : `<ul><li>${sEquip.default.map(i => renderStr(i)).join(\"</li><li>\")}</ul>`;\r\n    const goldAlt =\r\n      sEquip.goldAlternative === undefined\r\n        ? \"\"\r\n        : `<p>Alternatively, you may start with ${renderStr(sEquip.goldAlternative)} gp to buy your own equipment.</p>`;\r\n    rootEl.querySelector(\"#equipment div\").innerHTML = `${fromBackground}${defList}${goldAlt}`;\r\n  } else {\r\n    rootEl.querySelector(\"#equipment\").classList.add(\"hidden\");\r\n  }\r\n\r\n  // FEATURE TABLE ===================================================================================================\r\n  let tData = curClass.classTableGroups || [];\r\n  const groupHeaders = rootEl.querySelector(\"#groupHeaders\");\r\n  const colHeaders = rootEl.querySelector(\"#colHeaders\");\r\n  const levelTrs = [];\r\n  let spellsFlag = false;\r\n  for (let subclassDef of curClass.subclasses) {\r\n    if (subclassDef.subclassTableGroups) {\r\n      tData = tData.concat(subclassDef.subclassTableGroups);\r\n    }\r\n  }\r\n  if (tData) {\r\n    for (let i = 0; i < tData.length; i++) {\r\n      const tGroup = tData[i];\r\n\r\n      const hasTitle = tGroup.title !== undefined;\r\n      let subclassData = \"\";\r\n      if (tGroup.subclasses !== undefined) {\r\n        subclassData = `${ATB_DATA_SC_LIST}=\"${tGroup.subclasses\r\n          .map(s => s.name+ATB_DATA_PART_SEP+s.source)\r\n          .join(ATB_DATA_LIST_SEP)}\"`;\r\n      }\r\n      groupHeaders.append(parseHTML(\r\n        `<th ${hasTitle ? `class=\"colGroupTitle table-cell\"` : \"\"} colspan=\"${tGroup.colLabels.length}\" ${subclassData}>${\r\n          hasTitle ? tGroup.title : \"\"\r\n        }</th>`, true, true));\r\n\r\n      for (let j = 0; j < tGroup.colLabels.length; j++) {\r\n        let lbl = tGroup.colLabels[j];\r\n        if (lbl.indexOf(\"@\") > -1) {\r\n          let renderStack = []\r\n          renderer.recursiveEntryRender(lbl, renderStack, 0);\r\n          lbl = renderStack.join(\" \");\r\n        }\r\n        colHeaders.append(parseHTML(`<th class=\"centred-col table-cell\" ${subclassData}>${lbl}</th>`, true, true));\r\n      }\r\n\r\n      for (let j = 0; j < 20; j++) {\r\n        const tr = rootEl.querySelector(`#level${j + 1}`);\r\n        levelTrs[j] = tr;\r\n        for (let k = 0; k < tGroup.rows[j].length; k++) {\r\n          let entry = tGroup.rows[j][k];\r\n          if (entry === 0) entry = \"\\u2014\";\r\n          const stack = [];\r\n          renderer.recursiveEntryRender(entry, stack, \"\", \"\");\r\n          tr.append(parseHTML(`<td class=\"centred-col\" ${subclassData}>${stack.join(\"\")}</td>`, true, true));\r\n        }\r\n      }\r\n      let combinedLabels = tGroup.colLabels.join(' ');\r\n      if (\r\n        !spellsFlag &&\r\n        (combinedLabels.indexOf(\"Spells Known\") > -1 ||\r\n          combinedLabels.indexOf(\"Cantrips Known\") > -1 ||\r\n          combinedLabels.indexOf(\"1st\") > -1 ||\r\n          combinedLabels.indexOf(\"Ki Points\") > -1 ||\r\n          combinedLabels.indexOf(\"Rages\") > -1 ||\r\n          combinedLabels.indexOf(\"Talents Known\") > -1)\r\n      ) {\r\n        spellsFlag = true;\r\n      }\r\n    }\r\n  // uses different data structure for Fighter, since no classTableGroups\r\n  } else if (curClass.classFeatures.length) {\r\n    // for each level, find and index the feature cell\r\n    for (let i = 0; i < 20; i++) {\r\n      const tr = rootEl.querySelector(`#level${i + 1}`);\r\n      levelTrs[i] = tr;\r\n    }\r\n  }\r\n\r\n  rootEl.querySelector(\"#classtable\").classList.remove(\"mobile-clone-features\");\r\n  \r\n  // Add second feature table for mobile\r\n  if (spellsFlag) {\r\n    rootEl.querySelector(\"#classtable\").classList.add(\"mobile-clone-features\");\r\n\t\tlet mobileClone = parseHTML('<div class=\"mobile-clone-spells\"></div>');\r\n\t\tmobileClone.append(rootEl.querySelector(\"#classtable\").cloneNode(true));\r\n    mobileClone.querySelector(\"#classtable\").classList.remove(\"mobile-clone-features\");\r\n    mobileClone.querySelector(\"#groupHeaders th:not(.colGroupTitle)\").remove();\r\n    mobileClone.querySelector(\"#groupHeaders .colGroupTitle\") &&\r\n      mobileClone.querySelector(\"#groupHeaders .colGroupTitle\").setAttribute(\"colspan\", \"12\");\r\n\t\tlet colHeaderEls = mobileClone.querySelectorAll(\"#colHeaders th\");\r\n\t\tfor (let colHeaderEl of colHeaderEls) {\r\n      if (colHeaderEl.textContent.toLowerCase().indexOf(\"sneak attack\") > -1) {\r\n        colHeaderEl.innerHTML = '<span title=\"Sneak Attack\">Snk Atk</span>';\r\n      } else if (colHeaderEl.textContent.toLowerCase().indexOf(\"sorcery points\") > -1) {\r\n        colHeaderEl.innerHTML = '<span title=\"Sorcery Points\">SP</span>';\r\n      } else if (colHeaderEl.textContent.toLowerCase().indexOf(\"spells known\") > -1) {\r\n        colHeaderEl.innerHTML = '<span title=\"Spells Known\">S</span>';\r\n      } else if (colHeaderEl.textContent.toLowerCase().indexOf(\"cantrips known\") > -1) {\r\n        colHeaderEl.innerHTML = '<span title=\"Cantrips Known\">C</span>';\r\n      }\r\n\t\t}\r\n    jqAfter(rootEl.querySelector(\"#classtable\"), mobileClone);\r\n  }\r\n\r\n  // FEATURE DESCRIPTIONS ============================================================================================\r\n  const renderStack = [];\r\n  let subclassIndex = 0; // the subclass array is not 20 elements\r\n  for (let i = 0; i < 20; i++) {\r\n    // track class table feature names\r\n    const tblLvlFeatures = levelTrs[i].querySelector(\".features\");\r\n    const featureNames = [];\r\n\r\n    // add class features to render stack\r\n    const lvlFeatureList = curClass.classFeatures[i];\r\n    for (let j = 0; j < lvlFeatureList.length; j++) {\r\n      const feature = lvlFeatureList[j];\r\n      const featureId = HASH_FEATURE + encodeForHash(feature.name) + \"_\" + i;\r\n\r\n      const featureLinkPart = HASH_FEATURE + encodeForHash(feature.name) + i;\r\n      const featureLinkClasses = [CLSS_FEATURE_LINK];\r\n      if (isNonstandardSource(feature.source)) featureLinkClasses.push(CLSS_NON_STANDARD_SOURCE);\r\n      const featureLink = parseHTML(\r\n        `<a href=\"#${encodeForHash(curClass.name, curClass.source)}${HASH_PART_SEP}${featureLinkPart}\"\r\n          class=\"${featureLinkClasses.join(\" \")}\"\r\n          ${ATB_DATA_FEATURE_LINK}=\"${featureLinkPart}\"\r\n          ${ATB_DATA_FEATURE_ID}=\"${featureId}\">${feature.name}</a>`\r\n      );\r\n      featureLink.addEventListener(\"click\", function(e) {\r\n        e.preventDefault();\r\n        rootEl.getElementById(featureId).scrollIntoView(true);\r\n        let offset = -84 - jqHeight(rootEl.querySelector(\"#subclasses\"));\r\n        window.scrollBy(0, offset);\r\n      });\r\n      featureNames.push(featureLink);\r\n\r\n      const styleClasses = [CLSS_CLASS_FEATURE];\r\n      if (feature.gainSubclassFeature) styleClasses.push(CLSS_GAIN_SUBCLASS_FEATURE);\r\n\r\n      renderer.recursiveEntryRender(\r\n        feature,\r\n        renderStack,\r\n        0,\r\n        `<div id=\"${featureId}\" class=\"${styleClasses.join(\" \")}\">`,\r\n        `</div>`,\r\n        true\r\n      );\r\n\r\n      // add subclass features to render stack if appropriate\r\n      if (feature.gainSubclassFeature) {\r\n        for (let k = 0; k < curClass.subclasses.length; k++) {\r\n          const subClass = curClass.subclasses[k];\r\n          for (let l = 0; l < subClass.subclassFeatures[subclassIndex].length; l++) {\r\n            const subFeature = subClass.subclassFeatures[subclassIndex][l];\r\n\r\n            // if this is not the subclass intro, add the subclass to the feature name\r\n            // this will only be shown if there are multiple subclasses displayed\r\n            if (subFeature.name === undefined) {\r\n              for (let m = 0; m < subFeature.entries.length; m++) {\r\n                const childEntry = subFeature.entries[m];\r\n                if (\r\n                  childEntry.name !== undefined &&\r\n                  !childEntry.name.startsWith(`<span class=\"${CLSS_SUBCLASS_PREFIX}\">`)\r\n                ) {\r\n                  childEntry.name = `<span class=\"${CLSS_SUBCLASS_PREFIX}\">${subClass.name}: </span>${childEntry.name}`;\r\n                }\r\n              }\r\n            }\r\n\r\n            const styleClasses = [CLSS_SUBCLASS_FEATURE];\r\n            const hideSource =\r\n              isNonstandardSource(subClass.source) || hasBeenReprinted(subClass.shortName, subClass.source);\r\n            if (hideSource) styleClasses.push(CLSS_NON_STANDARD_SOURCE);\r\n            renderer.recursiveEntryRender(\r\n              subFeature,\r\n              renderStack,\r\n              0,\r\n              `<div class=\"${styleClasses.join(\" \")}\" ${ATB_DATA_SC}=\"${subClass.name}\" ${ATB_DATA_SRC}=\"${\r\n                subClass.source\r\n              }\">`,\r\n              `</div>`,\r\n              true\r\n            );\r\n          }\r\n        }\r\n        subclassIndex++;\r\n      }\r\n    }\r\n\r\n    // render class table feature names\r\n    if (featureNames.length === 0) tblLvlFeatures.innerHTML = \"\\u2014\";\r\n    else {\r\n      for (let j = 0; j < featureNames.length; j++) {\r\n        tblLvlFeatures.append(featureNames[j]);\r\n      }\r\n    }\r\n  }\r\n  rootEl.querySelector(\"#stats\").innerHTML = renderStack.join(\"\");\r\n\r\n  // show UA/other features by default\r\n  toggleUAFeatures(true);\r\n\r\n  // CLASS FEATURE/UA/SUBCLASS PILL BUTTONS ==========================================================================\r\n  let subclassPillWrapper = rootEl.querySelector(\"div#subclasses\");\r\n  // remove any from previous class\r\n  jqEmpty(subclassPillWrapper);\r\n  subclassPillWrapper.append(parseHTML(`<div class='title'>Subclasses</div>`));\r\n  subclassPillWrapper.append(parseHTML(`<div class='subclass-wrapper'></div>`));\r\n  subclassPillWrapper = subclassPillWrapper.querySelector('.subclass-wrapper');\r\n\r\n  // show/hide UA/other sources\r\n  const allSourcesToggle = makeGenericTogglePill(\r\n    \"Show UA\",\r\n    CLSS_OTHER_SOURCES_ACTIVE,\r\n    ID_OTHER_SOURCES_TOGGLE,\r\n    HASH_ALL_SOURCES,\r\n    false,\r\n    true\r\n  );\r\n\r\n  // show/hide class features pill\r\n  makeGenericTogglePill(\r\n    \"Class Features\",\r\n    CLSS_CLASS_FEATURES_ACTIVE,\r\n    ID_CLASS_FEATURES_TOGGLE,\r\n    HASH_HIDE_FEATURES,\r\n    true\r\n  );\r\n\r\n  // subclass pills\r\n  if (curClass.subclasses) {\r\n    const subClasses = curClass.subclasses\r\n      .map(sc => ({ name: sc.name, source: sc.source, shortName: sc.shortName }))\r\n      .sort(function(a, b) {\r\n        return ascSort(a.shortName, b.shortName);\r\n      });\r\n    for (let i = 0; i < subClasses.length; i++) {\r\n      const nonStandardSource =\r\n        isNonstandardSource(subClasses[i].source) || hasBeenReprinted(subClasses[i].shortName, subClasses[i].source);\r\n      const styleClasses = [CLSS_ACTIVE, CLSS_SUBCLASS_PILL];\r\n      if (nonStandardSource) styleClasses.push(CLSS_NON_STANDARD_SOURCE);\r\n      const pillText = hasBeenReprinted(subClasses[i].shortName, subClasses[i].source)\r\n        ? `${subClasses[i].shortName} (${Parser.sourceJsonToAbv(subClasses[i].source)})`\r\n        : subClasses[i].shortName;\r\n      const pill = parseHTML(\r\n        `<div class=\"${styleClasses.join(\" \")}\" ${ATB_DATA_SC}=\"${subClasses[i].name}\" ${ATB_DATA_SRC}=\"${\r\n          subClasses[i].source\r\n        }\" title=\"Source: ${Parser.sourceJsonToFull(\r\n          subClasses[i].source\r\n        )}\"><span class='mdc-chip__text'>${pillText}</span></div>`\r\n      );\r\n      pill.addEventListener(\"click\", function() {\r\n        handleSubclassClick(pill.classList.contains(CLSS_ACTIVE), subClasses[i].name, subClasses[i].source);\r\n      });\r\n      if (nonStandardSource) pill.style.display = 'none';\r\n      subclassPillWrapper.append(pill);\r\n    }\r\n    subclassPillWrapper.append(parseHTML(`<div class='tab material-icons'>expand_less</div>`));\r\n\r\n    rootEl.querySelector(\"#subclasses .tab\").addEventListener(\"click\", () => {\r\n      rootEl.querySelector(\"#subclasses\").classList.toggle(\"closed\");\r\n    });\r\n\r\n    // if this is a UA class, toggle the \"All Sources\" button\r\n    const showUA = readRouteSelection().indexOf(HASH_ALL_SOURCES + 'true') > -1 || readRouteSelection().indexOf(HASH_ALL_SOURCES + 'false') === -1\r\n    if (showUA) {\r\n      allSourcesToggle.click();\r\n    }\r\n  } else {\r\n    rootEl.querySelector(\"#subclasses\").classList.add(\"hidden\");\r\n  }\r\n\r\n  // helper functions\r\n  function makeGenericTogglePill(pillText, pillActiveClass, pillId, hashKey, defaultActive, isUA) {\r\n    const pill = parseHTML(`<div id=\"${pillId}\" class=\"mdc-chip\"><span class=\"mdc-chip__text\">${pillText}</span></div>`);\r\n    subclassPillWrapper.append(pill);\r\n    pill.addEventListener(\"click\", function() {\r\n      let active = pill.classList.contains(pillActiveClass);\r\n      if (!defaultActive) active = !active;\r\n      handleToggleFeaturesClicks(active);\r\n      // enable UA features\r\n      if (isUA) {\r\n        toggleUAFeatures(active);\r\n        pill.querySelector('.mdc-chip__text').innerHTML = active ? \"Hide UA\" : \"Show UA\";\r\n      }\r\n    });\r\n    return pill;\r\n\r\n    function handleToggleFeaturesClicks(isPillActive) {\r\n      const outStack = [];\r\n      const split = readRouteSelection().split(HASH_PART_SEP);\r\n\r\n      for (let i = 0; i < split.length; i++) {\r\n        const hashPart = split[i];\r\n        if (!hashPart.startsWith(hashKey)) outStack.push(hashPart);\r\n      }\r\n      if (isPillActive) {\r\n        outStack.push(hashKey + \"true\");\r\n      } else {\r\n        outStack.push(hashKey + \"false\");\r\n      }\r\n      const newHash = outStack.join(HASH_PART_SEP);\r\n      setRouteSelection(newHash, true);\r\n    }\r\n  }\r\n\r\n  function handleSubclassClick(isPillActive, subclassName, subclassSource) {\r\n    const outStack = [];\r\n    const routeSelection = readRouteSelection();\r\n    const split = routeSelection.split(HASH_PART_SEP);\r\n\r\n    const encodedSubClass = encodeForHash(subclassName, subclassSource);\r\n    const subclassLink = HASH_SUBCLASS + encodedSubClass;\r\n\r\n    if (isPillActive && routeSelection.includes(HASH_SUBCLASS)) {\r\n      for (let i = 0; i < split.length; i++) {\r\n        const hashPart = split[i];\r\n        if (!hashPart.startsWith(HASH_SUBCLASS)) {\r\n\t\t\t\t\toutStack.push(hashPart);\r\n\t\t\t\t} else {\r\n          const subClassStack = [];\r\n          const subClasses = hashPart.substr(HASH_SUBCLASS.length).split(HASH_LIST_SEP);\r\n          for (let j = 0; j < subClasses.length; j++) {\r\n            const subClass = subClasses[j];\r\n            if (subClass !== encodedSubClass) subClassStack.push(subClass);\r\n          }\r\n          if (subClassStack.length > 0) outStack.push(HASH_SUBCLASS + subClassStack.join(HASH_LIST_SEP));\r\n        }\r\n      }\r\n    } else {\r\n      let hasSubclassHash = false;\r\n\r\n      for (let i = 0; i < split.length; i++) {\r\n        const hashPart = split[i];\r\n        if (!hashPart.startsWith(HASH_SUBCLASS)) outStack.push(hashPart);\r\n        else {\r\n          const subClassStack = [];\r\n          const subClasses = hashPart.substr(HASH_SUBCLASS.length).split(HASH_LIST_SEP);\r\n          for (let j = 0; j < subClasses.length; j++) {\r\n            const subClass = subClasses[j];\r\n            if (subClass !== encodedSubClass) subClassStack.push(subClass);\r\n          }\r\n          subClassStack.push(encodedSubClass);\r\n          if (subClassStack.length > 0) outStack.push(HASH_SUBCLASS + subClassStack.join(HASH_LIST_SEP));\r\n\r\n          hasSubclassHash = true;\r\n        }\r\n      }\r\n\r\n      if (!hasSubclassHash) outStack.push(subclassLink);\r\n    }\r\n    const newHash = outStack.join(HASH_PART_SEP);\r\n    setRouteSelection(newHash, true);\r\n  }\r\n\r\n  function toggleUAFeatures(active) {\r\n    let nonStandardPills = rootEl.querySelectorAll(`.${CLSS_NON_STANDARD_SOURCE}`);\r\n    for (let nonStandardPill of nonStandardPills) {\r\n      if (!nonStandardPill.classList.contains(CLSS_SUBCLASS_PILL)) {\r\n        nonStandardPill.style.display = active ? null : 'none';\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction onSubChange(sub, curHash, rootEl) {\r\n\tlet subclasses = null;\r\n\tlet feature = null;\r\n\tlet hideClassFeatures = null;\r\n\tlet showAllSources = null;\r\n\r\n\tfor (let i = 0; i < sub.length; i++) {\r\n\t\tconst hashPart = sub[i];\r\n\r\n\t\tif (hashPart.startsWith(HASH_SUBCLASS)) subclasses = hashPart.slice(HASH_SUBCLASS.length).split(HASH_LIST_SEP);\r\n\t\tif (hashPart.startsWith(HASH_FEATURE)) feature = hashPart;\r\n\t\tif (hashPart.startsWith(HASH_HIDE_FEATURES)) hideClassFeatures = hashPart.slice(HASH_HIDE_FEATURES.length) === \"true\";\r\n\t\tif (hashPart.startsWith(HASH_ALL_SOURCES)) showAllSources = hashPart.slice(HASH_ALL_SOURCES.length) === \"true\";\r\n\t}\r\n\r\n\tconst hideOtherSources = showAllSources === null || showAllSources === false;\r\n\r\n\tif (subclasses !== null) {\r\n\t\tupdateClassTableLinks();\r\n\r\n\t\tconst $toShow = [];\r\n\t\tconst $toHide = [];\r\n\t\tconst $subClassSpanList = rootEl.querySelectorAll(`.${CLSS_SUBCLASS_PILL}`);\r\n\t\tfor (let classSpan of $subClassSpanList) {\r\n\t\t\tconst $this = classSpan;\r\n\t\t\tconst thisSc = encodeForHash($this.getAttribute(ATB_DATA_SC), $this.getAttribute(ATB_DATA_SRC));\r\n\t\t\tlet shown = false;\r\n\r\n\t\t\tfor (let j = 0; j < subclasses.length; j++) {\r\n\t\t\t\tconst sc = subclasses[j];\r\n\t\t\t\tif (sc.trim() === thisSc) {\r\n\t\t\t\t\tshown = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (shown) {\r\n\t\t\t\t$toShow.push($this);\r\n\t\t\t} else {\r\n\t\t\t\t$toHide.push($this);\r\n\t\t\t}\r\n\t\t}\r\n\r\n    const otherSrcSubFeats = rootEl.querySelectorAll(`p.${CLSS_NON_STANDARD_SOURCE}`);\r\n    const shownInTable = [];\r\n\r\n    for (let v of $toShow) {\r\n      v.classList.add(CLSS_ACTIVE);\r\n      let selectedSCFeatures = rootEl.querySelectorAll(`.${CLSS_SUBCLASS_FEATURE}[${ATB_DATA_SC}=\"${v.getAttribute(ATB_DATA_SC)}\"][${ATB_DATA_SRC}=\"${v.getAttribute(ATB_DATA_SRC)}\"]`);\r\n      for (let selectedSCFeature of selectedSCFeatures) {\r\n        selectedSCFeature.style.display = null;\r\n      }\r\n      if (hideOtherSources) {\r\n        for (let otherSrcSubFeat of otherSrcSubFeats) {\r\n          if (\r\n            otherSrcSubFeat.getAttribute(ATB_DATA_SC) === v.getAttribute(ATB_DATA_SC) &&\r\n            otherSrcSubFeat.getAttribute(ATB_DATA_SRC) === v.getAttribute(ATB_DATA_SRC)\r\n          ) {\r\n            otherSrcSubFeat.style.display = \"none\";\r\n          }\r\n        }\r\n      } else {\r\n        for (let otherSrcSubFeat of otherSrcSubFeats) {\r\n          if (\r\n            otherSrcSubFeat.getAttribute(ATB_DATA_SC) === v.getAttribute(ATB_DATA_SC) &&\r\n            otherSrcSubFeat.getAttribute(ATB_DATA_SRC) === v.getAttribute(ATB_DATA_SRC)\r\n          ) {\r\n            otherSrcSubFeat.style.display = null;\r\n          }\r\n        }\r\n      }\r\n\r\n      const asInTable = v.getAttribute(ATB_DATA_SC) + ATB_DATA_PART_SEP + v.getAttribute(ATB_DATA_SRC);\r\n      shownInTable.push(asInTable);\r\n    }\r\n\r\n    for (let v of $toHide) {\r\n      v.classList.remove(CLSS_ACTIVE);\r\n      let selectedSCFeatures = rootEl.querySelectorAll(`.${CLSS_SUBCLASS_FEATURE}[${ATB_DATA_SC}=\"${v.getAttribute(ATB_DATA_SC)}\"][${ATB_DATA_SRC}=\"${v.getAttribute(ATB_DATA_SRC)}\"]`);\r\n      for (let selectedSCFeature of selectedSCFeatures) {\r\n        selectedSCFeature.style.display = 'none';\r\n      }\r\n      for (let otherSrcSubFeat of otherSrcSubFeats) {\r\n        if (\r\n          otherSrcSubFeat.getAttribute(ATB_DATA_SC) === v.getAttribute(ATB_DATA_SC) &&\r\n          otherSrcSubFeat.getAttribute(ATB_DATA_SRC) === v.getAttribute(ATB_DATA_SRC)\r\n        ) {\r\n          otherSrcSubFeat.style.display = \"none\";\r\n        }\r\n      }\r\n      v.getAttribute(ATB_DATA_SC);\r\n    }\r\n    \r\n    handleTableGroups(shownInTable);\r\n\r\n    if (hideOtherSources) {\r\n      for (let otherSrcSubFeat of otherSrcSubFeats) {\r\n        if (\r\n          !otherSrcSubFeat.classList.contains(CLSS_SUBCLASS_FEATURE) &&\r\n          otherSrcSubFeat.getAttribute(ATB_DATA_SC) === EntryRenderer.DATA_NONE &&\r\n          otherSrcSubFeat.getAttribute(ATB_DATA_SRC) === EntryRenderer.DATA_NONE\r\n        ) {\r\n          otherSrcSubFeat.style.display = \"none\";\r\n        }\r\n      }\r\n    } else {\r\n      for (let otherSrcSubFeat of otherSrcSubFeats) {\r\n        if (\r\n          !otherSrcSubFeat.classList.contains(CLSS_SUBCLASS_FEATURE) &&\r\n          otherSrcSubFeat.getAttribute(ATB_DATA_SC) === EntryRenderer.DATA_NONE &&\r\n          otherSrcSubFeat.getAttribute(ATB_DATA_SRC) === EntryRenderer.DATA_NONE\r\n        ) {\r\n          otherSrcSubFeat.style.display = null;\r\n        }\r\n      }\r\n    }\r\n\r\n\t\t// show subclass prefixes if we're displaying more than 1 subclass\r\n\t\tlet subClassEls = rootEl.querySelectorAll(`.${CLSS_SUBCLASS_PREFIX}`);\r\n\t\tif ($toShow.length !== 1) {\r\n\t\t\tfor (let subClassEl of subClassEls) {\r\n\t\t\t\tsubClassEl.style.display = null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (let subClassEl of subClassEls) {\r\n\t\t\t\tsubClassEl.style.display = 'none';\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// hide class features as required\r\n\tconst cfToggle = rootEl.querySelector(`#${ID_CLASS_FEATURES_TOGGLE}`);\r\n\tconst toToggleCf= rootEl.querySelectorAll(`.${CLSS_CLASS_FEATURE}`);\r\n\tif (hideClassFeatures !== null && hideClassFeatures) {\r\n\t\tcfToggle.classList.remove(CLSS_CLASS_FEATURES_ACTIVE);\r\n\t\tfor (let el of toToggleCf) {\r\n\t\t\tif (!el.classList.contains(CLSS_GAIN_SUBCLASS_FEATURE)) {\r\n        el.style.display = \"none\";\r\n      }\r\n\t\t}\r\n\t} else {\r\n\t\tcfToggle.classList.add(CLSS_CLASS_FEATURES_ACTIVE);\r\n\t\tfor (let el of toToggleCf) {\r\n\t\t\tif (!el.classList.contains(CLSS_GAIN_SUBCLASS_FEATURE)) {\r\n        el.style.display = null;\r\n      }\r\n\t\t}\r\n\t}\r\n\r\n\t// show UA/etc content as required\r\n\tconst srcToggle = rootEl.querySelector(`#${ID_OTHER_SOURCES_TOGGLE}`);\r\n\tconst toToggleSrc = rootEl.querySelectorAll(`.${CLSS_SUBCLASS_PILL}.${CLSS_NON_STANDARD_SOURCE}`);\r\n\tif (hideOtherSources) {\r\n\t\tsrcToggle.classList.remove(CLSS_OTHER_SOURCES_ACTIVE);\r\n\t\tfor (let el of toToggleSrc) {\r\n\t\t\tel.style.display = \"none\";\r\n\t\t}\r\n\t} else {\r\n\t\tsrcToggle.classList.add(CLSS_OTHER_SOURCES_ACTIVE);\r\n\t\tfor (let el of toToggleSrc) {\r\n\t\t\tel.style.display = null;\r\n\t\t}\r\n\t}\r\n\r\n\t// scroll to the linked feature if required\r\n\tif (feature !== null && (window.prevFeature === undefined || window.prevFeature !== feature)) {\r\n\t\trootEl.getElementById(rootEl.querySelectorAll(`[${ATB_DATA_FEATURE_LINK}=\"${feature}\"]`).getAttribute(ATB_DATA_FEATURE_ID)).scrollIntoView();\r\n\t\twindow.prevFeature = feature;\r\n\t}\r\n\r\n\tupdateClassTableLinks();\r\n\r\n  function handleTableGroups(toShow) {\r\n    let listEls = rootEl.querySelectorAll(`[${ATB_DATA_SC_LIST}]`);\r\n    for (let el of listEls) {\r\n      const scs = el.getAttribute(ATB_DATA_SC_LIST).split(ATB_DATA_LIST_SEP);\r\n\r\n      for (let shown of toShow) {\r\n        if (scs.includes(shown)) {\r\n          el.style.display = null;\r\n          break;\r\n        }\r\n          el.style.display = 'none';\r\n        }\r\n      }\r\n\t}\r\n\r\n\tfunction updateClassTableLinks () {\r\n\t\tconst hashParts = curHash.slice(1).split(HASH_PART_SEP);\r\n\t\tconst outParts = [];\r\n\t\tfor (let i = 0; i < hashParts.length; i++) {\r\n\t\t\tconst part = hashParts[i];\r\n\t\t\tif (!part.startsWith(HASH_FEATURE)) outParts.push(part);\r\n\t\t}\r\n\t\tlet els = rootEl.querySelectorAll(`.${CLSS_FEATURE_LINK}`);\r\n\t\tfor (let el of els) {\r\n\t\t\tel.href = HASH_START+outParts.join(HASH_PART_SEP)+HASH_PART_SEP+el.getAttribute(ATB_DATA_FEATURE_LINK);\r\n\t\t}\r\n\t}\r\n}\r\n","import { setRouteSelection } from \"./routing\";\nimport { encodeForHash, parseHTML } from \"../js/utils\";\n\nexport default function renderList(rootEl, items) {\n  const container = rootEl.querySelector('.class-container');\n  container.appendChild(parseHTML(\"<div class='list-container'></div>\"))\n  const listWrapper = container.querySelector('.list-container');\n\n  let htmlString = \"\";\n\tfor (let i = 0; i < items.length; i++) {\n\t\tconst curItem = items[i];\n\t\tlet svg = curItem.name.replace(/(\\s|\\(|\\))/g, \"\");\n\n\t\thtmlString += \n\t\t\t`<div class='list-item history-link grid-item__${svg}'\n\t\t\t\tdata-link='${encodeForHash(curItem.name, curItem.source)}' data-title='${curItem.name}'>\n\t\t\t\t<dnd-svg id='${svg}' default-color class='asdf list-item--image grid-item__${svg}'></dnd-svg>\n\t\t\t\t<span class='list-item--text'>${curItem.name}</span>\n\t\t\t</div>`\n\t}\n\tlet itemElements = parseHTML(htmlString);\n\twhile (itemElements.length > 0) {\n\t\titemElements[0].addEventListener(\"click\", (e) => {\n\t\t\tlet tar = e.target.closest(\".list-item\");\n      setRouteSelection(tar.getAttribute(\"data-link\"));\n    });\n\t\tlistWrapper.appendChild(itemElements[0]);\n\t}\n};"],"sourceRoot":""}